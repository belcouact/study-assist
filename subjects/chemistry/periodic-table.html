<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>元素周期表 - 化学学习助手</title>
    <link rel="icon" href="../../assets/icons/logo_btrfly.ico" type="image/x-icon">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/components.css">
    <link rel="stylesheet" href="../../css/utilities.css">
    <link rel="stylesheet" href="../../css/responsive.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Mobile-first responsive design for periodic table */
        .periodic-table-container {
            padding: 2rem 0;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
        }

        .controls-panel {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .search-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .search-input {
            padding: 0.8rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            width: 100%;
        }

        .search-input:focus {
            outline: none;
            border-color: #dc3545;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
        }

        .view-modes {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .mode-btn {
            padding: 0.6rem 1rem;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
            min-width: 48px;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mode-btn.active {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .mode-btn:hover {
            background: #f8f9fa;
            border-color: #dc3545;
        }

        .mode-btn.active:hover {
            background: #c82333;
        }

        .periodic-table {
            display: grid;
            grid-template-columns: repeat(18, 1fr);
            gap: 2px;
            background: white;
            padding: 1rem;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
            min-width: 100%;
        }

        .element {
            aspect-ratio: 1;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            min-width: 40px;
            min-height: 40px;
            font-size: 0.7rem;
            padding: 2px;
        }

        .element:hover {
            transform: scale(1.1);
            z-index: 10;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .element.selected {
            border: 3px solid #dc3545;
            box-shadow: 0 0 0 2px rgba(220, 53, 69, 0.2);
        }

        .element-number {
            font-size: 0.6rem;
            font-weight: 600;
            line-height: 1;
        }

        .element-symbol {
            font-size: 0.8rem;
            font-weight: 700;
            line-height: 1;
            margin: 1px 0;
        }

        .element-name {
            font-size: 0.5rem;
            line-height: 1;
            text-align: center;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            width: 100%;
        }

        .element-mass {
            font-size: 0.5rem;
            line-height: 1;
        }

        /* Element categories */
        .alkali-metal { background: #ff6b6b; color: white; }
        .alkaline-earth { background: #feca57; color: white; }
        .transition-metal { background: #48dbfb; color: white; }
        .post-transition { background: #0abde3; color: white; }
        .metalloid { background: #00d2d3; color: white; }
        .nonmetal { background: #ff9ff3; color: white; }
        .halogen { background: #54a0ff; color: white; }
        .noble-gas { background: #5f27cd; color: white; }
        .lanthanide { background: #00d8d6; color: white; }
        .actinide { background: #ff3838; color: white; }

        .element-info-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            display: none;
        }

        .element-info-panel.show {
            display: block;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }

        .overlay.show {
            display: block;
        }

        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: #f0f0f0;
        }

        .element-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .element-symbol-large {
            font-size: 4rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .element-name-large {
            font-size: 1.5rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .element-number-large {
            font-size: 1.2rem;
            color: #999;
        }

        .element-properties {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .property-group {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 10px;
        }

        .property-group h4 {
            margin-bottom: 0.5rem;
            color: #dc3545;
            font-weight: 600;
        }

        .property-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.3rem;
            font-size: 0.9rem;
        }

        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.5rem;
            margin-top: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        /* Tablet styles */
        @media (min-width: 768px) {
            .periodic-table-container {
                padding: 3rem 0;
            }

            .controls-panel {
                padding: 2rem;
            }

            .search-container {
                flex-direction: row;
                align-items: center;
            }

            .search-input {
                max-width: 300px;
            }

            .element {
                min-width: 50px;
                min-height: 50px;
                font-size: 0.8rem;
            }

            .element-symbol {
                font-size: 1rem;
            }

            .element-name {
                font-size: 0.6rem;
            }

            .element-info-panel {
                max-width: 600px;
                padding: 3rem;
            }
        }

        /* Desktop styles */
        @media (min-width: 1024px) {
            .periodic-table {
                padding: 2rem;
                gap: 3px;
            }
            
            .element {
                min-width: 60px;
                min-height: 60px;
                font-size: 0.9rem;
                padding: 4px;
            }

            .element-number {
                font-size: 0.7rem;
            }
            
            .element-symbol {
                font-size: 1.2rem;
            }

            .element-name {
                font-size: 0.7rem;
            }

            .element-mass {
                font-size: 0.6rem;
            }

            .mode-btn {
                min-width: auto;
                padding: 0.8rem 1.2rem;
            }

            .legend {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        /* Large desktop styles */
        @media (min-width: 1440px) {
            .element {
                min-width: 70px;
                min-height: 70px;
                font-size: 1rem;
            }

            .element-symbol {
                font-size: 1.4rem;
            }

            .element-name {
                font-size: 0.8rem;
            }
        }

        .electron-config {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 0.5rem;
            border-radius: 5px;
            margin-top: 0.5rem;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 1rem;
            overflow-x: auto;
        }

        .tab {
            padding: 0.8rem 1.2rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 48px;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tab.active {
            border-bottom-color: #dc3545;
            color: #dc3545;
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="../../index.html">
                        <i class="fas fa-graduation-cap" style="background: linear-gradient(90deg, #4361ee, #7209b7); -webkit-background-clip: text; background-clip: text; color: transparent;"></i>
                        <span>Alex的学习助手</span>
                    </a>
                </div>
                <nav class="main-nav">
                    <ul>
                        <li><a href="../../index.html">首页</a></li>
                        <li><a href="main.html">化学</a></li>
                        <li><a href="../../tts.html">语音</a></li>
                        <li><a href="../../draw.html">绘图</a></li>
                    </ul>
                </nav>
                <button class="mobile-menu-toggle" aria-label="切换菜单">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <main>
        <section class="subject-hero">
        <div class="container">
                <div class="subject-hero-content">
                    <h1>元素<span class="gradient-text">周期表</span></h1>
                    <p class="subject-description">探索118个化学元素的性质、结构和周期性规律。点击元素查看详细信息，使用不同视图模式学习元素分类。</p>
                </div>
            </div>
        </section>

        <section class="periodic-table-container">
            <div class="container">
                <div class="controls-panel">
                    <div class="search-container">
                        <input type="text" class="search-input" placeholder="搜索元素（名称、符号或原子序数）" id="elementSearch">
                        <button class="btn btn-primary" onclick="clearSearch()">
                            <i class="fas fa-times"></i> 清除
                        </button>
                    </div>
                    
                    <div class="view-modes">
                        <button class="mode-btn active" data-mode="category" title="按类别显示">
                            <i class="fas fa-layer-group"></i>
                            <span class="mode-text">类别</span>
                        </button>
                        <button class="mode-btn" data-mode="state" title="按物态显示">
                            <i class="fas fa-thermometer-half"></i>
                            <span class="mode-text">物态</span>
                        </button>
                        <button class="mode-btn" data-mode="electronegativity" title="按电负性显示">
                            <i class="fas fa-magnet"></i>
                            <span class="mode-text">电负性</span>
                        </button>
                        <button class="mode-btn" data-mode="radius" title="按原子半径显示">
                            <i class="fas fa-circle"></i>
                            <span class="mode-text">半径</span>
                        </button>
                        </div>
                    </div>

                <div class="periodic-table" id="periodicTable">
                    <!-- Elements will be generated by JavaScript -->
                </div>

                <div class="legend" id="legend">
                    <!-- Legend will be generated by JavaScript -->
                            </div>
                            </div>
        </section>
    </main>

    <!-- Element Info Panel -->
    <div class="overlay" id="overlay"></div>
    <div class="element-info-panel" id="elementInfoPanel">
        <button class="close-btn" onclick="closeElementInfo()">
            <i class="fas fa-times"></i>
        </button>
        
        <div class="element-header">
            <div class="element-symbol-large" id="elementSymbolLarge"></div>
            <div class="element-name-large" id="elementNameLarge"></div>
            <div class="element-number-large" id="elementNumberLarge"></div>
                            </div>

        <div class="tabs">
            <div class="tab active" data-tab="basic">基本信息</div>
            <div class="tab" data-tab="physical">物理性质</div>
            <div class="tab" data-tab="atomic">原子结构</div>
            <div class="tab" data-tab="chemical">化学性质</div>
                            </div>

        <div class="tab-content active" id="basic">
            <div class="element-properties" id="basicProperties">
                <!-- Basic properties will be populated by JavaScript -->
                            </div>
                            </div>

        <div class="tab-content" id="physical">
            <div class="element-properties" id="physicalProperties">
                <!-- Physical properties will be populated by JavaScript -->
                            </div>
                        </div>
                        
        <div class="tab-content" id="atomic">
            <div class="element-properties" id="atomicProperties">
                <!-- Atomic properties will be populated by JavaScript -->
                        </div>
                    </div>
                    
        <div class="tab-content" id="chemical">
            <div class="element-properties" id="chemicalProperties">
                <!-- Chemical properties will be populated by JavaScript -->
                    </div>
                </div>
            </div>

    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <p class="copyright-text">study-llm.me域名为Alex所有。保留所有权利。</p>
                <div class="profile-section">
                    <button id="profile-button" class="profile-button">
                        <i class="fas fa-user-circle"></i>
                        学习阶段
                    </button>
                    <div id="profile-display" class="profile-display"></div>
                </div>
            </div>
        </div>
    </footer>

    <script src="../../js/common.js"></script>
    <script src="../../js/navigation.js"></script>
    <script src="../../js/profile.js"></script>
    <script>
        // Comprehensive element data
        const elements = [
            {
                number: 1, symbol: 'H', name: '氢', mass: 1.008, category: 'nonmetal',
                state: 'gas', electronegativity: 2.20, radius: 53,
                electronConfig: '1s¹', oxidationStates: ['-1', '+1'],
                meltingPoint: -259.16, boilingPoint: -252.87, density: 0.00008988,
                discovery: '1766', discoverer: 'Henry Cavendish',
                uses: '燃料电池、氨合成、石油精炼',
                position: { period: 1, group: 1 }
            },
            {
                number: 2, symbol: 'He', name: '氦', mass: 4.003, category: 'noble-gas',
                state: 'gas', electronegativity: null, radius: 31,
                electronConfig: '1s²', oxidationStates: ['0'],
                meltingPoint: -272.20, boilingPoint: -268.93, density: 0.0001785,
                discovery: '1868', discoverer: 'Pierre Janssen',
                uses: '气球充气、低温冷却、呼吸混合气',
                position: { period: 1, group: 18 }
            },
            {
                number: 3, symbol: 'Li', name: '锂', mass: 6.941, category: 'alkali-metal',
                state: 'solid', electronegativity: 0.98, radius: 167,
                electronConfig: '[He] 2s¹', oxidationStates: ['+1'],
                meltingPoint: 180.50, boilingPoint: 1342, density: 0.534,
                discovery: '1817', discoverer: 'Johan August Arfwedson',
                uses: '锂电池、合金、医药',
                position: { period: 2, group: 1 }
            },
            {
                number: 4, symbol: 'Be', name: '铍', mass: 9.012, category: 'alkaline-earth',
                state: 'solid', electronegativity: 1.57, radius: 112,
                electronConfig: '[He] 2s²', oxidationStates: ['+2'],
                meltingPoint: 1287, boilingPoint: 2469, density: 1.85,
                discovery: '1797', discoverer: 'Louis-Nicolas Vauquelin',
                uses: '航空航天合金、X射线窗口',
                position: { period: 2, group: 2 }
            },
            {
                number: 5, symbol: 'B', name: '硼', mass: 10.811, category: 'metalloid',
                state: 'solid', electronegativity: 2.04, radius: 87,
                electronConfig: '[He] 2s² 2p¹', oxidationStates: ['+3'],
                meltingPoint: 2075, boilingPoint: 4000, density: 2.34,
                discovery: '1808', discoverer: 'Joseph Louis Gay-Lussac',
                uses: '玻璃纤维、陶瓷、半导体',
                position: { period: 2, group: 13 }
            },
            {
                number: 6, symbol: 'C', name: '碳', mass: 12.011, category: 'nonmetal',
                state: 'solid', electronegativity: 2.55, radius: 67,
                electronConfig: '[He] 2s² 2p²', oxidationStates: ['-4', '+2', '+4'],
                meltingPoint: 3550, boilingPoint: 4027, density: 2.267,
                discovery: '古代', discoverer: '古代已知',
                uses: '钢铁、钻石、石墨、有机化合物',
                position: { period: 2, group: 14 }
            },
            {
                number: 7, symbol: 'N', name: '氮', mass: 14.007, category: 'nonmetal',
                state: 'gas', electronegativity: 3.04, radius: 56,
                electronConfig: '[He] 2s² 2p³', oxidationStates: ['-3', '+3', '+5'],
                meltingPoint: -210.00, boilingPoint: -195.79, density: 0.0012506,
                discovery: '1772', discoverer: 'Daniel Rutherford',
                uses: '肥料、炸药、液氮冷却',
                position: { period: 2, group: 15 }
            },
            {
                number: 8, symbol: 'O', name: '氧', mass: 15.999, category: 'nonmetal',
                state: 'gas', electronegativity: 3.44, radius: 48,
                electronConfig: '[He] 2s² 2p⁴', oxidationStates: ['-2'],
                meltingPoint: -218.79, boilingPoint: -182.95, density: 0.001429,
                discovery: '1774', discoverer: 'Joseph Priestley',
                uses: '呼吸、燃烧、钢铁生产',
                position: { period: 2, group: 16 }
            },
            {
                number: 9, symbol: 'F', name: '氟', mass: 18.998, category: 'halogen',
                state: 'gas', electronegativity: 3.98, radius: 42,
                electronConfig: '[He] 2s² 2p⁵', oxidationStates: ['-1'],
                meltingPoint: -219.67, boilingPoint: -188.11, density: 0.001696,
                discovery: '1886', discoverer: 'Henri Moissan',
                uses: '牙膏、聚四氟乙烯、制冷剂',
                position: { period: 2, group: 17 }
            },
            {
                number: 10, symbol: 'Ne', name: '氖', mass: 20.180, category: 'noble-gas',
                state: 'gas', electronegativity: null, radius: 38,
                electronConfig: '[He] 2s² 2p⁶', oxidationStates: ['0'],
                meltingPoint: -248.59, boilingPoint: -246.08, density: 0.0008999,
                discovery: '1898', discoverer: 'William Ramsay',
                uses: '霓虹灯、激光器、低温冷却',
                position: { period: 2, group: 18 }
            },
            {
                number: 11, symbol: 'Na', name: '钠', mass: 22.990, category: 'alkali-metal',
                state: 'solid', electronegativity: 0.93, radius: 190,
                electronConfig: '[Ne] 3s¹', oxidationStates: ['+1'],
                meltingPoint: 97.72, boilingPoint: 883, density: 0.971,
                discovery: '1807', discoverer: 'Humphry Davy',
                uses: '食盐、肥皂、钠灯',
                position: { period: 3, group: 1 }
            },
            {
                number: 12, symbol: 'Mg', name: '镁', mass: 24.305, category: 'alkaline-earth',
                state: 'solid', electronegativity: 1.31, radius: 145,
                electronConfig: '[Ne] 3s²', oxidationStates: ['+2'],
                meltingPoint: 650, boilingPoint: 1090, density: 1.738,
                discovery: '1755', discoverer: 'Joseph Black',
                uses: '合金、烟花、医药',
                position: { period: 3, group: 2 }
            },
            {
                number: 13, symbol: 'Al', name: '铝', mass: 26.982, category: 'post-transition',
                state: 'solid', electronegativity: 1.61, radius: 118,
                electronConfig: '[Ne] 3s² 3p¹', oxidationStates: ['+3'],
                meltingPoint: 660.32, boilingPoint: 2519, density: 2.698,
                discovery: '1825', discoverer: 'Hans Christian Ørsted',
                uses: '包装、建筑、交通工具',
                position: { period: 3, group: 13 }
            },
            {
                number: 14, symbol: 'Si', name: '硅', mass: 28.086, category: 'metalloid',
                state: 'solid', electronegativity: 1.90, radius: 111,
                electronConfig: '[Ne] 3s² 3p²', oxidationStates: ['+4', '-4'],
                meltingPoint: 1414, boilingPoint: 3265, density: 2.3296,
                discovery: '1824', discoverer: 'Jöns Jacob Berzelius',
                uses: '半导体、玻璃、陶瓷',
                position: { period: 3, group: 14 }
            },
            {
                number: 15, symbol: 'P', name: '磷', mass: 30.974, category: 'nonmetal',
                state: 'solid', electronegativity: 2.19, radius: 98,
                electronConfig: '[Ne] 3s² 3p³', oxidationStates: ['+3', '+5', '-3'],
                meltingPoint: 44.15, boilingPoint: 280.5, density: 1.82,
                discovery: '1669', discoverer: 'Hennig Brand',
                uses: '肥料、火柴、洗涤剂',
                position: { period: 3, group: 15 }
            },
            {
                number: 16, symbol: 'S', name: '硫', mass: 32.065, category: 'nonmetal',
                state: 'solid', electronegativity: 2.58, radius: 88,
                electronConfig: '[Ne] 3s² 3p⁴', oxidationStates: ['+6', '+4', '-2'],
                meltingPoint: 115.21, boilingPoint: 444.61, density: 2.067,
                discovery: '古代', discoverer: '古代已知',
                uses: '硫酸、橡胶、火药',
                position: { period: 3, group: 16 }
            },
            {
                number: 17, symbol: 'Cl', name: '氯', mass: 35.453, category: 'halogen',
                state: 'gas', electronegativity: 3.16, radius: 79,
                electronConfig: '[Ne] 3s² 3p⁵', oxidationStates: ['+7', '+5', '+3', '+1', '-1'],
                meltingPoint: -101.5, boilingPoint: -34.04, density: 0.003214,
                discovery: '1774', discoverer: 'Carl Wilhelm Scheele',
                uses: '消毒剂、PVC、漂白剂',
                position: { period: 3, group: 17 }
            },
            {
                number: 18, symbol: 'Ar', name: '氩', mass: 39.948, category: 'noble-gas',
                state: 'gas', electronegativity: null, radius: 71,
                electronConfig: '[Ne] 3s² 3p⁶', oxidationStates: ['0'],
                meltingPoint: -189.35, boilingPoint: -185.85, density: 0.0017837,
                discovery: '1894', discoverer: 'Lord Rayleigh',
                uses: '焊接保护气、白炽灯泡',
                position: { period: 3, group: 18 }
            },
            {
                number: 19, symbol: 'K', name: '钾', mass: 39.098, category: 'alkali-metal',
                state: 'solid', electronegativity: 0.82, radius: 243,
                electronConfig: '[Ar] 4s¹', oxidationStates: ['+1'],
                meltingPoint: 63.5, boilingPoint: 759, density: 0.862,
                discovery: '1807', discoverer: 'Humphry Davy',
                uses: '肥料、肥皂、玻璃',
                position: { period: 4, group: 1 }
            },
            {
                number: 20, symbol: 'Ca', name: '钙', mass: 40.078, category: 'alkaline-earth',
                state: 'solid', electronegativity: 1.00, radius: 194,
                electronConfig: '[Ar] 4s²', oxidationStates: ['+2'],
                meltingPoint: 842, boilingPoint: 1484, density: 1.54,
                discovery: '1808', discoverer: 'Humphry Davy',
                uses: '水泥、石膏、骨骼',
                position: { period: 4, group: 2 }
            }
            // Add more elements as needed...
        ];

        // Current view mode
        let currentMode = 'category';
        let selectedElement = null;

        // Initialize the periodic table
        function initPeriodicTable() {
            generatePeriodicTable();
            generateLegend();
            setupEventListeners();
        }

        // Generate the periodic table grid
        function generatePeriodicTable() {
            const table = document.getElementById('periodicTable');
                table.innerHTML = '';

            // Create 18x7 grid (periods x groups)
            for (let period = 1; period <= 7; period++) {
                for (let group = 1; group <= 18; group++) {
                    const element = elements.find(el => 
                        el.position && el.position.period === period && el.position.group === group
                    );

                    const cell = document.createElement('div');
                    cell.className = 'element';
                    cell.style.gridColumn = group;
                    cell.style.gridRow = period;
                    
                    if (element) {
                        cell.innerHTML = `
                            <div class="element-number">${element.number}</div>
                            <div class="element-symbol">${element.symbol}</div>
                            <div class="element-name">${element.name}</div>
                            <div class="element-mass">${element.mass}</div>
                        `;
                        cell.dataset.element = element.number;
                        cell.addEventListener('click', () => showElementInfo(element));
                        updateElementColor(cell, element);
                    } else {
                        cell.style.visibility = 'hidden';
                    }

                    table.appendChild(cell);
                }
            }
        }

        // Update element color based on current mode
        function updateElementColor(cell, element) {
            // Remove all category classes
            cell.className = 'element';
            
            switch (currentMode) {
                case 'category':
                    cell.classList.add(element.category);
                    break;
                case 'state':
                    if (element.state === 'gas') cell.style.backgroundColor = '#ff6b6b';
                    else if (element.state === 'liquid') cell.style.backgroundColor = '#4ecdc4';
                    else cell.style.backgroundColor = '#45b7d1';
                    cell.style.color = 'white';
                    break;
                case 'electronegativity':
                    if (element.electronegativity) {
                        const intensity = Math.min(element.electronegativity / 4, 1);
                        cell.style.backgroundColor = `rgba(220, 53, 69, ${intensity})`;
                        cell.style.color = intensity > 0.5 ? 'white' : 'black';
                    } else {
                        cell.style.backgroundColor = '#e9ecef';
                        cell.style.color = 'black';
                    }
                    break;
                case 'radius':
                    if (element.radius) {
                        const intensity = Math.min(element.radius / 300, 1);
                        cell.style.backgroundColor = `rgba(72, 219, 251, ${intensity})`;
                        cell.style.color = intensity > 0.5 ? 'white' : 'black';
                    } else {
                        cell.style.backgroundColor = '#e9ecef';
                        cell.style.color = 'black';
                    }
                    break;
            }
        }

        // Generate legend
        function generateLegend() {
            const legend = document.getElementById('legend');
            legend.innerHTML = '';

            let legendItems = [];

            switch (currentMode) {
                case 'category':
                    legendItems = [
                        { color: '#ff6b6b', label: '碱金属' },
                        { color: '#feca57', label: '碱土金属' },
                        { color: '#48dbfb', label: '过渡金属' },
                        { color: '#0abde3', label: '后过渡金属' },
                        { color: '#00d2d3', label: '类金属' },
                        { color: '#ff9ff3', label: '非金属' },
                        { color: '#54a0ff', label: '卤素' },
                        { color: '#5f27cd', label: '稀有气体' },
                        { color: '#00d8d6', label: '镧系元素' },
                        { color: '#ff3838', label: '锕系元素' }
                    ];
                    break;
                case 'state':
                    legendItems = [
                        { color: '#ff6b6b', label: '气体' },
                        { color: '#4ecdc4', label: '液体' },
                        { color: '#45b7d1', label: '固体' }
                    ];
                    break;
                case 'electronegativity':
                    legendItems = [
                        { color: 'rgba(220, 53, 69, 0.2)', label: '低电负性' },
                        { color: 'rgba(220, 53, 69, 0.6)', label: '中等电负性' },
                        { color: 'rgba(220, 53, 69, 1)', label: '高电负性' }
                    ];
                    break;
                case 'radius':
                    legendItems = [
                        { color: 'rgba(72, 219, 251, 0.2)', label: '小原子半径' },
                        { color: 'rgba(72, 219, 251, 0.6)', label: '中等原子半径' },
                        { color: 'rgba(72, 219, 251, 1)', label: '大原子半径' }
                    ];
                    break;
            }

            legendItems.forEach(item => {
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                legendItem.innerHTML = `
                    <div class="legend-color" style="background-color: ${item.color}"></div>
                    <span>${item.label}</span>
                `;
                legend.appendChild(legendItem);
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Mode buttons
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentMode = btn.dataset.mode;
                    generatePeriodicTable();
                    generateLegend();
                });
            });

            // Search functionality
            document.getElementById('elementSearch').addEventListener('input', handleSearch);

            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.dataset.tab;
                    switchTab(tabName);
                });
            });

            // Close panel when clicking overlay
            document.getElementById('overlay').addEventListener('click', closeElementInfo);
        }

        // Handle search
        function handleSearch(e) {
            const query = e.target.value.toLowerCase();
            const elementCells = document.querySelectorAll('.element[data-element]');

            elementCells.forEach(cell => {
                const elementNum = parseInt(cell.dataset.element);
                const element = elements.find(el => el.number === elementNum);
                
                if (element) {
                    const matches = 
                        element.name.toLowerCase().includes(query) ||
                        element.symbol.toLowerCase().includes(query) ||
                        element.number.toString().includes(query);
                    
                    cell.style.opacity = matches || query === '' ? '1' : '0.3';
                    cell.style.transform = matches && query !== '' ? 'scale(1.1)' : 'scale(1)';
                }
            });
        }

        // Clear search
        function clearSearch() {
            document.getElementById('elementSearch').value = '';
            document.querySelectorAll('.element[data-element]').forEach(cell => {
                cell.style.opacity = '1';
                cell.style.transform = 'scale(1)';
            });
        }

        // Show element information
        function showElementInfo(element) {
            selectedElement = element;
            
            // Update header
            document.getElementById('elementSymbolLarge').textContent = element.symbol;
            document.getElementById('elementSymbolLarge').className = `element-symbol-large ${element.category}`;
            document.getElementById('elementNameLarge').textContent = element.name;
            document.getElementById('elementNumberLarge').textContent = `原子序数: ${element.number}`;

            // Update properties
            updateElementProperties(element);

            // Show panel
            document.getElementById('overlay').classList.add('show');
            document.getElementById('elementInfoPanel').classList.add('show');
        }

        // Update element properties
        function updateElementProperties(element) {
            // Basic properties
            const basicProps = document.getElementById('basicProperties');
            basicProps.innerHTML = `
                <div class="property-group">
                    <h4>基本信息</h4>
                    <div class="property-item">
                        <span>原子序数:</span>
                        <span>${element.number}</span>
                        </div>
                    <div class="property-item">
                        <span>元素符号:</span>
                        <span>${element.symbol}</span>
                        </div>
                    <div class="property-item">
                        <span>中文名称:</span>
                        <span>${element.name}</span>
                        </div>
                    <div class="property-item">
                        <span>原子质量:</span>
                        <span>${element.mass} u</span>
                        </div>
                    <div class="property-item">
                        <span>元素类别:</span>
                        <span>${getCategoryName(element.category)}</span>
                        </div>
                    </div>
                <div class="property-group">
                    <h4>发现信息</h4>
                    <div class="property-item">
                        <span>发现年份:</span>
                        <span>${element.discovery}</span>
                    </div>
                    <div class="property-item">
                        <span>发现者:</span>
                        <span>${element.discoverer}</span>
                    </div>
                    <div class="property-item">
                        <span>主要用途:</span>
                        <span>${element.uses}</span>
                    </div>
                </div>
            `;

            // Physical properties
            const physicalProps = document.getElementById('physicalProperties');
            physicalProps.innerHTML = `
                <div class="property-group">
                    <h4>物理状态</h4>
                    <div class="property-item">
                        <span>常温状态:</span>
                        <span>${getStateName(element.state)}</span>
                    </div>
                    <div class="property-item">
                        <span>熔点:</span>
                        <span>${element.meltingPoint}°C</span>
                    </div>
                    <div class="property-item">
                        <span>沸点:</span>
                        <span>${element.boilingPoint}°C</span>
                    </div>
                    <div class="property-item">
                        <span>密度:</span>
                        <span>${element.density} g/cm³</span>
                    </div>
                </div>
                <div class="property-group">
                    <h4>原子性质</h4>
                    <div class="property-item">
                        <span>原子半径:</span>
                        <span>${element.radius} pm</span>
                    </div>
                    <div class="property-item">
                        <span>电负性:</span>
                        <span>${element.electronegativity || '未知'}</span>
                    </div>
                </div>
            `;

            // Atomic properties
            const atomicProps = document.getElementById('atomicProperties');
            atomicProps.innerHTML = `
                <div class="property-group">
                    <h4>电子结构</h4>
                    <div class="property-item">
                        <span>电子排布:</span>
                        <span class="electron-config">${element.electronConfig}</span>
                    </div>
                    <div class="property-item">
                        <span>周期:</span>
                        <span>${element.position?.period || '未知'}</span>
                    </div>
                    <div class="property-item">
                        <span>族:</span>
                        <span>${element.position?.group || '未知'}</span>
                    </div>
                    </div>
                `;

            // Chemical properties
            const chemicalProps = document.getElementById('chemicalProperties');
            chemicalProps.innerHTML = `
                <div class="property-group">
                    <h4>化学性质</h4>
                    <div class="property-item">
                        <span>氧化态:</span>
                        <span>${element.oxidationStates.join(', ')}</span>
                    </div>
                    <div class="property-item">
                        <span>化学活性:</span>
                        <span>${getActivityLevel(element.category)}</span>
                    </div>
                </div>
            `;
        }

        // Helper functions
        function getCategoryName(category) {
                const names = {
                    'alkali-metal': '碱金属',
                    'alkaline-earth': '碱土金属',
                    'transition-metal': '过渡金属',
                    'post-transition': '后过渡金属',
                    'metalloid': '类金属',
                    'nonmetal': '非金属',
                    'halogen': '卤素',
                'noble-gas': '稀有气体',
                    'lanthanide': '镧系元素',
                    'actinide': '锕系元素'
                };
                return names[category] || category;
            }

        function getStateName(state) {
            const names = {
                'solid': '固体',
                'liquid': '液体',
                'gas': '气体'
            };
            return names[state] || state;
        }

        function getActivityLevel(category) {
            const levels = {
                'alkali-metal': '极活泼',
                'alkaline-earth': '活泼',
                'transition-metal': '中等活泼',
                'post-transition': '较活泼',
                'metalloid': '中等',
                'nonmetal': '变化很大',
                'halogen': '活泼',
                'noble-gas': '极不活泼',
                'lanthanide': '活泼',
                'actinide': '活泼'
            };
            return levels[category] || '未知';
        }

        // Switch tabs
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // Close element info
        function closeElementInfo() {
            document.getElementById('overlay').classList.remove('show');
            document.getElementById('elementInfoPanel').classList.remove('show');
            
            // Remove selection highlight
            if (selectedElement) {
                const cell = document.querySelector(`[data-element="${selectedElement.number}"]`);
                if (cell) {
                    cell.classList.remove('selected');
                }
                selectedElement = null;
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initPeriodicTable);
    </script>
</body>
</html> 