<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>化学能力测试 - 化学学习助手</title>
    <link rel="icon" href="../../assets/icons/logo_btrfly.ico" type="image/x-icon">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/components.css">
    <link rel="stylesheet" href="../../css/utilities.css">
    <link rel="stylesheet" href="../../css/responsive.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        .testing-hero {
            background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%);
            color: white;
            padding: 4rem 0;
            text-align: center;
        }

        .testing-hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .testing-hero p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto 2rem auto;
        }

        .test-guide {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .guide-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .guide-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }

        .guide-icon {
            font-size: 2.5rem;
            color: #FFC107;
            margin-bottom: 1rem;
        }

        .guide-card h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: white;
        }

        .guide-card p {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        .guide-topics {
            font-size: 0.9rem;
            opacity: 0.8;
            line-height: 1.4;
        }

        .testing-tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin: 2rem 0;
            overflow: hidden;
            flex-wrap: wrap;
        }

        .testing-tab {
            flex: 1;
            min-width: 150px;
            padding: 1rem 2rem;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .testing-tab.active {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            color: white;
        }

        .testing-tab:hover:not(.active) {
            background: #e9ecef;
        }

        .testing-content {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .testing-panel {
            display: none;
        }

        .testing-panel.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .test-type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .test-type-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            text-align: center;
        }

        .test-type-card:hover {
            background: #e9ecef;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .test-type-card.selected {
            border-color: #4CAF50;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(139, 195, 74, 0.1));
        }

        .test-type-card h3 {
            color: #4CAF50;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .learning-objectives {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.05), rgba(139, 195, 74, 0.05));
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(76, 175, 80, 0.1);
        }

        .learning-objectives h4 {
            color: #4CAF50;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.1rem;
        }

        .objectives-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .objective-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .test-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .control-group label {
            font-weight: 500;
            color: #333;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-group select {
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            transition: border-color 0.3s ease;
        }

        .control-group select:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
        }

        .start-test-btn {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .start-test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
        }

        .start-test-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .test-container {
            display: none;
            margin-top: 2rem;
            padding: 2rem;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .test-question {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #4CAF50;
        }

        .question-text {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 1rem;
            color: #333;
            line-height: 1.6;
        }

        .options-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .option-item {
            padding: 1rem;
            margin: 0.5rem 0;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .option-item:hover {
            background: #f8f9fa;
            border-color: #4CAF50;
        }

        .option-item.selected {
            background: rgba(76, 175, 80, 0.1);
            border-color: #4CAF50;
            color: #2E7D32;
        }

        .result-summary {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(139, 195, 74, 0.1));
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .score-display {
            font-size: 4rem;
            font-weight: 700;
            color: #4CAF50;
            margin-bottom: 1rem;
        }

        .level-badge {
            display: inline-block;
            padding: 0.5rem 1.5rem;
            background: #4CAF50;
            color: white;
            border-radius: 25px;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .learning-suggestion {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            margin-top: 1.5rem;
            text-align: left;
        }

        .question-result {
            margin-bottom: 2rem;
            padding: 1.5rem;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .question-result.correct {
            background: rgba(76, 175, 80, 0.05);
            border-color: #4CAF50;
        }

        .question-result.incorrect {
            background: rgba(244, 67, 54, 0.05);
            border-color: #f44336;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .question-number {
            font-weight: 600;
            color: #333;
        }

        .question-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
        }

        .question-status.correct {
            color: #4CAF50;
        }

        .question-status.incorrect {
            color: #f44336;
        }

        .original-question {
            font-weight: 500;
            margin-bottom: 1rem;
            color: #333;
        }

        .answer-analysis {
            margin: 1rem 0;
        }

        .user-answer, .correct-answer {
            margin: 0.5rem 0;
            padding: 0.75rem;
            border-radius: 8px;
        }

        .user-answer.correct {
            background: rgba(76, 175, 80, 0.1);
            border-left: 4px solid #4CAF50;
        }

        .user-answer.incorrect {
            background: rgba(244, 67, 54, 0.1);
            border-left: 4px solid #f44336;
        }

        .correct-answer {
            background: rgba(76, 175, 80, 0.1);
            border-left: 4px solid #4CAF50;
        }

        .explanation-content {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1rem;
        }

        .explanation-text {
            line-height: 1.6;
            color: #555;
            margin-top: 0.5rem;
        }

        .result-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .testing-hero h1 {
                font-size: 2rem;
            }
            
            .testing-hero p {
                font-size: 1rem;
            }
            
            .test-guide {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .guide-card {
                padding: 1.5rem;
            }
            
            .testing-tabs {
                flex-direction: column;
            }

            .testing-tab {
                min-width: auto;
            }

            .test-controls {
                grid-template-columns: 1fr;
            }
            
            .score-display {
                font-size: 3rem;
            }
            
            .result-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .testing-hero {
                padding: 2rem 0;
            }
            
            .testing-content {
                padding: 1rem;
            }
            
            .test-container {
                padding: 1rem;
            }
            
            .question-text {
                font-size: 1rem;
            }
            
            .option-item {
                padding: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="../../index.html">
                        <i class="fas fa-graduation-cap" style="background: linear-gradient(90deg, #4361ee, #7209b7); -webkit-background-clip: text; background-clip: text; color: transparent;"></i>
                        <span>Alex的学习助手</span>
                    </a>
                </div>
                <nav class="main-nav">
                    <ul>
                        <li><a href="../../index.html">首页</a></li>
                        <li><a href="../../index.html#subjects">科目</a></li>
                        <li><a href="../../textbook.html">电子课本</a></li>
                        <li><a href="../../tts.html">语音</a></li>
                        <li><a href="../../draw.html">绘图</a></li>
                    </ul>
                </nav>
                <button class="mobile-menu-toggle" aria-label="切换菜单">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- 英雄区域 -->
        <section class="testing-hero">
            <h1><i class="fas fa-flask"></i> 化学能力测试</h1>
            <p>智能生成个性化化学测试题目，全面评估您的化学知识掌握情况</p>
                
                <div class="test-guide">
                    <div class="guide-card">
                    <div class="guide-icon">🧪</div>
                        <h3>初中化学</h3>
                    <p>基础化学概念与实验</p>
                    <div class="guide-topics">
                        化学反应、元素化合物、酸碱盐、金属非金属
                    </div>
                </div>
                
                    <div class="guide-card">
                    <div class="guide-icon">⚛️</div>
                        <h3>高中化学</h3>
                    <p>深入化学原理与应用</p>
                    <div class="guide-topics">
                        原子结构、化学键、热化学、电化学、有机化学
                    </div>
                </div>
            </div>
        </section>

        <!-- 测试标签页 -->
                <div class="testing-tabs">
            <button class="testing-tab active" data-tab="inorganic">
                <i class="fas fa-atom"></i> 无机化学
                    </button>
            <button class="testing-tab" data-tab="organic">
                <i class="fas fa-dna"></i> 有机化学
                    </button>
            <button class="testing-tab" data-tab="analytical">
                <i class="fas fa-search"></i> 分析化学
                    </button>
            <button class="testing-tab" data-tab="physical">
                <i class="fas fa-thermometer-half"></i> 物理化学
                    </button>
            <button class="testing-tab" data-tab="comprehensive">
                <i class="fas fa-graduation-cap"></i> 综合测试
                    </button>
                </div>
                
        <!-- 测试内容 -->
                <div class="testing-content">
            <!-- 无机化学测试 -->
            <div class="testing-panel active" id="inorganic">
                        <div class="learning-objectives">
                    <h4><i class="fas fa-target"></i> 无机化学学习目标</h4>
                            <div class="objectives-grid">
                                <div class="objective-item">
                            <strong>元素化合物：</strong>掌握常见元素及其化合物的性质和反应
                                </div>
                                <div class="objective-item">
                            <strong>化学反应：</strong>理解化学反应原理和反应类型
                                </div>
                        <div class="objective-item">
                            <strong>酸碱盐：</strong>掌握酸碱盐的性质和相互转化
                        </div>
                        <div class="objective-item">
                            <strong>氧化还原：</strong>理解氧化还原反应的本质和应用
                        </div>
                            </div>
                        </div>
                        
                        <div class="test-type-grid">
                    <div class="test-type-card" data-type="basic-concepts">
                        <h3><i class="fas fa-book"></i> 基础概念</h3>
                        <p>化学基本概念、原子分子理论、化学计量</p>
                                </div>
                    <div class="test-type-card" data-type="elements">
                        <h3><i class="fas fa-table"></i> 元素化合物</h3>
                        <p>金属非金属、酸碱盐、常见化合物性质</p>
                                </div>
                    <div class="test-type-card" data-type="reactions">
                        <h3><i class="fas fa-flask"></i> 化学反应</h3>
                        <p>反应类型、化学方程式、反应条件</p>
                                </div>
                    <div class="test-type-card" data-type="redox">
                        <h3><i class="fas fa-exchange-alt"></i> 氧化还原</h3>
                        <p>氧化还原反应、电子转移、电化学</p>
                                </div>
                                </div>

                <div class="test-controls">
                    <div class="control-group">
                        <label for="inorganic-level">
                            <i class="fas fa-graduation-cap"></i> 学校类型
                        </label>
                        <select id="inorganic-level">
                            <option value="middle">初中</option>
                            <option value="high">高中</option>
                        </select>
                                </div>
                    <div class="control-group">
                        <label for="inorganic-grade">
                            <i class="fas fa-layer-group"></i> 年级学期
                        </label>
                        <select id="inorganic-grade">
                            <option value="grade9-1">九年级上学期</option>
                            <option value="grade9-2">九年级下学期</option>
                            <option value="grade10-1">高一上学期</option>
                            <option value="grade10-2">高一下学期</option>
                            <option value="grade11-1">高二上学期</option>
                            <option value="grade11-2">高二下学期</option>
                            <option value="grade12-1">高三上学期</option>
                            <option value="grade12-2">高三下学期</option>
                        </select>
                                </div>
                    <div class="control-group">
                        <label for="inorganic-difficulty">
                            <i class="fas fa-chart-line"></i> 难度等级
                        </label>
                        <select id="inorganic-difficulty">
                            <option value="basic">基础</option>
                            <option value="medium">中等</option>
                            <option value="hard">困难</option>
                            <option value="competition">竞赛</option>
                        </select>
                            </div>
                    <div class="control-group">
                        <label for="inorganic-count">
                            <i class="fas fa-list-ol"></i> 题目数量
                        </label>
                        <select id="inorganic-count">
                            <option value="5">5题</option>
                            <option value="10">10题</option>
                            <option value="15">15题</option>
                            <option value="20">20题</option>
                        </select>
                                </div>
                            </div>

                <button class="start-test-btn" id="start-inorganic-test">
                    <i class="fas fa-play"></i> 开始无机化学测试
                </button>

                <div class="test-container" id="inorganic-test-container"></div>
                                </div>

            <!-- 有机化学测试 -->
            <div class="testing-panel" id="organic">
                <div class="learning-objectives">
                    <h4><i class="fas fa-target"></i> 有机化学学习目标</h4>
                    <div class="objectives-grid">
                        <div class="objective-item">
                            <strong>有机物结构：</strong>掌握有机化合物的结构特点和命名
                        </div>
                        <div class="objective-item">
                            <strong>官能团性质：</strong>理解各类官能团的性质和反应
                        </div>
                        <div class="objective-item">
                            <strong>有机反应：</strong>掌握有机反应机理和反应类型
                        </div>
                        <div class="objective-item">
                            <strong>合成路线：</strong>设计简单的有机合成路线
                        </div>
                            </div>
                        </div>
                        
                <div class="test-type-grid">
                    <div class="test-type-card" data-type="hydrocarbons">
                        <h3><i class="fas fa-oil-can"></i> 烃类化合物</h3>
                        <p>烷烃、烯烃、炔烃、芳香烃的性质和反应</p>
                    </div>
                    <div class="test-type-card" data-type="functional-groups">
                        <h3><i class="fas fa-puzzle-piece"></i> 官能团</h3>
                        <p>醇、酚、醛、酮、羧酸、酯的性质</p>
                    </div>
                    <div class="test-type-card" data-type="organic-reactions">
                        <h3><i class="fas fa-random"></i> 有机反应</h3>
                        <p>取代、加成、消去、氧化还原反应</p>
                    </div>
                    <div class="test-type-card" data-type="synthesis">
                        <h3><i class="fas fa-route"></i> 合成路线</h3>
                        <p>有机合成设计、逆合成分析</p>
                    </div>
                </div>

                <div class="test-controls">
                    <div class="control-group">
                        <label for="organic-level">
                            <i class="fas fa-graduation-cap"></i> 学校类型
                        </label>
                        <select id="organic-level">
                                <option value="middle">初中</option>
                            <option value="high">高中</option>
                            </select>
                            </div>
                    <div class="control-group">
                        <label for="organic-grade">
                            <i class="fas fa-layer-group"></i> 年级学期
                        </label>
                        <select id="organic-grade">
                            <option value="grade9-1">九年级上学期</option>
                            <option value="grade9-2">九年级下学期</option>
                            <option value="grade10-1">高一上学期</option>
                            <option value="grade10-2">高一下学期</option>
                            <option value="grade11-1">高二上学期</option>
                            <option value="grade11-2">高二下学期</option>
                            <option value="grade12-1">高三上学期</option>
                            <option value="grade12-2">高三下学期</option>
                            </select>
                        </div>
                    <div class="control-group">
                        <label for="organic-difficulty">
                            <i class="fas fa-chart-line"></i> 难度等级
                        </label>
                        <select id="organic-difficulty">
                            <option value="basic">基础</option>
                            <option value="medium">中等</option>
                            <option value="hard">困难</option>
                            <option value="competition">竞赛</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="organic-count">
                            <i class="fas fa-list-ol"></i> 题目数量
                        </label>
                        <select id="organic-count">
                                <option value="5">5题</option>
                            <option value="10">10题</option>
                                <option value="15">15题</option>
                                <option value="20">20题</option>
                            </select>
                    </div>
                        </div>
                        
                <button class="start-test-btn" id="start-organic-test">
                    <i class="fas fa-play"></i> 开始有机化学测试
                            </button>
                        
                <div class="test-container" id="organic-test-container"></div>
                    </div>

            <!-- 分析化学测试 -->
            <div class="testing-panel" id="analytical">
                        <div class="learning-objectives">
                    <h4><i class="fas fa-target"></i> 分析化学学习目标</h4>
                            <div class="objectives-grid">
                                <div class="objective-item">
                            <strong>定性分析：</strong>掌握离子检验和物质鉴定方法
                                </div>
                                <div class="objective-item">
                            <strong>定量分析：</strong>理解滴定分析和重量分析
                                </div>
                        <div class="objective-item">
                            <strong>仪器分析：</strong>了解现代分析仪器的原理
                        </div>
                        <div class="objective-item">
                            <strong>误差分析：</strong>掌握分析结果的处理和评价
                        </div>
                        </div>
                    </div>
                    
                        <div class="test-type-grid">
                    <div class="test-type-card" data-type="qualitative">
                        <h3><i class="fas fa-search"></i> 定性分析</h3>
                        <p>离子检验、物质鉴定、分离提纯</p>
                                </div>
                    <div class="test-type-card" data-type="quantitative">
                        <h3><i class="fas fa-balance-scale"></i> 定量分析</h3>
                        <p>酸碱滴定、氧化还原滴定、沉淀滴定</p>
                            </div>
                    <div class="test-type-card" data-type="instrumental">
                        <h3><i class="fas fa-microscope"></i> 仪器分析</h3>
                        <p>光谱分析、色谱分析、电化学分析</p>
                                </div>
                    <div class="test-type-card" data-type="calculation">
                        <h3><i class="fas fa-calculator"></i> 分析计算</h3>
                        <p>浓度计算、误差分析、数据处理</p>
                            </div>
                                </div>

                <div class="test-controls">
                    <div class="control-group">
                        <label for="analytical-level">
                            <i class="fas fa-graduation-cap"></i> 学校类型
                        </label>
                        <select id="analytical-level">
                            <option value="middle">初中</option>
                            <option value="high">高中</option>
                        </select>
                            </div>
                    <div class="control-group">
                        <label for="analytical-grade">
                            <i class="fas fa-layer-group"></i> 年级学期
                        </label>
                        <select id="analytical-grade">
                            <option value="grade9-1">九年级上学期</option>
                            <option value="grade9-2">九年级下学期</option>
                            <option value="grade10-1">高一上学期</option>
                            <option value="grade10-2">高一下学期</option>
                            <option value="grade11-1">高二上学期</option>
                            <option value="grade11-2">高二下学期</option>
                            <option value="grade12-1">高三上学期</option>
                            <option value="grade12-2">高三下学期</option>
                        </select>
                                </div>
                    <div class="control-group">
                        <label for="analytical-difficulty">
                            <i class="fas fa-chart-line"></i> 难度等级
                        </label>
                        <select id="analytical-difficulty">
                            <option value="basic">基础</option>
                            <option value="medium">中等</option>
                            <option value="hard">困难</option>
                            <option value="competition">竞赛</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="analytical-count">
                            <i class="fas fa-list-ol"></i> 题目数量
                        </label>
                        <select id="analytical-count">
                            <option value="5">5题</option>
                            <option value="10">10题</option>
                            <option value="15">15题</option>
                            <option value="20">20题</option>
                        </select>
                    </div>
                </div>

                <button class="start-test-btn" id="start-analytical-test">
                    <i class="fas fa-play"></i> 开始分析化学测试
                </button>

                <div class="test-container" id="analytical-test-container"></div>
            </div>

            <!-- 物理化学测试 -->
            <div class="testing-panel" id="physical">
                <div class="learning-objectives">
                    <h4><i class="fas fa-target"></i> 物理化学学习目标</h4>
                    <div class="objectives-grid">
                        <div class="objective-item">
                            <strong>热力学：</strong>掌握化学热力学基本定律和应用
                        </div>
                        <div class="objective-item">
                            <strong>动力学：</strong>理解化学反应速率和反应机理
                        </div>
                        <div class="objective-item">
                            <strong>平衡：</strong>掌握化学平衡和相平衡理论
                        </div>
                        <div class="objective-item">
                            <strong>电化学：</strong>理解电化学反应和电池原理
                        </div>
                    </div>
                </div>

                <div class="test-type-grid">
                    <div class="test-type-card" data-type="thermodynamics">
                        <h3><i class="fas fa-fire"></i> 化学热力学</h3>
                        <p>热力学定律、焓变、熵变、自由能</p>
                    </div>
                    <div class="test-type-card" data-type="kinetics">
                        <h3><i class="fas fa-tachometer-alt"></i> 反应动力学</h3>
                        <p>反应速率、速率方程、反应机理</p>
                    </div>
                    <div class="test-type-card" data-type="equilibrium">
                        <h3><i class="fas fa-balance-scale-right"></i> 化学平衡</h3>
                        <p>平衡常数、勒夏特列原理、相平衡</p>
                    </div>
                    <div class="test-type-card" data-type="electrochemistry">
                        <h3><i class="fas fa-battery-full"></i> 电化学</h3>
                        <p>电极反应、电池电动势、电解</p>
                    </div>
                </div>

                <div class="test-controls">
                    <div class="control-group">
                        <label for="physical-level">
                            <i class="fas fa-graduation-cap"></i> 学校类型
                        </label>
                        <select id="physical-level">
                                <option value="middle">初中</option>
                            <option value="high">高中</option>
                            </select>
                        </div>
                    <div class="control-group">
                        <label for="physical-grade">
                            <i class="fas fa-layer-group"></i> 年级学期
                        </label>
                        <select id="physical-grade">
                            <option value="grade9-1">九年级上学期</option>
                            <option value="grade9-2">九年级下学期</option>
                            <option value="grade10-1">高一上学期</option>
                            <option value="grade10-2">高一下学期</option>
                            <option value="grade11-1">高二上学期</option>
                            <option value="grade11-2">高二下学期</option>
                            <option value="grade12-1">高三上学期</option>
                            <option value="grade12-2">高三下学期</option>
                            </select>
                        </div>
                    <div class="control-group">
                        <label for="physical-difficulty">
                            <i class="fas fa-chart-line"></i> 难度等级
                        </label>
                        <select id="physical-difficulty">
                            <option value="basic">基础</option>
                            <option value="medium">中等</option>
                            <option value="hard">困难</option>
                            <option value="competition">竞赛</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="physical-count">
                            <i class="fas fa-list-ol"></i> 题目数量
                        </label>
                        <select id="physical-count">
                                <option value="5">5题</option>
                            <option value="10">10题</option>
                                <option value="15">15题</option>
                                <option value="20">20题</option>
                            </select>
                    </div>
                        </div>
                        
                <button class="start-test-btn" id="start-physical-test">
                    <i class="fas fa-play"></i> 开始物理化学测试
                        </button>
                        
                <div class="test-container" id="physical-test-container"></div>
                </div>

            <!-- 综合测试 -->
            <div class="testing-panel" id="comprehensive">
                <div class="learning-objectives">
                    <h4><i class="fas fa-target"></i> 综合测试学习目标</h4>
                    <div class="objectives-grid">
                        <div class="objective-item">
                            <strong>知识整合：</strong>综合运用各分支化学知识
                        </div>
                        <div class="objective-item">
                            <strong>问题解决：</strong>解决复杂的化学综合问题
                        </div>
                        <div class="objective-item">
                            <strong>实际应用：</strong>将化学知识应用于实际情境
                        </div>
                        <div class="objective-item">
                            <strong>创新思维：</strong>培养化学创新思维能力
                        </div>
                    </div>
                </div>

                <div class="test-type-grid">
                    <div class="test-type-card" data-type="mixed-topics">
                        <h3><i class="fas fa-puzzle-piece"></i> 跨领域综合</h3>
                        <p>无机、有机、分析、物化知识综合</p>
                    </div>
                    <div class="test-type-card" data-type="practical-application">
                        <h3><i class="fas fa-industry"></i> 实际应用</h3>
                        <p>工业生产、环境保护、生活化学</p>
                    </div>
                    <div class="test-type-card" data-type="experimental">
                        <h3><i class="fas fa-flask"></i> 实验综合</h3>
                        <p>实验设计、数据分析、结果评价</p>
                    </div>
                    <div class="test-type-card" data-type="competition">
                        <h3><i class="fas fa-trophy"></i> 竞赛水平</h3>
                        <p>化学竞赛、高考压轴、创新题型</p>
                    </div>
                </div>

                <div class="test-controls">
                    <div class="control-group">
                        <label for="comprehensive-level">
                            <i class="fas fa-graduation-cap"></i> 学校类型
                        </label>
                        <select id="comprehensive-level">
                            <option value="middle">初中</option>
                            <option value="high">高中</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="comprehensive-grade">
                            <i class="fas fa-layer-group"></i> 年级学期
                        </label>
                        <select id="comprehensive-grade">
                            <option value="grade9-1">九年级上学期</option>
                            <option value="grade9-2">九年级下学期</option>
                            <option value="grade10-1">高一上学期</option>
                            <option value="grade10-2">高一下学期</option>
                            <option value="grade11-1">高二上学期</option>
                            <option value="grade11-2">高二下学期</option>
                            <option value="grade12-1">高三上学期</option>
                            <option value="grade12-2">高三下学期</option>
                        </select>
                </div>
                    <div class="control-group">
                        <label for="comprehensive-difficulty">
                            <i class="fas fa-chart-line"></i> 难度等级
                        </label>
                        <select id="comprehensive-difficulty">
                            <option value="basic">基础</option>
                            <option value="medium">中等</option>
                            <option value="hard">困难</option>
                            <option value="competition">竞赛</option>
                        </select>
                </div>
                    <div class="control-group">
                        <label for="comprehensive-count">
                            <i class="fas fa-list-ol"></i> 题目数量
                        </label>
                        <select id="comprehensive-count">
                            <option value="5">5题</option>
                            <option value="10">10题</option>
                            <option value="15">15题</option>
                            <option value="20">20题</option>
                        </select>
            </div>
                </div>

                <button class="start-test-btn" id="start-comprehensive-test">
                    <i class="fas fa-play"></i> 开始综合测试
                </button>

                <div class="test-container" id="comprehensive-test-container"></div>
            </div>
        </div>
         </main>

    <script src="../../js/navigation.js"></script>
    <script>
        // 全局变量
        let currentTestType = null;
        let currentQuestions = [];

        // MathJax配置
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            }
        };

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            initializeTabs();
            initializeTestTypes();
            initializeTestButtons();
            initializeMobileMenu();
        });

        // 初始化标签页
        function initializeTabs() {
            const tabs = document.querySelectorAll('.testing-tab');
            const panels = document.querySelectorAll('.testing-panel');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // 更新标签页状态
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 更新面板状态
                    panels.forEach(panel => {
                        panel.classList.remove('active');
                        if (panel.id === targetTab) {
                        panel.classList.add('active');
                    }
                    });
                    
                    // 重置测试类型选择
                    currentTestType = null;
                    document.querySelectorAll('.test-type-card').forEach(card => {
                        card.classList.remove('selected');
                    });
                });
            });
        }

        // 初始化测试类型选择
        function initializeTestTypes() {
            const typeCards = document.querySelectorAll('.test-type-card');
            
            typeCards.forEach(card => {
                card.addEventListener('click', function() {
                    // 移除同一面板内其他卡片的选中状态
                    const parentPanel = this.closest('.testing-panel');
                    parentPanel.querySelectorAll('.test-type-card').forEach(c => {
                        c.classList.remove('selected');
                    });
                    
                    // 选中当前卡片
                    this.classList.add('selected');
                    currentTestType = this.getAttribute('data-type');
                });
            });
        }

        // 初始化测试按钮
        function initializeTestButtons() {
            // 无机化学测试
            document.getElementById('start-inorganic-test').addEventListener('click', function() {
                const level = document.getElementById('inorganic-level').value;
                const grade = document.getElementById('inorganic-grade').value;
                const difficulty = document.getElementById('inorganic-difficulty').value;
                const count = document.getElementById('inorganic-count').value;
                const container = document.getElementById('inorganic-test-container');
                
                if (!currentTestType) {
                    alert('请先选择一个测试类型');
                    return;
                }
                
                startChemistryTest('inorganic', currentTestType, level, grade, difficulty, count, container);
            });

            // 有机化学测试
            document.getElementById('start-organic-test').addEventListener('click', function() {
                const level = document.getElementById('organic-level').value;
                const grade = document.getElementById('organic-grade').value;
                const difficulty = document.getElementById('organic-difficulty').value;
                const count = document.getElementById('organic-count').value;
                const container = document.getElementById('organic-test-container');
                
                if (!currentTestType) {
                    alert('请先选择一个测试类型');
                    return;
                }
                
                startChemistryTest('organic', currentTestType, level, grade, difficulty, count, container);
            });

            // 分析化学测试
            document.getElementById('start-analytical-test').addEventListener('click', function() {
                const level = document.getElementById('analytical-level').value;
                const grade = document.getElementById('analytical-grade').value;
                const difficulty = document.getElementById('analytical-difficulty').value;
                const count = document.getElementById('analytical-count').value;
                const container = document.getElementById('analytical-test-container');
                
                if (!currentTestType) {
                    alert('请先选择一个测试类型');
                return;
            }

                startChemistryTest('analytical', currentTestType, level, grade, difficulty, count, container);
            });

            // 物理化学测试
            document.getElementById('start-physical-test').addEventListener('click', function() {
                const level = document.getElementById('physical-level').value;
                const grade = document.getElementById('physical-grade').value;
                const difficulty = document.getElementById('physical-difficulty').value;
                const count = document.getElementById('physical-count').value;
                const container = document.getElementById('physical-test-container');
                
                if (!currentTestType) {
                    alert('请先选择一个测试类型');
                    return;
                }
                
                startChemistryTest('physical', currentTestType, level, grade, difficulty, count, container);
            });

            // 综合测试
            document.getElementById('start-comprehensive-test').addEventListener('click', function() {
                const level = document.getElementById('comprehensive-level').value;
                const grade = document.getElementById('comprehensive-grade').value;
                const difficulty = document.getElementById('comprehensive-difficulty').value;
                const count = document.getElementById('comprehensive-count').value;
                const container = document.getElementById('comprehensive-test-container');
                
                if (!currentTestType) {
                    alert('请先选择一个测试类型');
                    return;
                }
                
                startChemistryTest('comprehensive', currentTestType, level, grade, difficulty, count, container);
            });
        }

        // 初始化移动端菜单
        function initializeMobileMenu() {
            const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
            const mainNav = document.querySelector('.main-nav');
            
            if (mobileMenuToggle && mainNav) {
                mobileMenuToggle.addEventListener('click', function() {
                    mainNav.classList.toggle('active');
                    mobileMenuToggle.classList.toggle('active');
                });
            }
        }

        // 开始化学测试
        async function startChemistryTest(subject, type, level, grade, difficulty, count, container) {
            container.style.display = 'block';
            container.innerHTML = '<div style="text-align: center; padding: 2rem;"><i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: #4CAF50;"></i><br><br>正在生成化学测试，请稍候...</div>';
            
            const subjectNames = {
                'inorganic': '无机化学',
                'organic': '有机化学',
                'analytical': '分析化学',
                'physical': '物理化学',
                'comprehensive': '综合化学'
            };

            const typeNames = {
                // 无机化学
                'basic-concepts': '基础概念',
                'elements': '元素化合物',
                'reactions': '化学反应',
                'redox': '氧化还原',
                // 有机化学
                'hydrocarbons': '烃类化合物',
                'functional-groups': '官能团',
                'organic-reactions': '有机反应',
                'synthesis': '合成路线',
                // 分析化学
                'qualitative': '定性分析',
                'quantitative': '定量分析',
                'instrumental': '仪器分析',
                'calculation': '分析计算',
                // 物理化学
                'thermodynamics': '化学热力学',
                'kinetics': '反应动力学',
                'equilibrium': '化学平衡',
                'electrochemistry': '电化学',
                // 综合测试
                'mixed-topics': '跨领域综合',
                'practical-application': '实际应用',
                'experimental': '实验综合',
                'competition': '竞赛水平'
            };

            const difficultyNames = {
                'basic': '基础',
                'medium': '中等',
                'hard': '困难',
                'competition': '竞赛'
            };

            const levelNames = {
                'middle': '初中',
                'high': '高中'
            };

            const gradeNames = {
                'grade9-1': '九年级上学期',
                'grade9-2': '九年级下学期',
                'grade10-1': '高一上学期',
                'grade10-2': '高一下学期',
                'grade11-1': '高二上学期',
                'grade11-2': '高二下学期',
                'grade12-1': '高三上学期',
                'grade12-2': '高三下学期'
            };

            try {
                // 构建详细的课程范围
                const curriculumScope = getChemistryCurriculumScope(level, grade, subject, type);
                
                const prompt = `请严格按照中国${levelNames[level]}化学教学大纲，为${gradeNames[grade]}学生生成${count}道${subjectNames[subject]}中${typeNames[type]}的${difficultyNames[difficulty]}测试题目。

## 教学大纲范围：
${curriculumScope}

## 题目要求：
1. **教育水平**：${levelNames[level]} ${gradeNames[grade]} - 严格遵循人教版化学教材内容
2. **难度等级**：${difficultyNames[difficulty]} - 符合实际考试标准
3. **知识范围**：仅限于上述教学大纲范围内的内容，不得超纲
4. **计算要求**：包含适量的化学计算和概念理解

## 题目规范：
1. 每道题必须是单选题，有4个选项(A、B、C、D)
2. 题目情境要贴近中国学生生活实际
3. 化学公式和方程式使用LaTeX格式，用$符号包围
4. 正确答案随机分布在A、B、C、D选项中
5. 设置有迷惑性的干扰项，体现常见错误理解
6. 数值计算要合理，避免复杂运算

## 解答要求：
每道题的explanation必须包含：
- 化学概念或原理的阐述
- 公式的选择和应用
- 计算过程（如有）
- 结果的化学意义

请按以下JSON格式返回：

{
  "questions": [
    {
      "question": "题目内容",
      "options": ["选项A", "选项B", "选项C", "选项D"],
      "correct": 正确答案的索引(0-3),
      "explanation": "详细解题步骤：1. 化学原理... 2. 公式应用... 3. 计算过程... 4. 答案分析..."
    }
  ]
}`;

                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ prompt: prompt })
                });

                if (!response.ok) {
                    throw new Error(`HTTP错误: ${response.status}`);
                }

                const result = await response.json();
                
                if (result.error) {
                    throw new Error(result.message || 'AI生成失败');
                }

                const test = parseAIQuizResponse(result.output);
                currentQuestions = test.questions;
                displayChemistryTest(test, container, subjectNames[subject], typeNames[type]);
                
            } catch (error) {
                console.error('生成化学测试失败:', error);
                // 备用题目
                const fallbackTest = {
                    questions: [
                        {
                            question: "下列物质中，属于化合物的是：",
                            options: ["氧气", "水", "铁", "氮气"],
                        correct: 1,
                            explanation: "化合物是由两种或两种以上不同元素组成的纯净物。水($H_2O$)由氢元素和氧元素组成，属于化合物。"
                        }
                    ]
                };
                currentQuestions = fallbackTest.questions;
                displayChemistryTest(fallbackTest, container, subjectNames[subject], typeNames[type]);
            }
        }

        // 获取化学课程范围
        function getChemistryCurriculumScope(level, grade, subject, type) {
            const curriculum = {
                'middle': {
                    'grade9-1': {
                        'inorganic': {
                            'basic-concepts': `
**九年级上学期无机化学基础概念：**
- 走进化学世界：化学的特征、化学变化和物理变化
- 物质的性质和变化：物理性质、化学性质、物理变化、化学变化
- 化学是一门以实验为基础的科学：化学实验的基本操作
- 物质构成的奥秘：分子、原子、离子、元素
- 化学式的书写和意义：化学式、化合价
- 化学方程式：质量守恒定律、化学方程式的配平`,
                            
                            'elements': `
**九年级上学期元素化合物：**
- 我们周围的空气：空气的组成、氧气的性质和制取
- 氧气的化学性质：氧气与碳、硫、磷、铁、蜡烛的反应
- 自然界的水：水的组成、氢气的性质、水的净化
- 爱护水资源：水污染及防治、水资源保护
- 碳和碳的氧化物：金刚石、石墨、C60、一氧化碳、二氧化碳`,
                            
                            'reactions': `
**九年级上学期化学反应：**
- 化合反应：两种或多种物质生成一种物质
- 分解反应：一种物质生成两种或多种物质
- 燃烧和缓慢氧化：燃烧的条件、灭火的原理
- 化学方程式的书写：反应物、生成物、反应条件
- 根据化学方程式的计算：质量比计算`,
                            
                            'redox': `
**九年级上学期氧化还原（初步）：**
- 氧化反应：物质与氧结合的反应
- 还原反应：含氧化合物失去氧的反应
- 氧化性和还原性：氧气的氧化性、氢气的还原性
- 燃料及其利用：化石燃料、燃料的充分燃烧`
                        }
                    },
                    'grade9-2': {
                        'inorganic': {
                            'elements': `
**九年级下学期元素化合物：**
- 金属和金属材料：金属的物理性质、金属的化学性质
- 金属活动性顺序：置换反应、金属的冶炼
- 金属资源的利用和保护：铁的锈蚀、金属的回收利用
- 溶液：溶液的形成、饱和溶液与不饱和溶液
- 溶解度：溶解度曲线、溶液的配制`,
                            
                            'reactions': `
**九年级下学期化学反应：**
- 酸和碱：常见的酸、常见的碱、酸碱指示剂
- 酸和碱的中和反应：中和反应、pH的应用
- 盐：盐的性质、复分解反应发生的条件
- 化肥：氮肥、磷肥、钾肥、复合肥料`
                        }
                    }
                },
                'high': {
                    'grade10-1': {
                        'inorganic': {
                            'basic-concepts': `
**高一上学期无机化学基础概念：**
- 物质的分类：纯净物和混合物、单质和化合物、酸碱盐氧化物
- 化学计量在实验中的应用：物质的量、摩尔质量、气体摩尔体积
- 物质的量浓度：溶液的配制、物质的量浓度的计算
- 化学实验基本方法：混合物的分离和提纯、离子检验`,
                            
                            'elements': `
**高一上学期元素化合物：**
- 海水中的重要元素：氯气的性质、氯离子的检验
- 卤族元素：卤素单质的性质、卤化物的性质
- 铁、金属材料：铁的氧化物、铁的氢氧化物
- 用途广泛的金属材料：合金的概念和性质`,
                            
                            'reactions': `
**高一上学期化学反应：**
- 氧化还原反应：氧化还原反应的本质、氧化剂和还原剂
- 离子反应：电解质和非电解质、离子方程式的书写
- 物质的量在化学方程式计算中的应用：化学反应中物质的量的关系`
                        }
                    }
                }
            };
            
            return curriculum[level]?.[grade]?.[subject]?.[type] || `请生成符合${level}${grade}化学${subject}中${type}内容的题目`;
        }

        // 解析AI响应
        function parseAIQuizResponse(response) {
            try {
                if (response.startsWith('{')) {
                    return JSON.parse(response);
                }
                
                const jsonMatch = response.match(/```(?:json)?\s*(\{[\s\S]*?\})\s*```/);
                if (jsonMatch) {
                    return JSON.parse(jsonMatch[1]);
                }
                
                const jsonStart = response.indexOf('{');
                const jsonEnd = response.lastIndexOf('}') + 1;
                if (jsonStart !== -1 && jsonEnd > jsonStart) {
                    const jsonString = response.substring(jsonStart, jsonEnd);
                    return JSON.parse(jsonString);
                }
                
                throw new Error('无法解析AI响应');
            } catch (error) {
                console.error('解析AI响应失败:', error);
                return {
                    questions: [
                        {
                            question: "示例化学题目",
                            options: ["选项A", "选项B", "选项C", "选项D"],
                            correct: 0,
                            explanation: "这是一个示例解释"
                        }
                    ]
                };
            }
        }

        // 显示化学测试
        function displayChemistryTest(test, container, subjectName, typeName) {
            let html = `<h3>${subjectName} - ${typeName}测试</h3>`;
            
            if (test.questions && Array.isArray(test.questions)) {
                test.questions.forEach((question, index) => {
                    html += `
                <div class="test-question">
                            <div class="question-text">${index + 1}. ${question.question}</div>
                    <ul class="options-list">
                    `;
                    
                    question.options.forEach((option, optionIndex) => {
                        html += `
                            <li class="option-item" data-question="${index}" data-option="${optionIndex}" data-correct="${question.correct}">
                                ${String.fromCharCode(65 + optionIndex)}. ${option}
                    </li>
                        `;
                    });
                    
                    html += '</ul></div>';
                });
            }
            
            html += `
                <div style="text-align: center; margin-top: 2rem;">
                    <button class="btn btn-primary" id="submit-chemistry-test">
                        <i class="fas fa-check"></i> 提交答案
                    </button>
                </div>
            `;
            
            container.innerHTML = html;
            
            // 渲染MathJax
            renderMathJaxSafely(container);
            
            // 添加选项点击事件
            const options = container.querySelectorAll('.option-item');
            options.forEach(option => {
                option.addEventListener('click', function() {
                    const questionId = this.getAttribute('data-question');
                    const questionOptions = document.querySelectorAll(`.option-item[data-question="${questionId}"]`);
                    questionOptions.forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
            
            // 添加提交按钮事件
            const submitBtn = container.querySelector('#submit-chemistry-test');
            submitBtn.addEventListener('click', function() {
                const selectedOptions = container.querySelectorAll('.option-item.selected');
                if (selectedOptions.length < (test.questions?.length || 1)) {
                    alert('请回答所有问题');
                    return;
                }
                
                showChemistryTestResults(test, selectedOptions, container);
            });
        }

        // 显示测试结果
        function showChemistryTestResults(test, selectedOptions, container) {
            let score = 0;
            let userAnswers = [];
            
            selectedOptions.forEach(selectedOption => {
                const questionIndex = parseInt(selectedOption.getAttribute('data-question'));
                const selectedIndex = parseInt(selectedOption.getAttribute('data-option'));
                const correctIndex = parseInt(selectedOption.getAttribute('data-correct'));
                
                userAnswers[questionIndex] = {
                    selected: selectedIndex,
                    correct: correctIndex,
                    isCorrect: selectedIndex === correctIndex
                };
                
                if (selectedIndex === correctIndex) {
                    score++;
                }
            });

            const percentage = Math.round((score / test.questions.length) * 100);
            
            let resultsHtml = `
                <div class="result-summary">
                    <div class="score-display">${percentage}%</div>
                    <div class="level-badge">${getChemistryLevel(percentage)}</div>
                    <p>您答对了 ${score} 道题，共 ${test.questions.length} 道题</p>
                    
                    <div class="learning-suggestion">
                        <h4><i class="fas fa-lightbulb"></i> 学习建议</h4>
                        <p>${getChemistryLearningAdvice(percentage)}</p>
                    </div>
                </div>
                
                <h4><i class="fas fa-clipboard-list"></i> 详细结果分析</h4>
            `;
            
            test.questions.forEach((question, index) => {
                            const userAnswer = userAnswers[index];
                const isCorrect = userAnswer.isCorrect;
                
                resultsHtml += `
                    <div class="question-result ${isCorrect ? 'correct' : 'incorrect'}">
                        <div class="question-header">
                            <div class="question-number">题目 ${index + 1}</div>
                            <div class="question-status ${isCorrect ? 'correct' : 'incorrect'}">
                                <i class="fas ${isCorrect ? 'fa-check-circle' : 'fa-times-circle'}"></i>
                                ${isCorrect ? '正确' : '错误'}
                                        </div>
                                            </div>
                        
                        <div class="original-question">${question.question}</div>
                        
                        <div class="answer-analysis">
                            <div class="user-answer ${isCorrect ? 'correct' : 'incorrect'}">
                                <strong>您的答案：</strong>
                                <span class="answer-option">${String.fromCharCode(65 + userAnswer.selected)}. ${question.options[userAnswer.selected]}</span>
                                        </div>
                            <div class="correct-answer">
                                <strong>正确答案：</strong>
                                <span class="answer-option">${String.fromCharCode(65 + question.correct)}. ${question.options[question.correct]}</span>
                                    </div>
                    </div>
                        
                        <div class="explanation-content">
                            <strong><i class="fas fa-lightbulb"></i> 解题思路：</strong>
                            <div class="explanation-text">${question.explanation}</div>
                </div>
                    </div>
                `;
            });
                
            resultsHtml += `
                <div class="result-actions">
                    <button class="btn btn-primary" onclick="location.reload()">
                        <i class="fas fa-redo"></i> 重新测试
                    </button>
                    <button class="btn btn-secondary" onclick="window.location.href='main.html'">
                        <i class="fas fa-home"></i> 返回首页
                    </button>
                </div>
            `;
            
            container.innerHTML = resultsHtml;
            renderMathJaxSafely(container);
        }

        // 获取化学水平
        function getChemistryLevel(percentage) {
            if (percentage >= 90) return '化学学霸';
            if (percentage >= 80) return '化学高手';
            if (percentage >= 70) return '化学能手';
            if (percentage >= 60) return '化学学徒';
            return '需要加强';
        }

        // 获取学习建议
        function getChemistryLearningAdvice(percentage) {
            if (percentage >= 90) {
                return '优秀！您的化学基础非常扎实，建议继续挑战更高难度的题目，并尝试化学竞赛相关内容。';
            } else if (percentage >= 80) {
                return '很好！您掌握了大部分化学知识，建议加强薄弱环节的练习，多做综合性题目。';
            } else if (percentage >= 70) {
                return '不错！您的化学基础较好，建议系统复习错题涉及的知识点，加强实验和计算能力。';
            } else if (percentage >= 60) {
                return '还需努力！建议回顾基础概念，多做基础题目，重点掌握化学方程式和基本计算。';
                } else {
                return '需要加强基础！建议从化学基本概念开始，系统学习教材内容，多做练习巩固知识。';
            }
        }

        // 安全渲染MathJax
        function renderMathJaxSafely(element) {
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise([element]).catch(function(err) {
                    console.error('MathJax渲染错误:', err);
                });
            }
        }
    </script>
</body>
</html> 