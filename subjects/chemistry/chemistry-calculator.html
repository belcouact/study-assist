<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>化学计算工具 - 化学学习助手</title>
    <link rel="icon" href="../../assets/icons/logo_btrfly.ico" type="image/x-icon">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/components.css">
    <link rel="stylesheet" href="../../css/utilities.css">
    <link rel="stylesheet" href="../../css/responsive.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Mobile First Design */
        .calculator-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        .calculator-header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem 1rem;
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            border-radius: 15px;
            color: white;
        }

        .calculator-header h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .calculator-header p {
            font-size: 1rem;
            opacity: 0.9;
        }

        .calculator-tabs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.5rem;
            margin-bottom: 2rem;
            background: white;
            padding: 0.5rem;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .calculator-tab {
            padding: 1rem 0.5rem;
            border: none;
            border-radius: 10px;
            background: transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .calculator-tab:hover {
            background: rgba(220, 53, 69, 0.1);
        }

        .calculator-tab.active {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
            color: white;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        .calculator-section {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            display: none;
        }

        .calculator-section.active {
            display: block;
        }

        .calculation-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }

        .input-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
        }

        .result-section {
            background: linear-gradient(135deg, rgba(220, 53, 69, 0.05), rgba(253, 126, 20, 0.05));
            border-radius: 10px;
            padding: 1.5rem;
            border-left: 4px solid #dc3545;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #2d3748;
        }

        .calc-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .calc-input:focus {
            outline: none;
            border-color: #dc3545;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
        }

        .calc-select {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
            font-size: 1rem;
            cursor: pointer;
        }

        .calculate-btn {
            width: 100%;
            padding: 1rem 2rem;
            background: linear-gradient(135deg, #dc3545, #fd7e14);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(220, 53, 69, 0.3);
        }

        .result-display {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .result-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #dc3545;
            margin-bottom: 0.5rem;
        }

        .result-label {
            color: #718096;
            font-size: 0.9rem;
        }

        .formula-display {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: #856404;
        }

        .step-by-step {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .step {
            margin-bottom: 1rem;
            padding: 0.5rem;
            background: white;
            border-radius: 5px;
            border-left: 3px solid #fd7e14;
        }

        .step-title {
            font-weight: 600;
            color: #dc3545;
            margin-bottom: 0.25rem;
        }

        .common-compounds {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .compound-btn {
            padding: 0.8rem;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.9rem;
        }

        .compound-btn:hover {
            border-color: #dc3545;
            background: rgba(220, 53, 69, 0.05);
        }

        /* Desktop Responsive */
        @media (min-width: 768px) {
            .calculator-container {
                padding: 2rem;
            }

            .calculator-header h1 {
                font-size: 2.5rem;
            }

            .calculator-header p {
                font-size: 1.1rem;
            }

            .calculator-tabs {
                grid-template-columns: repeat(5, 1fr);
            }

            .calculation-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (min-width: 1024px) {
            .calculation-grid {
                grid-template-columns: 2fr 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="../../index.html">
                        <i class="fas fa-graduation-cap" style="background: linear-gradient(90deg, #4361ee, #7209b7); -webkit-background-clip: text; background-clip: text; color: transparent;"></i>
                        <span>Alex的学习助手</span>
                    </a>
                </div>
                <nav class="main-nav">
                    <ul>
                        <li><a href="../../index.html">首页</a></li>
                        <li><a href="main.html">化学</a></li>
                        <li><a href="../../tts.html">语音</a></li>
                        <li><a href="../../draw.html">绘图</a></li>
                    </ul>
                </nav>
                <button class="mobile-menu-toggle" aria-label="切换菜单">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <main class="calculator-container">
        <div class="calculator-header">
            <h1><i class="fas fa-calculator"></i> 化学计算工具</h1>
            <p>进行摩尔计算、浓度换算、化学计量学等常用化学计算</p>
        </div>

        <!-- 计算器标签 -->
        <div class="calculator-tabs">
            <button class="calculator-tab active" data-tab="molarity">摩尔浓度</button>
            <button class="calculator-tab" data-tab="stoichiometry">化学计量学</button>
            <button class="calculator-tab" data-tab="composition">组成计算</button>
            <button class="calculator-tab" data-tab="gas">气体定律</button>
            <button class="calculator-tab" data-tab="dilution">稀释计算</button>
        </div>

        <!-- 摩尔浓度计算器 -->
        <div class="calculator-section active" id="molarity">
            <h3><i class="fas fa-flask"></i> 摩尔浓度计算</h3>
            <div class="formula-display">
                M = n / V  或  M = m / (MW × V)
            </div>
            
            <div class="calculation-grid">
                <div class="input-section">
                    <div class="input-group">
                        <label class="input-label">计算类型</label>
                        <select id="molarityType" class="calc-select">
                            <option value="molarity">计算摩尔浓度 (M)</option>
                            <option value="moles">计算摩尔数 (n)</option>
                            <option value="volume">计算体积 (V)</option>
                            <option value="mass">计算质量 (m)</option>
                        </select>
                    </div>

                    <div id="molarityInputs">
                        <div class="input-group">
                            <label class="input-label">质量 (g)</label>
                            <input type="number" id="mass" class="calc-input" placeholder="输入质量">
                        </div>
                        <div class="input-group">
                            <label class="input-label">分子量 (g/mol)</label>
                            <input type="number" id="molecularWeight" class="calc-input" placeholder="输入分子量">
                        </div>
                        <div class="input-group">
                            <label class="input-label">体积 (L)</label>
                            <input type="number" id="volume" class="calc-input" placeholder="输入体积">
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label">常见化合物</label>
                        <div class="common-compounds">
                            <button class="compound-btn" onclick="setCompound('NaCl', 58.44)">NaCl</button>
                            <button class="compound-btn" onclick="setCompound('H2SO4', 98.08)">H₂SO₄</button>
                            <button class="compound-btn" onclick="setCompound('CaCl2', 110.98)">CaCl₂</button>
                            <button class="compound-btn" onclick="setCompound('NaOH', 40.00)">NaOH</button>
                        </div>
                    </div>

                    <button class="calculate-btn" onclick="calculateMolarity()">
                        <i class="fas fa-calculator"></i> 计算
                    </button>
                </div>

                <div class="result-section">
                    <h4><i class="fas fa-chart-bar"></i> 计算结果</h4>
                    <div class="result-display" id="molarityResult">
                        <div class="result-value" id="molarityValue">-</div>
                        <div class="result-label" id="molarityLabel">摩尔浓度 (M)</div>
                    </div>
                    <div class="step-by-step" id="molaritySteps" style="display: none;">
                        <!-- 计算步骤将动态添加 -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 化学计量学计算器 -->
        <div class="calculator-section" id="stoichiometry">
            <h3><i class="fas fa-balance-scale"></i> 化学计量学计算</h3>
            <div class="formula-display">
                mol₁ / coeff₁ = mol₂ / coeff₂
            </div>
            
            <div class="calculation-grid">
                <div class="input-section">
                    <div class="input-group">
                        <label class="input-label">化学方程式</label>
                        <input type="text" id="equation" class="calc-input" placeholder="例如: 2H2 + O2 → 2H2O">
                    </div>

                    <div class="input-group">
                        <label class="input-label">已知物质</label>
                        <select id="knownSubstance" class="calc-select">
                            <option value="">选择已知物质</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label class="input-label">已知量 (mol)</label>
                        <input type="number" id="knownAmount" class="calc-input" placeholder="输入已知摩尔数">
                    </div>

                    <div class="input-group">
                        <label class="input-label">目标物质</label>
                        <select id="targetSubstance" class="calc-select">
                            <option value="">选择目标物质</option>
                        </select>
                    </div>

                    <button class="calculate-btn" onclick="calculateStoichiometry()">
                        <i class="fas fa-calculator"></i> 计算
                    </button>
                </div>

                <div class="result-section">
                    <h4><i class="fas fa-chart-bar"></i> 计算结果</h4>
                    <div class="result-display" id="stoichiometryResult">
                        <div class="result-value" id="stoichiometryValue">-</div>
                        <div class="result-label" id="stoichiometryLabel">目标物质摩尔数 (mol)</div>
                    </div>
                    <div class="step-by-step" id="stoichiometrySteps" style="display: none;">
                        <!-- 计算步骤将动态添加 -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 组成计算器 -->
        <div class="calculator-section" id="composition">
            <h3><i class="fas fa-pie-chart"></i> 百分组成计算</h3>
            <div class="formula-display">
                %成分 = (原子质量 × 原子数) / 分子量 × 100%
            </div>
            
            <div class="calculation-grid">
                <div class="input-section">
                    <div class="input-group">
                        <label class="input-label">化学式</label>
                        <input type="text" id="formula" class="calc-input" placeholder="例如: H2SO4">
                    </div>

                    <div class="input-group">
                        <label class="input-label">或手动输入元素</label>
                        <div id="elementsInput">
                            <div class="element-row" style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <input type="text" class="calc-input element-symbol" placeholder="元素符号">
                                <input type="number" class="calc-input element-count" placeholder="原子数">
                                <button class="calculate-btn" style="width: auto; padding: 0.5rem;" onclick="addElement()">+</button>
                            </div>
                        </div>
                    </div>

                    <button class="calculate-btn" onclick="calculateComposition()">
                        <i class="fas fa-calculator"></i> 计算
                    </button>
                </div>

                <div class="result-section">
                    <h4><i class="fas fa-chart-bar"></i> 组成分析</h4>
                    <div class="result-display" id="compositionResult">
                        <div class="result-value" id="molecularWeightValue">-</div>
                        <div class="result-label">分子量 (g/mol)</div>
                    </div>
                    <div id="elementComposition" style="margin-top: 1rem;">
                        <!-- 元素组成将动态添加 -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 气体定律计算器 -->
        <div class="calculator-section" id="gas">
            <h3><i class="fas fa-wind"></i> 理想气体定律</h3>
            <div class="formula-display">
                PV = nRT  (R = 0.08206 L·atm/mol·K)
            </div>
            
            <div class="calculation-grid">
                <div class="input-section">
                    <div class="input-group">
                        <label class="input-label">计算类型</label>
                        <select id="gasType" class="calc-select">
                            <option value="pressure">计算压强 (P)</option>
                            <option value="volume">计算体积 (V)</option>
                            <option value="moles">计算摩尔数 (n)</option>
                            <option value="temperature">计算温度 (T)</option>
                        </select>
                    </div>

                    <div id="gasInputs">
                        <div class="input-group">
                            <label class="input-label">压强 (atm)</label>
                            <input type="number" id="pressure" class="calc-input" placeholder="输入压强">
                        </div>
                        <div class="input-group">
                            <label class="input-label">体积 (L)</label>
                            <input type="number" id="gasVolume" class="calc-input" placeholder="输入体积">
                        </div>
                        <div class="input-group">
                            <label class="input-label">摩尔数 (mol)</label>
                            <input type="number" id="gasMoles" class="calc-input" placeholder="输入摩尔数">
                        </div>
                        <div class="input-group">
                            <label class="input-label">温度 (K)</label>
                            <input type="number" id="temperature" class="calc-input" placeholder="输入温度">
                        </div>
                    </div>

                    <button class="calculate-btn" onclick="calculateGas()">
                        <i class="fas fa-calculator"></i> 计算
                    </button>
                </div>

                <div class="result-section">
                    <h4><i class="fas fa-chart-bar"></i> 计算结果</h4>
                    <div class="result-display" id="gasResult">
                        <div class="result-value" id="gasValue">-</div>
                        <div class="result-label" id="gasLabel">-</div>
                    </div>
                    <div class="step-by-step" id="gasSteps" style="display: none;">
                        <!-- 计算步骤将动态添加 -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 稀释计算器 -->
        <div class="calculator-section" id="dilution">
            <h3><i class="fas fa-tint"></i> 稀释计算</h3>
            <div class="formula-display">
                M₁V₁ = M₂V₂
            </div>
            
            <div class="calculation-grid">
                <div class="input-section">
                    <div class="input-group">
                        <label class="input-label">初始浓度 (M)</label>
                        <input type="number" id="initialConcentration" class="calc-input" placeholder="输入初始浓度">
                    </div>

                    <div class="input-group">
                        <label class="input-label">初始体积 (mL)</label>
                        <input type="number" id="initialVolume" class="calc-input" placeholder="输入初始体积">
                    </div>

                    <div class="input-group">
                        <label class="input-label">最终浓度 (M)</label>
                        <input type="number" id="finalConcentration" class="calc-input" placeholder="输入最终浓度">
                    </div>

                    <div class="input-group">
                        <label class="input-label">最终体积 (mL)</label>
                        <input type="number" id="finalVolume" class="calc-input" placeholder="输入最终体积">
                    </div>

                    <div class="input-group">
                        <label class="input-label">计算类型</label>
                        <select id="dilutionType" class="calc-select">
                            <option value="finalVolume">计算最终体积</option>
                            <option value="finalConcentration">计算最终浓度</option>
                            <option value="initialVolume">计算所需初始体积</option>
                            <option value="waterVolume">计算所需加水体积</option>
                        </select>
                    </div>

                    <button class="calculate-btn" onclick="calculateDilution()">
                        <i class="fas fa-calculator"></i> 计算
                    </button>
                </div>

                <div class="result-section">
                    <h4><i class="fas fa-chart-bar"></i> 稀释结果</h4>
                    <div class="result-display" id="dilutionResult">
                        <div class="result-value" id="dilutionValue">-</div>
                        <div class="result-label" id="dilutionLabel">-</div>
                    </div>
                    <div class="step-by-step" id="dilutionSteps" style="display: none;">
                        <!-- 计算步骤将动态添加 -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <p class="copyright-text">study-llm.me域名为Alex所有。保留所有权利。</p>
                <div class="profile-section">
                    <button id="profile-button" class="profile-button">
                        <i class="fas fa-user-circle"></i>
                        学习阶段
                    </button>
                    <div id="profile-display" class="profile-display"></div>
                </div>
            </div>
        </div>
    </footer>

    <script src="../../js/common.js"></script>
    <script src="../../js/navigation.js"></script>
    <script src="../../js/profile.js"></script>
    <script>
        // 元素原子量数据
        const atomicWeights = {
            'H': 1.008, 'He': 4.003, 'Li': 6.941, 'Be': 9.012, 'B': 10.811, 'C': 12.011,
            'N': 14.007, 'O': 15.999, 'F': 18.998, 'Ne': 20.180, 'Na': 22.990, 'Mg': 24.305,
            'Al': 26.982, 'Si': 28.086, 'P': 30.974, 'S': 32.065, 'Cl': 35.453, 'Ar': 39.948,
            'K': 39.098, 'Ca': 40.078, 'Sc': 44.956, 'Ti': 47.867, 'V': 50.942, 'Cr': 51.996,
            'Mn': 54.938, 'Fe': 55.845, 'Co': 58.933, 'Ni': 58.693, 'Cu': 63.546, 'Zn': 65.38,
            'Ga': 69.723, 'Ge': 72.64, 'As': 74.922, 'Se': 78.96, 'Br': 79.904, 'Kr': 83.798,
            'Rb': 85.468, 'Sr': 87.62, 'Y': 88.906, 'Zr': 91.224, 'Nb': 92.906, 'Mo': 95.96,
            'Tc': 98, 'Ru': 101.07, 'Rh': 102.906, 'Pd': 106.42, 'Ag': 107.868, 'Cd': 112.411,
            'In': 114.818, 'Sn': 118.710, 'Sb': 121.760, 'Te': 127.60, 'I': 126.904, 'Xe': 131.293
        };

        // 标签切换
        document.querySelectorAll('.calculator-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.calculator-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.calculator-section').forEach(s => s.classList.remove('active'));
                
                this.classList.add('active');
                document.getElementById(this.dataset.tab).classList.add('active');
            });
        });

        // 设置化合物数据
        function setCompound(formula, mw) {
            document.getElementById('molecularWeight').value = mw;
            // 可以添加更多自动填充逻辑
        }

        // 摩尔浓度计算
        function calculateMolarity() {
            const type = document.getElementById('molarityType').value;
            const mass = parseFloat(document.getElementById('mass').value) || 0;
            const mw = parseFloat(document.getElementById('molecularWeight').value) || 0;
            const volume = parseFloat(document.getElementById('volume').value) || 0;

            let result, steps = [];

            switch(type) {
                case 'molarity':
                    if (mass && mw && volume) {
                        const moles = mass / mw;
                        result = moles / volume;
                        steps = [
                            `步骤1: 计算摩尔数 n = m / MW = ${mass} / ${mw} = ${moles.toFixed(4)} mol`,
                            `步骤2: 计算摩尔浓度 M = n / V = ${moles.toFixed(4)} / ${volume} = ${result.toFixed(4)} M`
                        ];
                    }
                    break;
                case 'moles':
                    const molarity = parseFloat(document.getElementById('molarity').value) || 0;
                    if (molarity && volume) {
                        result = molarity * volume;
                        steps = [`n = M × V = ${molarity} × ${volume} = ${result.toFixed(4)} mol`];
                    }
                    break;
                // 其他计算类型...
            }

            if (result !== undefined) {
                document.getElementById('molarityValue').textContent = result.toFixed(4);
                document.getElementById('molaritySteps').innerHTML = steps.map(step => 
                    `<div class="step"><div class="step-title">计算步骤</div>${step}</div>`
                ).join('');
                document.getElementById('molaritySteps').style.display = 'block';
            }
        }

        // 化学计量学计算
        function calculateStoichiometry() {
            const equation = document.getElementById('equation').value;
            const knownSubstance = document.getElementById('knownSubstance').value;
            const knownAmount = parseFloat(document.getElementById('knownAmount').value) || 0;
            const targetSubstance = document.getElementById('targetSubstance').value;

            // 简化的化学计量学计算逻辑
            // 在实际应用中需要解析化学方程式
            if (knownAmount && knownSubstance && targetSubstance) {
                // 假设1:1的化学计量关系作为示例
                const result = knownAmount; // 简化计算
                document.getElementById('stoichiometryValue').textContent = result.toFixed(4);
                
                const steps = [
                    `根据化学方程式: ${equation}`,
                    `已知 ${knownSubstance}: ${knownAmount} mol`,
                    `目标 ${targetSubstance}: ${result.toFixed(4)} mol`
                ];
                
                document.getElementById('stoichiometrySteps').innerHTML = steps.map(step => 
                    `<div class="step"><div class="step-title">计算步骤</div>${step}</div>`
                ).join('');
                document.getElementById('stoichiometrySteps').style.display = 'block';
            }
        }

        // 组成计算
        function calculateComposition() {
            const formula = document.getElementById('formula').value;
            
            if (formula) {
                const composition = parseFormula(formula);
                let totalMW = 0;
                let resultHTML = '';

                for (const [element, count] of Object.entries(composition)) {
                    const atomicWeight = atomicWeights[element] || 0;
                    const elementMass = atomicWeight * count;
                    totalMW += elementMass;
                }

                document.getElementById('molecularWeightValue').textContent = totalMW.toFixed(3);

                for (const [element, count] of Object.entries(composition)) {
                    const atomicWeight = atomicWeights[element] || 0;
                    const elementMass = atomicWeight * count;
                    const percentage = (elementMass / totalMW * 100).toFixed(2);
                    
                    resultHTML += `
                        <div class="step">
                            <div class="step-title">${element}</div>
                            ${count} 个原子 × ${atomicWeight} g/mol = ${elementMass.toFixed(3)} g/mol (${percentage}%)
                        </div>`;
                }

                document.getElementById('elementComposition').innerHTML = resultHTML;
            }
        }

        // 解析化学式
        function parseFormula(formula) {
            const composition = {};
            const regex = /([A-Z][a-z]?)(\d*)/g;
            let match;

            while ((match = regex.exec(formula)) !== null) {
                const element = match[1];
                const count = parseInt(match[2]) || 1;
                composition[element] = (composition[element] || 0) + count;
            }

            return composition;
        }

        // 气体定律计算
        function calculateGas() {
            const type = document.getElementById('gasType').value;
            const P = parseFloat(document.getElementById('pressure').value) || 0;
            const V = parseFloat(document.getElementById('gasVolume').value) || 0;
            const n = parseFloat(document.getElementById('gasMoles').value) || 0;
            const T = parseFloat(document.getElementById('temperature').value) || 0;
            const R = 0.08206; // L·atm/mol·K

            let result, label, steps = [];

            switch(type) {
                case 'pressure':
                    if (n && R && T && V) {
                        result = (n * R * T) / V;
                        label = '压强 (atm)';
                        steps = [`P = nRT/V = ${n} × ${R} × ${T} / ${V} = ${result.toFixed(4)} atm`];
                    }
                    break;
                case 'volume':
                    if (n && R && T && P) {
                        result = (n * R * T) / P;
                        label = '体积 (L)';
                        steps = [`V = nRT/P = ${n} × ${R} × ${T} / ${P} = ${result.toFixed(4)} L`];
                    }
                    break;
                case 'moles':
                    if (P && V && R && T) {
                        result = (P * V) / (R * T);
                        label = '摩尔数 (mol)';
                        steps = [`n = PV/RT = ${P} × ${V} / (${R} × ${T}) = ${result.toFixed(4)} mol`];
                    }
                    break;
                case 'temperature':
                    if (P && V && n && R) {
                        result = (P * V) / (n * R);
                        label = '温度 (K)';
                        steps = [`T = PV/nR = ${P} × ${V} / (${n} × ${R}) = ${result.toFixed(4)} K`];
                    }
                    break;
            }

            if (result !== undefined) {
                document.getElementById('gasValue').textContent = result.toFixed(4);
                document.getElementById('gasLabel').textContent = label;
                document.getElementById('gasSteps').innerHTML = steps.map(step => 
                    `<div class="step"><div class="step-title">计算步骤</div>${step}</div>`
                ).join('');
                document.getElementById('gasSteps').style.display = 'block';
            }
        }

        // 稀释计算
        function calculateDilution() {
            const type = document.getElementById('dilutionType').value;
            const M1 = parseFloat(document.getElementById('initialConcentration').value) || 0;
            const V1 = parseFloat(document.getElementById('initialVolume').value) || 0;
            const M2 = parseFloat(document.getElementById('finalConcentration').value) || 0;
            const V2 = parseFloat(document.getElementById('finalVolume').value) || 0;

            let result, label, steps = [];

            switch(type) {
                case 'finalVolume':
                    if (M1 && V1 && M2) {
                        result = (M1 * V1) / M2;
                        label = '最终体积 (mL)';
                        steps = [
                            `使用稀释公式: M₁V₁ = M₂V₂`,
                            `V₂ = M₁V₁/M₂ = ${M1} × ${V1} / ${M2} = ${result.toFixed(2)} mL`
                        ];
                    }
                    break;
                case 'finalConcentration':
                    if (M1 && V1 && V2) {
                        result = (M1 * V1) / V2;
                        label = '最终浓度 (M)';
                        steps = [
                            `使用稀释公式: M₁V₁ = M₂V₂`,
                            `M₂ = M₁V₁/V₂ = ${M1} × ${V1} / ${V2} = ${result.toFixed(4)} M`
                        ];
                    }
                    break;
                case 'initialVolume':
                    if (M1 && M2 && V2) {
                        result = (M2 * V2) / M1;
                        label = '所需初始体积 (mL)';
                        steps = [
                            `使用稀释公式: M₁V₁ = M₂V₂`,
                            `V₁ = M₂V₂/M₁ = ${M2} × ${V2} / ${M1} = ${result.toFixed(2)} mL`
                        ];
                    }
                    break;
                case 'waterVolume':
                    if (M1 && V1 && M2) {
                        const finalVolume = (M1 * V1) / M2;
                        result = finalVolume - V1;
                        label = '所需加水体积 (mL)';
                        steps = [
                            `最终体积: V₂ = M₁V₁/M₂ = ${M1} × ${V1} / ${M2} = ${finalVolume.toFixed(2)} mL`,
                            `加水体积 = V₂ - V₁ = ${finalVolume.toFixed(2)} - ${V1} = ${result.toFixed(2)} mL`
                        ];
                    }
                    break;
            }

            if (result !== undefined) {
                document.getElementById('dilutionValue').textContent = result.toFixed(2);
                document.getElementById('dilutionLabel').textContent = label;
                document.getElementById('dilutionSteps').innerHTML = steps.map(step => 
                    `<div class="step"><div class="step-title">计算步骤</div>${step}</div>`
                ).join('');
                document.getElementById('dilutionSteps').style.display = 'block';
            }
        }

        // 添加元素输入行
        function addElement() {
            const container = document.getElementById('elementsInput');
            const newRow = document.createElement('div');
            newRow.className = 'element-row';
            newRow.style.cssText = 'display: grid; grid-template-columns: 1fr 1fr auto; gap: 0.5rem; margin-bottom: 0.5rem;';
            newRow.innerHTML = `
                <input type="text" class="calc-input element-symbol" placeholder="元素符号">
                <input type="number" class="calc-input element-count" placeholder="原子数">
                <button class="calculate-btn" style="width: auto; padding: 0.5rem;" onclick="removeElement(this)">-</button>
            `;
            container.appendChild(newRow);
        }

        // 移除元素输入行
        function removeElement(button) {
            button.parentElement.remove();
        }

        // 响应式处理
        window.addEventListener('resize', function() {
            // 处理响应式布局变化
        });
    </script>
</body>
</html> 