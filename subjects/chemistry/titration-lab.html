<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>酸碱滴定实验 - 化学学习助手</title>
    <link rel="icon" href="assets/icons/alex.ico" type="image/x-icon">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/components.css">
    <link rel="stylesheet" href="../../css/utilities.css">
    <link rel="stylesheet" href="../../css/responsive.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .titration-page {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem 0;
        }

        .titration-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            margin: 2rem auto;
            max-width: 1600px;
        }

        .titration-header {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .titration-header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 700;
        }

        .titration-header p {
            margin: 1rem 0 0 0;
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .titration-tabs {
            background: #f8f9fa;
            padding: 0;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            overflow-x: auto;
        }

        .titration-tab {
            padding: 1rem 2rem;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #666;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .titration-tab.active {
            color: #dc3545;
            border-bottom-color: #dc3545;
            background: white;
        }

        .titration-tab:hover {
            color: #dc3545;
            background: #f0f8ff;
        }

        .titration-content {
            padding: 2rem;
            min-height: 600px;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        .virtual-lab {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 2rem;
            height: 600px;
        }

        .lab-equipment {
            background: #f8f9fa;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            border: 2px solid #e9ecef;
            padding: 2rem;
        }

        .lab-canvas {
            width: 100%;
            height: 100%;
            display: block;
            background: linear-gradient(135deg, #f0f8ff 0%, #e8f4f8 100%);
        }

        .lab-controls {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            height: fit-content;
            border: 1px solid #e9ecef;
        }

        .lab-controls h3 {
            margin: 0 0 1rem 0;
            color: #dc3545;
            font-size: 1.2rem;
        }

        .solution-selector {
            margin-bottom: 1.5rem;
        }

        .solution-group {
            margin-bottom: 1rem;
        }

        .solution-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .solution-select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .concentration-input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .titration-controls {
            background: #f0f8ff;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .volume-input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .add-btn {
            padding: 0.5rem 1rem;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .add-btn:hover {
            background: #c82333;
        }

        .ph-display {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 1rem;
            border: 2px solid #dc3545;
        }

        .ph-value {
            font-size: 2rem;
            font-weight: bold;
            color: #dc3545;
            margin-bottom: 0.5rem;
        }

        .ph-label {
            font-size: 0.9rem;
            color: #666;
        }

        .curve-analyzer {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
        }

        .curve-chart {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #e9ecef;
            height: 400px;
            position: relative;
        }

        .chart-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .curve-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .control-card {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            border: 1px solid #e9ecef;
        }

        .control-card h4 {
            margin: 0 0 0.5rem 0;
            color: #dc3545;
        }

        .endpoint-detector {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
        }

        .indicator-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .indicator-card {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            border: 1px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .indicator-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(220, 53, 69, 0.15);
        }

        .indicator-card.selected {
            border-color: #dc3545;
            background: #fff5f5;
        }

        .indicator-color {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 0 auto 0.5rem;
            border: 2px solid #ddd;
        }

        .indicator-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .indicator-range {
            font-size: 0.8rem;
            color: #666;
        }

        .calculations-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
        }

        .calculation-input {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #e9ecef;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .input-field {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .input-field label {
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }

        .input-field input {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .calculation-results {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            border: 1px solid #e9ecef;
        }

        .action-btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #dc3545, #fd7e14);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }

        .action-btn.secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
        }

        @media (max-width: 768px) {
            .virtual-lab {
                grid-template-columns: 1fr;
            }
            
            .titration-tabs {
                flex-direction: column;
            }
            
            .titration-tab {
                text-align: center;
            }
            
            .curve-controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="../../index.html">
                        <i class="fas fa-graduation-cap" style="background: linear-gradient(90deg, #4361ee, #7209b7); -webkit-background-clip: text; background-clip: text; color: transparent;"></i>
                        <span>Alex的学习助手</span>
                    </a>
                </div>
                <nav class="main-nav">
                    <ul>
                        <li><a href="../../index.html">首页</a></li>
                        <li><a href="main.html">化学</a></li>
                        <li><a href="../../index.html#subjects">科目</a></li>
                        <li><a href="../../tts.html">语音</a></li>
                        <li><a href="../../draw.html">绘图</a></li>
                    </ul>
                </nav>
                <button class="mobile-menu-toggle" aria-label="切换菜单">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <main class="titration-page">
        <div class="container">
            <div class="titration-container">
                <div class="titration-header">
                    <h1><i class="fas fa-flask"></i> 酸碱滴定实验</h1>
                    <p>虚拟滴定实验室，学习pH变化和滴定曲线</p>
                </div>

                <div class="titration-tabs">
                    <button class="titration-tab active" data-tab="virtual-lab">虚拟实验</button>
                    <button class="titration-tab" data-tab="curve-analysis">滴定曲线</button>
                    <button class="titration-tab" data-tab="endpoint-detection">终点检测</button>
                    <button class="titration-tab" data-tab="calculations">计算分析</button>
                </div>

                <div class="titration-content">
                    <!-- 虚拟实验标签页 -->
                    <div class="tab-panel active" id="virtual-lab-panel">
                        <div class="virtual-lab">
                            <div class="lab-equipment">
                                <canvas class="lab-canvas" id="lab-canvas" width="800" height="600"></canvas>
                            </div>
                            
                            <div class="lab-controls">
                                <h3><i class="fas fa-cogs"></i> 实验控制</h3>
                                
                                <div class="solution-selector">
                                    <div class="solution-group">
                                        <label>待测溶液 (锥形瓶)</label>
                                        <select class="solution-select" id="analyte-select">
                                            <option value="hcl">盐酸 (HCl)</option>
                                            <option value="naoh">氢氧化钠 (NaOH)</option>
                                            <option value="ch3cooh">醋酸 (CH₃COOH)</option>
                                            <option value="nh3">氨水 (NH₃)</option>
                                        </select>
                                        <input type="number" class="concentration-input" id="analyte-conc" 
                                               placeholder="浓度 (mol/L)" value="0.1" step="0.01" min="0.01" max="1">
                                    </div>
                                    
                                    <div class="solution-group">
                                        <label>滴定剂 (滴定管)</label>
                                        <select class="solution-select" id="titrant-select">
                                            <option value="naoh">氢氧化钠 (NaOH)</option>
                                            <option value="hcl">盐酸 (HCl)</option>
                                            <option value="koh">氢氧化钾 (KOH)</option>
                                            <option value="h2so4">硫酸 (H₂SO₄)</option>
                                        </select>
                                        <input type="number" class="concentration-input" id="titrant-conc" 
                                               placeholder="浓度 (mol/L)" value="0.1" step="0.01" min="0.01" max="1">
                                    </div>
                                </div>

                                <div class="titration-controls">
                                    <h4>滴定操作</h4>
                                    <div class="volume-control">
                                        <input type="number" class="volume-input" id="add-volume" 
                                               placeholder="添加体积 (mL)" value="1" step="0.1" min="0.1" max="10">
                                        <button class="add-btn" id="add-titrant">添加</button>
                                    </div>
                                    <button class="action-btn" id="auto-titrate" style="width: 100%; margin-bottom: 0.5rem;">自动滴定</button>
                                    <button class="action-btn secondary" id="reset-experiment" style="width: 100%;">重置实验</button>
                                </div>

                                <div class="ph-display">
                                    <div class="ph-value" id="ph-value">7.00</div>
                                    <div class="ph-label">当前pH值</div>
                                </div>

                                <div style="background: white; padding: 1rem; border-radius: 8px;">
                                    <h4 style="margin: 0 0 0.5rem 0; color: #dc3545;">实验数据</h4>
                                    <p style="margin: 0; font-size: 0.9rem;"><strong>已添加体积:</strong> <span id="total-volume">0.0</span> mL</p>
                                    <p style="margin: 0; font-size: 0.9rem;"><strong>溶液颜色:</strong> <span id="solution-color">无色</span></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 滴定曲线标签页 -->
                    <div class="tab-panel" id="curve-analysis-panel">
                        <h2>滴定曲线分析</h2>
                        <div class="curve-analyzer">
                            <div class="curve-chart">
                                <canvas class="chart-canvas" id="curve-canvas" width="600" height="300"></canvas>
                            </div>
                            
                            <div class="curve-controls">
                                <div class="control-card">
                                    <h4>强酸-强碱</h4>
                                    <p>HCl + NaOH</p>
                                    <button class="action-btn" onclick="titrationLab.showCurve('strong-strong')">显示曲线</button>
                                </div>
                                <div class="control-card">
                                    <h4>弱酸-强碱</h4>
                                    <p>CH₃COOH + NaOH</p>
                                    <button class="action-btn" onclick="titrationLab.showCurve('weak-strong')">显示曲线</button>
                                </div>
                                <div class="control-card">
                                    <h4>强酸-弱碱</h4>
                                    <p>HCl + NH₃</p>
                                    <button class="action-btn" onclick="titrationLab.showCurve('strong-weak')">显示曲线</button>
                                </div>
                                <div class="control-card">
                                    <h4>弱酸-弱碱</h4>
                                    <p>CH₃COOH + NH₃</p>
                                    <button class="action-btn" onclick="titrationLab.showCurve('weak-weak')">显示曲线</button>
                                </div>
                            </div>

                            <div style="text-align: center;">
                                <button class="action-btn secondary" id="clear-curve">清空曲线</button>
                            </div>
                        </div>
                    </div>

                    <!-- 终点检测标签页 -->
                    <div class="tab-panel" id="endpoint-detection-panel">
                        <h2>指示剂与终点检测</h2>
                        <div class="endpoint-detector">
                            <div class="indicator-selector">
                                <div class="indicator-card selected" data-indicator="phenolphthalein">
                                    <div class="indicator-color" style="background: linear-gradient(45deg, transparent 50%, #ff69b4 50%);"></div>
                                    <div class="indicator-name">酚酞</div>
                                    <div class="indicator-range">pH 8.2-10.0</div>
                                </div>
                                <div class="indicator-card" data-indicator="methyl-orange">
                                    <div class="indicator-color" style="background: linear-gradient(45deg, #ff4500 50%, #ffff00 50%);"></div>
                                    <div class="indicator-name">甲基橙</div>
                                    <div class="indicator-range">pH 3.1-4.4</div>
                                </div>
                                <div class="indicator-card" data-indicator="bromothymol-blue">
                                    <div class="indicator-color" style="background: linear-gradient(45deg, #ffff00 50%, #0000ff 50%);"></div>
                                    <div class="indicator-name">溴百里酚蓝</div>
                                    <div class="indicator-range">pH 6.0-7.6</div>
                                </div>
                                <div class="indicator-card" data-indicator="universal">
                                    <div class="indicator-color" style="background: linear-gradient(45deg, #ff0000, #ffff00, #00ff00, #0000ff);"></div>
                                    <div class="indicator-name">广泛pH试纸</div>
                                    <div class="indicator-range">pH 1-14</div>
                                </div>
                            </div>

                            <div style="background: white; padding: 2rem; border-radius: 10px; border: 1px solid #e9ecef;">
                                <h4>指示剂选择指南</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                                    <div>
                                        <h5>强酸-强碱滴定</h5>
                                        <p>等当点pH ≈ 7，可选择甲基橙、酚酞或溴百里酚蓝</p>
                                    </div>
                                    <div>
                                        <h5>弱酸-强碱滴定</h5>
                                        <p>等当点pH > 7，建议选择酚酞</p>
                                    </div>
                                    <div>
                                        <h5>强酸-弱碱滴定</h5>
                                        <p>等当点pH < 7，建议选择甲基橙</p>
                                    </div>
                                    <div>
                                        <h5>弱酸-弱碱滴定</h5>
                                        <p>等当点不明显，不适合用指示剂</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 计算分析标签页 -->
                    <div class="tab-panel" id="calculations-panel">
                        <h2>滴定计算与分析</h2>
                        <div class="calculations-panel">
                            <div class="calculation-input">
                                <h4>输入实验数据</h4>
                                <div class="input-grid">
                                    <div class="input-field">
                                        <label>待测溶液体积 (mL)</label>
                                        <input type="number" id="calc-analyte-volume" value="25.0" step="0.1">
                                    </div>
                                    <div class="input-field">
                                        <label>滴定剂浓度 (mol/L)</label>
                                        <input type="number" id="calc-titrant-conc" value="0.1000" step="0.0001">
                                    </div>
                                    <div class="input-field">
                                        <label>消耗滴定剂体积 (mL)</label>
                                        <input type="number" id="calc-titrant-volume" value="24.8" step="0.1">
                                    </div>
                                    <div class="input-field">
                                        <label>反应计量比</label>
                                        <select id="calc-stoichiometry">
                                            <option value="1:1">1:1 (单质子酸碱)</option>
                                            <option value="1:2">1:2 (双质子酸)</option>
                                            <option value="2:1">2:1 (双质子碱)</option>
                                        </select>
                                    </div>
                                </div>
                                <button class="action-btn" id="calculate-concentration">计算浓度</button>
                            </div>

                            <div class="calculation-results" id="calculation-results">
                                <h4>计算结果</h4>
                                <p>请输入实验数据并点击"计算浓度"按钮</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <p class="copyright-text">study-llm.me域名为Alex所有。保留所有权利。</p>
            </div>
        </div>
    </footer>

    <script src="../../js/common.js"></script>
    <script src="../../js/navigation.js"></script>
    <script>
        // 滴定实验功能
        class TitrationLab {
            constructor() {
                this.labCanvas = document.getElementById('lab-canvas');
                this.labCtx = this.labCanvas.getContext('2d');
                this.curveCanvas = document.getElementById('curve-canvas');
                this.curveCtx = this.curveCanvas.getContext('2d');
                
                this.currentPH = 7.0;
                this.totalVolume = 0.0;
                this.titrationData = [];
                this.selectedIndicator = 'phenolphthalein';
                
                this.initializeEventListeners();
                this.drawLabEquipment();
                this.drawCurveAxes();
            }

            initializeEventListeners() {
                // 标签页切换
                document.querySelectorAll('.titration-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        this.switchTab(e.target.dataset.tab);
                    });
                });

                // 滴定控制
                document.getElementById('add-titrant').addEventListener('click', () => {
                    this.addTitrant();
                });

                document.getElementById('auto-titrate').addEventListener('click', () => {
                    this.autoTitrate();
                });

                document.getElementById('reset-experiment').addEventListener('click', () => {
                    this.resetExperiment();
                });

                // 指示剂选择
                document.querySelectorAll('.indicator-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        this.selectIndicator(e.target.closest('.indicator-card'));
                    });
                });

                // 计算功能
                document.getElementById('calculate-concentration').addEventListener('click', () => {
                    this.calculateConcentration();
                });

                document.getElementById('clear-curve').addEventListener('click', () => {
                    this.clearCurve();
                });
            }

            switchTab(tabName) {
                // 更新标签页状态
                document.querySelectorAll('.titration-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

                // 显示对应面板
                document.querySelectorAll('.tab-panel').forEach(panel => {
                    panel.classList.remove('active');
                });
                document.getElementById(`${tabName}-panel`).classList.add('active');
            }

            drawLabEquipment() {
                this.labCtx.clearRect(0, 0, this.labCanvas.width, this.labCanvas.height);

                // 绘制实验台
                this.labCtx.fillStyle = '#8B4513';
                this.labCtx.fillRect(0, 500, this.labCanvas.width, 100);

                // 绘制滴定管
                this.labCtx.strokeStyle = '#333';
                this.labCtx.lineWidth = 3;
                this.labCtx.beginPath();
                this.labCtx.rect(150, 100, 30, 300);
                this.labCtx.stroke();

                // 滴定管刻度
                this.labCtx.strokeStyle = '#666';
                this.labCtx.lineWidth = 1;
                for (let i = 0; i <= 10; i++) {
                    const y = 120 + i * 25;
                    this.labCtx.beginPath();
                    this.labCtx.moveTo(150, y);
                    this.labCtx.lineTo(160, y);
                    this.labCtx.stroke();
                    
                    this.labCtx.fillStyle = '#333';
                    this.labCtx.font = '12px Arial';
                    this.labCtx.fillText((10 - i * 1).toString(), 185, y + 4);
                }

                // 滴定管中的溶液
                const solutionHeight = Math.max(0, 250 - this.totalVolume * 10);
                this.labCtx.fillStyle = '#87CEEB';
                this.labCtx.fillRect(152, 120 + solutionHeight, 26, 250 - solutionHeight);

                // 绘制锥形瓶
                this.labCtx.strokeStyle = '#333';
                this.labCtx.lineWidth = 3;
                this.labCtx.beginPath();
                this.labCtx.moveTo(400, 350);
                this.labCtx.lineTo(450, 450);
                this.labCtx.lineTo(550, 450);
                this.labCtx.lineTo(600, 350);
                this.labCtx.lineTo(580, 350);
                this.labCtx.lineTo(580, 320);
                this.labCtx.lineTo(420, 320);
                this.labCtx.lineTo(420, 350);
                this.labCtx.closePath();
                this.labCtx.stroke();

                // 锥形瓶中的溶液
                const flaskSolutionColor = this.getSolutionColor();
                this.labCtx.fillStyle = flaskSolutionColor;
                this.labCtx.beginPath();
                this.labCtx.moveTo(420, 350);
                this.labCtx.lineTo(460, 430);
                this.labCtx.lineTo(540, 430);
                this.labCtx.lineTo(580, 350);
                this.labCtx.closePath();
                this.labCtx.fill();

                // 绘制滴液
                if (this.isDropping) {
                    this.labCtx.fillStyle = '#87CEEB';
                    this.labCtx.beginPath();
                    this.labCtx.arc(165, 410, 3, 0, 2 * Math.PI);
                    this.labCtx.fill();
                }

                // 标签
                this.labCtx.fillStyle = '#333';
                this.labCtx.font = '16px Arial';
                this.labCtx.fillText('滴定管', 120, 80);
                this.labCtx.fillText('锥形瓶', 480, 300);
            }

            getSolutionColor() {
                const analyte = document.getElementById('analyte-select').value;
                
                // 根据pH和指示剂确定颜色
                if (this.selectedIndicator === 'phenolphthalein') {
                    if (this.currentPH >= 8.2) {
                        return '#ff69b4'; // 粉红色
                    } else {
                        return 'rgba(135, 206, 235, 0.3)'; // 无色
                    }
                } else if (this.selectedIndicator === 'methyl-orange') {
                    if (this.currentPH <= 3.1) {
                        return '#ff4500'; // 红色
                    } else if (this.currentPH >= 4.4) {
                        return '#ffff00'; // 黄色
                    } else {
                        return '#ffa500'; // 橙色
                    }
                } else if (this.selectedIndicator === 'bromothymol-blue') {
                    if (this.currentPH <= 6.0) {
                        return '#ffff00'; // 黄色
                    } else if (this.currentPH >= 7.6) {
                        return '#0000ff'; // 蓝色
                    } else {
                        return '#00ff00'; // 绿色
                    }
                }
                
                return 'rgba(135, 206, 235, 0.3)'; // 默认无色
            }

            addTitrant() {
                const volume = parseFloat(document.getElementById('add-volume').value) || 1.0;
                const analyte = document.getElementById('analyte-select').value;
                const titrant = document.getElementById('titrant-select').value;
                const analyteConc = parseFloat(document.getElementById('analyte-conc').value) || 0.1;
                const titrantConc = parseFloat(document.getElementById('titrant-conc').value) || 0.1;

                this.totalVolume += volume;
                
                // 计算新的pH值
                this.currentPH = this.calculatePH(analyte, titrant, analyteConc, titrantConc, this.totalVolume);
                
                // 记录数据点
                this.titrationData.push({ volume: this.totalVolume, pH: this.currentPH });
                
                // 更新显示
                this.updateDisplay();
                this.drawLabEquipment();
                
                // 显示滴液动画
                this.showDropAnimation();
            }

            calculatePH(analyte, titrant, analyteConc, titrantConc, addedVolume) {
                const initialVolume = 25.0; // 假设初始体积25mL
                
                // 简化的pH计算
                if (analyte === 'hcl' && titrant === 'naoh') {
                    // 强酸-强碱
                    const initialMoles = analyteConc * initialVolume / 1000;
                    const addedMoles = titrantConc * addedVolume / 1000;
                    const totalVolume = initialVolume + addedVolume;
                    
                    if (addedMoles < initialMoles) {
                        // 过量酸
                        const excessH = (initialMoles - addedMoles) / (totalVolume / 1000);
                        return -Math.log10(excessH);
                    } else if (addedMoles > initialMoles) {
                        // 过量碱
                        const excessOH = (addedMoles - initialMoles) / (totalVolume / 1000);
                        return 14 + Math.log10(excessOH);
                    } else {
                        // 等当点
                        return 7.0;
                    }
                } else if (analyte === 'ch3cooh' && titrant === 'naoh') {
                    // 弱酸-强碱
                    const initialMoles = analyteConc * initialVolume / 1000;
                    const addedMoles = titrantConc * addedVolume / 1000;
                    
                    if (addedMoles < initialMoles * 0.5) {
                        return 4.76 + Math.log10(addedMoles / (initialMoles - addedMoles));
                    } else if (addedMoles < initialMoles) {
                        return 4.76 + Math.log10(addedMoles / (initialMoles - addedMoles));
                    } else if (addedMoles === initialMoles) {
                        return 8.72; // 等当点
                    } else {
                        const excessOH = (addedMoles - initialMoles) / ((initialVolume + addedVolume) / 1000);
                        return 14 + Math.log10(excessOH);
                    }
                }
                
                // 默认返回中性
                return 7.0;
            }

            showDropAnimation() {
                this.isDropping = true;
                this.drawLabEquipment();
                
                setTimeout(() => {
                    this.isDropping = false;
                    this.drawLabEquipment();
                }, 200);
            }

            updateDisplay() {
                document.getElementById('ph-value').textContent = this.currentPH.toFixed(2);
                document.getElementById('total-volume').textContent = this.totalVolume.toFixed(1);
                
                const color = this.getSolutionColor();
                let colorName = '无色';
                if (color.includes('#ff69b4')) colorName = '粉红色';
                else if (color.includes('#ff4500')) colorName = '红色';
                else if (color.includes('#ffff00')) colorName = '黄色';
                else if (color.includes('#0000ff')) colorName = '蓝色';
                
                document.getElementById('solution-color').textContent = colorName;
            }

            autoTitrate() {
                const interval = setInterval(() => {
                    this.addTitrant();
                    
                    if (this.totalVolume >= 30 || Math.abs(this.currentPH - 7) < 0.1) {
                        clearInterval(interval);
                    }
                }, 500);
            }

            resetExperiment() {
                this.currentPH = 7.0;
                this.totalVolume = 0.0;
                this.titrationData = [];
                this.updateDisplay();
                this.drawLabEquipment();
            }

            selectIndicator(card) {
                document.querySelectorAll('.indicator-card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
                this.selectedIndicator = card.dataset.indicator;
                this.drawLabEquipment();
            }

            drawCurveAxes() {
                this.curveCtx.clearRect(0, 0, this.curveCanvas.width, this.curveCanvas.height);
                
                // 绘制坐标轴
                this.curveCtx.strokeStyle = '#333';
                this.curveCtx.lineWidth = 2;
                this.curveCtx.beginPath();
                this.curveCtx.moveTo(50, 250);
                this.curveCtx.lineTo(550, 250);
                this.curveCtx.moveTo(50, 250);
                this.curveCtx.lineTo(50, 50);
                this.curveCtx.stroke();
                
                // 标签
                this.curveCtx.fillStyle = '#333';
                this.curveCtx.font = '14px Arial';
                this.curveCtx.fillText('滴定剂体积 (mL)', 250, 280);
                this.curveCtx.save();
                this.curveCtx.translate(20, 150);
                this.curveCtx.rotate(-Math.PI / 2);
                this.curveCtx.fillText('pH', 0, 0);
                this.curveCtx.restore();
                
                // pH刻度
                for (let i = 0; i <= 14; i += 2) {
                    const y = 250 - i * 200 / 14;
                    this.curveCtx.strokeStyle = '#ddd';
                    this.curveCtx.lineWidth = 1;
                    this.curveCtx.beginPath();
                    this.curveCtx.moveTo(50, y);
                    this.curveCtx.lineTo(550, y);
                    this.curveCtx.stroke();
                    
                    this.curveCtx.fillStyle = '#333';
                    this.curveCtx.font = '12px Arial';
                    this.curveCtx.fillText(i.toString(), 35, y + 4);
                }
                
                // 体积刻度
                for (let i = 0; i <= 50; i += 10) {
                    const x = 50 + i * 500 / 50;
                    this.curveCtx.strokeStyle = '#ddd';
                    this.curveCtx.lineWidth = 1;
                    this.curveCtx.beginPath();
                    this.curveCtx.moveTo(x, 50);
                    this.curveCtx.lineTo(x, 250);
                    this.curveCtx.stroke();
                    
                    this.curveCtx.fillStyle = '#333';
                    this.curveCtx.font = '12px Arial';
                    this.curveCtx.fillText(i.toString(), x - 5, 265);
                }
            }

            showCurve(type) {
                this.drawCurveAxes();
                
                const curves = {
                    'strong-strong': this.generateStrongStrongCurve(),
                    'weak-strong': this.generateWeakStrongCurve(),
                    'strong-weak': this.generateStrongWeakCurve(),
                    'weak-weak': this.generateWeakWeakCurve()
                };
                
                const curve = curves[type];
                if (!curve) return;
                
                this.curveCtx.strokeStyle = '#dc3545';
                this.curveCtx.lineWidth = 3;
                this.curveCtx.beginPath();
                
                curve.forEach((point, index) => {
                    const x = 50 + point.volume * 500 / 50;
                    const y = 250 - point.pH * 200 / 14;
                    
                    if (index === 0) {
                        this.curveCtx.moveTo(x, y);
                    } else {
                        this.curveCtx.lineTo(x, y);
                    }
                });
                
                this.curveCtx.stroke();
                
                // 标记等当点
                const equivalencePoint = curve.find(p => Math.abs(p.volume - 25) < 1);
                if (equivalencePoint) {
                    const x = 50 + equivalencePoint.volume * 500 / 50;
                    const y = 250 - equivalencePoint.pH * 200 / 14;
                    
                    this.curveCtx.fillStyle = '#dc3545';
                    this.curveCtx.beginPath();
                    this.curveCtx.arc(x, y, 5, 0, 2 * Math.PI);
                    this.curveCtx.fill();
                    
                    this.curveCtx.fillStyle = '#333';
                    this.curveCtx.font = '12px Arial';
                    this.curveCtx.fillText('等当点', x + 10, y - 10);
                }
            }

            generateStrongStrongCurve() {
                const curve = [];
                for (let v = 0; v <= 40; v += 0.5) {
                    let pH;
                    if (v < 24.9) {
                        const excessH = (0.1 * 25 - 0.1 * v) / (25 + v) * 1000;
                        pH = -Math.log10(excessH);
                    } else if (v > 25.1) {
                        const excessOH = (0.1 * v - 0.1 * 25) / (25 + v) * 1000;
                        pH = 14 + Math.log10(excessOH);
                    } else {
                        pH = 7.0;
                    }
                    curve.push({ volume: v, pH: Math.max(0, Math.min(14, pH)) });
                }
                return curve;
            }

            generateWeakStrongCurve() {
                const curve = [];
                for (let v = 0; v <= 40; v += 0.5) {
                    let pH;
                    if (v === 0) {
                        pH = 2.87; // 0.1M醋酸的pH
                    } else if (v < 25) {
                        // 缓冲区
                        const ratio = v / (25 - v);
                        pH = 4.76 + Math.log10(ratio);
                    } else if (v === 25) {
                        pH = 8.72; // 等当点
                    } else {
                        const excessOH = (0.1 * v - 0.1 * 25) / (25 + v) * 1000;
                        pH = 14 + Math.log10(excessOH);
                    }
                    curve.push({ volume: v, pH: Math.max(0, Math.min(14, pH)) });
                }
                return curve;
            }

            generateStrongWeakCurve() {
                const curve = [];
                for (let v = 0; v <= 40; v += 0.5) {
                    let pH;
                    if (v === 0) {
                        pH = 11.13; // 0.1M氨水的pH
                    } else if (v < 25) {
                        // 缓冲区
                        const ratio = (25 - v) / v;
                        pH = 9.25 + Math.log10(ratio);
                    } else if (v === 25) {
                        pH = 5.28; // 等当点
                    } else {
                        const excessH = (0.1 * v - 0.1 * 25) / (25 + v) * 1000;
                        pH = -Math.log10(excessH);
                    }
                    curve.push({ volume: v, pH: Math.max(0, Math.min(14, pH)) });
                }
                return curve;
            }

            generateWeakWeakCurve() {
                const curve = [];
                for (let v = 0; v <= 40; v += 0.5) {
                    let pH = 7.0; // 简化处理，弱酸弱碱滴定曲线不明显
                    curve.push({ volume: v, pH });
                }
                return curve;
            }

            clearCurve() {
                this.drawCurveAxes();
            }

            calculateConcentration() {
                const analyteVolume = parseFloat(document.getElementById('calc-analyte-volume').value);
                const titrantConc = parseFloat(document.getElementById('calc-titrant-conc').value);
                const titrantVolume = parseFloat(document.getElementById('calc-titrant-volume').value);
                const stoichiometry = document.getElementById('calc-stoichiometry').value;
                
                if (!analyteVolume || !titrantConc || !titrantVolume) {
                    alert('请填写完整的数据');
                    return;
                }
                
                let ratio = 1;
                if (stoichiometry === '1:2') ratio = 0.5;
                else if (stoichiometry === '2:1') ratio = 2;
                
                const analyteConc = (titrantConc * titrantVolume * ratio) / analyteVolume;
                
                const resultsDiv = document.getElementById('calculation-results');
                resultsDiv.innerHTML = `
                    <h4>计算结果</h4>
                    <p><strong>待测溶液浓度:</strong> ${analyteConc.toFixed(4)} mol/L</p>
                    <p><strong>滴定剂消耗的摩尔数:</strong> ${(titrantConc * titrantVolume / 1000).toFixed(6)} mol</p>
                    <p><strong>待测物质的摩尔数:</strong> ${(analyteConc * analyteVolume / 1000).toFixed(6)} mol</p>
                    <h5>计算过程:</h5>
                    <p>根据化学计量关系: n(待测) = n(滴定剂) × ${ratio}</p>
                    <p>c(待测) = n(待测) / V(待测) = ${analyteConc.toFixed(4)} mol/L</p>
                `;
            }
        }

        // 初始化滴定实验
        let titrationLab;
        document.addEventListener('DOMContentLoaded', () => {
            titrationLab = new TitrationLab();
        });
    </script>
</body>
</html> 