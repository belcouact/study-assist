<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>有机化学工具 - 化学学习助手</title>
    <link rel="icon" href="../../assets/icons/alex.ico" type="image/x-icon">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/components.css">
    <link rel="stylesheet" href="../../css/utilities.css">
    <link rel="stylesheet" href="../../css/responsive.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .organic-page {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem 0;
        }

        .organic-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            margin: 2rem auto;
            max-width: 1600px;
        }

        .organic-header {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .organic-header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 700;
        }

        .organic-header p {
            margin: 1rem 0 0 0;
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .organic-tabs {
            background: #f8f9fa;
            padding: 0;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            overflow-x: auto;
        }

        .organic-tab {
            padding: 1rem 2rem;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #666;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .organic-tab.active {
            color: #dc3545;
            border-bottom-color: #dc3545;
            background: white;
        }

        .organic-tab:hover {
            color: #dc3545;
            background: #f0f8ff;
        }

        .organic-content {
            padding: 2rem;
            min-height: 600px;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        .molecular-drawer {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 2rem;
            height: 600px;
        }

        .drawing-canvas {
            background: #f8f9fa;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            border: 2px solid #e9ecef;
        }

        .canvas-area {
            width: 100%;
            height: 100%;
            display: block;
            background: white;
            cursor: crosshair;
        }

        .drawing-tools {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            height: fit-content;
            border: 1px solid #e9ecef;
        }

        .drawing-tools h3 {
            margin: 0 0 1rem 0;
            color: #dc3545;
            font-size: 1.2rem;
        }

        .tool-section {
            margin-bottom: 1.5rem;
        }

        .tool-section h4 {
            margin: 0 0 0.5rem 0;
            color: #333;
            font-size: 1rem;
        }

        .tool-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }

        .tool-btn {
            padding: 0.5rem;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.8rem;
        }

        .tool-btn:hover {
            border-color: #dc3545;
            background: #fff5f5;
        }

        .tool-btn.active {
            border-color: #dc3545;
            background: #dc3545;
            color: white;
        }

        .element-selector {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.3rem;
            margin-bottom: 1rem;
        }

        .element-btn {
            padding: 0.3rem;
            border: 1px solid #ddd;
            background: white;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .element-btn:hover {
            border-color: #dc3545;
            background: #fff5f5;
        }

        .element-btn.selected {
            border-color: #dc3545;
            background: #dc3545;
            color: white;
        }

        .naming-analyzer {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
        }

        .molecule-input {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #e9ecef;
        }

        .structure-input {
            width: 100%;
            height: 100px;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.9rem;
            resize: vertical;
        }

        .naming-results {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            border: 1px solid #e9ecef;
            margin-bottom: 2rem;
        }

        .functional-groups {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .group-card {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            border: 1px solid #e9ecef;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .group-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(220, 53, 69, 0.15);
        }

        .group-card.selected {
            border-color: #dc3545;
            background: #fff5f5;
        }

        .group-structure {
            font-family: monospace;
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: #dc3545;
        }

        .group-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.3rem;
        }

        .group-formula {
            font-size: 0.8rem;
            color: #666;
        }

        .reaction-simulator {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
        }

        .reaction-canvas {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #e9ecef;
            height: 400px;
            position: relative;
        }

        .reaction-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .reaction-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            border: 1px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .reaction-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(220, 53, 69, 0.15);
        }

        .reaction-card.selected {
            border-color: #dc3545;
            background: #fff5f5;
        }

        .reaction-title {
            font-weight: 600;
            color: #dc3545;
            margin-bottom: 0.5rem;
        }

        .reaction-equation {
            font-family: monospace;
            background: #f8f9fa;
            padding: 0.5rem;
            border-radius: 5px;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .reaction-description {
            font-size: 0.8rem;
            color: #666;
        }

        .properties-analyzer {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
        }

        .property-input {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #e9ecef;
        }

        .property-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .property-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            border: 1px solid #e9ecef;
            text-align: center;
        }

        .property-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #dc3545;
            margin-bottom: 0.5rem;
        }

        .property-label {
            font-size: 0.9rem;
            color: #666;
        }

        .action-btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #dc3545, #fd7e14);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }

        .action-btn.secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
        }

        @media (max-width: 768px) {
            .molecular-drawer {
                grid-template-columns: 1fr;
            }
            
            .organic-tabs {
                flex-direction: column;
            }
            
            .organic-tab {
                text-align: center;
            }
            
            .tool-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="../../index.html">
                        <i class="fas fa-graduation-cap" style="background: linear-gradient(90deg, #4361ee, #7209b7); -webkit-background-clip: text; background-clip: text; color: transparent;"></i>
                        <span>Alex的学习助手</span>
                    </a>
                </div>
                <nav class="main-nav">
                    <ul>
                        <li><a href="../../index.html">首页</a></li>
                        <li><a href="index.html">化学</a></li>
                        <li><a href="../../index.html#subjects">科目</a></li>
                        <li><a href="../../tts.html">语音</a></li>
                        <li><a href="../../draw.html">绘图</a></li>
                    </ul>
                </nav>
                <button class="mobile-menu-toggle" aria-label="切换菜单">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <main class="organic-page">
        <div class="container">
            <div class="organic-container">
                <div class="organic-header">
                    <h1><i class="fas fa-bezier-curve"></i> 有机化学工具</h1>
                    <p>有机分子绘制、命名和反应机理学习工具</p>
                </div>

                <div class="organic-tabs">
                    <button class="organic-tab active" data-tab="molecular-drawer">分子绘制</button>
                    <button class="organic-tab" data-tab="naming">IUPAC命名</button>
                    <button class="organic-tab" data-tab="reactions">反应机理</button>
                    <button class="organic-tab" data-tab="properties">性质分析</button>
                </div>

                <div class="organic-content">
                    <!-- 分子绘制标签页 -->
                    <div class="tab-panel active" id="molecular-drawer-panel">
                        <div class="molecular-drawer">
                            <div class="drawing-canvas">
                                <canvas class="canvas-area" id="drawing-canvas" width="800" height="600"></canvas>
                            </div>
                            
                            <div class="drawing-tools">
                                <h3><i class="fas fa-palette"></i> 绘制工具</h3>
                                
                                <div class="tool-section">
                                    <h4>绘制模式</h4>
                                    <div class="tool-buttons">
                                        <button class="tool-btn active" data-tool="bond">单键</button>
                                        <button class="tool-btn" data-tool="double-bond">双键</button>
                                        <button class="tool-btn" data-tool="triple-bond">三键</button>
                                        <button class="tool-btn" data-tool="benzene">苯环</button>
                                        <button class="tool-btn" data-tool="chain">碳链</button>
                                        <button class="tool-btn" data-tool="erase">擦除</button>
                                    </div>
                                </div>

                                <div class="tool-section">
                                    <h4>元素选择</h4>
                                    <div class="element-selector">
                                        <button class="element-btn selected" data-element="C">C</button>
                                        <button class="element-btn" data-element="H">H</button>
                                        <button class="element-btn" data-element="O">O</button>
                                        <button class="element-btn" data-element="N">N</button>
                                        <button class="element-btn" data-element="S">S</button>
                                        <button class="element-btn" data-element="P">P</button>
                                        <button class="element-btn" data-element="F">F</button>
                                        <button class="element-btn" data-element="Cl">Cl</button>
                                        <button class="element-btn" data-element="Br">Br</button>
                                        <button class="element-btn" data-element="I">I</button>
                                    </div>
                                </div>

                                <div class="tool-section">
                                    <h4>快速结构</h4>
                                    <div class="tool-buttons">
                                        <button class="tool-btn" data-template="methane">甲烷</button>
                                        <button class="tool-btn" data-template="ethanol">乙醇</button>
                                        <button class="tool-btn" data-template="benzene">苯</button>
                                        <button class="tool-btn" data-template="glucose">葡萄糖</button>
                                    </div>
                                </div>

                                <div style="margin-top: 1rem;">
                                    <button class="action-btn" id="analyze-structure" style="width: 100%; margin-bottom: 0.5rem;">分析结构</button>
                                    <button class="action-btn secondary" id="clear-canvas" style="width: 100%;">清空画布</button>
                                </div>

                                <div style="background: #f0f8ff; padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                                    <h4 style="margin: 0 0 0.5rem 0; color: #dc3545;">分子信息</h4>
                                    <p style="margin: 0; font-size: 0.9rem;"><strong>分子式:</strong> <span id="molecular-formula">-</span></p>
                                    <p style="margin: 0; font-size: 0.9rem;"><strong>原子数:</strong> <span id="atom-count">0</span></p>
                                    <p style="margin: 0; font-size: 0.9rem;"><strong>键数:</strong> <span id="bond-count">0</span></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- IUPAC命名标签页 -->
                    <div class="tab-panel" id="naming-panel">
                        <h2>IUPAC命名系统</h2>
                        <div class="naming-analyzer">
                            <div class="molecule-input">
                                <h4>输入分子结构</h4>
                                <textarea class="structure-input" id="structure-input" 
                                          placeholder="请输入分子的SMILES表示法或结构描述，例如：&#10;CCO (乙醇)&#10;CC(C)C (异丁烷)&#10;c1ccccc1 (苯)"></textarea>
                                <button class="action-btn" id="analyze-naming" style="margin-top: 1rem;">分析命名</button>
                            </div>

                            <div class="naming-results" id="naming-results">
                                <h4>命名结果</h4>
                                <p>请输入分子结构进行分析</p>
                            </div>

                            <div class="functional-groups">
                                <div class="group-card" data-group="alkane">
                                    <div class="group-structure">-CH₂-CH₂-</div>
                                    <div class="group-name">烷烃</div>
                                    <div class="group-formula">CₙH₂ₙ₊₂</div>
                                </div>
                                <div class="group-card" data-group="alkene">
                                    <div class="group-structure">C=C</div>
                                    <div class="group-name">烯烃</div>
                                    <div class="group-formula">CₙH₂ₙ</div>
                                </div>
                                <div class="group-card" data-group="alkyne">
                                    <div class="group-structure">C≡C</div>
                                    <div class="group-name">炔烃</div>
                                    <div class="group-formula">CₙH₂ₙ₋₂</div>
                                </div>
                                <div class="group-card" data-group="alcohol">
                                    <div class="group-structure">-OH</div>
                                    <div class="group-name">醇</div>
                                    <div class="group-formula">R-OH</div>
                                </div>
                                <div class="group-card" data-group="aldehyde">
                                    <div class="group-structure">-CHO</div>
                                    <div class="group-name">醛</div>
                                    <div class="group-formula">R-CHO</div>
                                </div>
                                <div class="group-card" data-group="ketone">
                                    <div class="group-structure">C=O</div>
                                    <div class="group-name">酮</div>
                                    <div class="group-formula">R-CO-R'</div>
                                </div>
                                <div class="group-card" data-group="carboxylic">
                                    <div class="group-structure">-COOH</div>
                                    <div class="group-name">羧酸</div>
                                    <div class="group-formula">R-COOH</div>
                                </div>
                                <div class="group-card" data-group="ester">
                                    <div class="group-structure">-COO-</div>
                                    <div class="group-name">酯</div>
                                    <div class="group-formula">R-COO-R'</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 反应机理标签页 -->
                    <div class="tab-panel" id="reactions-panel">
                        <h2>有机反应机理</h2>
                        <div class="reaction-simulator">
                            <div class="reaction-canvas">
                                <canvas id="reaction-canvas" width="600" height="350"></canvas>
                            </div>
                            
                            <div class="reaction-types">
                                <div class="reaction-card" data-reaction="substitution">
                                    <div class="reaction-title">亲核取代反应 (SN)</div>
                                    <div class="reaction-equation">R-X + Nu⁻ → R-Nu + X⁻</div>
                                    <div class="reaction-description">亲核试剂攻击碳原子，取代离去基团</div>
                                </div>
                                <div class="reaction-card" data-reaction="elimination">
                                    <div class="reaction-title">消除反应 (E)</div>
                                    <div class="reaction-equation">R-CH₂-CH₂-X → R-CH=CH₂ + HX</div>
                                    <div class="reaction-description">消除小分子形成双键</div>
                                </div>
                                <div class="reaction-card" data-reaction="addition">
                                    <div class="reaction-title">加成反应</div>
                                    <div class="reaction-equation">R-CH=CH₂ + HX → R-CHX-CH₃</div>
                                    <div class="reaction-description">不饱和化合物与试剂加成</div>
                                </div>
                                <div class="reaction-card" data-reaction="oxidation">
                                    <div class="reaction-title">氧化反应</div>
                                    <div class="reaction-equation">R-CH₂OH → R-CHO → R-COOH</div>
                                    <div class="reaction-description">醇氧化为醛或羧酸</div>
                                </div>
                                <div class="reaction-card" data-reaction="reduction">
                                    <div class="reaction-title">还原反应</div>
                                    <div class="reaction-equation">R-CHO + H₂ → R-CH₂OH</div>
                                    <div class="reaction-description">羰基化合物还原为醇</div>
                                </div>
                                <div class="reaction-card" data-reaction="esterification">
                                    <div class="reaction-title">酯化反应</div>
                                    <div class="reaction-equation">R-COOH + R'OH → R-COO-R' + H₂O</div>
                                    <div class="reaction-description">羧酸与醇形成酯</div>
                                </div>
                            </div>

                            <div style="text-align: center;">
                                <button class="action-btn" id="simulate-reaction">模拟反应</button>
                                <button class="action-btn secondary" id="clear-reaction">清空反应</button>
                            </div>
                        </div>
                    </div>

                    <!-- 性质分析标签页 -->
                    <div class="tab-panel" id="properties-panel">
                        <h2>分子性质分析</h2>
                        <div class="properties-analyzer">
                            <div class="property-input">
                                <h4>输入分子信息</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">分子式</label>
                                        <input type="text" id="property-formula" placeholder="例如：C2H6O" style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 5px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">分子量 (g/mol)</label>
                                        <input type="number" id="property-weight" placeholder="例如：46.07" style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 5px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">沸点 (°C)</label>
                                        <input type="number" id="property-bp" placeholder="例如：78.4" style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 5px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">密度 (g/cm³)</label>
                                        <input type="number" id="property-density" placeholder="例如：0.789" step="0.001" style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 5px;">
                                    </div>
                                </div>
                                <button class="action-btn" id="analyze-properties">分析性质</button>
                            </div>

                            <div class="property-results">
                                <div class="property-card">
                                    <div class="property-value" id="molar-mass">-</div>
                                    <div class="property-label">摩尔质量 (g/mol)</div>
                                </div>
                                <div class="property-card">
                                    <div class="property-value" id="polarity">-</div>
                                    <div class="property-label">极性</div>
                                </div>
                                <div class="property-card">
                                    <div class="property-value" id="solubility">-</div>
                                    <div class="property-label">水溶性</div>
                                </div>
                                <div class="property-card">
                                    <div class="property-value" id="volatility">-</div>
                                    <div class="property-label">挥发性</div>
                                </div>
                            </div>

                            <div style="background: white; padding: 2rem; border-radius: 10px; border: 1px solid #e9ecef;">
                                <h4>性质预测说明</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                                    <div>
                                        <h5>分子量与沸点</h5>
                                        <p>分子量越大，分子间作用力越强，沸点越高</p>
                                    </div>
                                    <div>
                                        <h5>极性与溶解性</h5>
                                        <p>极性分子易溶于极性溶剂，非极性分子易溶于非极性溶剂</p>
                                    </div>
                                    <div>
                                        <h5>氢键与物理性质</h5>
                                        <p>能形成氢键的分子具有较高的沸点和粘度</p>
                                    </div>
                                    <div>
                                        <h5>官能团影响</h5>
                                        <p>不同官能团赋予分子特定的化学和物理性质</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <p class="copyright-text">study-llm.me域名为Alex所有。保留所有权利。</p>
            </div>
        </div>
    </footer>

    <script src="../../js/common.js"></script>
    <script src="../../js/navigation.js"></script>
    <script>
        // 有机化学工具功能
        class OrganicChemistry {
            constructor() {
                this.drawingCanvas = document.getElementById('drawing-canvas');
                this.drawingCtx = this.drawingCanvas.getContext('2d');
                this.reactionCanvas = document.getElementById('reaction-canvas');
                this.reactionCtx = this.reactionCanvas.getContext('2d');
                
                this.currentTool = 'bond';
                this.selectedElement = 'C';
                this.molecules = [];
                this.bonds = [];
                this.selectedReaction = null;
                
                this.initializeEventListeners();
                this.drawGrid();
            }

            initializeEventListeners() {
                // 标签页切换
                document.querySelectorAll('.organic-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        this.switchTab(e.target.dataset.tab);
                    });
                });

                // 绘制工具选择
                document.querySelectorAll('.tool-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.selectTool(e.target);
                    });
                });

                // 元素选择
                document.querySelectorAll('.element-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.selectElement(e.target);
                    });
                });

                // 画布事件
                this.drawingCanvas.addEventListener('click', (e) => {
                    this.handleCanvasClick(e);
                });

                this.drawingCanvas.addEventListener('mousemove', (e) => {
                    this.handleCanvasMove(e);
                });

                // 功能按钮
                document.getElementById('analyze-structure').addEventListener('click', () => {
                    this.analyzeStructure();
                });

                document.getElementById('clear-canvas').addEventListener('click', () => {
                    this.clearCanvas();
                });

                document.getElementById('analyze-naming').addEventListener('click', () => {
                    this.analyzeNaming();
                });

                document.getElementById('analyze-properties').addEventListener('click', () => {
                    this.analyzeProperties();
                });

                // 反应类型选择
                document.querySelectorAll('.reaction-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        this.selectReaction(e.target.closest('.reaction-card'));
                    });
                });

                document.getElementById('simulate-reaction').addEventListener('click', () => {
                    this.simulateReaction();
                });

                document.getElementById('clear-reaction').addEventListener('click', () => {
                    this.clearReaction();
                });

                // 官能团选择
                document.querySelectorAll('.group-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        this.selectFunctionalGroup(e.target.closest('.group-card'));
                    });
                });
            }

            switchTab(tabName) {
                // 更新标签页状态
                document.querySelectorAll('.organic-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

                // 显示对应面板
                document.querySelectorAll('.tab-panel').forEach(panel => {
                    panel.classList.remove('active');
                });
                document.getElementById(`${tabName}-panel`).classList.add('active');
            }

            selectTool(btn) {
                document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                this.currentTool = btn.dataset.tool || btn.dataset.template;
            }

            selectElement(btn) {
                document.querySelectorAll('.element-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                this.selectedElement = btn.dataset.element;
            }

            drawGrid() {
                this.drawingCtx.clearRect(0, 0, this.drawingCanvas.width, this.drawingCanvas.height);
                
                // 绘制网格
                this.drawingCtx.strokeStyle = '#f0f0f0';
                this.drawingCtx.lineWidth = 1;
                
                for (let x = 0; x <= this.drawingCanvas.width; x += 20) {
                    this.drawingCtx.beginPath();
                    this.drawingCtx.moveTo(x, 0);
                    this.drawingCtx.lineTo(x, this.drawingCanvas.height);
                    this.drawingCtx.stroke();
                }
                
                for (let y = 0; y <= this.drawingCanvas.height; y += 20) {
                    this.drawingCtx.beginPath();
                    this.drawingCtx.moveTo(0, y);
                    this.drawingCtx.lineTo(this.drawingCanvas.width, y);
                    this.drawingCtx.stroke();
                }
            }

            handleCanvasClick(e) {
                const rect = this.drawingCanvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                // 对齐到网格
                const gridX = Math.round(x / 20) * 20;
                const gridY = Math.round(y / 20) * 20;
                
                if (this.currentTool === 'methane') {
                    this.drawMethane(gridX, gridY);
                } else if (this.currentTool === 'ethanol') {
                    this.drawEthanol(gridX, gridY);
                } else if (this.currentTool === 'benzene') {
                    this.drawBenzene(gridX, gridY);
                } else if (this.currentTool === 'glucose') {
                    this.drawGlucose(gridX, gridY);
                } else {
                    this.drawAtom(gridX, gridY);
                }
                
                this.updateMolecularInfo();
            }

            handleCanvasMove(e) {
                // 鼠标移动时的预览效果
                if (this.currentTool === 'bond' || this.currentTool === 'double-bond' || this.currentTool === 'triple-bond') {
                    // 可以添加键的预览效果
                }
            }

            drawAtom(x, y) {
                this.drawingCtx.fillStyle = this.getElementColor(this.selectedElement);
                this.drawingCtx.beginPath();
                this.drawingCtx.arc(x, y, 8, 0, 2 * Math.PI);
                this.drawingCtx.fill();
                
                this.drawingCtx.fillStyle = 'white';
                this.drawingCtx.font = '12px Arial';
                this.drawingCtx.textAlign = 'center';
                this.drawingCtx.fillText(this.selectedElement, x, y + 4);
                
                this.molecules.push({ x, y, element: this.selectedElement });
            }

            getElementColor(element) {
                const colors = {
                    'C': '#333333',
                    'H': '#ffffff',
                    'O': '#ff0000',
                    'N': '#0000ff',
                    'S': '#ffff00',
                    'P': '#ffa500',
                    'F': '#00ff00',
                    'Cl': '#00ff00',
                    'Br': '#8b4513',
                    'I': '#800080'
                };
                return colors[element] || '#666666';
            }

            drawMethane(x, y) {
                // 绘制甲烷分子 CH4
                this.drawingCtx.fillStyle = '#333333';
                this.drawingCtx.beginPath();
                this.drawingCtx.arc(x, y, 10, 0, 2 * Math.PI);
                this.drawingCtx.fill();
                
                this.drawingCtx.fillStyle = 'white';
                this.drawingCtx.font = '12px Arial';
                this.drawingCtx.textAlign = 'center';
                this.drawingCtx.fillText('C', x, y + 4);
                
                // 绘制氢原子
                const positions = [
                    { x: x, y: y - 30 },
                    { x: x + 25, y: y + 15 },
                    { x: x - 25, y: y + 15 },
                    { x: x, y: y + 30 }
                ];
                
                positions.forEach(pos => {
                    this.drawingCtx.fillStyle = '#ffffff';
                    this.drawingCtx.beginPath();
                    this.drawingCtx.arc(pos.x, pos.y, 6, 0, 2 * Math.PI);
                    this.drawingCtx.fill();
                    this.drawingCtx.strokeStyle = '#333';
                    this.drawingCtx.stroke();
                    
                    this.drawingCtx.fillStyle = '#333';
                    this.drawingCtx.fillText('H', pos.x, pos.y + 3);
                    
                    // 绘制键
                    this.drawingCtx.beginPath();
                    this.drawingCtx.moveTo(x, y);
                    this.drawingCtx.lineTo(pos.x, pos.y);
                    this.drawingCtx.stroke();
                });
            }

            drawEthanol(x, y) {
                // 绘制乙醇分子 C2H5OH
                this.drawingCtx.strokeStyle = '#333';
                this.drawingCtx.lineWidth = 2;
                
                // C-C键
                this.drawingCtx.beginPath();
                this.drawingCtx.moveTo(x, y);
                this.drawingCtx.lineTo(x + 40, y);
                this.drawingCtx.stroke();
                
                // C-O键
                this.drawingCtx.beginPath();
                this.drawingCtx.moveTo(x + 40, y);
                this.drawingCtx.lineTo(x + 60, y - 20);
                this.drawingCtx.stroke();
                
                // O-H键
                this.drawingCtx.beginPath();
                this.drawingCtx.moveTo(x + 60, y - 20);
                this.drawingCtx.lineTo(x + 75, y - 30);
                this.drawingCtx.stroke();
                
                // 绘制原子
                this.drawAtomLabel(x, y, 'C', '#333333');
                this.drawAtomLabel(x + 40, y, 'C', '#333333');
                this.drawAtomLabel(x + 60, y - 20, 'O', '#ff0000');
                this.drawAtomLabel(x + 75, y - 30, 'H', '#ffffff');
            }

            drawBenzene(x, y) {
                // 绘制苯环
                this.drawingCtx.strokeStyle = '#333';
                this.drawingCtx.lineWidth = 2;
                
                const radius = 30;
                const angles = [0, 60, 120, 180, 240, 300];
                const points = angles.map(angle => ({
                    x: x + radius * Math.cos(angle * Math.PI / 180),
                    y: y + radius * Math.sin(angle * Math.PI / 180)
                }));
                
                // 绘制六边形
                this.drawingCtx.beginPath();
                points.forEach((point, index) => {
                    if (index === 0) {
                        this.drawingCtx.moveTo(point.x, point.y);
                    } else {
                        this.drawingCtx.lineTo(point.x, point.y);
                    }
                });
                this.drawingCtx.closePath();
                this.drawingCtx.stroke();
                
                // 绘制内圆表示共轭
                this.drawingCtx.beginPath();
                this.drawingCtx.arc(x, y, radius * 0.6, 0, 2 * Math.PI);
                this.drawingCtx.stroke();
                
                // 标记碳原子
                points.forEach(point => {
                    this.drawAtomLabel(point.x, point.y, 'C', '#333333');
                });
            }

            drawGlucose(x, y) {
                // 绘制葡萄糖的简化结构
                this.drawingCtx.strokeStyle = '#333';
                this.drawingCtx.lineWidth = 2;
                
                // 绘制六元环
                const radius = 25;
                const angles = [0, 60, 120, 180, 240, 300];
                const points = angles.map(angle => ({
                    x: x + radius * Math.cos(angle * Math.PI / 180),
                    y: y + radius * Math.sin(angle * Math.PI / 180)
                }));
                
                this.drawingCtx.beginPath();
                points.forEach((point, index) => {
                    if (index === 0) {
                        this.drawingCtx.moveTo(point.x, point.y);
                    } else {
                        this.drawingCtx.lineTo(point.x, point.y);
                    }
                });
                this.drawingCtx.closePath();
                this.drawingCtx.stroke();
                
                // 标记原子
                points.forEach((point, index) => {
                    if (index === 0) {
                        this.drawAtomLabel(point.x, point.y, 'O', '#ff0000');
                    } else {
                        this.drawAtomLabel(point.x, point.y, 'C', '#333333');
                    }
                });
            }

            drawAtomLabel(x, y, element, color) {
                this.drawingCtx.fillStyle = color;
                this.drawingCtx.beginPath();
                this.drawingCtx.arc(x, y, 8, 0, 2 * Math.PI);
                this.drawingCtx.fill();
                
                this.drawingCtx.fillStyle = element === 'C' ? 'white' : 'black';
                this.drawingCtx.font = '10px Arial';
                this.drawingCtx.textAlign = 'center';
                this.drawingCtx.fillText(element, x, y + 3);
            }

            updateMolecularInfo() {
                const atomCount = this.molecules.length;
                const bondCount = this.bonds.length;
                
                // 简化的分子式计算
                const elementCounts = {};
                this.molecules.forEach(mol => {
                    elementCounts[mol.element] = (elementCounts[mol.element] || 0) + 1;
                });
                
                let formula = '';
                Object.keys(elementCounts).sort().forEach(element => {
                    formula += element;
                    if (elementCounts[element] > 1) {
                        formula += elementCounts[element];
                    }
                });
                
                document.getElementById('molecular-formula').textContent = formula || '-';
                document.getElementById('atom-count').textContent = atomCount;
                document.getElementById('bond-count').textContent = bondCount;
            }

            analyzeStructure() {
                if (this.molecules.length === 0) {
                    alert('请先绘制分子结构');
                    return;
                }
                
                const analysis = this.performStructureAnalysis();
                alert(`结构分析结果:\n${analysis}`);
            }

            performStructureAnalysis() {
                const elementCounts = {};
                this.molecules.forEach(mol => {
                    elementCounts[mol.element] = (elementCounts[mol.element] || 0) + 1;
                });
                
                let analysis = '分子组成:\n';
                Object.keys(elementCounts).forEach(element => {
                    analysis += `${element}: ${elementCounts[element]}个\n`;
                });
                
                // 简单的分子类型判断
                if (elementCounts.C && elementCounts.H && !elementCounts.O && !elementCounts.N) {
                    analysis += '\n可能的化合物类型: 烷烃';
                } else if (elementCounts.C && elementCounts.H && elementCounts.O) {
                    analysis += '\n可能的化合物类型: 含氧有机化合物';
                } else if (elementCounts.C && elementCounts.H && elementCounts.N) {
                    analysis += '\n可能的化合物类型: 含氮有机化合物';
                }
                
                return analysis;
            }

            clearCanvas() {
                this.molecules = [];
                this.bonds = [];
                this.drawGrid();
                this.updateMolecularInfo();
            }

            analyzeNaming() {
                const input = document.getElementById('structure-input').value.trim();
                if (!input) {
                    alert('请输入分子结构');
                    return;
                }
                
                const result = this.performNamingAnalysis(input);
                document.getElementById('naming-results').innerHTML = result;
            }

            performNamingAnalysis(input) {
                // 简化的命名分析
                const commonStructures = {
                    'CCO': {
                        name: '乙醇',
                        iupac: 'ethanol',
                        type: '醇类',
                        formula: 'C₂H₆O'
                    },
                    'CC': {
                        name: '乙烷',
                        iupac: 'ethane',
                        type: '烷烃',
                        formula: 'C₂H₆'
                    },
                    'C=C': {
                        name: '乙烯',
                        iupac: 'ethene',
                        type: '烯烃',
                        formula: 'C₂H₄'
                    },
                    'c1ccccc1': {
                        name: '苯',
                        iupac: 'benzene',
                        type: '芳香烃',
                        formula: 'C₆H₆'
                    }
                };
                
                const structure = commonStructures[input.toUpperCase()];
                if (structure) {
                    return `
                        <h4>命名结果</h4>
                        <p><strong>中文名:</strong> ${structure.name}</p>
                        <p><strong>IUPAC名:</strong> ${structure.iupac}</p>
                        <p><strong>化合物类型:</strong> ${structure.type}</p>
                        <p><strong>分子式:</strong> ${structure.formula}</p>
                    `;
                } else {
                    return `
                        <h4>命名结果</h4>
                        <p>未能识别该结构，请检查输入格式或尝试常见的SMILES表示法</p>
                        <p><strong>示例:</strong></p>
                        <ul>
                            <li>CCO (乙醇)</li>
                            <li>CC (乙烷)</li>
                            <li>C=C (乙烯)</li>
                            <li>c1ccccc1 (苯)</li>
                        </ul>
                    `;
                }
            }

            selectFunctionalGroup(card) {
                document.querySelectorAll('.group-card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
                
                const group = card.dataset.group;
                this.showFunctionalGroupInfo(group);
            }

            showFunctionalGroupInfo(group) {
                const groupInfo = {
                    'alkane': '烷烃是最简单的有机化合物，只含C-C和C-H单键',
                    'alkene': '烯烃含有C=C双键，具有不饱和性',
                    'alkyne': '炔烃含有C≡C三键，具有高度不饱和性',
                    'alcohol': '醇类含有-OH羟基，可发生氧化反应',
                    'aldehyde': '醛类含有-CHO基团，具有还原性',
                    'ketone': '酮类含有C=O基团，可发生加成反应',
                    'carboxylic': '羧酸含有-COOH基团，具有酸性',
                    'ester': '酯类是羧酸与醇的缩合产物'
                };
                
                alert(groupInfo[group] || '未知官能团');
            }

            selectReaction(card) {
                document.querySelectorAll('.reaction-card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
                this.selectedReaction = card.dataset.reaction;
            }

            simulateReaction() {
                if (!this.selectedReaction) {
                    alert('请先选择反应类型');
                    return;
                }
                
                this.drawReactionMechanism(this.selectedReaction);
            }

            drawReactionMechanism(reactionType) {
                this.reactionCtx.clearRect(0, 0, this.reactionCanvas.width, this.reactionCanvas.height);
                
                this.reactionCtx.fillStyle = '#333';
                this.reactionCtx.font = '16px Arial';
                this.reactionCtx.textAlign = 'center';
                
                switch(reactionType) {
                    case 'substitution':
                        this.drawSubstitutionMechanism();
                        break;
                    case 'elimination':
                        this.drawEliminationMechanism();
                        break;
                    case 'addition':
                        this.drawAdditionMechanism();
                        break;
                    case 'oxidation':
                        this.drawOxidationMechanism();
                        break;
                    case 'reduction':
                        this.drawReductionMechanism();
                        break;
                    case 'esterification':
                        this.drawEsterificationMechanism();
                        break;
                }
            }

            drawSubstitutionMechanism() {
                this.reactionCtx.fillText('亲核取代反应机理', 300, 30);
                this.reactionCtx.fillText('R-X + Nu⁻ → R-Nu + X⁻', 300, 60);
                
                // 绘制反应步骤
                this.reactionCtx.fillText('1. 亲核试剂攻击', 150, 120);
                this.reactionCtx.fillText('2. 过渡态形成', 300, 120);
                this.reactionCtx.fillText('3. 离去基团离开', 450, 120);
                
                // 绘制简化的分子结构
                this.drawSimpleMolecule(150, 180, 'R-X');
                this.drawArrow(200, 180, 250, 180);
                this.drawSimpleMolecule(300, 180, '[R...Nu...X]⁻');
                this.drawArrow(350, 180, 400, 180);
                this.drawSimpleMolecule(450, 180, 'R-Nu');
            }

            drawEliminationMechanism() {
                this.reactionCtx.fillText('消除反应机理', 300, 30);
                this.reactionCtx.fillText('R-CH₂-CH₂-X → R-CH=CH₂ + HX', 300, 60);
                
                this.drawSimpleMolecule(150, 150, 'R-CH₂-CH₂-X');
                this.drawArrow(220, 150, 280, 150);
                this.drawSimpleMolecule(350, 150, 'R-CH=CH₂');
                this.reactionCtx.fillText('+ HX', 450, 155);
            }

            drawAdditionMechanism() {
                this.reactionCtx.fillText('加成反应机理', 300, 30);
                this.reactionCtx.fillText('R-CH=CH₂ + HX → R-CHX-CH₃', 300, 60);
                
                this.drawSimpleMolecule(150, 150, 'R-CH=CH₂');
                this.reactionCtx.fillText('+ HX', 220, 155);
                this.drawArrow(270, 150, 330, 150);
                this.drawSimpleMolecule(400, 150, 'R-CHX-CH₃');
            }

            drawOxidationMechanism() {
                this.reactionCtx.fillText('氧化反应', 300, 30);
                this.reactionCtx.fillText('R-CH₂OH → R-CHO → R-COOH', 300, 60);
                
                this.drawSimpleMolecule(100, 150, 'R-CH₂OH');
                this.drawArrow(170, 150, 230, 150);
                this.drawSimpleMolecule(280, 150, 'R-CHO');
                this.drawArrow(330, 150, 390, 150);
                this.drawSimpleMolecule(450, 150, 'R-COOH');
            }

            drawReductionMechanism() {
                this.reactionCtx.fillText('还原反应', 300, 30);
                this.reactionCtx.fillText('R-CHO + H₂ → R-CH₂OH', 300, 60);
                
                this.drawSimpleMolecule(150, 150, 'R-CHO');
                this.reactionCtx.fillText('+ H₂', 220, 155);
                this.drawArrow(270, 150, 330, 150);
                this.drawSimpleMolecule(400, 150, 'R-CH₂OH');
            }

            drawEsterificationMechanism() {
                this.reactionCtx.fillText('酯化反应', 300, 30);
                this.reactionCtx.fillText('R-COOH + R\'OH → R-COO-R\' + H₂O', 300, 60);
                
                this.drawSimpleMolecule(120, 150, 'R-COOH');
                this.reactionCtx.fillText('+ R\'OH', 200, 155);
                this.drawArrow(260, 150, 320, 150);
                this.drawSimpleMolecule(400, 150, 'R-COO-R\'');
                this.reactionCtx.fillText('+ H₂O', 480, 155);
            }

            drawSimpleMolecule(x, y, formula) {
                this.reactionCtx.fillStyle = '#333';
                this.reactionCtx.font = '14px Arial';
                this.reactionCtx.textAlign = 'center';
                this.reactionCtx.fillText(formula, x, y);
            }

            drawArrow(x1, y1, x2, y2) {
                this.reactionCtx.strokeStyle = '#dc3545';
                this.reactionCtx.lineWidth = 2;
                this.reactionCtx.beginPath();
                this.reactionCtx.moveTo(x1, y1);
                this.reactionCtx.lineTo(x2, y2);
                this.reactionCtx.stroke();
                
                // 箭头头部
                this.reactionCtx.beginPath();
                this.reactionCtx.moveTo(x2 - 10, y2 - 5);
                this.reactionCtx.lineTo(x2, y2);
                this.reactionCtx.lineTo(x2 - 10, y2 + 5);
                this.reactionCtx.stroke();
            }

            clearReaction() {
                this.reactionCtx.clearRect(0, 0, this.reactionCanvas.width, this.reactionCanvas.height);
                document.querySelectorAll('.reaction-card').forEach(c => c.classList.remove('selected'));
                this.selectedReaction = null;
            }

            analyzeProperties() {
                const formula = document.getElementById('property-formula').value;
                const weight = parseFloat(document.getElementById('property-weight').value);
                const bp = parseFloat(document.getElementById('property-bp').value);
                const density = parseFloat(document.getElementById('property-density').value);
                
                if (!formula) {
                    alert('请输入分子式');
                    return;
                }
                
                // 计算摩尔质量
                const molarMass = this.calculateMolarMass(formula);
                document.getElementById('molar-mass').textContent = molarMass.toFixed(2);
                
                // 预测极性
                const polarity = this.predictPolarity(formula);
                document.getElementById('polarity').textContent = polarity;
                
                // 预测溶解性
                const solubility = this.predictSolubility(formula, polarity);
                document.getElementById('solubility').textContent = solubility;
                
                // 预测挥发性
                const volatility = this.predictVolatility(weight, bp);
                document.getElementById('volatility').textContent = volatility;
            }

            calculateMolarMass(formula) {
                const atomicMasses = {
                    'C': 12.01, 'H': 1.008, 'O': 16.00, 'N': 14.01,
                    'S': 32.07, 'P': 30.97, 'F': 19.00, 'Cl': 35.45,
                    'Br': 79.90, 'I': 126.90
                };
                
                let mass = 0;
                const matches = formula.match(/([A-Z][a-z]?)(\d*)/g);
                
                if (matches) {
                    matches.forEach(match => {
                        const element = match.match(/[A-Z][a-z]?/)[0];
                        const count = parseInt(match.match(/\d+/)?.[0] || '1');
                        mass += (atomicMasses[element] || 0) * count;
                    });
                }
                
                return mass;
            }

            predictPolarity(formula) {
                if (formula.includes('O') || formula.includes('N')) {
                    return '极性';
                } else if (formula.match(/^C\d*H\d*$/)) {
                    return '非极性';
                } else {
                    return '中等极性';
                }
            }

            predictSolubility(formula, polarity) {
                if (polarity === '极性') {
                    return '易溶于水';
                } else if (polarity === '非极性') {
                    return '难溶于水';
                } else {
                    return '部分溶于水';
                }
            }

            predictVolatility(weight, bp) {
                if (bp && bp < 100) {
                    return '高挥发性';
                } else if (bp && bp > 200) {
                    return '低挥发性';
                } else if (weight && weight < 100) {
                    return '中等挥发性';
                } else {
                    return '低挥发性';
                }
            }
        }

        // 初始化有机化学工具
        let organicChemistry;
        document.addEventListener('DOMContentLoaded', () => {
            organicChemistry = new OrganicChemistry();
        });
    </script>
</body>
</html> 