<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Á´ã‰ΩìÂá†‰Ωï - Êï∞Â≠¶Â≠¶‰π†Âä©Êâã</title>
    <link rel="icon" href="assets/icons/alex.ico" type="image/x-icon">
    <link rel="icon" href="../../assets/icons/logo_btrfly.ico" type="image/x-icon">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/components.css">
    <link rel="stylesheet" href="../../css/utilities.css">
    <link rel="stylesheet" href="../../css/responsive.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Three.js r128 with stable CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/TransformControls.js"></script>
    <script>
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ DOMÂÜÖÂÆπÂ∑≤Âä†ËΩΩ');
            console.log('Ê£ÄÊü•THREE.js:', typeof THREE !== 'undefined' ? '‚úÖ Â∑≤Âä†ËΩΩ' : '‚ùå Êú™Âä†ËΩΩ');
            console.log('Ê£ÄÊü•OrbitControls:', typeof THREE.OrbitControls !== 'undefined' ? '‚úÖ Â∑≤Âä†ËΩΩ' : '‚ùå Êú™Âä†ËΩΩ');
            
            if (typeof THREE === 'undefined') {
                console.error('‚ùå THREE.jsÊú™Âä†ËΩΩ');
                showError('Êó†Ê≥ïÂä†ËΩΩ3DÊ∏≤ÊüìÂºïÊìé');
                return;
            }
            
            if (typeof THREE.OrbitControls === 'undefined') {
                console.error('‚ùå OrbitControlsÊú™Âä†ËΩΩ');
                showError('ÊéßÂà∂Âô®ÁªÑ‰ª∂Âä†ËΩΩÂ§±Ë¥•');
                return;
            }
            
            // Âª∂Ëøü‰∏ÄÁÇπÁÇπÁ°Æ‰øùÊâÄÊúâËÑöÊú¨ÂÆåÂÖ®Âä†ËΩΩ
            setTimeout(initGeometrySystem, 100);
        });
    </script>
    <style>
        .solid-geometry-page {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #fff;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
        }

        .geometry-header {
            text-align: center;
            padding: 3rem 0 2rem;
        }

        .geometry-header h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #FFD700, #FFA500, #FF6347);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        .geometry-header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .main-workspace {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            margin: 2rem 0;
        }

        .control-panel {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            overflow: hidden; /* Èò≤Ê≠¢ÂÜÖÂÆπÊ∫¢Âá∫ */
            box-sizing: border-box;
        }

        .control-section {
            margin-bottom: 2rem;
            overflow: hidden; /* Èò≤Ê≠¢ÂÜÖÂÆπÊ∫¢Âá∫ */
            box-sizing: border-box;
            width: 100%;
        }

        .control-section:last-child {
            margin-bottom: 0;
        }

        .control-section h3 {
            color: #FFD700;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            border-bottom: 1px solid rgba(255, 215, 0, 0.3);
            padding-bottom: 0.5rem;
        }

        .geometry-viewer {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            height: 700px;
        }

        #geometry-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        #geometry-container canvas {
            display: block;
            width: 100% !important;
            height: 100% !important;
        }

        .shape-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 0.5rem;
        }

        .shape-button {
            width: 100%;
            padding: 0.8rem;
            margin-bottom: 0;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            min-height: 50px;
            text-align: center;
        }

        .shape-button:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #FFD700;
        }

        .shape-button.active {
            background: rgba(255, 215, 0, 0.3);
            border-color: #FFD700;
        }

        .parameter-input {
            width: 100%;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            color: #fff;
            font-size: 0.9rem;
        }

        .parameter-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .parameter-input:focus {
            outline: none;
            border-color: #FFD700;
        }

        .action-button {
            width: 100%;
            padding: 0.7rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(45deg, #4361ee, #7209b7);
            border: none;
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            box-sizing: border-box;
            min-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
        }

        .coordinate-input {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 0.3rem;
            margin-bottom: 0.5rem;
            overflow: hidden;
            width: 100%;
            box-sizing: border-box;
        }

        .coord-input {
            padding: 0.4rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            color: #fff;
            text-align: center;
            font-size: 0.8rem;
            box-sizing: border-box;
            width: 100%;
            min-width: 0; /* ÂÖÅËÆ∏Êî∂Áº© */
        }

        .line-type-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            width: 100%;
            box-sizing: border-box;
        }

        .line-type-button {
            flex: 1;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            box-sizing: border-box;
            min-width: 0; /* ÂÖÅËÆ∏Êî∂Áº© */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .line-type-button.active {
            background: rgba(255, 215, 0, 0.3);
            border-color: #FFD700;
        }

        .transparency-slider {
            width: 100%;
            margin: 0.5rem 0;
        }

        .info-panel {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 215, 0, 0.6);
            border-radius: 10px;
            padding: 15px;
            max-width: 250px;
            color: #FFD700;
            font-size: 0.9rem;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .toolbar {
            position: absolute;
            bottom: 15px;
            left: 15px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .tool-button {
            width: 45px;
            height: 45px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid rgba(255, 215, 0, 0.6);
            border-radius: 10px;
            color: #FFD700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .tool-button:hover {
            background: rgba(255, 215, 0, 0.2);
            border-color: #FFD700;
            transform: scale(1.05);
        }

        .coordinates-display {
            position: absolute;
            bottom: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 215, 0, 0.6);
            border-radius: 10px;
            padding: 10px;
            color: #FFD700;
            font-size: 0.8rem;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .objects-list {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 0.5rem;
        }

        .object-item {
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin-bottom: 0.3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .object-buttons {
            display: flex;
            gap: 0.3rem;
        }

        .select-button, .delete-button {
            background: rgba(231, 76, 60, 0.3);
            border: 1px solid #e74c3c;
            border-radius: 3px;
            color: #fff;
            padding: 0.2rem 0.4rem;
            cursor: pointer;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 24px;
            height: 24px;
        }

        .select-button {
            background: rgba(40, 167, 69, 0.3);
            border-color: #28a745;
        }

        .select-button:hover {
            background: rgba(40, 167, 69, 0.5);
        }

        .delete-button:hover {
            background: rgba(231, 76, 60, 0.5);
        }

        .color-picker {
            width: 100%;
            height: 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 0.5rem;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .control-panel {
                grid-template-columns: 1fr;
            }
            
            .shape-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
            
            .guide-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .geometry-header h1 {
                font-size: 2rem;
            }
            
            .geometry-viewer {
                height: 400px;
            }
            
            .control-panel {
                padding: 1rem;
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .control-section {
                margin-bottom: 1.5rem;
            }
            
            .shape-grid {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 0.4rem;
            }
            
            .shape-button {
                padding: 0.6rem 0.4rem;
                font-size: 0.75rem;
                min-height: 45px;
                flex-direction: column;
                gap: 0.2rem;
            }
            
            .shape-button i {
                font-size: 1rem;
            }
            
            .guide-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .guide-item {
                padding: 0.6rem;
                font-size: 0.8rem;
            }
            
            .info-panel-top {
                padding: 1rem;
                margin-bottom: 1rem;
            }
            
            .info-panel-top h3 {
                font-size: 1rem;
            }
            
            .coordinate-input {
                gap: 0.2rem;
            }
            
            .coord-input {
                padding: 0.3rem;
                font-size: 0.75rem;
            }
            
            .transform-controls {
                gap: 0.2rem;
            }
            
            .transform-controls .action-button {
                padding: 0.3rem 0.1rem;
                font-size: 0.7rem;
            }
            
            .toolbar {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .tool-button {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0.5rem;
            }
            
            .geometry-header {
                padding: 2rem 0 1rem;
            }
            
            .geometry-header h1 {
                font-size: 1.5rem;
            }
            
            .geometry-header p {
                font-size: 1rem;
            }
            
            .control-panel {
                padding: 0.8rem;
                gap: 0.8rem;
            }
            
            .control-section h3 {
                font-size: 1rem;
            }
            
            .shape-grid {
                grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
                gap: 0.3rem;
            }
            
            .shape-button {
                padding: 0.5rem 0.2rem;
                font-size: 0.7rem;
                min-height: 40px;
            }
            
            .parameter-input, .coord-input {
                padding: 0.4rem;
                font-size: 0.8rem;
            }
            
            .action-button {
                padding: 0.6rem;
                font-size: 0.8rem;
            }
        }

        /* Placement instruction animation */
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.05); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .placement-instruction {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 215, 0, 0.95);
            color: #000;
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: bold;
            z-index: 1000;
            animation: pulse 2s infinite;
            pointer-events: none;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
            border: 2px solid #FFD700;
        }

        .edit-controls {
            margin-top: 1rem;
            overflow: hidden;
            max-width: 100%;
        }

        .edit-controls label {
            display: block;
            margin-top: 0.5rem;
            margin-bottom: 0.3rem;
            word-wrap: break-word;
        }

        .transform-controls {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 0.3rem;
            margin: 0.5rem 0;
            overflow: hidden;
        }

        .transform-controls .action-button {
            margin-bottom: 0;
            padding: 0.4rem 0.2rem;
            font-size: 0.75rem;
            min-width: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Á°Æ‰øùÊâÄÊúâËæìÂÖ•Ê°Ü‰∏ç‰ºöÊ∫¢Âá∫ */
        .parameter-input, .color-picker, .transparency-slider, .coord-input {
            max-width: 100%;
            box-sizing: border-box;
        }

        .info-panel-top {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 215, 0, 0.6);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
        }

        .info-panel-top h3 {
            color: #FFD700;
            margin: 0 0 1rem 0;
            font-size: 1.2rem;
            text-align: center;
        }

        .guide-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.8rem;
        }

        .guide-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.8rem;
            border-radius: 8px;
            font-size: 0.9rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .parameter-guide {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            padding: 0.8rem;
            margin-bottom: 1rem;
            font-size: 0.85rem;
            text-align: center;
        }

        .parameter-guide p {
            margin: 0;
            color: #FFD700;
            font-weight: 500;
        }

        .param-label {
            display: block;
            color: #FFD700;
            font-size: 0.85rem;
            margin-bottom: 0.3rem;
            margin-top: 0.5rem;
            font-weight: 500;
            opacity: 0.9;
        }

        .param-label:first-child {
            margin-top: 0;
        }

        .coordinate-guide {
            background: rgba(64, 224, 208, 0.1);
            border: 1px solid rgba(64, 224, 208, 0.3);
            border-radius: 8px;
            padding: 0.8rem;
            margin-bottom: 1rem;
            font-size: 0.85rem;
            text-align: center;
        }

        .coordinate-guide p {
            margin: 0;
            color: #40E0D0;
            font-weight: 500;
        }

        .coord-label {
            display: block;
            color: #40E0D0;
            font-size: 0.85rem;
            margin-bottom: 0.3rem;
            margin-top: 0.5rem;
            font-weight: 500;
            opacity: 0.9;
        }

        .coord-label:first-child {
            margin-top: 0;
        }

        /* Á°Æ‰øùÊâÄÊúâËæìÂÖ•Ê°ÜÂíåÊåâÈíÆ‰∏ç‰ºöÊ∫¢Âá∫ */
        .parameter-input, .color-picker, .transparency-slider, .coord-input, .action-button {
            max-width: 100%;
            box-sizing: border-box;
            word-wrap: break-word;
        }

        /* ÊûÅÂ∞èÂ±èÂπïÁöÑÈ¢ùÂ§ñ‰øùÊä§ */
        @media (max-width: 320px) {
            .control-panel {
                padding: 0.5rem;
                gap: 0.5rem;
                grid-template-columns: 1fr;
                min-width: 0;
            }
            
            .control-section {
                margin-bottom: 1rem;
                min-width: 0;
                width: 100%;
            }
            
            .coordinate-input {
                gap: 0.2rem;
            }
            
            .coord-input {
                padding: 0.3rem;
                font-size: 0.75rem;
                min-width: 0;
            }
            
            .line-type-button {
                padding: 0.3rem 0.2rem;
                font-size: 0.7rem;
                min-width: 0;
            }
            
            .action-button {
                padding: 0.5rem 0.3rem;
                font-size: 0.75rem;
                min-width: 0;
            }
            
            .parameter-input {
                padding: 0.3rem;
                font-size: 0.75rem;
                min-width: 0;
            }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="../../index.html">
                        <i class="fas fa-graduation-cap" style="background: linear-gradient(90deg, #4361ee, #7209b7); -webkit-background-clip: text; background-clip: text; color: transparent;"></i>
                        <span>AlexÁöÑÂ≠¶‰π†Âä©Êâã</span>
                    </a>
                </div>
                <nav class="main-nav">
                    <ul>
                        <li><a href="../../index.html">È¶ñÈ°µ</a></li>
                        <li><a href="main.html">Êï∞Â≠¶</a></li>
                        <li><a href="#" class="active">Á´ã‰ΩìÂá†‰Ωï</a></li>
                        <li><a href="../../tts.html">ËØ≠Èü≥</a></li>
                        <li><a href="../../draw.html">ÁªòÂõæ</a></li>
                    </ul>
                </nav>
                <button class="mobile-menu-toggle" aria-label="ÂàáÊç¢ËèúÂçï">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <main class="solid-geometry-page">
        <section class="geometry-header">
            <div class="container">
                <h1><i class="fas fa-cube"></i> 3D Á´ã‰ΩìÂá†‰ΩïÂ∑•ÂÖ∑</h1>
                <p>‰∫§‰∫íÂºè3DÂá†‰Ωï‰ΩìÁªòÂà∂‰∏éÁ©∫Èó¥ÂùêÊ†áÁ≥ªÂ≠¶‰π†Âπ≥Âè∞</p>
            </div>
        </section>

        <section class="container">
            <!-- Êìç‰ΩúÊåáÂçó -->
            <div class="info-panel-top">
                <h3><i class="fas fa-info-circle"></i> Êìç‰ΩúÊåáÂçó</h3>
                <div class="guide-grid">
                    <div class="guide-item">üñ±Ô∏è Â∑¶ÈîÆÊãñÊãΩÔºöÊóãËΩ¨ËßÜËßí</div>
                    <div class="guide-item">üîÑ ÊªöËΩÆÔºöÁº©ÊîæÁîªÈù¢</div>
                    <div class="guide-item">‚úã Âè≥ÈîÆÊãñÊãΩÔºöÂπ≥ÁßªËßÜÂõæ</div>
                    <div class="guide-item">üìè ÁÇπÂáªÂØπË±°ÔºöÈÄâÊã©ÁºñËæë</div>
                    <div class="guide-item">üéØ Ctrl+ÁÇπÂáªÔºöÊü•ÁúãÂ±ûÊÄß</div>
                    <div class="guide-item">‚ö° ÂàõÂª∫ÂêéÂèØÁßªÂä®„ÄÅÁºñËæë</div>
                </div>
            </div>

            <div class="main-workspace">
                <!-- ÊéßÂà∂Èù¢Êùø -->
                <div class="control-panel">
                    <!-- Âá†‰Ωï‰ΩìÈÄâÊã© -->
                    <div class="control-section">
                        <h3>üéØ ÈÄâÊã©Âá†‰Ωï‰Ωì</h3>
                        <div class="shape-grid">
                            <button class="shape-button active" data-shape="cube">
                                <i class="fas fa-cube"></i>
                                Á´ãÊñπ‰Ωì
                            </button>
                            <button class="shape-button" data-shape="box">
                                <i class="fas fa-square"></i>
                                ÈïøÊñπ‰Ωì
                            </button>
                            <button class="shape-button" data-shape="sphere">
                                <i class="fas fa-circle"></i>
                                ÁêÉ‰Ωì
                            </button>
                            <button class="shape-button" data-shape="cylinder">
                                <i class="fas fa-arrow-up"></i>
                                ÂúÜÊü±‰Ωì
                            </button>
                            <button class="shape-button" data-shape="cone">
                                <i class="fas fa-triangle"></i>
                                ÂúÜÈî•‰Ωì
                            </button>
                            <button class="shape-button" data-shape="pyramid">
                                <i class="fas fa-mountain"></i>
                                ÂõõËßíÈî•
                            </button>
                            <button class="shape-button" data-shape="prism">
                                <i class="fas fa-gem"></i>
                                ‰∏âËßíÊü±
                            </button>
                            <button class="shape-button" data-shape="torus">
                                <i class="fas fa-ring"></i>
                                ÂúÜÁéØ‰Ωì
                            </button>
                            <button class="shape-button" data-shape="polygon">
                                <i class="fas fa-shapes"></i>
                                Â§öËæπÂΩ¢Êü±
                            </button>
                        </div>
                    </div>

                    <!-- ÂèÇÊï∞ËÆæÁΩÆ -->
                    <div class="control-section">
                        <h3>üìè ËÆæÁΩÆÂèÇÊï∞</h3>
                        <div class="parameter-guide">
                            <p>üí° Ê†πÊçÆÈÄâÊã©ÁöÑÂá†‰Ωï‰ΩìË∞ÉÊï¥Áõ∏Â∫îÂèÇÊï∞</p>
                        </div>
                        <div id="shape-parameters">
                            <label class="param-label" for="param1">ÂèÇÊï∞1:</label>
                            <input type="number" class="parameter-input" id="param1" placeholder="ËæπÈïø (Âçï‰Ωç)" min="0.1" max="20" step="0.1" value="2">
                            
                            <label class="param-label" for="param2" style="display: none;">ÂèÇÊï∞2:</label>
                            <input type="number" class="parameter-input" id="param2" placeholder="ÂÆΩÂ∫¶/È´òÂ∫¶ (Âçï‰Ωç)" min="0.1" max="20" step="0.1" value="2" style="display: none;">
                            
                            <label class="param-label" for="param3" style="display: none;">ÂèÇÊï∞3:</label>
                            <input type="number" class="parameter-input" id="param3" placeholder="È´òÂ∫¶/Ê∑±Â∫¶ (Âçï‰Ωç)" min="0.1" max="20" step="0.1" value="2" style="display: none;">
                            
                            <label class="param-label" for="polygon-sides" style="display: none;">ËæπÊï∞:</label>
                            <input type="number" class="parameter-input" id="polygon-sides" placeholder="ËæπÊï∞ (3-20)" min="3" max="20" step="1" value="6" style="display: none;">
                        </div>
                        <button class="action-button" onclick="createShape()">
                            <i class="fas fa-plus"></i> ÂàõÂª∫Âá†‰Ωï‰Ωì
                        </button>
                        <button class="action-button" onclick="enableClickToPlace()" style="background: linear-gradient(45deg, #28a745, #20c997); margin-top: 5px;">
                            <i class="fas fa-mouse-pointer"></i> ÁÇπÂáªÊîæÁΩÆÊ®°Âºè
                        </button>
                    </div>

                    <!-- Â§ñËßÇËÆæÁΩÆ -->
                    <div class="control-section">
                        <h3>üé® Â§ñËßÇËÆæÁΩÆ</h3>
                        <input type="color" class="color-picker" id="shape-color" value="#4361ee">
                        <label style="font-size: 0.9rem; opacity: 0.8;">ÈÄèÊòéÂ∫¶:</label>
                        <input type="range" class="transparency-slider" id="transparency" min="0.1" max="1" step="0.1" value="0.7">
                        <label style="font-size: 0.9rem; opacity: 0.8;">
                            <input type="checkbox" id="wireframe"> Á∫øÊ°ÜÊ®°Âºè
                        </label>
                    </div>

                    <!-- ÂùêÊ†áËøûÁ∫ø -->
                    <div class="control-section">
                        <h3>üìç ÂùêÊ†áËøûÁ∫ø</h3>
                        <div class="coordinate-guide">
                            <p>üîó ËæìÂÖ•‰∏§‰∏™3DÂùêÊ†áÁÇπËøõË°åËøûÁ∫ø</p>
                        </div>
                        <label class="coord-label">Ëµ∑ÁÇπÂùêÊ†á (X1, Y1, Z1):</label>
                        <div class="coordinate-input">
                            <input type="number" class="coord-input" id="x1" placeholder="X1" step="0.1">
                            <input type="number" class="coord-input" id="y1" placeholder="Y1" step="0.1">
                            <input type="number" class="coord-input" id="z1" placeholder="Z1" step="0.1">
                        </div>
                        <label class="coord-label">ÁªàÁÇπÂùêÊ†á (X2, Y2, Z2):</label>
                        <div class="coordinate-input">
                            <input type="number" class="coord-input" id="x2" placeholder="X2" step="0.1">
                            <input type="number" class="coord-input" id="y2" placeholder="Y2" step="0.1">
                            <input type="number" class="coord-input" id="z2" placeholder="Z2" step="0.1">
                        </div>
                        <label class="coord-label">ËøûÁ∫øÁ±ªÂûã:</label>
                        <div class="line-type-selector">
                            <button class="line-type-button active" data-type="straight">Áõ¥Á∫ø</button>
                            <button class="line-type-button" data-type="curve">Êõ≤Á∫ø</button>
                        </div>
                        <button class="action-button" onclick="createLine()">
                            <i class="fas fa-drafting-compass"></i> ËøûÊé•ÂùêÊ†á
                        </button>
                    </div>

                    <!-- ÂØπË±°ÁÆ°ÁêÜ -->
                    <div class="control-section">
                        <h3>üìã ÂØπË±°ÁÆ°ÁêÜ</h3>
                        <div class="objects-list" id="objects-list">
                            <div style="text-align: center; color: rgba(255,255,255,0.6); font-size: 0.8rem;">
                                ÊöÇÊó†ÂØπË±°
                            </div>
                        </div>
                        <button class="action-button" onclick="clearAll()" style="background: linear-gradient(45deg, #e74c3c, #c0392b);">
                            <i class="fas fa-trash"></i> Ê∏ÖÁ©∫ÊâÄÊúâ
                        </button>
                    </div>

                    <!-- ÂØπË±°ÁºñËæë -->
                    <div class="control-section" id="object-editor" style="display: none;">
                        <h3>‚úèÔ∏è ÁºñËæëÈÄâ‰∏≠ÂØπË±°</h3>
                        <div class="edit-controls">
                            <label style="font-size: 0.9rem; opacity: 0.8;">ÂØπË±°ÂùêÊ†á:</label>
                            <div class="coordinate-input">
                                <input type="number" class="coord-input" id="edit-x" placeholder="X" step="0.1">
                                <input type="number" class="coord-input" id="edit-y" placeholder="Y" step="0.1">
                                <input type="number" class="coord-input" id="edit-z" placeholder="Z" step="0.1">
                            </div>
                            
                            <label style="font-size: 0.9rem; opacity: 0.8;">ÂØπË±°È¢úËâ≤:</label>
                            <input type="color" class="color-picker" id="edit-color">
                            
                            <label style="font-size: 0.9rem; opacity: 0.8;">ÈÄèÊòéÂ∫¶:</label>
                            <input type="range" class="transparency-slider" id="edit-transparency" min="0.1" max="1" step="0.1">
                            
                            <label style="font-size: 0.9rem; opacity: 0.8;">Â∞∫ÂØ∏ÂèÇÊï∞:</label>
                            <input type="number" class="parameter-input" id="edit-param1" placeholder="ÂèÇÊï∞1" min="0.1" max="20" step="0.1">
                            <input type="number" class="parameter-input" id="edit-param2" placeholder="ÂèÇÊï∞2" min="0.1" max="20" step="0.1" style="display: none;">
                            <input type="number" class="parameter-input" id="edit-param3" placeholder="ÂèÇÊï∞3" min="0.1" max="20" step="0.1" style="display: none;">
                            
                            <div class="transform-controls">
                                <button class="action-button" onclick="setTransformMode('translate')" style="background: linear-gradient(45deg, #17a2b8, #138496);">
                                    <i class="fas fa-arrows-alt"></i> ÁßªÂä®
                                </button>
                                <button class="action-button" onclick="setTransformMode('rotate')" style="background: linear-gradient(45deg, #fd7e14, #e36414);">
                                    <i class="fas fa-sync-alt"></i> ÊóãËΩ¨
                                </button>
                                <button class="action-button" onclick="setTransformMode('scale')" style="background: linear-gradient(45deg, #6f42c1, #59359a);">
                                    <i class="fas fa-expand-arrows-alt"></i> Áº©Êîæ
                                </button>
                            </div>
                            
                            <button class="action-button" onclick="applyObjectEdits()">
                                <i class="fas fa-check"></i> Â∫îÁî®Êõ¥Êîπ
                            </button>
                            <button class="action-button" onclick="deselectObject()" style="background: linear-gradient(45deg, #6c757d, #545b62);">
                                <i class="fas fa-times"></i> ÂèñÊ∂àÈÄâÊã©
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 3DËßÜÂõæÂå∫Âüü -->
                <div class="geometry-viewer">
                    <div id="geometry-container"></div>
                    
                    <!-- Â∑•ÂÖ∑Ê†è -->
                    <div class="toolbar">
                        <button class="tool-button" onclick="resetView()" title="ÈáçÁΩÆËßÜÂõæ">
                            <i class="fas fa-home"></i>
                        </button>
                        <button class="tool-button" onclick="toggleGrid()" title="ÊòæÁ§∫/ÈöêËóèÁΩëÊ†º">
                            <i class="fas fa-border-all"></i>
                        </button>
                        <button class="tool-button" onclick="toggleAxes()" title="ÊòæÁ§∫/ÈöêËóèÂùêÊ†áËΩ¥">
                            <i class="fas fa-arrows-alt"></i>
                        </button>
                        <button class="tool-button" onclick="exportScene()" title="ÂØºÂá∫Âú∫ÊôØ">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>

                    <!-- ÂùêÊ†áÊòæÁ§∫ -->
                    <div class="coordinates-display" id="coordinates-display">
                        Èº†Ê†áÂùêÊ†á: (0, 0, 0)
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <p class="copyright-text">study-llm.meÂüüÂêç‰∏∫AlexÊâÄÊúâ„ÄÇ‰øùÁïôÊâÄÊúâÊùÉÂà©„ÄÇ</p>
            </div>
        </div>
    </footer>

    <script src="../../js/common.js"></script>
    <script src="../../js/navigation.js"></script>
    <script>
        // Global variables
        let geometrySystem = null;

        // Error display function
        function showError(message) {
            document.getElementById('geometry-container').innerHTML = `
                <div style="display: flex; justify-content: center; align-items: center; height: 100%; color: #FFD700; text-align: center; padding: 20px;">
                    <div>
                        <h3>‚ùå ${message}</h3>
                        <p>ËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï</p>
                        <button onclick="location.reload()" style="background: #4361ee; color: white; border: none; padding: 10px 20px; border-radius: 5px; margin-top: 10px; cursor: pointer;">Âà∑Êñ∞È°µÈù¢</button>
                    </div>
                </div>
            `;
        }

        // Initialize the geometry system
        function initGeometrySystem() {
            console.log('üîß ÂºÄÂßãÂàùÂßãÂåñÂá†‰ΩïÁ≥ªÁªü...');
            
            // Ê£ÄÊü•ÂÆπÂô®
            const container = document.getElementById('geometry-container');
            if (!container) {
                console.error('‚ùå Êâæ‰∏çÂà∞geometry-containerÂÖÉÁ¥†');
                showError('Êâæ‰∏çÂà∞3DÂÆπÂô®ÂÖÉÁ¥†');
                return;
            }
            
            console.log('üì¶ ÂÆπÂô®Â∞∫ÂØ∏:', {
                width: container.clientWidth,
                height: container.clientHeight,
                offsetWidth: container.offsetWidth,
                offsetHeight: container.offsetHeight
            });
            
            // Á°Æ‰øùÂÆπÂô®ÊúâÂ∞∫ÂØ∏
            if (container.clientWidth === 0 || container.clientHeight === 0) {
                console.warn('‚ö†Ô∏è ÂÆπÂô®Â∞∫ÂØ∏‰∏∫Èõ∂ÔºåÁ≠âÂæÖÂ∏ÉÂ±ÄÂÆåÊàê...');
                setTimeout(() => {
                    console.log('üîÑ ÈáçËØïÂàùÂßãÂåñ...');
                    initGeometrySystem();
                }, 200);
                return;
            }
            
            console.log('‚úÖ ÂÆπÂô®Ê£ÄÊü•ÈÄöËøá');
            
            if (typeof THREE === 'undefined') {
                console.error('‚ùå THREE.jsÊú™Âä†ËΩΩ');
                showError('Êó†Ê≥ïÂä†ËΩΩ3DÊ∏≤ÊüìÂºïÊìé');
                return;
            }
            
            if (typeof THREE.OrbitControls === 'undefined') {
                console.error('‚ùå OrbitControlsÊú™Âä†ËΩΩ');
                showError('ÊéßÂà∂Âô®ÁªÑ‰ª∂Âä†ËΩΩÂ§±Ë¥•');
                return;
            }
            
            try {
                geometrySystem = new SolidGeometryVisualizationSystem();
                console.log('‚úÖ Âá†‰ΩïÁ≥ªÁªüÂÆû‰æãÂåñÊàêÂäü:', geometrySystem);
            } catch (error) {
                console.error('‚ùå Âá†‰ΩïÁ≥ªÁªüÂÆû‰æãÂåñÂ§±Ë¥•:', error);
                showError('3DÁ≥ªÁªüÂàùÂßãÂåñÂ§±Ë¥•: ' + error.message);
            }
        }

        // 3DÁ´ã‰ΩìÂá†‰ΩïÂèØËßÜÂåñÁ≥ªÁªü
        class SolidGeometryVisualizationSystem {
            constructor() {
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.controls = null;
                this.transformControls = null; // ÂèòÊç¢ÊéßÂà∂Âô®
                this.objects = [];
                this.selectedShape = 'cube';
                this.lineType = 'straight';
                this.gridHelper = null;
                this.axesHelper = null;
                this.raycaster = new THREE.Raycaster();
                this.mouse = new THREE.Vector2();
                this.lastClickPosition = new THREE.Vector3(0, 0, 0); // ËÆ∞ÂΩïÊúÄÂêéÁÇπÂáª‰ΩçÁΩÆ
                this.placementMode = false; // ÊòØÂê¶Â§Ñ‰∫éÊîæÁΩÆÊ®°Âºè
                this.escKeyListener = null; // Áî®‰∫éÂ≠òÂÇ®ESCÈîÆÁõëÂê¨Âô®
                this.selectedObject = null; // ÂΩìÂâçÈÄâ‰∏≠ÁöÑÂØπË±°
                this.isEditMode = false; // ÊòØÂê¶Â§Ñ‰∫éÁºñËæëÊ®°Âºè
                
                this.init();
            }

            init() {
                try {
                    console.log('üîÑ ÂºÄÂßãÂàùÂßãÂåñ3DÁ´ã‰ΩìÂá†‰ΩïÁ≥ªÁªü...');
                    console.log('THREE.jsÁâàÊú¨:', THREE.REVISION);
                    
                    this.setupScene();
                    console.log('‚úÖ Âú∫ÊôØËÆæÁΩÆÂÆåÊàê');
                    
                    this.setupCamera();
                    console.log('‚úÖ Áõ∏Êú∫ËÆæÁΩÆÂÆåÊàê');
                    
                    this.setupRenderer();
                    console.log('‚úÖ Ê∏≤ÊüìÂô®ËÆæÁΩÆÂÆåÊàê');
                    
                    this.setupLights();
                    console.log('‚úÖ ÂÖâÁÖßËÆæÁΩÆÂÆåÊàê');
                    
                    this.setupControls();
                    console.log('‚úÖ ÊéßÂà∂Âô®ËÆæÁΩÆÂÆåÊàê');
                    
                    this.setupTransformControls();
                    console.log('‚úÖ ÂèòÊç¢ÊéßÂà∂Âô®ËÆæÁΩÆÂÆåÊàê');
                    
                    this.setupHelpers();
                    console.log('‚úÖ ËæÖÂä©Â∑•ÂÖ∑ËÆæÁΩÆÂÆåÊàê');
                    
                    this.setupEventListeners();
                    console.log('‚úÖ ‰∫ã‰ª∂ÁõëÂê¨Âô®ËÆæÁΩÆÂÆåÊàê');
                    
                    this.animate();
                    console.log('‚úÖ Âä®ÁîªÂæ™ÁéØÂêØÂä®');
                    
                    console.log('‚úÖ 3DÁ´ã‰ΩìÂá†‰ΩïÁ≥ªÁªüÂàùÂßãÂåñÂÆåÊàê');
                } catch (error) {
                    console.error('‚ùå ÂàùÂßãÂåñÂ§±Ë¥•:', error);
                    throw error;
                }
            }

            setupScene() {
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0x1a1a2e);
            }

            setupCamera() {
                const container = document.getElementById('geometry-container');
                const width = container.clientWidth;
                const height = container.clientHeight;
                
                this.camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
                this.camera.position.set(10, 10, 10);
                this.camera.lookAt(0, 0, 0);
            }

            setupRenderer() {
                const container = document.getElementById('geometry-container');
                
                this.renderer = new THREE.WebGLRenderer({ 
                    antialias: true,
                    alpha: true
                });
                this.renderer.setSize(container.clientWidth, container.clientHeight);
                this.renderer.setPixelRatio(window.devicePixelRatio);
                this.renderer.shadowMap.enabled = true;
                this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                
                container.appendChild(this.renderer.domElement);
            }

            setupLights() {
                // ÁéØÂ¢ÉÂÖâ
                const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
                this.scene.add(ambientLight);
                
                // ÊñπÂêëÂÖâ
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(10, 10, 5);
                directionalLight.castShadow = true;
                directionalLight.shadow.mapSize.width = 2048;
                directionalLight.shadow.mapSize.height = 2048;
                this.scene.add(directionalLight);
                
                // ÁÇπÂÖâÊ∫ê
                const pointLight = new THREE.PointLight(0x4361ee, 0.6, 100);
                pointLight.position.set(-10, 10, 10);
                this.scene.add(pointLight);
            }

            setupControls() {
                this.controls = new THREE.OrbitControls(this.camera, this.renderer.domElement);
                this.controls.enableDamping = true;
                this.controls.dampingFactor = 0.05;
                this.controls.minDistance = 5;
                this.controls.maxDistance = 50;
                
                // ÁßªÂä®Á´ØÊîØÊåÅ
                this.controls.touches = {
                    ONE: THREE.TOUCH.ROTATE,
                    TWO: THREE.TOUCH.DOLLY_PAN
                };
            }

            setupTransformControls() {
                this.transformControls = new THREE.TransformControls(this.camera, this.renderer.domElement);
                this.transformControls.addEventListener('change', () => this.updateSelectedObject());
                
                // ÂΩìÂèòÊç¢ÊéßÂà∂Âô®Ë¢´ÊãñÊãΩÊó∂ÔºåÁ¶ÅÁî®ËΩ®ÈÅìÊéßÂà∂Âô®
                this.transformControls.addEventListener('dragging-changed', (event) => {
                    this.controls.enabled = !event.value;
                });
                
                this.scene.add(this.transformControls);
                
                // ÈªòËÆ§ÈöêËóèÂèòÊç¢ÊéßÂà∂Âô®
                this.transformControls.visible = false;
            }

            setupHelpers() {
                // ÁΩëÊ†ºËæÖÂä©Á∫ø
                this.gridHelper = new THREE.GridHelper(20, 20, 0x444444, 0x444444);
                this.scene.add(this.gridHelper);
                
                // ÂùêÊ†áËΩ¥
                this.axesHelper = new THREE.AxesHelper(5);
                this.scene.add(this.axesHelper);
            }

            setupEventListeners() {
                // Á™óÂè£Â§ßÂ∞èË∞ÉÊï¥
                window.addEventListener('resize', () => this.onWindowResize());
                
                // Èº†Ê†áÁßªÂä®
                this.renderer.domElement.addEventListener('mousemove', (event) => this.onMouseMove(event));
                
                // Èº†Ê†áÁÇπÂáª - ‰øÆÊîπ‰∏∫ÊîØÊåÅÊîæÁΩÆÊ®°Âºè
                this.renderer.domElement.addEventListener('click', (event) => this.onMouseClick(event));
                
                // ÂΩ¢Áä∂ÈÄâÊã©ÊåâÈíÆ
                document.querySelectorAll('.shape-button').forEach(button => {
                    button.addEventListener('click', () => {
                        document.querySelectorAll('.shape-button').forEach(b => b.classList.remove('active'));
                        button.classList.add('active');
                        this.selectedShape = button.dataset.shape;
                        this.updateParameterInputs();
                    });
                });
                
                // Á∫øÂûãÈÄâÊã©
                document.querySelectorAll('.line-type-button').forEach(button => {
                    button.addEventListener('click', () => {
                        document.querySelectorAll('.line-type-button').forEach(b => b.classList.remove('active'));
                        button.classList.add('active');
                        this.lineType = button.dataset.type;
                    });
                });
            }

            updateParameterInputs() {
                const param1 = document.getElementById('param1');
                const param2 = document.getElementById('param2');
                const param3 = document.getElementById('param3');
                const polygonSides = document.getElementById('polygon-sides');
                
                // Ëé∑ÂèñÊ†áÁ≠æÂÖÉÁ¥†
                const labels = document.querySelectorAll('.param-label');
                const label1 = labels[0];
                const label2 = labels[1];
                const label3 = labels[2];
                const labelSides = labels[3];
                
                // ÈªòËÆ§ÈöêËóèËæπÊï∞ËæìÂÖ•Ê°ÜÂíåÊ†áÁ≠æ
                polygonSides.style.display = 'none';
                if (labelSides) labelSides.style.display = 'none';
                
                switch(this.selectedShape) {
                    case 'cube':
                        param1.placeholder = 'ËæπÈïø (Âçï‰Ωç)';
                        if (label1) label1.textContent = 'ËæπÈïø:';
                        param2.style.display = 'none';
                        param3.style.display = 'none';
                        if (label2) label2.style.display = 'none';
                        if (label3) label3.style.display = 'none';
                        break;
                    case 'box':
                        param1.placeholder = 'ÈïøÂ∫¶ (Âçï‰Ωç)';
                        param2.placeholder = 'ÂÆΩÂ∫¶ (Âçï‰Ωç)';
                        param3.placeholder = 'È´òÂ∫¶ (Âçï‰Ωç)';
                        if (label1) label1.textContent = 'ÈïøÂ∫¶:';
                        if (label2) label2.textContent = 'ÂÆΩÂ∫¶:';
                        if (label3) label3.textContent = 'È´òÂ∫¶:';
                        param2.style.display = 'block';
                        param3.style.display = 'block';
                        if (label2) label2.style.display = 'block';
                        if (label3) label3.style.display = 'block';
                        break;
                    case 'sphere':
                        param1.placeholder = 'ÂçäÂæÑ (Âçï‰Ωç)';
                        if (label1) label1.textContent = 'ÂçäÂæÑ:';
                        param2.style.display = 'none';
                        param3.style.display = 'none';
                        if (label2) label2.style.display = 'none';
                        if (label3) label3.style.display = 'none';
                        break;
                    case 'cylinder':
                        param1.placeholder = 'ÂçäÂæÑ (Âçï‰Ωç)';
                        param2.placeholder = 'È´òÂ∫¶ (Âçï‰Ωç)';
                        if (label1) label1.textContent = 'ÂçäÂæÑ:';
                        if (label2) label2.textContent = 'È´òÂ∫¶:';
                        param2.style.display = 'block';
                        param3.style.display = 'none';
                        if (label2) label2.style.display = 'block';
                        if (label3) label3.style.display = 'none';
                        break;
                    case 'cone':
                        param1.placeholder = 'Â∫ïÈù¢ÂçäÂæÑ (Âçï‰Ωç)';
                        param2.placeholder = 'È´òÂ∫¶ (Âçï‰Ωç)';
                        if (label1) label1.textContent = 'Â∫ïÈù¢ÂçäÂæÑ:';
                        if (label2) label2.textContent = 'È´òÂ∫¶:';
                        param2.style.display = 'block';
                        param3.style.display = 'none';
                        if (label2) label2.style.display = 'block';
                        if (label3) label3.style.display = 'none';
                        break;
                    case 'pyramid':
                        param1.placeholder = 'Â∫ïÈù¢ÂçäÂæÑ (Âçï‰Ωç)';
                        param2.placeholder = 'È´òÂ∫¶ (Âçï‰Ωç)';
                        if (label1) label1.textContent = 'Â∫ïÈù¢ÂçäÂæÑ:';
                        if (label2) label2.textContent = 'È´òÂ∫¶:';
                        param2.style.display = 'block';
                        param3.style.display = 'none';
                        if (label2) label2.style.display = 'block';
                        if (label3) label3.style.display = 'none';
                        break;
                    case 'prism':
                        param1.placeholder = 'Â∫ïËæπÈïø (Âçï‰Ωç)';
                        param2.placeholder = '‰∏âËßíÂΩ¢È´ò (Âçï‰Ωç)';
                        param3.placeholder = 'Êü±‰ΩìÊ∑±Â∫¶ (Âçï‰Ωç)';
                        if (label1) label1.textContent = 'Â∫ïËæπÈïø:';
                        if (label2) label2.textContent = '‰∏âËßíÂΩ¢È´ò:';
                        if (label3) label3.textContent = 'Êü±‰ΩìÊ∑±Â∫¶:';
                        param2.style.display = 'block';
                        param3.style.display = 'block';
                        if (label2) label2.style.display = 'block';
                        if (label3) label3.style.display = 'block';
                        break;
                    case 'torus':
                        param1.placeholder = 'ÁéØÈù¢ÂçäÂæÑ (Âçï‰Ωç)';
                        param2.placeholder = 'ÁÆ°ÈÅìÂçäÂæÑ (Âçï‰Ωç)';
                        if (label1) label1.textContent = 'ÁéØÈù¢ÂçäÂæÑ:';
                        if (label2) label2.textContent = 'ÁÆ°ÈÅìÂçäÂæÑ:';
                        param2.style.display = 'block';
                        param3.style.display = 'none';
                        if (label2) label2.style.display = 'block';
                        if (label3) label3.style.display = 'none';
                        break;
                    case 'polygon':
                        param1.placeholder = 'ÂçäÂæÑ (Âçï‰Ωç)';
                        param2.placeholder = 'È´òÂ∫¶ (Âçï‰Ωç)';
                        if (label1) label1.textContent = 'ÂçäÂæÑ:';
                        if (label2) label2.textContent = 'È´òÂ∫¶:';
                        param2.style.display = 'block';
                        param3.style.display = 'none';
                        if (label2) label2.style.display = 'block';
                        if (label3) label3.style.display = 'none';
                        // ÊòæÁ§∫ËæπÊï∞ËæìÂÖ•Ê°ÜÂíåÊ†áÁ≠æ
                        polygonSides.style.display = 'block';
                        if (labelSides) {
                            labelSides.style.display = 'block';
                            labelSides.textContent = 'ËæπÊï∞:';
                        }
                        break;
                    default:
                        param1.placeholder = 'ÈïøÂ∫¶ (Âçï‰Ωç)';
                        param2.placeholder = 'ÂÆΩÂ∫¶ (Âçï‰Ωç)';
                        param3.placeholder = 'È´òÂ∫¶ (Âçï‰Ωç)';
                        if (label1) label1.textContent = 'ÈïøÂ∫¶:';
                        if (label2) label2.textContent = 'ÂÆΩÂ∫¶:';
                        if (label3) label3.textContent = 'È´òÂ∫¶:';
                        param2.style.display = 'block';
                        param3.style.display = 'block';
                        if (label2) label2.style.display = 'block';
                        if (label3) label3.style.display = 'block';
                }
            }

            createGeometry(shape, params) {
                let geometry;
                
                switch(shape) {
                    case 'cube':
                        geometry = new THREE.BoxGeometry(params[0], params[0], params[0]);
                        break;
                    case 'box':
                        geometry = new THREE.BoxGeometry(params[0], params[1], params[2]);
                        break;
                    case 'sphere':
                        geometry = new THREE.SphereGeometry(params[0], 32, 32);
                        break;
                    case 'cylinder':
                        geometry = new THREE.CylinderGeometry(params[0], params[0], params[1], 32);
                        break;
                    case 'cone':
                        geometry = new THREE.ConeGeometry(params[0], params[1], 32);
                        break;
                    case 'pyramid':
                        geometry = new THREE.ConeGeometry(params[0], params[1], 4);
                        break;
                    case 'prism':
                        const shape = new THREE.Shape();
                        shape.moveTo(0, 0);
                        shape.lineTo(params[0], 0);
                        shape.lineTo(params[0]/2, params[1]);
                        shape.lineTo(0, 0);
                        geometry = new THREE.ExtrudeGeometry(shape, { depth: params[2] });
                        break;
                    case 'torus':
                        geometry = new THREE.TorusGeometry(params[0], params[1], 16, 100);
                        break;
                    case 'polygon':
                        const sides = parseInt(document.getElementById('polygon-sides').value) || 6;
                        geometry = new THREE.CylinderGeometry(params[0], params[0], params[1], Math.max(3, Math.min(20, sides)));
                        break;
                    default:
                        geometry = new THREE.BoxGeometry(params[0], params[1], params[2]);
                }
                
                return geometry;
            }

            createShape() {
                try {
                    console.log('üîÑ ÂºÄÂßãÂàõÂª∫Âá†‰Ωï‰Ωì...');
                    console.log('ÈÄâÊã©ÁöÑÂΩ¢Áä∂:', this.selectedShape);
                    console.log('Âú∫ÊôØÂØπË±°Êï∞Èáè:', this.scene.children.length);
                    
                    const param1 = parseFloat(document.getElementById('param1').value) || 2;
                    const param2 = parseFloat(document.getElementById('param2').value) || 2;
                    const param3 = parseFloat(document.getElementById('param3').value) || 2;
                    const color = document.getElementById('shape-color').value;
                    const transparency = parseFloat(document.getElementById('transparency').value);
                    const wireframe = document.getElementById('wireframe').checked;
                    
                    console.log('ÂèÇÊï∞:', { param1, param2, param3, color, transparency, wireframe });
                    
                    const params = [param1, param2, param3];
                    const geometry = this.createGeometry(this.selectedShape, params);
                    console.log('‚úÖ Âá†‰Ωï‰ΩìÂàõÂª∫ÂÆåÊàê:', geometry);
                    console.log('Âá†‰Ωï‰ΩìÈ°∂ÁÇπÊï∞:', geometry.attributes.position ? geometry.attributes.position.count : 'N/A');
                    
                    const material = new THREE.MeshPhongMaterial({
                        color: color,
                        transparent: true,
                        opacity: transparency,
                        wireframe: wireframe
                    });
                    console.log('‚úÖ ÊùêË¥®ÂàõÂª∫ÂÆåÊàê:', material);
                    
                    const mesh = new THREE.Mesh(geometry, material);
                    mesh.castShadow = true;
                    mesh.receiveShadow = true;
                    console.log('‚úÖ ÁΩëÊ†ºÂàõÂª∫ÂÆåÊàê:', mesh);
                    
                    // Êô∫ËÉΩ‰ΩçÁΩÆËÆæÁΩÆÔºö‰ΩøÁî®ÊúÄÂêéÁÇπÂáª‰ΩçÁΩÆÊàñÈªòËÆ§Â±Ö‰∏≠‰ΩçÁΩÆ
                    if (this.lastClickPosition.length() > 0) {
                        // ‰ΩøÁî®ÊúÄÂêéÁÇπÂáªÁöÑ‰ΩçÁΩÆ
                        mesh.position.copy(this.lastClickPosition);
                        console.log('‚úÖ ‰ΩøÁî®ÁÇπÂáª‰ΩçÁΩÆ:', mesh.position);
                        // Ê∏ÖÈô§ÁÇπÂáª‰ΩçÁΩÆÔºåÈÅøÂÖçÂêéÁª≠ÂØπË±°ÈÉΩÂ†ÜÂè†Âú®Âêå‰∏Ä‰ΩçÁΩÆ
                        this.lastClickPosition.set(0, 0, 0);
                    } else {
                        // ÈªòËÆ§‰ΩçÁΩÆÔºöÂú®Áõ∏Êú∫ÂâçÊñπÂèØËßÅÂå∫ÂüüÂÜÖÊúâÂ∫èÊéíÂàó
                        const offsetCount = this.objects.length;
                        const gridSize = 4; // 4x4ÁΩëÊ†ºÊéíÂàó
                        const spacing = 3; // ÂØπË±°Èó¥Ë∑ù
                        
                        const row = Math.floor(offsetCount / gridSize);
                        const col = offsetCount % gridSize;
                        
                        mesh.position.set(
                            (col - gridSize/2) * spacing, // XËΩ¥ÔºöÂ∑¶Âè≥ÂàÜÂ∏É
                            1 + row * 2, // YËΩ¥ÔºöÂûÇÁõ¥ÂàÜÂ±Ç
                            -2 - row * spacing // ZËΩ¥ÔºöÂêëÂâçÊéíÂàóÔºåÁ°Æ‰øùÂú®Áõ∏Êú∫ËßÜÈáéÂÜÖ
                        );
                        console.log('‚úÖ ‰ΩøÁî®ÈªòËÆ§ÊéíÂàó‰ΩçÁΩÆ:', mesh.position);
                    }
                    
                    this.scene.add(mesh);
                    console.log('‚úÖ Ê∑ªÂä†Âà∞Âú∫ÊôØÂÆåÊàêÔºåÂú∫ÊôØÂØπË±°Êï∞Èáè:', this.scene.children.length);
                    
                    // Â≠òÂÇ®ÂØπË±°‰ø°ÊÅØ
                    const objectInfo = {
                        id: Date.now(),
                        mesh: mesh,
                        type: this.selectedShape,
                        parameters: params,
                        color: color
                    };
                    
                    // ÂØπ‰∫éÂ§öËæπÂΩ¢Êü±ÔºåÈ¢ùÂ§ñÂ≠òÂÇ®ËæπÊï∞‰ø°ÊÅØ
                    if (this.selectedShape === 'polygon') {
                        objectInfo.sides = parseInt(document.getElementById('polygon-sides').value) || 6;
                    }
                    
                    // Á°Æ‰øùÊùêË¥®È¢úËâ≤‰∏éÂ≠òÂÇ®ÁöÑÈ¢úËâ≤‰∏ÄËá¥
                    mesh.material.color.setHex(parseInt(color.slice(1), 16));
                    
                    this.objects.push(objectInfo);
                    this.updateObjectsList();
                    console.log('‚úÖ Âá†‰Ωï‰ΩìÂàõÂª∫ÊàêÂäüÔºÅÂØπË±°ÊÄªÊï∞:', this.objects.length);
                    console.log('Âá†‰Ωï‰Ωì‰ΩçÁΩÆ:', mesh.position);
                    console.log('Âá†‰Ωï‰ΩìÂú®Áõ∏Êú∫ËßÜÈáéÂÜÖ:', this.isInCameraView(mesh));
                    
                    // ÈáçÁΩÆÊîæÁΩÆÊ®°Âºè
                    this.placementMode = false;
                    this.updatePlacementUI();
                } catch (error) {
                    console.error('‚ùå ÂàõÂª∫Âá†‰Ωï‰ΩìÂ§±Ë¥•:', error);
                    alert('ÂàõÂª∫Âá†‰Ωï‰ΩìÂ§±Ë¥•: ' + error.message);
                }
            }

            // Ê£ÄÊü•ÂØπË±°ÊòØÂê¶Âú®Áõ∏Êú∫ËßÜÈáéÂÜÖ
            isInCameraView(object) {
                const frustum = new THREE.Frustum();
                const cameraMatrix = new THREE.Matrix4().multiplyMatrices(this.camera.projectionMatrix, this.camera.matrixWorldInverse);
                frustum.setFromProjectionMatrix(cameraMatrix);
                return frustum.intersectsObject(object);
            }

            createLine() {
                const x1 = parseFloat(document.getElementById('x1').value);
                const y1 = parseFloat(document.getElementById('y1').value);
                const z1 = parseFloat(document.getElementById('z1').value);
                const x2 = parseFloat(document.getElementById('x2').value);
                const y2 = parseFloat(document.getElementById('y2').value);
                const z2 = parseFloat(document.getElementById('z2').value);
                
                if (isNaN(x1) || isNaN(y1) || isNaN(z1) || isNaN(x2) || isNaN(y2) || isNaN(z2)) {
                    alert('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÂùêÊ†áÂÄº');
                    return;
                }
                
                const material = new THREE.LineBasicMaterial({ 
                    color: 0xFFD700,
                    linewidth: 3
                });
                
                let geometry;
                
                if (this.lineType === 'straight') {
                    // Áõ¥Á∫ø
                    const points = [
                        new THREE.Vector3(x1, y1, z1),
                        new THREE.Vector3(x2, y2, z2)
                    ];
                    geometry = new THREE.BufferGeometry().setFromPoints(points);
                } else {
                    // Êõ≤Á∫ø
                    const curve = new THREE.QuadraticBezierCurve3(
                        new THREE.Vector3(x1, y1, z1),
                        new THREE.Vector3((x1+x2)/2, Math.max(y1,y2) + 2, (z1+z2)/2),
                        new THREE.Vector3(x2, y2, z2)
                    );
                    const points = curve.getPoints(50);
                    geometry = new THREE.BufferGeometry().setFromPoints(points);
                }
                
                const line = new THREE.Line(geometry, material);
                this.scene.add(line);
                
                // Ê∑ªÂä†Á´ØÁÇπÊ†áËÆ∞
                this.addPointMarker(x1, y1, z1);
                this.addPointMarker(x2, y2, z2);
                
                // Â≠òÂÇ®Á∫øÊÆµ‰ø°ÊÅØ
                const lineInfo = {
                    id: Date.now(),
                    mesh: line,
                    type: 'line',
                    start: [x1, y1, z1],
                    end: [x2, y2, z2],
                    lineType: this.lineType
                };
                
                this.objects.push(lineInfo);
                this.updateObjectsList();
            }

            addPointMarker(x, y, z) {
                const geometry = new THREE.SphereGeometry(0.1, 16, 16);
                const material = new THREE.MeshPhongMaterial({ color: 0xFF6B6B });
                const sphere = new THREE.Mesh(geometry, material);
                sphere.position.set(x, y, z);
                this.scene.add(sphere);
            }

            updateObjectsList() {
                const listContainer = document.getElementById('objects-list');
                
                if (this.objects.length === 0) {
                    listContainer.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.6); font-size: 0.8rem;">ÊöÇÊó†ÂØπË±°</div>';
                    return;
                }
                
                listContainer.innerHTML = this.objects.map(obj => `
                    <div class="object-item">
                        <span>${this.getObjectDisplayName(obj)}</span>
                        <div class="object-buttons">
                            <button class="select-button" onclick="geometrySystem.selectObjectById(${obj.id})" title="ÈÄâÊã©ÁºñËæë">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="delete-button" onclick="geometrySystem.deleteObject(${obj.id})" title="Âà†Èô§">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            getObjectDisplayName(obj) {
                const typeNames = {
                    cube: 'Á´ãÊñπ‰Ωì',
                    box: 'ÈïøÊñπ‰Ωì',
                    sphere: 'ÁêÉ‰Ωì',
                    cylinder: 'ÂúÜÊü±‰Ωì',
                    cone: 'ÂúÜÈî•‰Ωì',
                    pyramid: 'ÂõõËßíÈî•',
                    prism: '‰∏âËßíÊü±',
                    torus: 'ÂúÜÁéØ‰Ωì',
                    polygon: 'Â§öËæπÂΩ¢Êü±',
                    line: 'Á∫øÊÆµ'
                };
                return typeNames[obj.type] || obj.type;
            }

            deleteObject(id) {
                const index = this.objects.findIndex(obj => obj.id === id);
                if (index !== -1) {
                    this.scene.remove(this.objects[index].mesh);
                    this.objects.splice(index, 1);
                    this.updateObjectsList();
                }
            }

            clearAll() {
                this.objects.forEach(obj => {
                    this.scene.remove(obj.mesh);
                });
                this.objects = [];
                this.updateObjectsList();
            }

            resetView() {
                this.camera.position.set(10, 10, 10);
                this.camera.lookAt(0, 0, 0);
                this.controls.reset();
            }

            toggleGrid() {
                this.gridHelper.visible = !this.gridHelper.visible;
            }

            toggleAxes() {
                this.axesHelper.visible = !this.axesHelper.visible;
            }

            exportScene() {
                const sceneData = {
                    objects: this.objects.map(obj => ({
                        type: obj.type,
                        parameters: obj.parameters,
                        color: obj.color,
                        position: obj.mesh.position.toArray(),
                        rotation: obj.mesh.rotation.toArray()
                    }))
                };
                
                const dataStr = JSON.stringify(sceneData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = 'geometry-scene.json';
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            }

            onWindowResize() {
                const container = document.getElementById('geometry-container');
                const width = container.clientWidth;
                const height = container.clientHeight;
                
                this.camera.aspect = width / height;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(width, height);
            }

            onMouseMove(event) {
                const rect = this.renderer.domElement.getBoundingClientRect();
                this.mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
                this.mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
                
                // Êõ¥Êñ∞ÂùêÊ†áÊòæÁ§∫
                this.raycaster.setFromCamera(this.mouse, this.camera);
                
                // Â∞ùËØï‰∏éÁΩëÊ†ºÁõ∏‰∫§
                const intersects = this.raycaster.intersectObject(this.gridHelper);
                
                if (intersects.length > 0) {
                    const point = intersects[0].point;
                    document.getElementById('coordinates-display').textContent = 
                        `Èº†Ê†áÂùêÊ†á: (${point.x.toFixed(2)}, ${point.y.toFixed(2)}, ${point.z.toFixed(2)})`;
                } else {
                    // Â¶ÇÊûúÊ≤°Êúâ‰∏éÁΩëÊ†ºÁõ∏‰∫§ÔºåÊòæÁ§∫Â±èÂπïÂùêÊ†á
                    document.getElementById('coordinates-display').textContent = 
                        `Â±èÂπïÂùêÊ†á: (${this.mouse.x.toFixed(2)}, ${this.mouse.y.toFixed(2)})`;
                }
            }

            onMouseClick(event) {
                // Èò≤Ê≠¢ÊéßÂà∂Âô®ÂÜ≤Á™Å
                if (event.button !== 0) return; // Âè™Â§ÑÁêÜÂ∑¶ÈîÆÁÇπÂáª
                
                this.raycaster.setFromCamera(this.mouse, this.camera);
                
                // Â¶ÇÊûúÂ§Ñ‰∫éÊîæÁΩÆÊ®°ÂºèÔºåËÆæÁΩÆÊîæÁΩÆ‰ΩçÁΩÆ
                if (this.placementMode) {
                    // ‰∏éÁΩëÊ†ºÂπ≥Èù¢Áõ∏‰∫§Êù•Á°ÆÂÆöÊîæÁΩÆ‰ΩçÁΩÆ
                    const intersects = this.raycaster.intersectObject(this.gridHelper);
                    if (intersects.length > 0) {
                        this.lastClickPosition.copy(intersects[0].point);
                        this.lastClickPosition.y = Math.max(0, this.lastClickPosition.y); // Á°Æ‰øùÂú®Âú∞Èù¢‰ª•‰∏ä
                        console.log('üìç ËÆæÁΩÆÊîæÁΩÆ‰ΩçÁΩÆ:', this.lastClickPosition);
                        this.createShape(); // Á´ãÂç≥ÂàõÂª∫Âá†‰Ωï‰Ωì
                        return;
                    }
                }
                
                // Ê£ÄÊü•ÊòØÂê¶ÁÇπÂáª‰∫ÜÁé∞ÊúâÂØπË±°
                const intersects = this.raycaster.intersectObjects(this.objects.map(obj => obj.mesh));
                
                if (intersects.length > 0) {
                    const clickedObject = intersects[0].object;
                    const objectInfo = this.objects.find(obj => obj.mesh === clickedObject);
                    
                    if (objectInfo) {
                        // Â¶ÇÊûúÊåâ‰ΩèCtrlÈîÆÔºåÊòæÁ§∫ÂØπË±°‰ø°ÊÅØÔºõÂê¶ÂàôÈÄâÊã©ÂØπË±°ËøõË°åÁºñËæë
                        if (event.ctrlKey) {
                            this.showObjectInfo(objectInfo);
                        } else {
                            this.selectObject(clickedObject, objectInfo);
                        }
                    }
                } else {
                    // Â¶ÇÊûúÊ≤°ÊúâÁÇπÂáªÂà∞ÂØπË±°ÔºåÂèñÊ∂àÈÄâÊã©Âπ∂Âú®ÁΩëÊ†º‰∏äËÆæÁΩÆÊñ∞ÁöÑÁÇπÂáª‰ΩçÁΩÆ
                    this.deselectObject();
                    
                    const gridIntersects = this.raycaster.intersectObject(this.gridHelper);
                    if (gridIntersects.length > 0) {
                        this.lastClickPosition.copy(gridIntersects[0].point);
                        this.lastClickPosition.y = Math.max(0, this.lastClickPosition.y);
                        console.log('üìç Êõ¥Êñ∞ÁÇπÂáª‰ΩçÁΩÆ:', this.lastClickPosition);
                    }
                }
            }

            showObjectInfo(objectInfo) {
                let info = `ÂØπË±°Á±ªÂûã: ${this.getObjectDisplayName(objectInfo)}\n`;
                
                if (objectInfo.parameters) {
                    info += `ÂèÇÊï∞: ${objectInfo.parameters.join(', ')}\n`;
                }
                
                info += `‰ΩçÁΩÆ: (${objectInfo.mesh.position.x.toFixed(2)}, ${objectInfo.mesh.position.y.toFixed(2)}, ${objectInfo.mesh.position.z.toFixed(2)})`;
                
                alert(info);
            }

            animate() {
                requestAnimationFrame(() => this.animate());
                
                this.controls.update();
                this.renderer.render(this.scene, this.camera);
            }

            // ÂêØÁî®ÊîæÁΩÆÊ®°Âºè
            enablePlacementMode() {
                this.placementMode = true;
                this.updatePlacementUI();
                console.log('üéØ ÊîæÁΩÆÊ®°ÂºèÂ∑≤ÂêØÁî®ÔºåÁÇπÂáª3DËßÜÂõæÊù•ÊîæÁΩÆÂá†‰Ωï‰Ωì');
            }

            // Êõ¥Êñ∞ÊîæÁΩÆÊ®°ÂºèUIÊèêÁ§∫
            updatePlacementUI() {
                const container = document.getElementById('geometry-container');
                let instruction = container.querySelector('.placement-instruction');
                
                if (this.placementMode) {
                    if (!instruction) {
                        instruction = document.createElement('div');
                        instruction.className = 'placement-instruction';
                        instruction.style.cssText = `
                            position: absolute;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            background: rgba(255, 215, 0, 0.9);
                            color: #000;
                            padding: 15px 25px;
                            border-radius: 10px;
                            font-weight: bold;
                            z-index: 1000;
                            animation: pulse 2s infinite;
                            pointer-events: none;
                        `;
                        instruction.innerHTML = 'üéØ ÁÇπÂáªÁΩëÊ†º‰∏äÁöÑ‰ªªÊÑè‰ΩçÁΩÆÊù•ÊîæÁΩÆÂá†‰Ωï‰Ωì<br><small>Êåâ ESC ÈîÆÈÄÄÂá∫ÊîæÁΩÆÊ®°Âºè</small>';
                        container.appendChild(instruction);
                    }
                } else {
                    if (instruction) {
                        instruction.remove();
                    }
                }
                
                // Ê∑ªÂä†ESCÈîÆÈÄÄÂá∫ÊîæÁΩÆÊ®°ÂºèÁöÑÁõëÂê¨
                if (this.placementMode && !this.escKeyListener) {
                    this.escKeyListener = (event) => {
                        if (event.key === 'Escape') {
                            this.placementMode = false;
                            this.updatePlacementUI();
                            console.log('üö´ ÂèñÊ∂àÊîæÁΩÆÊ®°Âºè');
                        }
                    };
                    document.addEventListener('keydown', this.escKeyListener);
                } else if (!this.placementMode && this.escKeyListener) {
                    document.removeEventListener('keydown', this.escKeyListener);
                    this.escKeyListener = null;
                }
            }

            updateSelectedObject() {
                if (this.selectedObject && this.transformControls.object) {
                    // ÂÆûÊó∂Êõ¥Êñ∞ÁºñËæëÈù¢Êùø‰∏≠ÁöÑÂùêÊ†á
                    const pos = this.selectedObject.position;
                    document.getElementById('edit-x').value = pos.x.toFixed(2);
                    document.getElementById('edit-y').value = pos.y.toFixed(2);
                    document.getElementById('edit-z').value = pos.z.toFixed(2);
                    
                    // Êõ¥Êñ∞ÈÄâ‰∏≠ÂØπË±°ÁöÑ‰ΩçÁΩÆ„ÄÅÊóãËΩ¨„ÄÅÁº©Êîæ
                    const objectInfo = this.objects.find(obj => obj.mesh === this.selectedObject);
                    if (objectInfo) {
                        // ÂèØ‰ª•Âú®ËøôÈáåÊ∑ªÂä†Êõ¥Â§öÂÆûÊó∂Êõ¥Êñ∞ÁöÑÂ±ûÊÄß
                        console.log('üìç ÂØπË±°‰ΩçÁΩÆÊõ¥Êñ∞:', pos);
                    }
                }
            }

            // ÈÄâÊã©ÂØπË±°ËøõË°åÁºñËæë
            selectObject(mesh, objectInfo) {
                // ÂèñÊ∂à‰πãÂâçÁöÑÈÄâÊã©
                this.deselectObject();
                
                // ËÆæÁΩÆÊñ∞ÁöÑÈÄâÊã©
                this.selectedObject = mesh;
                this.isEditMode = true;
                
                // Ê∑ªÂä†ÈÄâÊã©È´ò‰∫ÆÊïàÊûú
                this.addSelectionHighlight(mesh);
                
                // ÊòæÁ§∫ÁºñËæëÈù¢Êùø
                this.showEditPanel(objectInfo);
                
                // ÊòæÁ§∫ÂèòÊç¢ÊéßÂà∂Âô®
                this.transformControls.attach(mesh);
                this.transformControls.visible = true;
                this.transformControls.setMode('translate'); // ÈªòËÆ§ÁßªÂä®Ê®°Âºè
                
                console.log('‚úÖ ÈÄâÊã©ÂØπË±°ËøõË°åÁºñËæë:', objectInfo.type);
            }

            // ÂèñÊ∂àÂØπË±°ÈÄâÊã©
            deselectObject() {
                if (this.selectedObject) {
                    // ÁßªÈô§È´ò‰∫ÆÊïàÊûú
                    this.removeSelectionHighlight(this.selectedObject);
                    
                    // ÈöêËóèÂèòÊç¢ÊéßÂà∂Âô®
                    this.transformControls.detach();
                    this.transformControls.visible = false;
                    
                    this.selectedObject = null;
                    this.isEditMode = false;
                    
                    // ÈöêËóèÁºñËæëÈù¢Êùø
                    document.getElementById('object-editor').style.display = 'none';
                    
                    console.log('‚úÖ ÂèñÊ∂àÂØπË±°ÈÄâÊã©');
                }
            }

            // Ê∑ªÂä†ÈÄâÊã©È´ò‰∫ÆÊïàÊûú
            addSelectionHighlight(mesh) {
                // ‰øùÂ≠òÂéüÂßãÊùêË¥®
                mesh.userData.originalMaterial = mesh.material;
                
                // ÂàõÂª∫È´ò‰∫ÆÊùêË¥®
                const highlightMaterial = mesh.material.clone();
                highlightMaterial.emissive = new THREE.Color(0x444444);
                highlightMaterial.transparent = true;
                highlightMaterial.opacity = Math.max(0.8, mesh.material.opacity);
                
                mesh.material = highlightMaterial;
            }

            // ÁßªÈô§ÈÄâÊã©È´ò‰∫ÆÊïàÊûú
            removeSelectionHighlight(mesh) {
                if (mesh.userData.originalMaterial) {
                    mesh.material = mesh.userData.originalMaterial;
                    delete mesh.userData.originalMaterial;
                }
            }

            // ÊòæÁ§∫ÁºñËæëÈù¢Êùø
            showEditPanel(objectInfo) {
                const editPanel = document.getElementById('object-editor');
                editPanel.style.display = 'block';
                
                // Â°´ÂÖÖÂΩìÂâçÂØπË±°ÁöÑÂùêÊ†á
                document.getElementById('edit-x').value = objectInfo.mesh.position.x.toFixed(2);
                document.getElementById('edit-y').value = objectInfo.mesh.position.y.toFixed(2);
                document.getElementById('edit-z').value = objectInfo.mesh.position.z.toFixed(2);
                
                // Ê∑ªÂä†ÂùêÊ†áÂÆûÊó∂Êõ¥Êñ∞ÁõëÂê¨Âô®
                this.setupCoordinateListeners();
                
                // Â°´ÂÖÖÂΩìÂâçÂØπË±°ÁöÑÂ±ûÊÄß
                document.getElementById('edit-color').value = objectInfo.color;
                document.getElementById('edit-transparency').value = objectInfo.mesh.material.opacity;
                
                // Ê†πÊçÆÂØπË±°Á±ªÂûãÊòæÁ§∫Áõ∏Â∫îÁöÑÂèÇÊï∞ËæìÂÖ•Ê°Ü
                this.updateEditParameterInputs(objectInfo);
                
                // Â°´ÂÖÖÂèÇÊï∞ÂÄº
                if (objectInfo.parameters) {
                    document.getElementById('edit-param1').value = objectInfo.parameters[0] || '';
                    document.getElementById('edit-param2').value = objectInfo.parameters[1] || '';
                    document.getElementById('edit-param3').value = objectInfo.parameters[2] || '';
                }
            }

            // ËÆæÁΩÆÂùêÊ†áËæìÂÖ•Ê°ÜÁöÑÂÆûÊó∂ÁõëÂê¨Âô®
            setupCoordinateListeners() {
                const inputs = ['edit-x', 'edit-y', 'edit-z'];
                
                inputs.forEach(inputId => {
                    const input = document.getElementById(inputId);
                    if (input) {
                        // ÁßªÈô§ÊóßÁöÑÁõëÂê¨Âô®ÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
                        input.removeEventListener('input', this.handleCoordinateChange);
                        // Ê∑ªÂä†Êñ∞ÁöÑÁõëÂê¨Âô®
                        input.addEventListener('input', this.handleCoordinateChange.bind(this));
                    }
                });
            }

            // Â§ÑÁêÜÂùêÊ†áÂèòÂåñ
            handleCoordinateChange() {
                if (!this.selectedObject) return;
                
                const x = parseFloat(document.getElementById('edit-x').value);
                const y = parseFloat(document.getElementById('edit-y').value);
                const z = parseFloat(document.getElementById('edit-z').value);
                
                if (!isNaN(x) && !isNaN(y) && !isNaN(z)) {
                    this.selectedObject.position.set(x, y, z);
                }
            }

            // Êõ¥Êñ∞ÁºñËæëÂèÇÊï∞ËæìÂÖ•Ê°Ü
            updateEditParameterInputs(objectInfo) {
                const param1 = document.getElementById('edit-param1');
                const param2 = document.getElementById('edit-param2');
                const param3 = document.getElementById('edit-param3');
                
                switch(objectInfo.type) {
                    case 'cube':
                        param1.placeholder = 'ËæπÈïø (Âçï‰Ωç)';
                        param2.style.display = 'none';
                        param3.style.display = 'none';
                        break;
                    case 'box':
                        param1.placeholder = 'ÈïøÂ∫¶ (Âçï‰Ωç)';
                        param2.placeholder = 'ÂÆΩÂ∫¶ (Âçï‰Ωç)';
                        param3.placeholder = 'È´òÂ∫¶ (Âçï‰Ωç)';
                        param2.style.display = 'block';
                        param3.style.display = 'block';
                        break;
                    case 'sphere':
                        param1.placeholder = 'ÂçäÂæÑ (Âçï‰Ωç)';
                        param2.style.display = 'none';
                        param3.style.display = 'none';
                        break;
                    case 'cylinder':
                        param1.placeholder = 'ÂçäÂæÑ (Âçï‰Ωç)';
                        param2.placeholder = 'È´òÂ∫¶ (Âçï‰Ωç)';
                        param2.style.display = 'block';
                        param3.style.display = 'none';
                        break;
                    case 'cone':
                        param1.placeholder = 'Â∫ïÈù¢ÂçäÂæÑ (Âçï‰Ωç)';
                        param2.placeholder = 'È´òÂ∫¶ (Âçï‰Ωç)';
                        param2.style.display = 'block';
                        param3.style.display = 'none';
                        break;
                    case 'pyramid':
                        param1.placeholder = 'Â∫ïÈù¢ÂçäÂæÑ (Âçï‰Ωç)';
                        param2.placeholder = 'È´òÂ∫¶ (Âçï‰Ωç)';
                        param2.style.display = 'block';
                        param3.style.display = 'none';
                        break;
                    case 'prism':
                        param1.placeholder = 'Â∫ïËæπÈïø (Âçï‰Ωç)';
                        param2.placeholder = '‰∏âËßíÂΩ¢È´ò (Âçï‰Ωç)';
                        param3.placeholder = 'Êü±‰ΩìÊ∑±Â∫¶ (Âçï‰Ωç)';
                        param2.style.display = 'block';
                        param3.style.display = 'block';
                        break;
                    case 'torus':
                        param1.placeholder = 'ÁéØÈù¢ÂçäÂæÑ (Âçï‰Ωç)';
                        param2.placeholder = 'ÁÆ°ÈÅìÂçäÂæÑ (Âçï‰Ωç)';
                        param2.style.display = 'block';
                        param3.style.display = 'none';
                        break;
                    case 'polygon':
                        param1.placeholder = 'ÂçäÂæÑ (Âçï‰Ωç)';
                        param2.placeholder = 'È´òÂ∫¶ (Âçï‰Ωç)';
                        param2.style.display = 'block';
                        param3.style.display = 'none';
                        break;
                    default:
                        param1.placeholder = 'ÈïøÂ∫¶ (Âçï‰Ωç)';
                        param2.placeholder = 'ÂÆΩÂ∫¶ (Âçï‰Ωç)';
                        param3.placeholder = 'È´òÂ∫¶ (Âçï‰Ωç)';
                        param2.style.display = 'block';
                        param3.style.display = 'block';
                }
            }

            // Â∫îÁî®ÂØπË±°ÁºñËæë
            applyObjectEdits() {
                if (!this.selectedObject) return;
                
                const objectInfo = this.objects.find(obj => obj.mesh === this.selectedObject);
                if (!objectInfo) return;
                
                try {
                    // Êõ¥Êñ∞ÂùêÊ†á
                    const newX = parseFloat(document.getElementById('edit-x').value);
                    const newY = parseFloat(document.getElementById('edit-y').value);
                    const newZ = parseFloat(document.getElementById('edit-z').value);
                    
                    if (!isNaN(newX) && !isNaN(newY) && !isNaN(newZ)) {
                        this.selectedObject.position.set(newX, newY, newZ);
                        console.log('‚úÖ ÂùêÊ†áÊõ¥Êñ∞:', { x: newX, y: newY, z: newZ });
                    }
                    
                    // Êõ¥Êñ∞È¢úËâ≤ - ÈúÄË¶ÅÂ§ÑÁêÜÂéüÂßãÊùêË¥®ÂíåÈ´ò‰∫ÆÊùêË¥®
                    const newColor = document.getElementById('edit-color').value;
                    const colorInt = parseInt(newColor.slice(1), 16);
                    
                    // Êõ¥Êñ∞ÂΩìÂâçÊòæÁ§∫ÁöÑÊùêË¥®
                    this.selectedObject.material.color.setHex(colorInt);
                    
                    // Â¶ÇÊûúÊúâÂéüÂßãÊùêË¥®Ôºå‰πüË¶ÅÊõ¥Êñ∞ÂÆÉ
                    if (this.selectedObject.userData.originalMaterial) {
                        this.selectedObject.userData.originalMaterial.color.setHex(colorInt);
                    }
                    
                    objectInfo.color = newColor;
                    console.log('‚úÖ È¢úËâ≤Êõ¥Êñ∞:', newColor);
                    
                    // Êõ¥Êñ∞ÈÄèÊòéÂ∫¶
                    const newTransparency = parseFloat(document.getElementById('edit-transparency').value);
                    this.selectedObject.material.opacity = newTransparency;
                    
                    // ‰πüÊõ¥Êñ∞ÂéüÂßãÊùêË¥®ÁöÑÈÄèÊòéÂ∫¶
                    if (this.selectedObject.userData.originalMaterial) {
                        this.selectedObject.userData.originalMaterial.opacity = newTransparency;
                    }
                    
                    console.log('‚úÖ ÈÄèÊòéÂ∫¶Êõ¥Êñ∞:', newTransparency);
                    
                    // Êõ¥Êñ∞Â∞∫ÂØ∏ÂèÇÊï∞
                    const newParam1 = parseFloat(document.getElementById('edit-param1').value);
                    const newParam2 = parseFloat(document.getElementById('edit-param2').value);
                    const newParam3 = parseFloat(document.getElementById('edit-param3').value);
                    
                    if (!isNaN(newParam1) && newParam1 > 0) {
                        const newParams = [newParam1];
                        if (!isNaN(newParam2) && newParam2 > 0) newParams.push(newParam2);
                        if (!isNaN(newParam3) && newParam3 > 0) newParams.push(newParam3);
                        
                        // ÈáçÊñ∞ÂàõÂª∫Âá†‰Ωï‰Ωì
                        this.updateObjectGeometry(objectInfo, newParams);
                        console.log('‚úÖ Â∞∫ÂØ∏Êõ¥Êñ∞:', newParams);
                    }
                    
                    console.log('‚úÖ ÂØπË±°ÁºñËæëÂ∫îÁî®ÊàêÂäü');
                    this.updateObjectsList();
                } catch (error) {
                    console.error('‚ùå Â∫îÁî®ÁºñËæëÂ§±Ë¥•:', error);
                    alert('Â∫îÁî®ÁºñËæëÂ§±Ë¥•: ' + error.message);
                }
            }

            // Êõ¥Êñ∞ÂØπË±°Âá†‰Ωï‰Ωì
            updateObjectGeometry(objectInfo, newParams) {
                const oldGeometry = objectInfo.mesh.geometry;
                const newGeometry = this.createGeometry(objectInfo.type, newParams);
                
                // Êõ¥Êñ∞Âá†‰Ωï‰Ωì
                objectInfo.mesh.geometry = newGeometry;
                objectInfo.parameters = newParams;
                
                // ÈáäÊîæÊóßÂá†‰Ωï‰ΩìÂÜÖÂ≠ò
                oldGeometry.dispose();
                
                console.log('‚úÖ Âá†‰Ωï‰ΩìÊõ¥Êñ∞ÂÆåÊàê:', newParams);
            }

            updateObjectPropertiesPanel(objectInfo) {
                // ÂÆûÊó∂Êõ¥Êñ∞ÁºñËæëÈù¢Êùø‰∏≠ÁöÑ‰ΩçÁΩÆ‰ø°ÊÅØÁ≠â
                // Ëøô‰∏™ÊñπÊ≥ïÂú®ÂèòÊç¢ÊéßÂà∂Âô®ÁßªÂä®ÂØπË±°Êó∂Ë¢´Ë∞ÉÁî®
            }

            // Ê†πÊçÆIDÈÄâÊã©ÂØπË±°
            selectObjectById(id) {
                const objectInfo = this.objects.find(obj => obj.id === id);
                if (objectInfo) {
                    this.selectObject(objectInfo.mesh, objectInfo);
                }
            }
        }

        // ÂÖ®Â±ÄÂáΩÊï∞‰æõHTMLË∞ÉÁî®
        function createShape() {
            console.log('üéØ createShapeÂáΩÊï∞Ë¢´Ë∞ÉÁî®');
            if (!geometrySystem) {
                console.error('‚ùå Âá†‰ΩïÁ≥ªÁªüÊú™ÂàùÂßãÂåñ');
                alert('3DÁ≥ªÁªüÊú™ÂàùÂßãÂåñÔºåËØ∑Âà∑Êñ∞È°µÈù¢');
                return;
            }
            
            // Áõ¥Êé•ÂàõÂª∫Âá†‰Ωï‰ΩìÂú®ÈªòËÆ§‰ΩçÁΩÆ
            geometrySystem.createShape();
        }

        function enableClickToPlace() {
            if (!geometrySystem) {
                alert('3DÁ≥ªÁªüÊú™ÂàùÂßãÂåñÔºåËØ∑Âà∑Êñ∞È°µÈù¢');
                return;
            }
            geometrySystem.enablePlacementMode();
        }

        function createLine() {
            if (!geometrySystem) {
                alert('3DÁ≥ªÁªüÊú™ÂàùÂßãÂåñÔºåËØ∑Âà∑Êñ∞È°µÈù¢');
                return;
            }
            geometrySystem.createLine();
        }

        function clearAll() {
            if (!geometrySystem) {
                alert('3DÁ≥ªÁªüÊú™ÂàùÂßãÂåñÔºåËØ∑Âà∑Êñ∞È°µÈù¢');
                return;
            }
            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÂØπË±°ÂêóÔºü')) {
                geometrySystem.clearAll();
            }
        }

        function resetView() {
            if (geometrySystem) geometrySystem.resetView();
        }

        function toggleGrid() {
            if (geometrySystem) geometrySystem.toggleGrid();
        }

        function toggleAxes() {
            if (geometrySystem) geometrySystem.toggleAxes();
        }

        function exportScene() {
            if (geometrySystem) geometrySystem.exportScene();
        }

        function setTransformMode(mode) {
            if (!geometrySystem || !geometrySystem.transformControls) {
                alert('ÂèòÊç¢ÊéßÂà∂Âô®Êú™ÂàùÂßãÂåñ');
                return;
            }
            geometrySystem.transformControls.setMode(mode);
            console.log('üîß ÂèòÊç¢Ê®°ÂºèËÆæÁΩÆ‰∏∫:', mode);
        }

        function applyObjectEdits() {
            if (!geometrySystem) {
                alert('3DÁ≥ªÁªüÊú™ÂàùÂßãÂåñÔºåËØ∑Âà∑Êñ∞È°µÈù¢');
                return;
            }
            geometrySystem.applyObjectEdits();
        }

        function deselectObject() {
            if (!geometrySystem) {
                alert('3DÁ≥ªÁªüÊú™ÂàùÂßãÂåñÔºåËØ∑Âà∑Êñ∞È°µÈù¢');
                return;
            }
            geometrySystem.deselectObject();
        }
    </script>
</body>
</html> 