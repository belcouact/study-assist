<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç«‹ä½“å‡ ä½• - æ•°å­¦å­¦ä¹ åŠ©æ‰‹</title>
    <link rel="icon" href="assets/icons/alex.ico" type="image/x-icon">
    <link rel="icon" href="../../assets/icons/logo_btrfly.ico" type="image/x-icon">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/components.css">
    <link rel="stylesheet" href="../../css/utilities.css">
    <link rel="stylesheet" href="../../css/responsive.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Three.js r128 with stable CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/TransformControls.js"></script>
    <script>
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“„ DOMå†…å®¹å·²åŠ è½½');
            console.log('æ£€æŸ¥THREE.js:', typeof THREE !== 'undefined' ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½');
            console.log('æ£€æŸ¥OrbitControls:', typeof THREE.OrbitControls !== 'undefined' ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½');
            
            if (typeof THREE === 'undefined') {
                console.error('âŒ THREE.jsæœªåŠ è½½');
                showError('æ— æ³•åŠ è½½3Dæ¸²æŸ“å¼•æ“');
                return;
            }
            
            if (typeof THREE.OrbitControls === 'undefined') {
                console.error('âŒ OrbitControlsæœªåŠ è½½');
                showError('æ§åˆ¶å™¨ç»„ä»¶åŠ è½½å¤±è´¥');
                return;
            }
            
            // å»¶è¿Ÿä¸€ç‚¹ç‚¹ç¡®ä¿æ‰€æœ‰è„šæœ¬å®Œå…¨åŠ è½½
            setTimeout(initGeometrySystem, 100);
        });
    </script>
    <style>
        .solid-geometry-page {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #fff;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
        }

        .geometry-header {
            text-align: center;
            padding: 3rem 0 2rem;
        }

        .geometry-header h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #FFD700, #FFA500, #FF6347);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        .geometry-header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .main-workspace {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            margin: 2rem 0;
        }

        .control-panel {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            overflow: hidden; /* é˜²æ­¢å†…å®¹æº¢å‡º */
            box-sizing: border-box;
        }

        .control-section {
            margin-bottom: 2rem;
            overflow: hidden; /* é˜²æ­¢å†…å®¹æº¢å‡º */
            box-sizing: border-box;
            width: 100%;
        }

        .control-section:last-child {
            margin-bottom: 0;
        }

        .control-section h3 {
            color: #FFD700;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            border-bottom: 1px solid rgba(255, 215, 0, 0.3);
            padding-bottom: 0.5rem;
        }

        .geometry-viewer {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            height: 700px;
        }

        #geometry-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        #geometry-container canvas {
            display: block;
            width: 100% !important;
            height: 100% !important;
        }

        .shape-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 0.5rem;
        }

        .shape-button {
            width: 100%;
            padding: 0.8rem;
            margin-bottom: 0;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            min-height: 50px;
            text-align: center;
        }

        .shape-button:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #FFD700;
        }

        .shape-button.active {
            background: rgba(255, 215, 0, 0.3);
            border-color: #FFD700;
        }

        .parameter-input {
            width: 100%;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            color: #fff;
            font-size: 0.9rem;
        }

        .parameter-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .parameter-input:focus {
            outline: none;
            border-color: #FFD700;
        }

        .action-button {
            width: 100%;
            padding: 0.7rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(45deg, #4361ee, #7209b7);
            border: none;
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            box-sizing: border-box;
            min-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
        }

        .coordinate-input {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 0.3rem;
            margin-bottom: 0.5rem;
            overflow: hidden;
            width: 100%;
            box-sizing: border-box;
        }

        .coord-input {
            padding: 0.4rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            color: #fff;
            text-align: center;
            font-size: 0.8rem;
            box-sizing: border-box;
            width: 100%;
            min-width: 0; /* å…è®¸æ”¶ç¼© */
        }

        .line-type-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            width: 100%;
            box-sizing: border-box;
        }

        .line-type-button {
            flex: 1;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            box-sizing: border-box;
            min-width: 0; /* å…è®¸æ”¶ç¼© */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .line-type-button.active {
            background: rgba(255, 215, 0, 0.3);
            border-color: #FFD700;
        }

        .transparency-slider {
            width: 100%;
            margin: 0.5rem 0;
        }

        .info-panel {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 215, 0, 0.6);
            border-radius: 10px;
            padding: 15px;
            max-width: 250px;
            color: #FFD700;
            font-size: 0.9rem;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .toolbar {
            position: absolute;
            bottom: 15px;
            left: 15px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .tool-button {
            width: 45px;
            height: 45px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid rgba(255, 215, 0, 0.6);
            border-radius: 10px;
            color: #FFD700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .tool-button:hover {
            background: rgba(255, 215, 0, 0.2);
            border-color: #FFD700;
            transform: scale(1.05);
        }

        .coordinates-display {
            position: absolute;
            bottom: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 215, 0, 0.6);
            border-radius: 10px;
            padding: 10px;
            color: #FFD700;
            font-size: 0.8rem;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .objects-list {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 0.5rem;
        }

        .object-item {
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin-bottom: 0.3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .object-buttons {
            display: flex;
            gap: 0.3rem;
        }

        .select-button, .delete-button {
            background: rgba(231, 76, 60, 0.3);
            border: 1px solid #e74c3c;
            border-radius: 3px;
            color: #fff;
            padding: 0.2rem 0.4rem;
            cursor: pointer;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 24px;
            height: 24px;
        }

        .select-button {
            background: rgba(40, 167, 69, 0.3);
            border-color: #28a745;
        }

        .select-button:hover {
            background: rgba(40, 167, 69, 0.5);
        }

        .delete-button:hover {
            background: rgba(231, 76, 60, 0.5);
        }

        .color-picker {
            width: 100%;
            height: 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 0.5rem;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .control-panel {
                grid-template-columns: 1fr;
            }
            
            .shape-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
            
            .guide-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .geometry-header h1 {
                font-size: 2rem;
            }
            
            .geometry-viewer {
                height: 400px;
            }
            
            .control-panel {
                padding: 1rem;
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .control-section {
                margin-bottom: 1.5rem;
            }
            
            .shape-grid {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 0.4rem;
            }
            
            .shape-button {
                padding: 0.6rem 0.4rem;
                font-size: 0.75rem;
                min-height: 45px;
                flex-direction: column;
                gap: 0.2rem;
            }
            
            .shape-button i {
                font-size: 1rem;
            }
            
            .guide-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .guide-item {
                padding: 0.6rem;
                font-size: 0.8rem;
            }
            
            .info-panel-top {
                padding: 1rem;
                margin-bottom: 1rem;
            }
            
            .info-panel-top h3 {
                font-size: 1rem;
            }
            
            .coordinate-input {
                gap: 0.2rem;
            }
            
            .coord-input {
                padding: 0.3rem;
                font-size: 0.75rem;
            }
            
            .transform-controls {
                gap: 0.2rem;
            }
            
            .transform-controls .action-button {
                padding: 0.3rem 0.1rem;
                font-size: 0.7rem;
            }
            
            .toolbar {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .tool-button {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0.5rem;
            }
            
            .geometry-header {
                padding: 2rem 0 1rem;
            }
            
            .geometry-header h1 {
                font-size: 1.5rem;
            }
            
            .geometry-header p {
                font-size: 1rem;
            }
            
            .control-panel {
                padding: 0.8rem;
                gap: 0.8rem;
            }
            
            .control-section h3 {
                font-size: 1rem;
            }
            
            .shape-grid {
                grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
                gap: 0.3rem;
            }
            
            .shape-button {
                padding: 0.5rem 0.2rem;
                font-size: 0.7rem;
                min-height: 40px;
            }
            
            .parameter-input, .coord-input {
                padding: 0.4rem;
                font-size: 0.8rem;
            }
            
            .action-button {
                padding: 0.6rem;
                font-size: 0.8rem;
            }
        }

        /* Placement instruction animation */
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.05); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .placement-instruction {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 215, 0, 0.95);
            color: #000;
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: bold;
            z-index: 1000;
            animation: pulse 2s infinite;
            pointer-events: none;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
            border: 2px solid #FFD700;
        }

        .edit-controls {
            margin-top: 1rem;
            overflow: hidden;
            max-width: 100%;
        }

        .edit-controls label {
            display: block;
            margin-top: 0.5rem;
            margin-bottom: 0.3rem;
            word-wrap: break-word;
        }

        .transform-controls {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 0.3rem;
            margin: 0.5rem 0;
            overflow: hidden;
        }

        .transform-controls .action-button {
            margin-bottom: 0;
            padding: 0.4rem 0.2rem;
            font-size: 0.75rem;
            min-width: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* ç¡®ä¿æ‰€æœ‰è¾“å…¥æ¡†ä¸ä¼šæº¢å‡º */
        .parameter-input, .color-picker, .transparency-slider, .coord-input {
            max-width: 100%;
            box-sizing: border-box;
        }

        .info-panel-top {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 215, 0, 0.6);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
        }

        .info-panel-top h3 {
            color: #FFD700;
            margin: 0 0 1rem 0;
            font-size: 1.2rem;
            text-align: center;
        }

        .guide-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.8rem;
        }

        .guide-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.8rem;
            border-radius: 8px;
            font-size: 0.9rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .parameter-guide {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            padding: 0.8rem;
            margin-bottom: 1rem;
            font-size: 0.85rem;
            text-align: center;
        }

        .parameter-guide p {
            margin: 0;
            color: #FFD700;
            font-weight: 500;
        }

        .param-label {
            display: block;
            color: #FFD700;
            font-size: 0.85rem;
            margin-bottom: 0.3rem;
            margin-top: 0.5rem;
            font-weight: 500;
            opacity: 0.9;
        }

        .param-label:first-child {
            margin-top: 0;
        }

        .coordinate-guide {
            background: rgba(64, 224, 208, 0.1);
            border: 1px solid rgba(64, 224, 208, 0.3);
            border-radius: 8px;
            padding: 0.8rem;
            margin-bottom: 1rem;
            font-size: 0.85rem;
            text-align: center;
        }

        .coordinate-guide p {
            margin: 0;
            color: #40E0D0;
            font-weight: 500;
        }

        .coord-label {
            display: block;
            color: #40E0D0;
            font-size: 0.85rem;
            margin-bottom: 0.3rem;
            margin-top: 0.5rem;
            font-weight: 500;
            opacity: 0.9;
        }

        .coord-label:first-child {
            margin-top: 0;
        }

        /* ç¡®ä¿æ‰€æœ‰è¾“å…¥æ¡†å’ŒæŒ‰é’®ä¸ä¼šæº¢å‡º */
        .parameter-input, .color-picker, .transparency-slider, .coord-input, .action-button {
            max-width: 100%;
            box-sizing: border-box;
            word-wrap: break-word;
        }

        /* æå°å±å¹•çš„é¢å¤–ä¿æŠ¤ */
        @media (max-width: 320px) {
            .control-panel {
                padding: 0.5rem;
                gap: 0.5rem;
                grid-template-columns: 1fr;
                min-width: 0;
            }
            
            .control-section {
                margin-bottom: 1rem;
                min-width: 0;
                width: 100%;
            }
            
            .coordinate-input {
                gap: 0.2rem;
            }
            
            .coord-input {
                padding: 0.3rem;
                font-size: 0.75rem;
                min-width: 0;
            }
            
            .line-type-button {
                padding: 0.3rem 0.2rem;
                font-size: 0.7rem;
                min-width: 0;
            }
            
            .action-button {
                padding: 0.5rem 0.3rem;
                font-size: 0.75rem;
                min-width: 0;
            }
            
            .parameter-input {
                padding: 0.3rem;
                font-size: 0.75rem;
                min-width: 0;
            }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="../../index.html">
                        <i class="fas fa-graduation-cap" style="background: linear-gradient(90deg, #4361ee, #7209b7); -webkit-background-clip: text; background-clip: text; color: transparent;"></i>
                        <span>Alexçš„å­¦ä¹ åŠ©æ‰‹</span>
                    </a>
                </div>
                <nav class="main-nav">
                    <ul>
                        <li><a href="../../index.html">é¦–é¡µ</a></li>
                        <li><a href="main.html">æ•°å­¦</a></li>
                        <li><a href="#" class="active">ç«‹ä½“å‡ ä½•</a></li>
                        <li><a href="../../tts.html">è¯­éŸ³</a></li>
                        <li><a href="../../draw.html">ç»˜å›¾</a></li>
                    </ul>
                </nav>
                <button class="mobile-menu-toggle" aria-label="åˆ‡æ¢èœå•">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <main class="solid-geometry-page">
        <section class="geometry-header">
            <div class="container">
                <h1><i class="fas fa-cube"></i> 3D ç«‹ä½“å‡ ä½•å·¥å…·</h1>
                <p>äº¤äº’å¼3Då‡ ä½•ä½“ç»˜åˆ¶ä¸ç©ºé—´åæ ‡ç³»å­¦ä¹ å¹³å°</p>
            </div>
        </section>

        <section class="container">
            <!-- æ“ä½œæŒ‡å— -->
            <div class="info-panel-top">
                <h3><i class="fas fa-info-circle"></i> æ“ä½œæŒ‡å—</h3>
                <div class="guide-grid">
                    <div class="guide-item">ğŸ–±ï¸ å·¦é”®æ‹–æ‹½ï¼šæ—‹è½¬è§†è§’</div>
                    <div class="guide-item">ğŸ”„ æ»šè½®ï¼šç¼©æ”¾ç”»é¢</div>
                    <div class="guide-item">âœ‹ å³é”®æ‹–æ‹½ï¼šå¹³ç§»è§†å›¾</div>
                    <div class="guide-item">ğŸ“ ç‚¹å‡»å¯¹è±¡ï¼šé€‰æ‹©ç¼–è¾‘</div>
                    <div class="guide-item">ğŸ¯ Ctrl+ç‚¹å‡»ï¼šæŸ¥çœ‹å±æ€§</div>
                    <div class="guide-item">âš¡ åˆ›å»ºåå¯ç§»åŠ¨ã€ç¼–è¾‘</div>
                </div>
            </div>

            <div class="main-workspace">
                <!-- æ§åˆ¶é¢æ¿ -->
                <div class="control-panel">
                    <!-- å‡ ä½•ä½“é€‰æ‹© -->
                    <div class="control-section">
                        <h3>ğŸ¯ é€‰æ‹©å‡ ä½•ä½“</h3>
                        <div class="shape-grid">
                            <button class="shape-button active" data-shape="cube">
                                <i class="fas fa-cube"></i>
                                ç«‹æ–¹ä½“
                            </button>
                            <button class="shape-button" data-shape="box">
                                <i class="fas fa-square"></i>
                                é•¿æ–¹ä½“
                            </button>
                            <button class="shape-button" data-shape="sphere">
                                <i class="fas fa-circle"></i>
                                çƒä½“
                            </button>
                            <button class="shape-button" data-shape="cylinder">
                                <i class="fas fa-arrow-up"></i>
                                åœ†æŸ±ä½“
                            </button>
                            <button class="shape-button" data-shape="cone">
                                <i class="fas fa-triangle"></i>
                                åœ†é”¥ä½“
                            </button>
                            <button class="shape-button" data-shape="pyramid">
                                <i class="fas fa-mountain"></i>
                                å››è§’é”¥
                            </button>
                            <button class="shape-button" data-shape="prism">
                                <i class="fas fa-gem"></i>
                                ä¸‰è§’æŸ±
                            </button>
                            <button class="shape-button" data-shape="torus">
                                <i class="fas fa-ring"></i>
                                åœ†ç¯ä½“
                            </button>
                            <button class="shape-button" data-shape="polygon">
                                <i class="fas fa-shapes"></i>
                                å¤šè¾¹å½¢æŸ±
                            </button>
                        </div>
                    </div>

                    <!-- å‚æ•°è®¾ç½® -->
                    <div class="control-section">
                        <h3>ğŸ“ è®¾ç½®å‚æ•°</h3>
                        <div class="parameter-guide">
                            <p>ğŸ’¡ æ ¹æ®é€‰æ‹©çš„å‡ ä½•ä½“è°ƒæ•´ç›¸åº”å‚æ•°</p>
                        </div>
                        <div id="shape-parameters">
                            <label class="param-label" for="param1">å‚æ•°1:</label>
                            <input type="number" class="parameter-input" id="param1" placeholder="è¾¹é•¿ (å•ä½)" min="0.1" max="20" step="0.1" value="2">
                            
                            <label class="param-label" for="param2" style="display: none;">å‚æ•°2:</label>
                            <input type="number" class="parameter-input" id="param2" placeholder="å®½åº¦/é«˜åº¦ (å•ä½)" min="0.1" max="20" step="0.1" value="2" style="display: none;">
                            
                            <label class="param-label" for="param3" style="display: none;">å‚æ•°3:</label>
                            <input type="number" class="parameter-input" id="param3" placeholder="é«˜åº¦/æ·±åº¦ (å•ä½)" min="0.1" max="20" step="0.1" value="2" style="display: none;">
                            
                            <label class="param-label" for="polygon-sides" style="display: none;">è¾¹æ•°:</label>
                            <input type="number" class="parameter-input" id="polygon-sides" placeholder="è¾¹æ•° (3-20)" min="3" max="20" step="1" value="6" style="display: none;">
                        </div>
                        <button class="action-button" onclick="createShape()">
                            <i class="fas fa-plus"></i> åˆ›å»ºå‡ ä½•ä½“
                        </button>
                        <button class="action-button" onclick="enableClickToPlace()" style="background: linear-gradient(45deg, #28a745, #20c997); margin-top: 5px;">
                            <i class="fas fa-mouse-pointer"></i> ç‚¹å‡»æ”¾ç½®æ¨¡å¼
                        </button>
                    </div>

                    <!-- å¤–è§‚è®¾ç½® -->
                    <div class="control-section">
                        <h3>ğŸ¨ å¤–è§‚è®¾ç½®</h3>
                        <input type="color" class="color-picker" id="shape-color" value="#4361ee">
                        <label style="font-size: 0.9rem; opacity: 0.8;">é€æ˜åº¦:</label>
                        <input type="range" class="transparency-slider" id="transparency" min="0.1" max="1" step="0.1" value="0.7">
                        <label style="font-size: 0.9rem; opacity: 0.8;">
                            <input type="checkbox" id="wireframe"> çº¿æ¡†æ¨¡å¼
                        </label>
                    </div>

                    <!-- åæ ‡è¿çº¿ -->
                    <div class="control-section">
                        <h3>ğŸ“ åæ ‡è¿çº¿</h3>
                        <div class="coordinate-guide">
                            <p>ğŸ”— è¾“å…¥ä¸¤ä¸ª3Dåæ ‡ç‚¹è¿›è¡Œè¿çº¿</p>
                        </div>
                        <label class="coord-label">èµ·ç‚¹åæ ‡ (X1, Y1, Z1):</label>
                        <div class="coordinate-input">
                            <input type="number" class="coord-input" id="x1" placeholder="X1" step="0.1">
                            <input type="number" class="coord-input" id="y1" placeholder="Y1" step="0.1">
                            <input type="number" class="coord-input" id="z1" placeholder="Z1" step="0.1">
                        </div>
                        <label class="coord-label">ç»ˆç‚¹åæ ‡ (X2, Y2, Z2):</label>
                        <div class="coordinate-input">
                            <input type="number" class="coord-input" id="x2" placeholder="X2" step="0.1">
                            <input type="number" class="coord-input" id="y2" placeholder="Y2" step="0.1">
                            <input type="number" class="coord-input" id="z2" placeholder="Z2" step="0.1">
                        </div>
                        <label class="coord-label">è¿çº¿ç±»å‹:</label>
                        <div class="line-type-selector">
                            <button class="line-type-button active" data-type="straight">ç›´çº¿</button>
                            <button class="line-type-button" data-type="curve">æ›²çº¿</button>
                        </div>
                        <button class="action-button" onclick="createLine()">
                            <i class="fas fa-drafting-compass"></i> è¿æ¥åæ ‡
                        </button>
                    </div>

                    <!-- å¯¹è±¡ç®¡ç† -->
                    <div class="control-section">
                        <h3>ğŸ“‹ å¯¹è±¡ç®¡ç†</h3>
                        <div class="objects-list" id="objects-list">
                            <div style="text-align: center; color: rgba(255,255,255,0.6); font-size: 0.8rem;">
                                æš‚æ— å¯¹è±¡
                            </div>
                        </div>
                        <button class="action-button" onclick="clearAll()" style="background: linear-gradient(45deg, #e74c3c, #c0392b);">
                            <i class="fas fa-trash"></i> æ¸…ç©ºæ‰€æœ‰
                        </button>
                    </div>

                    <!-- å¯¹è±¡ç¼–è¾‘ -->
                    <div class="control-section" id="object-editor" style="display: none;">
                        <h3>âœï¸ ç¼–è¾‘é€‰ä¸­å¯¹è±¡</h3>
                        <div class="edit-controls">
                            <label style="font-size: 0.9rem; opacity: 0.8;">å¯¹è±¡åæ ‡:</label>
                            <div class="coordinate-input">
                                <input type="number" class="coord-input" id="edit-x" placeholder="X" step="0.1">
                                <input type="number" class="coord-input" id="edit-y" placeholder="Y" step="0.1">
                                <input type="number" class="coord-input" id="edit-z" placeholder="Z" step="0.1">
                            </div>
                            
                            <label style="font-size: 0.9rem; opacity: 0.8;">å¯¹è±¡é¢œè‰²:</label>
                            <input type="color" class="color-picker" id="edit-color">
                            
                            <label style="font-size: 0.9rem; opacity: 0.8;">é€æ˜åº¦:</label>
                            <input type="range" class="transparency-slider" id="edit-transparency" min="0.1" max="1" step="0.1">
                            
                            <label style="font-size: 0.9rem; opacity: 0.8;">å°ºå¯¸å‚æ•°:</label>
                            <input type="number" class="parameter-input" id="edit-param1" placeholder="å‚æ•°1" min="0.1" max="20" step="0.1">
                            <input type="number" class="parameter-input" id="edit-param2" placeholder="å‚æ•°2" min="0.1" max="20" step="0.1" style="display: none;">
                            <input type="number" class="parameter-input" id="edit-param3" placeholder="å‚æ•°3" min="0.1" max="20" step="0.1" style="display: none;">
                            
                            <div class="transform-controls">
                                <button class="action-button" onclick="setTransformMode('translate')" style="background: linear-gradient(45deg, #17a2b8, #138496);">
                                    <i class="fas fa-arrows-alt"></i> ç§»åŠ¨
                                </button>
                                <button class="action-button" onclick="setTransformMode('rotate')" style="background: linear-gradient(45deg, #fd7e14, #e36414);">
                                    <i class="fas fa-sync-alt"></i> æ—‹è½¬
                                </button>
                                <button class="action-button" onclick="setTransformMode('scale')" style="background: linear-gradient(45deg, #6f42c1, #59359a);">
                                    <i class="fas fa-expand-arrows-alt"></i> ç¼©æ”¾
                                </button>
                            </div>
                            
                            <button class="action-button" onclick="applyObjectEdits()">
                                <i class="fas fa-check"></i> åº”ç”¨æ›´æ”¹
                            </button>
                            <button class="action-button" onclick="deselectObject()" style="background: linear-gradient(45deg, #6c757d, #545b62);">
                                <i class="fas fa-times"></i> å–æ¶ˆé€‰æ‹©
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 3Dè§†å›¾åŒºåŸŸ -->
                <div class="geometry-viewer">
                    <div id="geometry-container"></div>
                    
                    <!-- å·¥å…·æ  -->
                    <div class="toolbar">
                        <button class="tool-button" onclick="resetView()" title="é‡ç½®è§†å›¾">
                            <i class="fas fa-home"></i>
                        </button>
                        <button class="tool-button" onclick="toggleGrid()" title="æ˜¾ç¤º/éšè—ç½‘æ ¼">
                            <i class="fas fa-border-all"></i>
                        </button>
                        <button class="tool-button" onclick="toggleAxes()" title="æ˜¾ç¤º/éšè—åæ ‡è½´">
                            <i class="fas fa-arrows-alt"></i>
                        </button>
                        <button class="tool-button" onclick="exportScene()" title="å¯¼å‡ºåœºæ™¯">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>

                    <!-- åæ ‡æ˜¾ç¤º -->
                    <div class="coordinates-display" id="coordinates-display">
                        é¼ æ ‡åæ ‡: (0, 0, 0)
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <p class="copyright-text">study-llm.meåŸŸåä¸ºAlexæ‰€æœ‰ã€‚ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚</p>
            </div>
        </div>
    </footer>

    <script src="../../js/common.js"></script>
    <script src="../../js/navigation.js"></script>
    <script>
        // Global variables
        let geometrySystem = null;

        // Error display function
        function showError(message) {
            document.getElementById('geometry-container').innerHTML = `
                <div style="display: flex; justify-content: center; align-items: center; height: 100%; color: #FFD700; text-align: center; padding: 20px;">
                    <div>
                        <h3>âŒ ${message}</h3>
                        <p>è¯·åˆ·æ–°é¡µé¢é‡è¯•</p>
                        <button onclick="location.reload()" style="background: #4361ee; color: white; border: none; padding: 10px 20px; border-radius: 5px; margin-top: 10px; cursor: pointer;">åˆ·æ–°é¡µé¢</button>
                    </div>
                </div>
            `;
        }

        // Initialize the geometry system
        function initGeometrySystem() {
            console.log('ğŸ”§ å¼€å§‹åˆå§‹åŒ–å‡ ä½•ç³»ç»Ÿ...');
            
            // æ£€æŸ¥å®¹å™¨
            const container = document.getElementById('geometry-container');
            if (!container) {
                console.error('âŒ æ‰¾ä¸åˆ°geometry-containerå…ƒç´ ');
                showError('æ‰¾ä¸åˆ°3Då®¹å™¨å…ƒç´ ');
                return;
            }
            
            console.log('ğŸ“¦ å®¹å™¨å°ºå¯¸:', {
                width: container.clientWidth,
                height: container.clientHeight,
                offsetWidth: container.offsetWidth,
                offsetHeight: container.offsetHeight
            });
            
            // ç¡®ä¿å®¹å™¨æœ‰å°ºå¯¸
            if (container.clientWidth === 0 || container.clientHeight === 0) {
                console.warn('âš ï¸ å®¹å™¨å°ºå¯¸ä¸ºé›¶ï¼Œç­‰å¾…å¸ƒå±€å®Œæˆ...');
                setTimeout(() => {
                    console.log('ğŸ”„ é‡è¯•åˆå§‹åŒ–...');
                    initGeometrySystem();
                }, 200);
                return;
            }
            
            console.log('âœ… å®¹å™¨æ£€æŸ¥é€šè¿‡');
            
            if (typeof THREE === 'undefined') {
                console.error('âŒ THREE.jsæœªåŠ è½½');
                showError('æ— æ³•åŠ è½½3Dæ¸²æŸ“å¼•æ“');
                return;
            }
            
            if (typeof THREE.OrbitControls === 'undefined') {
                console.error('âŒ OrbitControlsæœªåŠ è½½');
                showError('æ§åˆ¶å™¨ç»„ä»¶åŠ è½½å¤±è´¥');
                return;
            }
            
            try {
                geometrySystem = new SolidGeometryVisualizationSystem();
                console.log('âœ… å‡ ä½•ç³»ç»Ÿå®ä¾‹åŒ–æˆåŠŸ:', geometrySystem);
            } catch (error) {
                console.error('âŒ å‡ ä½•ç³»ç»Ÿå®ä¾‹åŒ–å¤±è´¥:', error);
                showError('3Dç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥: ' + error.message);
            }
        }

        // 3Dç«‹ä½“å‡ ä½•å¯è§†åŒ–ç³»ç»Ÿ
        class SolidGeometryVisualizationSystem {
            constructor() {
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.controls = null;
                this.transformControls = null; // å˜æ¢æ§åˆ¶å™¨
                this.objects = [];
                this.selectedShape = 'cube';
                this.lineType = 'straight';
                this.gridHelper = null;
                this.axesHelper = null;
                this.raycaster = new THREE.Raycaster();
                this.mouse = new THREE.Vector2();
                this.lastClickPosition = new THREE.Vector3(0, 0, 0); // è®°å½•æœ€åç‚¹å‡»ä½ç½®
                this.placementMode = false; // æ˜¯å¦å¤„äºæ”¾ç½®æ¨¡å¼
                this.escKeyListener = null; // ç”¨äºå­˜å‚¨ESCé”®ç›‘å¬å™¨
                this.selectedObject = null; // å½“å‰é€‰ä¸­çš„å¯¹è±¡
                this.isEditMode = false; // æ˜¯å¦å¤„äºç¼–è¾‘æ¨¡å¼
                
                this.init();
            }

            init() {
                try {
                    console.log('ğŸ”„ å¼€å§‹åˆå§‹åŒ–3Dç«‹ä½“å‡ ä½•ç³»ç»Ÿ...');
                    console.log('THREE.jsç‰ˆæœ¬:', THREE.REVISION);
                    
                    this.setupScene();
                    console.log('âœ… åœºæ™¯è®¾ç½®å®Œæˆ');
                    
                    this.setupCamera();
                    console.log('âœ… ç›¸æœºè®¾ç½®å®Œæˆ');
                    
                    this.setupRenderer();
                    console.log('âœ… æ¸²æŸ“å™¨è®¾ç½®å®Œæˆ');
                    
                    this.setupLights();
                    console.log('âœ… å…‰ç…§è®¾ç½®å®Œæˆ');
                    
                    this.setupControls();
                    console.log('âœ… æ§åˆ¶å™¨è®¾ç½®å®Œæˆ');
                    
                    this.setupTransformControls();
                    console.log('âœ… å˜æ¢æ§åˆ¶å™¨è®¾ç½®å®Œæˆ');
                    
                    this.setupHelpers();
                    console.log('âœ… è¾…åŠ©å·¥å…·è®¾ç½®å®Œæˆ');
                    
                    this.setupEventListeners();
                    console.log('âœ… äº‹ä»¶ç›‘å¬å™¨è®¾ç½®å®Œæˆ');
                    
                    this.animate();
                    console.log('âœ… åŠ¨ç”»å¾ªç¯å¯åŠ¨');
                    
                    console.log('âœ… 3Dç«‹ä½“å‡ ä½•ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
                } catch (error) {
                    console.error('âŒ åˆå§‹åŒ–å¤±è´¥:', error);
                    throw error;
                }
            }

            setupScene() {
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0x1a1a2e);
            }

            setupCamera() {
                const container = document.getElementById('geometry-container');
                const width = container.clientWidth;
                const height = container.clientHeight;
                
                this.camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
                this.camera.position.set(10, 10, 10);
                this.camera.lookAt(0, 0, 0);
            }

            setupRenderer() {
                const container = document.getElementById('geometry-container');
                
                this.renderer = new THREE.WebGLRenderer({ 
                    antialias: true,
                    alpha: true
                });
                this.renderer.setSize(container.clientWidth, container.clientHeight);
                this.renderer.setPixelRatio(window.devicePixelRatio);
                this.renderer.shadowMap.enabled = true;
                this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                
                container.appendChild(this.renderer.domElement);
            }

            setupLights() {
                // ç¯å¢ƒå…‰
                const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
                this.scene.add(ambientLight);
                
                // æ–¹å‘å…‰
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(10, 10, 5);
                directionalLight.castShadow = true;
                directionalLight.shadow.mapSize.width = 2048;
                directionalLight.shadow.mapSize.height = 2048;
                this.scene.add(directionalLight);
                
                // ç‚¹å…‰æº
                const pointLight = new THREE.PointLight(0x4361ee, 0.6, 100);
                pointLight.position.set(-10, 10, 10);
                this.scene.add(pointLight);
            }

            setupControls() {
                this.controls = new THREE.OrbitControls(this.camera, this.renderer.domElement);
                this.controls.enableDamping = true;
                this.controls.dampingFactor = 0.05;
                this.controls.minDistance = 5;
                this.controls.maxDistance = 50;
                
                // ç§»åŠ¨ç«¯æ”¯æŒ
                this.controls.touches = {
                    ONE: THREE.TOUCH.ROTATE,
                    TWO: THREE.TOUCH.DOLLY_PAN
                };
            }

            setupTransformControls() {
                this.transformControls = new THREE.TransformControls(this.camera, this.renderer.domElement);
                this.transformControls.addEventListener('change', () => this.updateSelectedObject());
                
                // å½“å˜æ¢æ§åˆ¶å™¨è¢«æ‹–æ‹½æ—¶ï¼Œç¦ç”¨è½¨é“æ§åˆ¶å™¨
                this.transformControls.addEventListener('dragging-changed', (event) => {
                    this.controls.enabled = !event.value;
                });
                
                this.scene.add(this.transformControls);
                
                // é»˜è®¤éšè—å˜æ¢æ§åˆ¶å™¨
                this.transformControls.visible = false;
            }

            setupHelpers() {
                // ç½‘æ ¼è¾…åŠ©çº¿
                this.gridHelper = new THREE.GridHelper(20, 20, 0x444444, 0x444444);
                this.scene.add(this.gridHelper);
                
                // åæ ‡è½´
                this.axesHelper = new THREE.AxesHelper(5);
                this.scene.add(this.axesHelper);
            }

            setupEventListeners() {
                // çª—å£å¤§å°è°ƒæ•´
                window.addEventListener('resize', () => this.onWindowResize());
                
                // é¼ æ ‡ç§»åŠ¨
                this.renderer.domElement.addEventListener('mousemove', (event) => this.onMouseMove(event));
                
                // é¼ æ ‡ç‚¹å‡» - ä¿®æ”¹ä¸ºæ”¯æŒæ”¾ç½®æ¨¡å¼
                this.renderer.domElement.addEventListener('click', (event) => this.onMouseClick(event));
                
                // å½¢çŠ¶é€‰æ‹©æŒ‰é’®
                document.querySelectorAll('.shape-button').forEach(button => {
                    button.addEventListener('click', () => {
                        document.querySelectorAll('.shape-button').forEach(b => b.classList.remove('active'));
                        button.classList.add('active');
                        this.selectedShape = button.dataset.shape;
                        this.updateParameterInputs();
                    });
                });
                
                // çº¿å‹é€‰æ‹©
                document.querySelectorAll('.line-type-button').forEach(button => {
                    button.addEventListener('click', () => {
                        document.querySelectorAll('.line-type-button').forEach(b => b.classList.remove('active'));
                        button.classList.add('active');
                        this.lineType = button.dataset.type;
                    });
                });
            }

            updateParameterInputs() {
                const param1 = document.getElementById('param1');
                const param2 = document.getElementById('param2');
                const param3 = document.getElementById('param3');
                const polygonSides = document.getElementById('polygon-sides');
                
                // è·å–æ ‡ç­¾å…ƒç´ 
                const labels = document.querySelectorAll('.param-label');
                const label1 = labels[0];
                const label2 = labels[1];
                const label3 = labels[2];
                const labelSides = labels[3];
                
                // é»˜è®¤éšè—è¾¹æ•°è¾“å…¥æ¡†å’Œæ ‡ç­¾
                polygonSides.style.display = 'none';
                if (labelSides) labelSides.style.display = 'none';
                
                switch(this.selectedShape) {
                    case 'cube':
                        param1.placeholder = 'è¾¹é•¿ (å•ä½)';
                        if (label1) label1.textContent = 'è¾¹é•¿:';
                        param2.style.display = 'none';
                        param3.style.display = 'none';
                        if (label2) label2.style.display = 'none';
                        if (label3) label3.style.display = 'none';
                        break;
                    case 'box':
                        param1.placeholder = 'é•¿åº¦ (å•ä½)';
                        param2.placeholder = 'å®½åº¦ (å•ä½)';
                        param3.placeholder = 'é«˜åº¦ (å•ä½)';
                        if (label1) label1.textContent = 'é•¿åº¦:';
                        if (label2) label2.textContent = 'å®½åº¦:';
                        if (label3) label3.textContent = 'é«˜åº¦:';
                        param2.style.display = 'block';
                        param3.style.display = 'block';
                        if (label2) label2.style.display = 'block';
                        if (label3) label3.style.display = 'block';
                        break;
                    case 'sphere':
                        param1.placeholder = 'åŠå¾„ (å•ä½)';
                        if (label1) label1.textContent = 'åŠå¾„:';
                        param2.style.display = 'none';
                        param3.style.display = 'none';
                        if (label2) label2.style.display = 'none';
                        if (label3) label3.style.display = 'none';
                        break;
                    case 'cylinder':
                        param1.placeholder = 'åŠå¾„ (å•ä½)';
                        param2.placeholder = 'é«˜åº¦ (å•ä½)';
                        if (label1) label1.textContent = 'åŠå¾„:';
                        if (label2) label2.textContent = 'é«˜åº¦:';
                        param2.style.display = 'block';
                        param3.style.display = 'none';
                        if (label2) label2.style.display = 'block';
                        if (label3) label3.style.display = 'none';
                        break;
                    case 'cone':
                        param1.placeholder = 'åº•é¢åŠå¾„ (å•ä½)';
                        param2.placeholder = 'é«˜åº¦ (å•ä½)';
                        if (label1) label1.textContent = 'åº•é¢åŠå¾„:';
                        if (label2) label2.textContent = 'é«˜åº¦:';
                        param2.style.display = 'block';
                        param3.style.display = 'none';
                        if (label2) label2.style.display = 'block';
                        if (label3) label3.style.display = 'none';
                        break;
                    case 'pyramid':
                        param1.placeholder = 'åº•é¢åŠå¾„ (å•ä½)';
                        param2.placeholder = 'é«˜åº¦ (å•ä½)';
                        if (label1) label1.textContent = 'åº•é¢åŠå¾„:';
                        if (label2) label2.textContent = 'é«˜åº¦:';
                        param2.style.display = 'block';
                        param3.style.display = 'none';
                        if (label2) label2.style.display = 'block';
                        if (label3) label3.style.display = 'none';
                        break;
                    case 'prism':
                        param1.placeholder = 'åº•è¾¹é•¿ (å•ä½)';
                        param2.placeholder = 'ä¸‰è§’å½¢é«˜ (å•ä½)';
                        param3.placeholder = 'æŸ±ä½“æ·±åº¦ (å•ä½)';
                        if (label1) label1.textContent = 'åº•è¾¹é•¿:';
                        if (label2) label2.textContent = 'ä¸‰è§’å½¢é«˜:';
                        if (label3) label3.textContent = 'æŸ±ä½“æ·±åº¦:';
                        param2.style.display = 'block';
                        param3.style.display = 'block';
                        if (label2) label2.style.display = 'block';
                        if (label3) label3.style.display = 'block';
                        break;
                    case 'torus':
                        param1.placeholder = 'ç¯é¢åŠå¾„ (å•ä½)';
                        param2.placeholder = 'ç®¡é“åŠå¾„ (å•ä½)';
                        if (label1) label1.textContent = 'ç¯é¢åŠå¾„:';
                        if (label2) label2.textContent = 'ç®¡é“åŠå¾„:';
                        param2.style.display = 'block';
                        param3.style.display = 'none';
                        if (label2) label2.style.display = 'block';
                        if (label3) label3.style.display = 'none';
                        break;
                    case 'polygon':
                        param1.placeholder = 'åŠå¾„ (å•ä½)';
                        param2.placeholder = 'é«˜åº¦ (å•ä½)';
                        if (label1) label1.textContent = 'åŠå¾„:';
                        if (label2) label2.textContent = 'é«˜åº¦:';
                        param2.style.display = 'block';
                        param3.style.display = 'none';
                        if (label2) label2.style.display = 'block';
                        if (label3) label3.style.display = 'none';
                        // æ˜¾ç¤ºè¾¹æ•°è¾“å…¥æ¡†å’Œæ ‡ç­¾
                        polygonSides.style.display = 'block';
                        if (labelSides) {
                            labelSides.style.display = 'block';
                            labelSides.textContent = 'è¾¹æ•°:';
                        }
                        break;
                    default:
                        param1.placeholder = 'é•¿åº¦ (å•ä½)';
                        param2.placeholder = 'å®½åº¦ (å•ä½)';
                        param3.placeholder = 'é«˜åº¦ (å•ä½)';
                        if (label1) label1.textContent = 'é•¿åº¦:';
                        if (label2) label2.textContent = 'å®½åº¦:';
                        if (label3) label3.textContent = 'é«˜åº¦:';
                        param2.style.display = 'block';
                        param3.style.display = 'block';
                        if (label2) label2.style.display = 'block';
                        if (label3) label3.style.display = 'block';
                }
            }

            createGeometry(shape, params) {
                let geometry;
                
                switch(shape) {
                    case 'cube':
                        geometry = new THREE.BoxGeometry(params[0], params[0], params[0]);
                        break;
                    case 'box':
                        geometry = new THREE.BoxGeometry(params[0], params[1], params[2]);
                        break;
                    case 'sphere':
                        geometry = new THREE.SphereGeometry(params[0], 32, 32);
                        break;
                    case 'cylinder':
                        geometry = new THREE.CylinderGeometry(params[0], params[0], params[1], 32);
                        break;
                    case 'cone':
                        geometry = new THREE.ConeGeometry(params[0], params[1], 32);
                        break;
                    case 'pyramid':
                        geometry = new THREE.ConeGeometry(params[0], params[1], 4);
                        break;
                    case 'prism':
                        const shape = new THREE.Shape();
                        shape.moveTo(0, 0);
                        shape.lineTo(params[0], 0);
                        shape.lineTo(params[0]/2, params[1]);
                        shape.lineTo(0, 0);
                        geometry = new THREE.ExtrudeGeometry(shape, { depth: params[2] });
                        break;
                    case 'torus':
                        geometry = new THREE.TorusGeometry(params[0], params[1], 16, 100);
                        break;
                    case 'polygon':
                        const sides = parseInt(document.getElementById('polygon-sides').value) || 6;
                        geometry = new THREE.CylinderGeometry(params[0], params[0], params[1], Math.max(3, Math.min(20, sides)));
                        break;
                    default:
                        geometry = new THREE.BoxGeometry(params[0], params[1], params[2]);
                }
                
                return geometry;
            }

            createShape() {
                try {
                    console.log('ğŸ”„ å¼€å§‹åˆ›å»ºå‡ ä½•ä½“...');
                    console.log('é€‰æ‹©çš„å½¢çŠ¶:', this.selectedShape);
                    console.log('åœºæ™¯å¯¹è±¡æ•°é‡:', this.scene.children.length);
                    
                    const param1 = parseFloat(document.getElementById('param1').value) || 2;
                    const param2 = parseFloat(document.getElementById('param2').value) || 2;
                    const param3 = parseFloat(document.getElementById('param3').value) || 2;
                    const color = document.getElementById('shape-color').value;
                    const transparency = parseFloat(document.getElementById('transparency').value);
                    const wireframe = document.getElementById('wireframe').checked;
                    
                    console.log('å‚æ•°:', { param1, param2, param3, color, transparency, wireframe });
                    
                    const params = [param1, param2, param3];
                    const geometry = this.createGeometry(this.selectedShape, params);
                    console.log('âœ… å‡ ä½•ä½“åˆ›å»ºå®Œæˆ:', geometry);
                    console.log('å‡ ä½•ä½“é¡¶ç‚¹æ•°:', geometry.attributes.position ? geometry.attributes.position.count : 'N/A');
                    
                    const material = new THREE.MeshPhongMaterial({
                        color: color,
                        transparent: true,
                        opacity: transparency,
                        wireframe: wireframe
                    });
                    console.log('âœ… æè´¨åˆ›å»ºå®Œæˆ:', material);
                    
                    const mesh = new THREE.Mesh(geometry, material);
                    mesh.castShadow = true;
                    mesh.receiveShadow = true;
                    console.log('âœ… ç½‘æ ¼åˆ›å»ºå®Œæˆ:', mesh);
                    
                    // æ™ºèƒ½ä½ç½®è®¾ç½®ï¼šä½¿ç”¨æœ€åç‚¹å‡»ä½ç½®æˆ–é»˜è®¤å±…ä¸­ä½ç½®
                    if (this.lastClickPosition.length() > 0) {
                        // ä½¿ç”¨æœ€åç‚¹å‡»çš„ä½ç½®
                        mesh.position.copy(this.lastClickPosition);
                        console.log('âœ… ä½¿ç”¨ç‚¹å‡»ä½ç½®:', mesh.position);
                        // æ¸…é™¤ç‚¹å‡»ä½ç½®ï¼Œé¿å…åç»­å¯¹è±¡éƒ½å †å åœ¨åŒä¸€ä½ç½®
                        this.lastClickPosition.set(0, 0, 0);
                    } else {
                        // é»˜è®¤ä½ç½®ï¼šåœ¨ç›¸æœºå‰æ–¹å¯è§åŒºåŸŸå†…æœ‰åºæ’åˆ—
                        const offsetCount = this.objects.length;
                        const gridSize = 4; // 4x4ç½‘æ ¼æ’åˆ—
                        const spacing = 3; // å¯¹è±¡é—´è·
                        
                        const row = Math.floor(offsetCount / gridSize);
                        const col = offsetCount % gridSize;
                        
                        mesh.position.set(
                            (col - gridSize/2) * spacing, // Xè½´ï¼šå·¦å³åˆ†å¸ƒ
                            1 + row * 2, // Yè½´ï¼šå‚ç›´åˆ†å±‚
                            -2 - row * spacing // Zè½´ï¼šå‘å‰æ’åˆ—ï¼Œç¡®ä¿åœ¨ç›¸æœºè§†é‡å†…
                        );
                        console.log('âœ… ä½¿ç”¨é»˜è®¤æ’åˆ—ä½ç½®:', mesh.position);
                    }
                    
                    this.scene.add(mesh);
                    console.log('âœ… æ·»åŠ åˆ°åœºæ™¯å®Œæˆï¼Œåœºæ™¯å¯¹è±¡æ•°é‡:', this.scene.children.length);
                    
                    // å­˜å‚¨å¯¹è±¡ä¿¡æ¯
                    const objectInfo = {
                        id: Date.now(),
                        mesh: mesh,
                        type: this.selectedShape,
                        parameters: params,
                        color: color
                    };
                    
                    // å¯¹äºå¤šè¾¹å½¢æŸ±ï¼Œé¢å¤–å­˜å‚¨è¾¹æ•°ä¿¡æ¯
                    if (this.selectedShape === 'polygon') {
                        objectInfo.sides = parseInt(document.getElementById('polygon-sides').value) || 6;
                    }
                    
                    // ç¡®ä¿æè´¨é¢œè‰²ä¸å­˜å‚¨çš„é¢œè‰²ä¸€è‡´
                    mesh.material.color.setHex(parseInt(color.slice(1), 16));
                    
                    this.objects.push(objectInfo);
                    this.updateObjectsList();
                    console.log('âœ… å‡ ä½•ä½“åˆ›å»ºæˆåŠŸï¼å¯¹è±¡æ€»æ•°:', this.objects.length);
                    console.log('å‡ ä½•ä½“ä½ç½®:', mesh.position);
                    console.log('å‡ ä½•ä½“åœ¨ç›¸æœºè§†é‡å†…:', this.isInCameraView(mesh));
                    
                    // é‡ç½®æ”¾ç½®æ¨¡å¼
                    this.placementMode = false;
                    this.updatePlacementUI();
                } catch (error) {
                    console.error('âŒ åˆ›å»ºå‡ ä½•ä½“å¤±è´¥:', error);
                    alert('åˆ›å»ºå‡ ä½•ä½“å¤±è´¥: ' + error.message);
                }
            }

            // æ£€æŸ¥å¯¹è±¡æ˜¯å¦åœ¨ç›¸æœºè§†é‡å†…
            isInCameraView(object) {
                const frustum = new THREE.Frustum();
                const cameraMatrix = new THREE.Matrix4().multiplyMatrices(this.camera.projectionMatrix, this.camera.matrixWorldInverse);
                frustum.setFromProjectionMatrix(cameraMatrix);
                return frustum.intersectsObject(object);
            }

            createLine() {
                const x1 = parseFloat(document.getElementById('x1').value);
                const y1 = parseFloat(document.getElementById('y1').value);
                const z1 = parseFloat(document.getElementById('z1').value);
                const x2 = parseFloat(document.getElementById('x2').value);
                const y2 = parseFloat(document.getElementById('y2').value);
                const z2 = parseFloat(document.getElementById('z2').value);
                
                if (isNaN(x1) || isNaN(y1) || isNaN(z1) || isNaN(x2) || isNaN(y2) || isNaN(z2)) {
                    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„åæ ‡å€¼');
                    return;
                }
                
                const material = new THREE.LineBasicMaterial({ 
                    color: 0xFFD700,
                    linewidth: 3
                });
                
                let geometry;
                
                if (this.lineType === 'straight') {
                    // ç›´çº¿
                    const points = [
                        new THREE.Vector3(x1, y1, z1),
                        new THREE.Vector3(x2, y2, z2)
                    ];
                    geometry = new THREE.BufferGeometry().setFromPoints(points);
                } else {
                    // æ›²çº¿
                    const curve = new THREE.QuadraticBezierCurve3(
                        new THREE.Vector3(x1, y1, z1),
                        new THREE.Vector3((x1+x2)/2, Math.max(y1,y2) + 2, (z1+z2)/2),
                        new THREE.Vector3(x2, y2, z2)
                    );
                    const points = curve.getPoints(50);
                    geometry = new THREE.BufferGeometry().setFromPoints(points);
                }
                
                const line = new THREE.Line(geometry, material);
                this.scene.add(line);
                
                // æ·»åŠ ç«¯ç‚¹æ ‡è®°
                this.addPointMarker(x1, y1, z1);
                this.addPointMarker(x2, y2, z2);
                
                // å­˜å‚¨çº¿æ®µä¿¡æ¯
                const lineInfo = {
                    id: Date.now(),
                    mesh: line,
                    type: 'line',
                    start: [x1, y1, z1],
                    end: [x2, y2, z2],
                    lineType: this.lineType
                };
                
                this.objects.push(lineInfo);
                this.updateObjectsList();
            }

            addPointMarker(x, y, z) {
                const geometry = new THREE.SphereGeometry(0.1, 16, 16);
                const material = new THREE.MeshPhongMaterial({ color: 0xFF6B6B });
                const sphere = new THREE.Mesh(geometry, material);
                sphere.position.set(x, y, z);
                this.scene.add(sphere);
            }

            updateObjectsList() {
                const listContainer = document.getElementById('objects-list');
                
                if (this.objects.length === 0) {
                    listContainer.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.6); font-size: 0.8rem;">æš‚æ— å¯¹è±¡</div>';
                    return;
                }
                
                listContainer.innerHTML = this.objects.map(obj => `
                    <div class="object-item">
                        <span>${this.getObjectDisplayName(obj)}</span>
                        <div class="object-buttons">
                            <button class="select-button" onclick="geometrySystem.selectObjectById(${obj.id})" title="é€‰æ‹©ç¼–è¾‘">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="delete-button" onclick="geometrySystem.deleteObject(${obj.id})" title="åˆ é™¤">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            getObjectDisplayName(obj) {
                const typeNames = {
                    cube: 'ç«‹æ–¹ä½“',
                    box: 'é•¿æ–¹ä½“',
                    sphere: 'çƒä½“',
                    cylinder: 'åœ†æŸ±ä½“',
                    cone: 'åœ†é”¥ä½“',
                    pyramid: 'å››è§’é”¥',
                    prism: 'ä¸‰è§’æŸ±',
                    torus: 'åœ†ç¯ä½“',
                    polygon: 'å¤šè¾¹å½¢æŸ±',
                    line: 'çº¿æ®µ'
                };
                return typeNames[obj.type] || obj.type;
            }

            deleteObject(id) {
                const index = this.objects.findIndex(obj => obj.id === id);
                if (index !== -1) {
                    this.scene.remove(this.objects[index].mesh);
                    this.objects.splice(index, 1);
                    this.updateObjectsList();
                }
            }

            clearAll() {
                this.objects.forEach(obj => {
                    this.scene.remove(obj.mesh);
                });
                this.objects = [];
                this.updateObjectsList();
            }

            resetView() {
                this.camera.position.set(10, 10, 10);
                this.camera.lookAt(0, 0, 0);
                this.controls.reset();
            }

            toggleGrid() {
                this.gridHelper.visible = !this.gridHelper.visible;
            }

            toggleAxes() {
                this.axesHelper.visible = !this.axesHelper.visible;
            }

            exportScene() {
                const sceneData = {
                    objects: this.objects.map(obj => ({
                        type: obj.type,
                        parameters: obj.parameters,
                        color: obj.color,
                        position: obj.mesh.position.toArray(),
                        rotation: obj.mesh.rotation.toArray()
                    }))
                };
                
                const dataStr = JSON.stringify(sceneData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = 'geometry-scene.json';
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            }

            onWindowResize() {
                const container = document.getElementById('geometry-container');
                const width = container.clientWidth;
                const height = container.clientHeight;
                
                this.camera.aspect = width / height;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(width, height);
            }

            onMouseMove(event) {
                const rect = this.renderer.domElement.getBoundingClientRect();
                this.mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
                this.mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
                
                // æ›´æ–°åæ ‡æ˜¾ç¤º
                this.raycaster.setFromCamera(this.mouse, this.camera);
                
                // å°è¯•ä¸ç½‘æ ¼ç›¸äº¤
                const intersects = this.raycaster.intersectObject(this.gridHelper);
                
                if (intersects.length > 0) {
                    const point = intersects[0].point;
                    document.getElementById('coordinates-display').textContent = 
                        `é¼ æ ‡åæ ‡: (${point.x.toFixed(2)}, ${point.y.toFixed(2)}, ${point.z.toFixed(2)})`;
                } else {
                    // å¦‚æœæ²¡æœ‰ä¸ç½‘æ ¼ç›¸äº¤ï¼Œæ˜¾ç¤ºå±å¹•åæ ‡
                    document.getElementById('coordinates-display').textContent = 
                        `å±å¹•åæ ‡: (${this.mouse.x.toFixed(2)}, ${this.mouse.y.toFixed(2)})`;
                }
            }

            onMouseClick(event) {
                // é˜²æ­¢æ§åˆ¶å™¨å†²çª
                if (event.button !== 0) return; // åªå¤„ç†å·¦é”®ç‚¹å‡»
                
                this.raycaster.setFromCamera(this.mouse, this.camera);
                
                // å¦‚æœå¤„äºæ”¾ç½®æ¨¡å¼ï¼Œè®¾ç½®æ”¾ç½®ä½ç½®
                if (this.placementMode) {
                    // ä¸ç½‘æ ¼å¹³é¢ç›¸äº¤æ¥ç¡®å®šæ”¾ç½®ä½ç½®
                    const intersects = this.raycaster.intersectObject(this.gridHelper);
                    if (intersects.length > 0) {
                        this.lastClickPosition.copy(intersects[0].point);
                        this.lastClickPosition.y = Math.max(0, this.lastClickPosition.y); // ç¡®ä¿åœ¨åœ°é¢ä»¥ä¸Š
                        console.log('ğŸ“ è®¾ç½®æ”¾ç½®ä½ç½®:', this.lastClickPosition);
                        this.createShape(); // ç«‹å³åˆ›å»ºå‡ ä½•ä½“
                        return;
                    }
                }
                
                // æ£€æŸ¥æ˜¯å¦ç‚¹å‡»äº†ç°æœ‰å¯¹è±¡
                const intersects = this.raycaster.intersectObjects(this.objects.map(obj => obj.mesh));
                
                if (intersects.length > 0) {
                    const clickedObject = intersects[0].object;
                    const objectInfo = this.objects.find(obj => obj.mesh === clickedObject);
                    
                    if (objectInfo) {
                        // å¦‚æœæŒ‰ä½Ctrlé”®ï¼Œæ˜¾ç¤ºå¯¹è±¡ä¿¡æ¯ï¼›å¦åˆ™é€‰æ‹©å¯¹è±¡è¿›è¡Œç¼–è¾‘
                        if (event.ctrlKey) {
                            this.showObjectInfo(objectInfo);
                        } else {
                            this.selectObject(clickedObject, objectInfo);
                        }
                    }
                } else {
                    // å¦‚æœæ²¡æœ‰ç‚¹å‡»åˆ°å¯¹è±¡ï¼Œå–æ¶ˆé€‰æ‹©å¹¶åœ¨ç½‘æ ¼ä¸Šè®¾ç½®æ–°çš„ç‚¹å‡»ä½ç½®
                    this.deselectObject();
                    
                    const gridIntersects = this.raycaster.intersectObject(this.gridHelper);
                    if (gridIntersects.length > 0) {
                        this.lastClickPosition.copy(gridIntersects[0].point);
                        this.lastClickPosition.y = Math.max(0, this.lastClickPosition.y);
                        console.log('ğŸ“ æ›´æ–°ç‚¹å‡»ä½ç½®:', this.lastClickPosition);
                    }
                }
            }

            showObjectInfo(objectInfo) {
                let info = `å¯¹è±¡ç±»å‹: ${this.getObjectDisplayName(objectInfo)}\n`;
                
                if (objectInfo.parameters) {
                    info += `å‚æ•°: ${objectInfo.parameters.join(', ')}\n`;
                }
                
                info += `ä½ç½®: (${objectInfo.mesh.position.x.toFixed(2)}, ${objectInfo.mesh.position.y.toFixed(2)}, ${objectInfo.mesh.position.z.toFixed(2)})`;
                
                alert(info);
            }

            animate() {
                requestAnimationFrame(() => this.animate());
                
                this.controls.update();
                this.renderer.render(this.scene, this.camera);
            }

            // å¯ç”¨æ”¾ç½®æ¨¡å¼
            enablePlacementMode() {
                this.placementMode = true;
                this.updatePlacementUI();
                console.log('ğŸ¯ æ”¾ç½®æ¨¡å¼å·²å¯ç”¨ï¼Œç‚¹å‡»3Dè§†å›¾æ¥æ”¾ç½®å‡ ä½•ä½“');
            }

            // æ›´æ–°æ”¾ç½®æ¨¡å¼UIæç¤º
            updatePlacementUI() {
                const container = document.getElementById('geometry-container');
                let instruction = container.querySelector('.placement-instruction');
                
                if (this.placementMode) {
                    if (!instruction) {
                        instruction = document.createElement('div');
                        instruction.className = 'placement-instruction';
                        instruction.style.cssText = `
                            position: absolute;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            background: rgba(255, 215, 0, 0.9);
                            color: #000;
                            padding: 15px 25px;
                            border-radius: 10px;
                            font-weight: bold;
                            z-index: 1000;
                            animation: pulse 2s infinite;
                            pointer-events: none;
                        `;
                        instruction.innerHTML = 'ğŸ¯ ç‚¹å‡»ç½‘æ ¼ä¸Šçš„ä»»æ„ä½ç½®æ¥æ”¾ç½®å‡ ä½•ä½“<br><small>æŒ‰ ESC é”®é€€å‡ºæ”¾ç½®æ¨¡å¼</small>';
                        container.appendChild(instruction);
                    }
                } else {
                    if (instruction) {
                        instruction.remove();
                    }
                }
                
                // æ·»åŠ ESCé”®é€€å‡ºæ”¾ç½®æ¨¡å¼çš„ç›‘å¬
                if (this.placementMode && !this.escKeyListener) {
                    this.escKeyListener = (event) => {
                        if (event.key === 'Escape') {
                            this.placementMode = false;
                            this.updatePlacementUI();
                            console.log('ğŸš« å–æ¶ˆæ”¾ç½®æ¨¡å¼');
                        }
                    };
                    document.addEventListener('keydown', this.escKeyListener);
                } else if (!this.placementMode && this.escKeyListener) {
                    document.removeEventListener('keydown', this.escKeyListener);
                    this.escKeyListener = null;
                }
            }

            updateSelectedObject() {
                if (this.selectedObject && this.transformControls.object) {
                    // å®æ—¶æ›´æ–°ç¼–è¾‘é¢æ¿ä¸­çš„åæ ‡
                    const pos = this.selectedObject.position;
                    document.getElementById('edit-x').value = pos.x.toFixed(2);
                    document.getElementById('edit-y').value = pos.y.toFixed(2);
                    document.getElementById('edit-z').value = pos.z.toFixed(2);
                    
                    // æ›´æ–°é€‰ä¸­å¯¹è±¡çš„ä½ç½®ã€æ—‹è½¬ã€ç¼©æ”¾
                    const objectInfo = this.objects.find(obj => obj.mesh === this.selectedObject);
                    if (objectInfo) {
                        // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ›´å¤šå®æ—¶æ›´æ–°çš„å±æ€§
                        console.log('ğŸ“ å¯¹è±¡ä½ç½®æ›´æ–°:', pos);
                    }
                }
            }

            // é€‰æ‹©å¯¹è±¡è¿›è¡Œç¼–è¾‘
            selectObject(mesh, objectInfo) {
                // å–æ¶ˆä¹‹å‰çš„é€‰æ‹©
                this.deselectObject();
                
                // è®¾ç½®æ–°çš„é€‰æ‹©
                this.selectedObject = mesh;
                this.isEditMode = true;
                
                // æ·»åŠ é€‰æ‹©é«˜äº®æ•ˆæœ
                this.addSelectionHighlight(mesh);
                
                // æ˜¾ç¤ºç¼–è¾‘é¢æ¿
                this.showEditPanel(objectInfo);
                
                // æ˜¾ç¤ºå˜æ¢æ§åˆ¶å™¨
                this.transformControls.attach(mesh);
                this.transformControls.visible = true;
                this.transformControls.setMode('translate'); // é»˜è®¤ç§»åŠ¨æ¨¡å¼
                
                console.log('âœ… é€‰æ‹©å¯¹è±¡è¿›è¡Œç¼–è¾‘:', objectInfo.type);
            }

            // å–æ¶ˆå¯¹è±¡é€‰æ‹©
            deselectObject() {
                if (this.selectedObject) {
                    // ç§»é™¤é«˜äº®æ•ˆæœ
                    this.removeSelectionHighlight(this.selectedObject);
                    
                    // éšè—å˜æ¢æ§åˆ¶å™¨
                    this.transformControls.detach();
                    this.transformControls.visible = false;
                    
                    this.selectedObject = null;
                    this.isEditMode = false;
                    
                    // éšè—ç¼–è¾‘é¢æ¿
                    document.getElementById('object-editor').style.display = 'none';
                    
                    console.log('âœ… å–æ¶ˆå¯¹è±¡é€‰æ‹©');
                }
            }

            // æ·»åŠ é€‰æ‹©é«˜äº®æ•ˆæœ
            addSelectionHighlight(mesh) {
                // ä¿å­˜åŸå§‹æè´¨
                mesh.userData.originalMaterial = mesh.material;
                
                // åˆ›å»ºé«˜äº®æè´¨
                const highlightMaterial = mesh.material.clone();
                highlightMaterial.emissive = new THREE.Color(0x444444);
                highlightMaterial.transparent = true;
                highlightMaterial.opacity = Math.max(0.8, mesh.material.opacity);
                
                mesh.material = highlightMaterial;
            }

            // ç§»é™¤é€‰æ‹©é«˜äº®æ•ˆæœ
            removeSelectionHighlight(mesh) {
                if (mesh.userData.originalMaterial) {
                    mesh.material = mesh.userData.originalMaterial;
                    delete mesh.userData.originalMaterial;
                }
            }

            // æ˜¾ç¤ºç¼–è¾‘é¢æ¿
            showEditPanel(objectInfo) {
                const editPanel = document.getElementById('object-editor');
                editPanel.style.display = 'block';
                
                // å¡«å……å½“å‰å¯¹è±¡çš„åæ ‡
                document.getElementById('edit-x').value = objectInfo.mesh.position.x.toFixed(2);
                document.getElementById('edit-y').value = objectInfo.mesh.position.y.toFixed(2);
                document.getElementById('edit-z').value = objectInfo.mesh.position.z.toFixed(2);
                
                // æ·»åŠ åæ ‡å®æ—¶æ›´æ–°ç›‘å¬å™¨
                this.setupCoordinateListeners();
                
                // å¡«å……å½“å‰å¯¹è±¡çš„å±æ€§
                document.getElementById('edit-color').value = objectInfo.color;
                document.getElementById('edit-transparency').value = objectInfo.mesh.material.opacity;
                
                // æ ¹æ®å¯¹è±¡ç±»å‹æ˜¾ç¤ºç›¸åº”çš„å‚æ•°è¾“å…¥æ¡†
                this.updateEditParameterInputs(objectInfo);
                
                // å¡«å……å‚æ•°å€¼
                if (objectInfo.parameters) {
                    document.getElementById('edit-param1').value = objectInfo.parameters[0] || '';
                    document.getElementById('edit-param2').value = objectInfo.parameters[1] || '';
                    document.getElementById('edit-param3').value = objectInfo.parameters[2] || '';
                }
            }

            // è®¾ç½®åæ ‡è¾“å…¥æ¡†çš„å®æ—¶ç›‘å¬å™¨
            setupCoordinateListeners() {
                const inputs = ['edit-x', 'edit-y', 'edit-z'];
                
                inputs.forEach(inputId => {
                    const input = document.getElementById(inputId);
                    if (input) {
                        // ç§»é™¤æ—§çš„ç›‘å¬å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                        input.removeEventListener('input', this.handleCoordinateChange);
                        // æ·»åŠ æ–°çš„ç›‘å¬å™¨
                        input.addEventListener('input', this.handleCoordinateChange.bind(this));
                    }
                });
            }

            // å¤„ç†åæ ‡å˜åŒ–
            handleCoordinateChange() {
                if (!this.selectedObject) return;
                
                const x = parseFloat(document.getElementById('edit-x').value);
                const y = parseFloat(document.getElementById('edit-y').value);
                const z = parseFloat(document.getElementById('edit-z').value);
                
                if (!isNaN(x) && !isNaN(y) && !isNaN(z)) {
                    this.selectedObject.position.set(x, y, z);
                }
            }

            // æ›´æ–°ç¼–è¾‘å‚æ•°è¾“å…¥æ¡†
            updateEditParameterInputs(objectInfo) {
                const param1 = document.getElementById('edit-param1');
                const param2 = document.getElementById('edit-param2');
                const param3 = document.getElementById('edit-param3');
                
                switch(objectInfo.type) {
                    case 'cube':
                        param1.placeholder = 'è¾¹é•¿ (å•ä½)';
                        param2.style.display = 'none';
                        param3.style.display = 'none';
                        break;
                    case 'box':
                        param1.placeholder = 'é•¿åº¦ (å•ä½)';
                        param2.placeholder = 'å®½åº¦ (å•ä½)';
                        param3.placeholder = 'é«˜åº¦ (å•ä½)';
                        param2.style.display = 'block';
                        param3.style.display = 'block';
                        break;
                    case 'sphere':
                        param1.placeholder = 'åŠå¾„ (å•ä½)';
                        param2.style.display = 'none';
                        param3.style.display = 'none';
                        break;
                    case 'cylinder':
                        param1.placeholder = 'åŠå¾„ (å•ä½)';
                        param2.placeholder = 'é«˜åº¦ (å•ä½)';
                        param2.style.display = 'block';
                        param3.style.display = 'none';
                        break;
                    case 'cone':
                        param1.placeholder = 'åº•é¢åŠå¾„ (å•ä½)';
                        param2.placeholder = 'é«˜åº¦ (å•ä½)';
                        param2.style.display = 'block';
                        param3.style.display = 'none';
                        break;
                    case 'pyramid':
                        param1.placeholder = 'åº•é¢åŠå¾„ (å•ä½)';
                        param2.placeholder = 'é«˜åº¦ (å•ä½)';
                        param2.style.display = 'block';
                        param3.style.display = 'none';
                        break;
                    case 'prism':
                        param1.placeholder = 'åº•è¾¹é•¿ (å•ä½)';
                        param2.placeholder = 'ä¸‰è§’å½¢é«˜ (å•ä½)';
                        param3.placeholder = 'æŸ±ä½“æ·±åº¦ (å•ä½)';
                        param2.style.display = 'block';
                        param3.style.display = 'block';
                        break;
                    case 'torus':
                        param1.placeholder = 'ç¯é¢åŠå¾„ (å•ä½)';
                        param2.placeholder = 'ç®¡é“åŠå¾„ (å•ä½)';
                        param2.style.display = 'block';
                        param3.style.display = 'none';
                        break;
                    case 'polygon':
                        param1.placeholder = 'åŠå¾„ (å•ä½)';
                        param2.placeholder = 'é«˜åº¦ (å•ä½)';
                        param2.style.display = 'block';
                        param3.style.display = 'none';
                        break;
                    default:
                        param1.placeholder = 'é•¿åº¦ (å•ä½)';
                        param2.placeholder = 'å®½åº¦ (å•ä½)';
                        param3.placeholder = 'é«˜åº¦ (å•ä½)';
                        param2.style.display = 'block';
                        param3.style.display = 'block';
                }
            }

            // åº”ç”¨å¯¹è±¡ç¼–è¾‘
            applyObjectEdits() {
                if (!this.selectedObject) return;
                
                const objectInfo = this.objects.find(obj => obj.mesh === this.selectedObject);
                if (!objectInfo) return;
                
                try {
                    // æ›´æ–°åæ ‡
                    const newX = parseFloat(document.getElementById('edit-x').value);
                    const newY = parseFloat(document.getElementById('edit-y').value);
                    const newZ = parseFloat(document.getElementById('edit-z').value);
                    
                    if (!isNaN(newX) && !isNaN(newY) && !isNaN(newZ)) {
                        this.selectedObject.position.set(newX, newY, newZ);
                        console.log('âœ… åæ ‡æ›´æ–°:', { x: newX, y: newY, z: newZ });
                    }
                    
                    // æ›´æ–°é¢œè‰² - éœ€è¦å¤„ç†åŸå§‹æè´¨å’Œé«˜äº®æè´¨
                    const newColor = document.getElementById('edit-color').value;
                    const colorInt = parseInt(newColor.slice(1), 16);
                    
                    // æ›´æ–°å½“å‰æ˜¾ç¤ºçš„æè´¨
                    this.selectedObject.material.color.setHex(colorInt);
                    
                    // å¦‚æœæœ‰åŸå§‹æè´¨ï¼Œä¹Ÿè¦æ›´æ–°å®ƒ
                    if (this.selectedObject.userData.originalMaterial) {
                        this.selectedObject.userData.originalMaterial.color.setHex(colorInt);
                    }
                    
                    objectInfo.color = newColor;
                    console.log('âœ… é¢œè‰²æ›´æ–°:', newColor);
                    
                    // æ›´æ–°é€æ˜åº¦
                    const newTransparency = parseFloat(document.getElementById('edit-transparency').value);
                    this.selectedObject.material.opacity = newTransparency;
                    
                    // ä¹Ÿæ›´æ–°åŸå§‹æè´¨çš„é€æ˜åº¦
                    if (this.selectedObject.userData.originalMaterial) {
                        this.selectedObject.userData.originalMaterial.opacity = newTransparency;
                    }
                    
                    console.log('âœ… é€æ˜åº¦æ›´æ–°:', newTransparency);
                    
                    // æ›´æ–°å°ºå¯¸å‚æ•°
                    const newParam1 = parseFloat(document.getElementById('edit-param1').value);
                    const newParam2 = parseFloat(document.getElementById('edit-param2').value);
                    const newParam3 = parseFloat(document.getElementById('edit-param3').value);
                    
                    if (!isNaN(newParam1) && newParam1 > 0) {
                        const newParams = [newParam1];
                        if (!isNaN(newParam2) && newParam2 > 0) newParams.push(newParam2);
                        if (!isNaN(newParam3) && newParam3 > 0) newParams.push(newParam3);
                        
                        // é‡æ–°åˆ›å»ºå‡ ä½•ä½“
                        this.updateObjectGeometry(objectInfo, newParams);
                        console.log('âœ… å°ºå¯¸æ›´æ–°:', newParams);
                    }
                    
                    console.log('âœ… å¯¹è±¡ç¼–è¾‘åº”ç”¨æˆåŠŸ');
                    this.updateObjectsList();
                } catch (error) {
                    console.error('âŒ åº”ç”¨ç¼–è¾‘å¤±è´¥:', error);
                    alert('åº”ç”¨ç¼–è¾‘å¤±è´¥: ' + error.message);
                }
            }

            // æ›´æ–°å¯¹è±¡å‡ ä½•ä½“
            updateObjectGeometry(objectInfo, newParams) {
                const oldGeometry = objectInfo.mesh.geometry;
                const newGeometry = this.createGeometry(objectInfo.type, newParams);
                
                // æ›´æ–°å‡ ä½•ä½“
                objectInfo.mesh.geometry = newGeometry;
                objectInfo.parameters = newParams;
                
                // é‡Šæ”¾æ—§å‡ ä½•ä½“å†…å­˜
                oldGeometry.dispose();
                
                console.log('âœ… å‡ ä½•ä½“æ›´æ–°å®Œæˆ:', newParams);
            }

            updateObjectPropertiesPanel(objectInfo) {
                // å®æ—¶æ›´æ–°ç¼–è¾‘é¢æ¿ä¸­çš„ä½ç½®ä¿¡æ¯ç­‰
                // è¿™ä¸ªæ–¹æ³•åœ¨å˜æ¢æ§åˆ¶å™¨ç§»åŠ¨å¯¹è±¡æ—¶è¢«è°ƒç”¨
            }

            // æ ¹æ®IDé€‰æ‹©å¯¹è±¡
            selectObjectById(id) {
                const objectInfo = this.objects.find(obj => obj.id === id);
                if (objectInfo) {
                    this.selectObject(objectInfo.mesh, objectInfo);
                }
            }
        }

        // å…¨å±€å‡½æ•°ä¾›HTMLè°ƒç”¨
        function createShape() {
            console.log('ğŸ¯ createShapeå‡½æ•°è¢«è°ƒç”¨');
            if (!geometrySystem) {
                console.error('âŒ å‡ ä½•ç³»ç»Ÿæœªåˆå§‹åŒ–');
                alert('3Dç³»ç»Ÿæœªåˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢');
                return;
            }
            
            // ç›´æ¥åˆ›å»ºå‡ ä½•ä½“åœ¨é»˜è®¤ä½ç½®
            geometrySystem.createShape();
        }

        function enableClickToPlace() {
            if (!geometrySystem) {
                alert('3Dç³»ç»Ÿæœªåˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢');
                return;
            }
            geometrySystem.enablePlacementMode();
        }

        function createLine() {
            if (!geometrySystem) {
                alert('3Dç³»ç»Ÿæœªåˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢');
                return;
            }
            geometrySystem.createLine();
        }

        function clearAll() {
            if (!geometrySystem) {
                alert('3Dç³»ç»Ÿæœªåˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢');
                return;
            }
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å¯¹è±¡å—ï¼Ÿ')) {
                geometrySystem.clearAll();
            }
        }

        function resetView() {
            if (geometrySystem) geometrySystem.resetView();
        }

        function toggleGrid() {
            if (geometrySystem) geometrySystem.toggleGrid();
        }

        function toggleAxes() {
            if (geometrySystem) geometrySystem.toggleAxes();
        }

        function exportScene() {
            if (geometrySystem) geometrySystem.exportScene();
        }

        function setTransformMode(mode) {
            if (!geometrySystem || !geometrySystem.transformControls) {
                alert('å˜æ¢æ§åˆ¶å™¨æœªåˆå§‹åŒ–');
                return;
            }
            geometrySystem.transformControls.setMode(mode);
            console.log('ğŸ”§ å˜æ¢æ¨¡å¼è®¾ç½®ä¸º:', mode);
        }

        function applyObjectEdits() {
            if (!geometrySystem) {
                alert('3Dç³»ç»Ÿæœªåˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢');
                return;
            }
            geometrySystem.applyObjectEdits();
        }

        function deselectObject() {
            if (!geometrySystem) {
                alert('3Dç³»ç»Ÿæœªåˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢');
                return;
            }
            geometrySystem.deselectObject();
        }
    </script>
</body>
</html> 