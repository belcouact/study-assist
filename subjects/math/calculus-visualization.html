<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>微积分可视化 - 数学学习助手</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .calculus-workspace {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .tool-tabs {
            background: #f8f9fa;
            padding: 0;
            border-bottom: 2px solid #e9ecef;
            display: flex;
            overflow-x: auto;
        }

        .tab-btn {
            padding: 15px 25px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #495057;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-btn:hover {
            background: #e9ecef;
            color: #007bff;
        }

        .tab-btn.active {
            color: #007bff;
            border-bottom-color: #007bff;
            background: white;
        }

        .tool-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .tool-section {
            display: none;
        }

        .tool-section.active {
            display: block;
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.9);
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .back-btn:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        /* Learning Section Styles */
        .learning-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .learning-section h3 {
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .concept-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .concept-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .concept-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }

        .concept-card h4 {
            margin-bottom: 0.5rem;
            color: #fff;
        }

        .concept-card p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Interactive Demo Styles */
        .interactive-demo {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1rem 0;
            border: 2px solid #e9ecef;
        }

        .demo-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .demo-slider {
            flex: 1;
            min-width: 150px;
        }

        .demo-slider label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .demo-slider input[type="range"] {
            width: 100%;
            margin-bottom: 0.5rem;
        }

        .demo-value {
            text-align: center;
            font-weight: bold;
            color: #007bff;
        }

        .visualization-container {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            border: 2px solid #e9ecef;
            min-height: 400px;
            position: relative;
        }

        .function-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 1rem;
            font-family: 'Courier New', monospace;
        }

        .function-input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .formula-display {
            font-family: 'Times New Roman', serif;
            font-size: 18px;
            text-align: center;
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 2px solid #e9ecef;
        }

        .explanation-box {
            background: #e7f3ff;
            border: 2px solid #b3d9ff;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .explanation-box h4 {
            color: #0056b3;
            margin-bottom: 1rem;
        }

        .step-by-step {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #28a745;
        }

        .step {
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .step:last-child {
            border-bottom: none;
        }

        .step-number {
            display: inline-block;
            background: #007bff;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            text-align: center;
            line-height: 25px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }

        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .example-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #17a2b8;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .example-card:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .example-card h5 {
            color: #17a2b8;
            margin-bottom: 8px;
        }

        .example-card .equation {
            font-family: 'Courier New', monospace;
            background: white;
            padding: 8px;
            border-radius: 4px;
            margin: 8px 0;
        }

        /* Canvas for plotting */
        .plot-canvas {
            width: 100%;
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .tool-tabs {
                flex-direction: column;
            }

            .tab-btn {
                text-align: center;
                border-bottom: 1px solid #e9ecef;
                border-right: none;
            }

            .tab-btn.active {
                border-bottom: 1px solid #007bff;
                border-right: none;
            }

            .tool-content {
                padding: 20px;
            }

            .concept-cards {
                grid-template-columns: 1fr;
            }

            .demo-controls {
                flex-direction: column;
            }

            .demo-slider {
                min-width: auto;
            }

            .learning-section {
                padding: 1.5rem;
            }

            .examples-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .header p {
                font-size: 0.9rem;
            }

            .tool-content {
                padding: 15px;
            }

            .learning-section {
                padding: 1rem;
            }

            .visualization-container {
                min-height: 300px;
            }
        }

        /* Animation for smooth transitions */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Loading spinner */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <!-- Include Plotly.js for advanced plotting -->
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
</head>
<body>
    <button class="back-btn" onclick="window.location.href='main.html'">← 返回数学主页</button>
    
    <div class="container">
        <div class="header">
            <h1>📈 微积分可视化</h1>
            <p>探索导数、积分和极限的动态世界</p>
        </div>

        <div class="calculus-workspace">
            <div class="tool-tabs">
                <button class="tab-btn active" data-tab="derivatives">
                    <span>📊</span> 导数可视化
                </button>
                <button class="tab-btn" data-tab="integrals">
                    <span>📐</span> 积分可视化
                </button>
                <button class="tab-btn" data-tab="limits">
                    <span>🎯</span> 极限演示
                </button>
                <button class="tab-btn" data-tab="series">
                    <span>🔢</span> 级数展开
                </button>
                <button class="tab-btn" data-tab="applications">
                    <span>🚀</span> 实际应用
                </button>
            </div>

            <div class="tool-content">
                <!-- 导数可视化 -->
                <div class="tool-section active" id="derivatives">
                    <h3>导数可视化</h3>
                    <p>理解导数的几何意义和物理意义</p>
                    
                    <!-- Learning Section -->
                    <div class="learning-section">
                        <h3>🎓 导数基础知识</h3>
                        <p>导数描述了函数在某一点的瞬时变化率，是微积分的核心概念之一。</p>
                        <div class="concept-cards">
                            <div class="concept-card">
                                <h4>几何意义</h4>
                                <p>导数表示函数图像在某点的切线斜率，反映了函数在该点的变化趋势。</p>
                            </div>
                            <div class="concept-card">
                                <h4>物理意义</h4>
                                <p>在物理中，导数表示瞬时速度、加速度等变化率概念。</p>
                            </div>
                            <div class="concept-card">
                                <h4>求导法则</h4>
                                <p>幂函数法则、乘积法则、商法则、链式法则等是求导的基本工具。</p>
                            </div>
                            <div class="concept-card">
                                <h4>高阶导数</h4>
                                <p>二阶导数表示函数的凹凸性，高阶导数有更深层的数学意义。</p>
                            </div>
                        </div>
                    </div>

                    <!-- Interactive Demo -->
                    <div class="interactive-demo">
                        <h4>🎮 交互式导数演示</h4>
                        <p>调整参数观察函数及其导数的变化</p>
                        
                        <div class="demo-controls">
                            <div class="demo-slider">
                                <label>函数类型:</label>
                                <select id="derivative-function-type" onchange="updateDerivativeDemo()">
                                    <option value="polynomial">多项式: ax³ + bx² + cx + d</option>
                                    <option value="trigonometric">三角函数: a·sin(bx + c)</option>
                                    <option value="exponential">指数函数: a·e^(bx)</option>
                                    <option value="logarithmic">对数函数: a·ln(bx + c)</option>
                                </select>
                            </div>
                        </div>

                        <div class="demo-controls" id="polynomial-controls">
                            <div class="demo-slider">
                                <label>系数 a:</label>
                                <input type="range" id="poly-a" min="-2" max="2" value="1" step="0.1" oninput="updateDerivativeDemo()">
                                <div class="demo-value" id="poly-a-value">1</div>
                            </div>
                            <div class="demo-slider">
                                <label>系数 b:</label>
                                <input type="range" id="poly-b" min="-3" max="3" value="0" step="0.1" oninput="updateDerivativeDemo()">
                                <div class="demo-value" id="poly-b-value">0</div>
                            </div>
                            <div class="demo-slider">
                                <label>系数 c:</label>
                                <input type="range" id="poly-c" min="-5" max="5" value="1" step="0.1" oninput="updateDerivativeDemo()">
                                <div class="demo-value" id="poly-c-value">1</div>
                            </div>
                            <div class="demo-slider">
                                <label>系数 d:</label>
                                <input type="range" id="poly-d" min="-5" max="5" value="0" step="0.1" oninput="updateDerivativeDemo()">
                                <div class="demo-value" id="poly-d-value">0</div>
                            </div>
                        </div>

                        <div class="demo-controls" id="trig-controls" style="display: none;">
                            <div class="demo-slider">
                                <label>振幅 a:</label>
                                <input type="range" id="trig-a" min="0.5" max="3" value="1" step="0.1" oninput="updateDerivativeDemo()">
                                <div class="demo-value" id="trig-a-value">1</div>
                            </div>
                            <div class="demo-slider">
                                <label>频率 b:</label>
                                <input type="range" id="trig-b" min="0.5" max="3" value="1" step="0.1" oninput="updateDerivativeDemo()">
                                <div class="demo-value" id="trig-b-value">1</div>
                            </div>
                            <div class="demo-slider">
                                <label>相位 c:</label>
                                <input type="range" id="trig-c" min="0" max="6.28" value="0" step="0.1" oninput="updateDerivativeDemo()">
                                <div class="demo-value" id="trig-c-value">0</div>
                            </div>
                        </div>

                        <div class="visualization-container">
                            <div id="derivative-plot" class="plot-canvas"></div>
                        </div>

                        <div class="formula-display" id="derivative-formula">
                            f(x) = x³, f'(x) = 3x²
                        </div>
                    </div>

                    <!-- Examples -->
                    <div class="examples-grid">
                        <div class="example-card" onclick="loadDerivativeExample('polynomial')">
                            <h5>多项式函数</h5>
                            <div class="equation">f(x) = x³ - 2x² + x</div>
                            <p>f'(x) = 3x² - 4x + 1</p>
                        </div>
                        <div class="example-card" onclick="loadDerivativeExample('trigonometric')">
                            <h5>三角函数</h5>
                            <div class="equation">f(x) = sin(x)</div>
                            <p>f'(x) = cos(x)</p>
                        </div>
                        <div class="example-card" onclick="loadDerivativeExample('exponential')">
                            <h5>指数函数</h5>
                            <div class="equation">f(x) = e^x</div>
                            <p>f'(x) = e^x</p>
                        </div>
                        <div class="example-card" onclick="loadDerivativeExample('logarithmic')">
                            <h5>对数函数</h5>
                            <div class="equation">f(x) = ln(x)</div>
                            <p>f'(x) = 1/x</p>
                        </div>
                    </div>
                </div>

                <!-- 积分可视化 -->
                <div class="tool-section" id="integrals">
                    <h3>积分可视化</h3>
                    <p>理解积分的几何意义和计算方法</p>
                    
                    <!-- Learning Section -->
                    <div class="learning-section">
                        <h3>🎓 积分基础知识</h3>
                        <p>积分是导数的逆运算，用于计算面积、体积和累积量。</p>
                        <div class="concept-cards">
                            <div class="concept-card">
                                <h4>定积分</h4>
                                <p>表示函数图像与x轴之间的有向面积，有明确的数值结果。</p>
                            </div>
                            <div class="concept-card">
                                <h4>不定积分</h4>
                                <p>表示原函数的集合，是求导的逆过程，结果包含任意常数C。</p>
                            </div>
                            <div class="concept-card">
                                <h4>黎曼和</h4>
                                <p>通过矩形面积的极限来定义积分，是积分概念的基础。</p>
                            </div>
                            <div class="concept-card">
                                <h4>微积分基本定理</h4>
                                <p>连接了导数和积分，提供了计算定积分的有效方法。</p>
                            </div>
                        </div>
                    </div>

                    <!-- Interactive Demo -->
                    <div class="interactive-demo">
                        <h4>🎮 黎曼和可视化</h4>
                        <p>观察矩形数量增加时如何逼近真实积分值</p>
                        
                        <div class="demo-controls">
                            <div class="demo-slider">
                                <label>函数:</label>
                                <select id="integral-function" onchange="updateIntegralDemo()">
                                    <option value="quadratic">f(x) = x²</option>
                                    <option value="cubic">f(x) = x³</option>
                                    <option value="sine">f(x) = sin(x)</option>
                                    <option value="exponential">f(x) = e^x</option>
                                </select>
                            </div>
                            <div class="demo-slider">
                                <label>矩形数量:</label>
                                <input type="range" id="rectangle-count" min="4" max="100" value="10" step="1" oninput="updateIntegralDemo()">
                                <div class="demo-value" id="rectangle-count-value">10</div>
                            </div>
                            <div class="demo-slider">
                                <label>积分下限:</label>
                                <input type="range" id="integral-lower" min="-2" max="2" value="0" step="0.1" oninput="updateIntegralDemo()">
                                <div class="demo-value" id="integral-lower-value">0</div>
                            </div>
                            <div class="demo-slider">
                                <label>积分上限:</label>
                                <input type="range" id="integral-upper" min="-2" max="4" value="2" step="0.1" oninput="updateIntegralDemo()">
                                <div class="demo-value" id="integral-upper-value">2</div>
                            </div>
                        </div>

                        <div class="visualization-container">
                            <div id="integral-plot" class="plot-canvas"></div>
                        </div>

                        <div class="explanation-box">
                            <h4>积分计算结果</h4>
                            <div id="integral-result">
                                <p>黎曼和近似值: <span id="riemann-sum">2.67</span></p>
                                <p>精确积分值: <span id="exact-integral">2.67</span></p>
                                <p>误差: <span id="integration-error">0.00</span></p>
                            </div>
                        </div>
                    </div>

                    <!-- Examples -->
                    <div class="examples-grid">
                        <div class="example-card" onclick="loadIntegralExample('area')">
                            <h5>面积计算</h5>
                            <div class="equation">∫₀² x² dx</div>
                            <p>计算抛物线下的面积</p>
                        </div>
                        <div class="example-card" onclick="loadIntegralExample('volume')">
                            <h5>体积计算</h5>
                            <div class="equation">V = π∫₀ʰ r² dx</div>
                            <p>旋转体体积计算</p>
                        </div>
                        <div class="example-card" onclick="loadIntegralExample('physics')">
                            <h5>物理应用</h5>
                            <div class="equation">s = ∫ v(t) dt</div>
                            <p>由速度求位移</p>
                        </div>
                        <div class="example-card" onclick="loadIntegralExample('probability')">
                            <h5>概率密度</h5>
                            <div class="equation">P = ∫ₐᵇ f(x) dx</div>
                            <p>连续概率分布</p>
                        </div>
                    </div>
                </div>

                <!-- 极限演示 -->
                <div class="tool-section" id="limits">
                    <h3>极限演示</h3>
                    <p>理解极限的概念和计算方法</p>
                    
                    <!-- Learning Section -->
                    <div class="learning-section">
                        <h3>🎓 极限基础知识</h3>
                        <p>极限是微积分的基础概念，描述了函数在某点附近的行为趋势。</p>
                        <div class="concept-cards">
                            <div class="concept-card">
                                <h4>函数极限</h4>
                                <p>当自变量趋近某个值时，函数值的趋近行为。</p>
                            </div>
                            <div class="concept-card">
                                <h4>左右极限</h4>
                                <p>从左侧和右侧分别趋近时的极限值，用于判断极限存在性。</p>
                            </div>
                            <div class="concept-card">
                                <h4>无穷极限</h4>
                                <p>函数值趋向无穷大或自变量趋向无穷时的极限行为。</p>
                            </div>
                            <div class="concept-card">
                                <h4>连续性</h4>
                                <p>函数在某点连续当且仅当该点的极限值等于函数值。</p>
                            </div>
                        </div>
                    </div>

                    <!-- Interactive Demo -->
                    <div class="interactive-demo">
                        <h4>🎮 极限可视化</h4>
                        <p>观察函数在特定点附近的行为</p>
                        
                        <div class="demo-controls">
                            <div class="demo-slider">
                                <label>极限类型:</label>
                                <select id="limit-type" onchange="updateLimitDemo()">
                                    <option value="continuous">连续函数</option>
                                    <option value="removable">可去间断</option>
                                    <option value="jump">跳跃间断</option>
                                    <option value="infinite">无穷间断</option>
                                </select>
                            </div>
                            <div class="demo-slider">
                                <label>趋近点 x₀:</label>
                                <input type="range" id="limit-point" min="-3" max="3" value="0" step="0.1" oninput="updateLimitDemo()">
                                <div class="demo-value" id="limit-point-value">0</div>
                            </div>
                            <div class="demo-slider">
                                <label>观察范围 δ:</label>
                                <input type="range" id="limit-delta" min="0.1" max="2" value="0.5" step="0.1" oninput="updateLimitDemo()">
                                <div class="demo-value" id="limit-delta-value">0.5</div>
                            </div>
                        </div>

                        <div class="visualization-container">
                            <div id="limit-plot" class="plot-canvas"></div>
                        </div>

                        <div class="explanation-box">
                            <h4>极限分析</h4>
                            <div id="limit-analysis">
                                <p>左极限: <span id="left-limit">1</span></p>
                                <p>右极限: <span id="right-limit">1</span></p>
                                <p>函数值: <span id="function-value">1</span></p>
                                <p>极限存在性: <span id="limit-existence">存在</span></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 级数展开 -->
                <div class="tool-section" id="series">
                    <h3>级数展开</h3>
                    <p>泰勒级数和傅里叶级数的可视化</p>
                    
                    <!-- Learning Section -->
                    <div class="learning-section">
                        <h3>🎓 级数基础知识</h3>
                        <p>级数是无穷多项的和，在数学分析和应用数学中有重要作用。</p>
                        <div class="concept-cards">
                            <div class="concept-card">
                                <h4>泰勒级数</h4>
                                <p>用多项式逼近函数，在数值计算和理论分析中广泛应用。</p>
                            </div>
                            <div class="concept-card">
                                <h4>麦克劳林级数</h4>
                                <p>在x=0处展开的泰勒级数，许多基本函数都有简洁的展开式。</p>
                            </div>
                            <div class="concept-card">
                                <h4>收敛性</h4>
                                <p>级数是否收敛决定了展开的有效性和应用范围。</p>
                            </div>
                            <div class="concept-card">
                                <h4>傅里叶级数</h4>
                                <p>用三角函数展开周期函数，在信号处理中应用广泛。</p>
                            </div>
                        </div>
                    </div>

                    <!-- Interactive Demo -->
                    <div class="interactive-demo">
                        <h4>🎮 泰勒级数逼近</h4>
                        <p>观察不同项数的泰勒级数如何逼近原函数</p>
                        
                        <div class="demo-controls">
                            <div class="demo-slider">
                                <label>函数:</label>
                                <select id="series-function" onchange="updateSeriesDemo()">
                                    <option value="exp">e^x</option>
                                    <option value="sin">sin(x)</option>
                                    <option value="cos">cos(x)</option>
                                    <option value="ln">ln(1+x)</option>
                                </select>
                            </div>
                            <div class="demo-slider">
                                <label>展开项数:</label>
                                <input type="range" id="series-terms" min="1" max="10" value="3" step="1" oninput="updateSeriesDemo()">
                                <div class="demo-value" id="series-terms-value">3</div>
                            </div>
                            <div class="demo-slider">
                                <label>展开中心:</label>
                                <input type="range" id="series-center" min="-2" max="2" value="0" step="0.1" oninput="updateSeriesDemo()">
                                <div class="demo-value" id="series-center-value">0</div>
                            </div>
                        </div>

                        <div class="visualization-container">
                            <div id="series-plot" class="plot-canvas"></div>
                        </div>

                        <div class="formula-display" id="series-formula">
                            e^x ≈ 1 + x + x²/2! + x³/3!
                        </div>
                    </div>
                </div>

                <!-- 实际应用 -->
                <div class="tool-section" id="applications">
                    <h3>微积分实际应用</h3>
                    <p>微积分在物理、工程、经济等领域的应用</p>
                    
                    <!-- Learning Section -->
                    <div class="learning-section">
                        <h3>🎓 微积分应用领域</h3>
                        <p>微积分不仅是数学理论，更是解决实际问题的强大工具。</p>
                        <div class="concept-cards">
                            <div class="concept-card">
                                <h4>物理学</h4>
                                <p>运动学、动力学、电磁学等都大量使用微积分概念。</p>
                            </div>
                            <div class="concept-card">
                                <h4>工程学</h4>
                                <p>结构分析、信号处理、控制系统设计等工程问题。</p>
                            </div>
                            <div class="concept-card">
                                <h4>经济学</h4>
                                <p>边际成本、最优化问题、经济增长模型等。</p>
                            </div>
                            <div class="concept-card">
                                <h4>生物学</h4>
                                <p>种群增长、药物浓度变化、生态系统建模等。</p>
                            </div>
                        </div>
                    </div>

                    <!-- Interactive Demo -->
                    <div class="interactive-demo">
                        <h4>🎮 优化问题演示</h4>
                        <p>使用导数求解实际优化问题</p>
                        
                        <div class="demo-controls">
                            <div class="demo-slider">
                                <label>问题类型:</label>
                                <select id="optimization-type" onchange="updateOptimizationDemo()">
                                    <option value="box">最大体积盒子</option>
                                    <option value="fence">最小围栏面积</option>
                                    <option value="profit">最大利润</option>
                                    <option value="distance">最短距离</option>
                                </select>
                            </div>
                            <div class="demo-slider" id="box-controls">
                                <label>纸张边长:</label>
                                <input type="range" id="paper-size" min="10" max="30" value="20" step="1" oninput="updateOptimizationDemo()">
                                <div class="demo-value" id="paper-size-value">20</div>
                            </div>
                        </div>

                        <div class="visualization-container">
                            <div id="optimization-plot" class="plot-canvas"></div>
                        </div>

                        <div class="explanation-box">
                            <h4>优化结果</h4>
                            <div id="optimization-result">
                                <p>最优解: <span id="optimal-value">x = 3.33</span></p>
                                <p>最大值: <span id="maximum-value">V = 592.59</span></p>
                                <p>解释: <span id="optimization-explanation">当切去边长为3.33时，盒子体积最大</span></p>
                            </div>
                        </div>
                    </div>

                    <!-- Real-world Examples -->
                    <div class="examples-grid">
                        <div class="example-card" onclick="loadApplicationExample('physics')">
                            <h5>物理应用</h5>
                            <div class="equation">F = ma = m(dv/dt)</div>
                            <p>牛顿第二定律中的导数</p>
                        </div>
                        <div class="example-card" onclick="loadApplicationExample('economics')">
                            <h5>经济应用</h5>
                            <div class="equation">MC = dC/dq</div>
                            <p>边际成本的导数定义</p>
                        </div>
                        <div class="example-card" onclick="loadApplicationExample('biology')">
                            <h5>生物应用</h5>
                            <div class="equation">dP/dt = rP(1-P/K)</div>
                            <p>Logistic增长模型</p>
                        </div>
                        <div class="example-card" onclick="loadApplicationExample('engineering')">
                            <h5>工程应用</h5>
                            <div class="equation">∫ P(t) dt = Energy</div>
                            <p>功率积分求能量</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching functionality
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // Remove active class from all tabs and sections
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tool-section').forEach(s => s.classList.remove('active'));
                
                // Add active class to clicked tab
                btn.classList.add('active');
                
                // Show corresponding section
                const tabId = btn.dataset.tab;
                document.getElementById(tabId).classList.add('active');
                
                // Initialize the corresponding demo
                switch(tabId) {
                    case 'derivatives':
                        updateDerivativeDemo();
                        break;
                    case 'integrals':
                        updateIntegralDemo();
                        break;
                    case 'limits':
                        updateLimitDemo();
                        break;
                    case 'series':
                        updateSeriesDemo();
                        break;
                    case 'applications':
                        updateOptimizationDemo();
                        break;
                }
            });
        });

        // Derivative visualization
        function updateDerivativeDemo() {
            const functionType = document.getElementById('derivative-function-type').value;
            
            // Show/hide appropriate controls
            document.getElementById('polynomial-controls').style.display = 
                functionType === 'polynomial' ? 'flex' : 'none';
            document.getElementById('trig-controls').style.display = 
                functionType === 'trigonometric' ? 'flex' : 'none';
            
            let x = [];
            let y = [];
            let dy = [];
            let formula = '';
            let derivativeFormula = '';
            
            // Generate x values
            for (let i = -5; i <= 5; i += 0.1) {
                x.push(i);
            }
            
            if (functionType === 'polynomial') {
                const a = parseFloat(document.getElementById('poly-a').value);
                const b = parseFloat(document.getElementById('poly-b').value);
                const c = parseFloat(document.getElementById('poly-c').value);
                const d = parseFloat(document.getElementById('poly-d').value);
                
                // Update value displays
                document.getElementById('poly-a-value').textContent = a;
                document.getElementById('poly-b-value').textContent = b;
                document.getElementById('poly-c-value').textContent = c;
                document.getElementById('poly-d-value').textContent = d;
                
                // Calculate function and derivative values
                x.forEach(xi => {
                    const yi = a * xi * xi * xi + b * xi * xi + c * xi + d;
                    const dyi = 3 * a * xi * xi + 2 * b * xi + c;
                    y.push(yi);
                    dy.push(dyi);
                });
                
                formula = `f(x) = ${a}x³ + ${b}x² + ${c}x + ${d}`;
                derivativeFormula = `f'(x) = ${3*a}x² + ${2*b}x + ${c}`;
            } else if (functionType === 'trigonometric') {
                const a = parseFloat(document.getElementById('trig-a').value);
                const b = parseFloat(document.getElementById('trig-b').value);
                const c = parseFloat(document.getElementById('trig-c').value);
                
                // Update value displays
                document.getElementById('trig-a-value').textContent = a;
                document.getElementById('trig-b-value').textContent = b;
                document.getElementById('trig-c-value').textContent = c.toFixed(2);
                
                // Calculate function and derivative values
                x.forEach(xi => {
                    const yi = a * Math.sin(b * xi + c);
                    const dyi = a * b * Math.cos(b * xi + c);
                    y.push(yi);
                    dy.push(dyi);
                });
                
                formula = `f(x) = ${a}sin(${b}x + ${c.toFixed(2)})`;
                derivativeFormula = `f'(x) = ${a*b}cos(${b}x + ${c.toFixed(2)})`;
            }
            
            // Update formula display
            document.getElementById('derivative-formula').innerHTML = 
                `${formula}<br>${derivativeFormula}`;
            
            // Plot the function and its derivative
            const trace1 = {
                x: x,
                y: y,
                type: 'scatter',
                mode: 'lines',
                name: 'f(x)',
                line: { color: 'blue', width: 3 }
            };
            
            const trace2 = {
                x: x,
                y: dy,
                type: 'scatter',
                mode: 'lines',
                name: "f'(x)",
                line: { color: 'red', width: 3 }
            };
            
            const layout = {
                title: '函数及其导数',
                xaxis: { title: 'x' },
                yaxis: { title: 'y' },
                showlegend: true,
                grid: true
            };
            
            Plotly.newPlot('derivative-plot', [trace1, trace2], layout, {responsive: true});
        }

        // Integral visualization
        function updateIntegralDemo() {
            const functionType = document.getElementById('integral-function').value;
            const n = parseInt(document.getElementById('rectangle-count').value);
            const a = parseFloat(document.getElementById('integral-lower').value);
            const b = parseFloat(document.getElementById('integral-upper').value);
            
            // Update value displays
            document.getElementById('rectangle-count-value').textContent = n;
            document.getElementById('integral-lower-value').textContent = a;
            document.getElementById('integral-upper-value').textContent = b;
            
            let x = [];
            let y = [];
            let func;
            let exactIntegral;
            
            // Define function
            switch(functionType) {
                case 'quadratic':
                    func = x => x * x;
                    exactIntegral = (b * b * b - a * a * a) / 3;
                    break;
                case 'cubic':
                    func = x => x * x * x;
                    exactIntegral = (b * b * b * b - a * a * a * a) / 4;
                    break;
                case 'sine':
                    func = x => Math.sin(x);
                    exactIntegral = -Math.cos(b) + Math.cos(a);
                    break;
                case 'exponential':
                    func = x => Math.exp(x);
                    exactIntegral = Math.exp(b) - Math.exp(a);
                    break;
            }
            
            // Generate smooth curve
            for (let i = a; i <= b; i += (b - a) / 200) {
                x.push(i);
                y.push(func(i));
            }
            
            // Calculate Riemann sum
            const dx = (b - a) / n;
            let riemannSum = 0;
            let rectangleX = [];
            let rectangleY = [];
            
            for (let i = 0; i < n; i++) {
                const xi = a + i * dx;
                const height = func(xi);
                riemannSum += height * dx;
                
                // Rectangle coordinates
                rectangleX.push(xi, xi + dx, xi + dx, xi, xi, null);
                rectangleY.push(0, 0, height, height, 0, null);
            }
            
            // Update results
            document.getElementById('riemann-sum').textContent = riemannSum.toFixed(4);
            document.getElementById('exact-integral').textContent = exactIntegral.toFixed(4);
            document.getElementById('integration-error').textContent = 
                Math.abs(riemannSum - exactIntegral).toFixed(4);
            
            // Plot
            const trace1 = {
                x: x,
                y: y,
                type: 'scatter',
                mode: 'lines',
                name: 'f(x)',
                line: { color: 'blue', width: 3 }
            };
            
            const trace2 = {
                x: rectangleX,
                y: rectangleY,
                type: 'scatter',
                mode: 'lines',
                name: '黎曼和',
                line: { color: 'red', width: 1 },
                fill: 'tozeroy',
                fillcolor: 'rgba(255, 0, 0, 0.3)'
            };
            
            const layout = {
                title: `积分可视化 (n = ${n})`,
                xaxis: { title: 'x' },
                yaxis: { title: 'y' },
                showlegend: true
            };
            
            Plotly.newPlot('integral-plot', [trace1, trace2], layout, {responsive: true});
        }

        // Limit visualization
        function updateLimitDemo() {
            const limitType = document.getElementById('limit-type').value;
            const x0 = parseFloat(document.getElementById('limit-point').value);
            const delta = parseFloat(document.getElementById('limit-delta').value);
            
            // Update value displays
            document.getElementById('limit-point-value').textContent = x0;
            document.getElementById('limit-delta-value').textContent = delta;
            
            let x = [];
            let y = [];
            let func;
            let leftLimit, rightLimit, functionValue;
            
            // Generate x values
            for (let i = x0 - 3; i <= x0 + 3; i += 0.01) {
                x.push(i);
            }
            
            // Define function based on limit type
            switch(limitType) {
                case 'continuous':
                    func = x => x * x;
                    leftLimit = rightLimit = functionValue = x0 * x0;
                    break;
                case 'removable':
                    func = x => x === x0 ? 2 : (x * x - x0 * x0) / (x - x0);
                    leftLimit = rightLimit = 2 * x0;
                    functionValue = 2;
                    break;
                case 'jump':
                    func = x => x < x0 ? x + 1 : x + 2;
                    leftLimit = x0 + 1;
                    rightLimit = x0 + 2;
                    functionValue = x0 + 2;
                    break;
                case 'infinite':
                    func = x => x === x0 ? undefined : 1 / (x - x0);
                    leftLimit = -Infinity;
                    rightLimit = Infinity;
                    functionValue = undefined;
                    break;
            }
            
            // Calculate y values
            x.forEach(xi => {
                if (limitType === 'infinite' && Math.abs(xi - x0) < 0.01) {
                    y.push(null);
                } else {
                    y.push(func(xi));
                }
            });
            
            // Update analysis
            document.getElementById('left-limit').textContent = 
                leftLimit === Infinity ? '∞' : leftLimit === -Infinity ? '-∞' : leftLimit.toFixed(2);
            document.getElementById('right-limit').textContent = 
                rightLimit === Infinity ? '∞' : rightLimit === -Infinity ? '-∞' : rightLimit.toFixed(2);
            document.getElementById('function-value').textContent = 
                functionValue === undefined ? '未定义' : functionValue.toFixed(2);
            document.getElementById('limit-existence').textContent = 
                leftLimit === rightLimit && isFinite(leftLimit) ? '存在' : '不存在';
            
            // Plot
            const trace = {
                x: x,
                y: y,
                type: 'scatter',
                mode: 'lines',
                name: 'f(x)',
                line: { color: 'blue', width: 3 }
            };
            
            // Add vertical line at x0
            const verticalLine = {
                x: [x0, x0],
                y: [-10, 10],
                type: 'scatter',
                mode: 'lines',
                name: `x = ${x0}`,
                line: { color: 'red', width: 2, dash: 'dash' }
            };
            
            const layout = {
                title: `极限演示: x → ${x0}`,
                xaxis: { title: 'x', range: [x0 - 2, x0 + 2] },
                yaxis: { title: 'y', range: [-5, 5] },
                showlegend: true
            };
            
            Plotly.newPlot('limit-plot', [trace, verticalLine], layout, {responsive: true});
        }

        // Series visualization
        function updateSeriesDemo() {
            const functionType = document.getElementById('series-function').value;
            const terms = parseInt(document.getElementById('series-terms').value);
            const center = parseFloat(document.getElementById('series-center').value);
            
            // Update value displays
            document.getElementById('series-terms-value').textContent = terms;
            document.getElementById('series-center-value').textContent = center;
            
            let x = [];
            let originalY = [];
            let seriesY = [];
            let formula = '';
            
            // Generate x values
            for (let i = -3; i <= 3; i += 0.05) {
                x.push(i);
            }
            
            // Calculate original function and Taylor series
            x.forEach(xi => {
                let original, series = 0;
                const dx = xi - center;
                
                switch(functionType) {
                    case 'exp':
                        original = Math.exp(xi);
                        for (let n = 0; n < terms; n++) {
                            series += Math.pow(dx, n) / factorial(n);
                        }
                        series *= Math.exp(center);
                        formula = `e^x ≈ e^${center}`;
                        for (let n = 0; n < terms; n++) {
                            if (n === 0) formula += ` × (1`;
                            else formula += ` + (x-${center})^${n}/${factorial(n)}`;
                        }
                        formula += ')';
                        break;
                        
                    case 'sin':
                        original = Math.sin(xi);
                        for (let n = 0; n < terms; n++) {
                            const coeff = Math.pow(-1, n) / factorial(2 * n + 1);
                            series += coeff * Math.pow(dx, 2 * n + 1);
                        }
                        formula = `sin(x) ≈ `;
                        for (let n = 0; n < terms; n++) {
                            if (n > 0) formula += ' + ';
                            formula += `(-1)^${n} × x^${2*n+1}/${factorial(2*n+1)}`;
                        }
                        break;
                        
                    case 'cos':
                        original = Math.cos(xi);
                        for (let n = 0; n < terms; n++) {
                            const coeff = Math.pow(-1, n) / factorial(2 * n);
                            series += coeff * Math.pow(dx, 2 * n);
                        }
                        formula = `cos(x) ≈ `;
                        for (let n = 0; n < terms; n++) {
                            if (n > 0) formula += ' + ';
                            formula += `(-1)^${n} × x^${2*n}/${factorial(2*n)}`;
                        }
                        break;
                        
                    case 'ln':
                        if (xi > -1) {
                            original = Math.log(1 + xi);
                            for (let n = 1; n <= terms; n++) {
                                series += Math.pow(-1, n + 1) * Math.pow(dx, n) / n;
                            }
                        } else {
                            original = null;
                            series = null;
                        }
                        formula = `ln(1+x) ≈ `;
                        for (let n = 1; n <= terms; n++) {
                            if (n > 1) formula += ' + ';
                            formula += `(-1)^${n+1} × x^${n}/${n}`;
                        }
                        break;
                }
                
                originalY.push(original);
                seriesY.push(series);
            });
            
            // Update formula display
            document.getElementById('series-formula').innerHTML = formula;
            
            // Plot
            const trace1 = {
                x: x,
                y: originalY,
                type: 'scatter',
                mode: 'lines',
                name: '原函数',
                line: { color: 'blue', width: 3 }
            };
            
            const trace2 = {
                x: x,
                y: seriesY,
                type: 'scatter',
                mode: 'lines',
                name: `泰勒级数 (${terms}项)`,
                line: { color: 'red', width: 3, dash: 'dash' }
            };
            
            const layout = {
                title: `泰勒级数逼近 (${terms}项)`,
                xaxis: { title: 'x' },
                yaxis: { title: 'y' },
                showlegend: true
            };
            
            Plotly.newPlot('series-plot', [trace1, trace2], layout, {responsive: true});
        }

        // Optimization visualization
        function updateOptimizationDemo() {
            const optimizationType = document.getElementById('optimization-type').value;
            
            let x = [];
            let y = [];
            let optimalX, optimalY, explanation;
            
            if (optimizationType === 'box') {
                const paperSize = parseFloat(document.getElementById('paper-size').value);
                document.getElementById('paper-size-value').textContent = paperSize;
                
                // Box volume function: V = x(L-2x)(W-2x) where L=W=paperSize
                for (let i = 0; i <= paperSize/2; i += 0.1) {
                    x.push(i);
                    const volume = i * (paperSize - 2*i) * (paperSize - 2*i);
                    y.push(volume);
                }
                
                // Find optimal value (derivative = 0)
                optimalX = paperSize / 6;
                optimalY = optimalX * (paperSize - 2*optimalX) * (paperSize - 2*optimalX);
                explanation = `当切去边长为${optimalX.toFixed(2)}时，盒子体积最大`;
                
                document.getElementById('optimal-value').textContent = `x = ${optimalX.toFixed(2)}`;
                document.getElementById('maximum-value').textContent = `V = ${optimalY.toFixed(2)}`;
                document.getElementById('optimization-explanation').textContent = explanation;
            }
            
            // Plot
            const trace = {
                x: x,
                y: y,
                type: 'scatter',
                mode: 'lines',
                name: '目标函数',
                line: { color: 'blue', width: 3 }
            };
            
            const optimalPoint = {
                x: [optimalX],
                y: [optimalY],
                type: 'scatter',
                mode: 'markers',
                name: '最优点',
                marker: { color: 'red', size: 10 }
            };
            
            const layout = {
                title: '优化问题可视化',
                xaxis: { title: 'x' },
                yaxis: { title: '目标函数值' },
                showlegend: true
            };
            
            Plotly.newPlot('optimization-plot', [trace, optimalPoint], layout, {responsive: true});
        }

        // Helper function for factorial
        function factorial(n) {
            if (n <= 1) return 1;
            return n * factorial(n - 1);
        }

        // Example loading functions
        function loadDerivativeExample(type) {
            document.getElementById('derivative-function-type').value = type;
            updateDerivativeDemo();
        }

        function loadIntegralExample(type) {
            // Set appropriate function for the example
            switch(type) {
                case 'area':
                    document.getElementById('integral-function').value = 'quadratic';
                    document.getElementById('integral-lower').value = 0;
                    document.getElementById('integral-upper').value = 2;
                    break;
                case 'volume':
                    document.getElementById('integral-function').value = 'quadratic';
                    break;
            }
            updateIntegralDemo();
        }

        function loadApplicationExample(type) {
            document.getElementById('optimization-type').value = 'box';
            updateOptimizationDemo();
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the first demo
            updateDerivativeDemo();
        });
    </script>
</body>
</html> 