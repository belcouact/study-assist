<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>微积分可视化 - 数学学习助手</title>
    <link rel="icon" href="assets/icons/alex.ico" type="image/x-icon">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/components.css">
    <link rel="stylesheet" href="../../css/utilities.css">
    <link rel="stylesheet" href="../../css/responsive.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .calculus-workspace {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .tool-tabs {
            background: #f8f9fa;
            padding: 0;
            border-bottom: 2px solid #e9ecef;
            display: flex;
            overflow-x: auto;
        }

        .tab-btn {
            padding: 15px 25px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #495057;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-btn:hover {
            background: #e9ecef;
            color: #007bff;
        }

        .tab-btn.active {
            color: #007bff;
            border-bottom-color: #007bff;
            background: white;
        }

        .tool-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .tool-section {
            display: none;
        }

        .tool-section.active {
            display: block;
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.9);
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .back-btn:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        /* Learning Section Styles */
        .learning-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .learning-section h3 {
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .concept-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .concept-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .concept-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }

        .concept-card h4 {
            margin-bottom: 0.5rem;
            color: #fff;
        }

        .concept-card p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Interactive Demo Styles */
        .interactive-demo {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1rem 0;
            border: 2px solid #e9ecef;
        }

        .demo-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .demo-slider {
            flex: 1;
            min-width: 150px;
        }

        .demo-slider label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .demo-slider input[type="range"] {
            width: 100%;
            margin-bottom: 0.5rem;
        }

        .demo-value {
            text-align: center;
            font-weight: bold;
            color: #007bff;
        }

        .visual-equation {
            background: white;
            border: 2px solid #007bff;
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
            font-size: 1.5rem;
            font-family: 'Times New Roman', serif;
            margin: 1rem 0;
        }

        .graph-container {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            border: 2px solid #e9ecef;
            min-height: 400px;
            position: relative;
        }

        .canvas-container {
            width: 100%;
            height: 350px;
            position: relative;
        }

        #calculusCanvas {
            border: 1px solid #ddd;
            border-radius: 8px;
            width: 100%;
            height: 100%;
        }

        /* Real World Examples */
        .real-world-examples {
            background: #e8f5e8;
            border: 2px solid #c3e6cb;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .real-world-examples h4 {
            color: #155724;
            margin-bottom: 1rem;
        }

        .example-scenario {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid #28a745;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .scenario-title {
            font-weight: 600;
            color: #155724;
            margin-bottom: 0.8rem;
            font-size: 1.1rem;
        }

        .scenario-description {
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .scenario-math {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            border-left: 3px solid #007bff;
            margin: 0.5rem 0;
        }

        .scenario-result {
            background: #d4edda;
            padding: 0.8rem;
            border-radius: 6px;
            color: #155724;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        /* Application Cards */
        .application-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .application-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-left: 4px solid #007bff;
            transition: all 0.3s ease;
        }

        .application-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.15);
        }

        .application-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .application-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #007bff;
            margin-bottom: 0.8rem;
        }

        .application-description {
            font-size: 0.95rem;
            line-height: 1.5;
            color: #666;
        }

        /* Input Controls */
        .input-group {
            margin-bottom: 1rem;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #495057;
        }

        .input-field {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        /* Tips Section */
        .tips-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .tips-section h4 {
            color: #856404;
            margin-bottom: 1rem;
        }

        .tip-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 0.8rem;
            gap: 0.5rem;
        }

        .tip-icon {
            background: #ffc107;
            color: #856404;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            flex-shrink: 0;
            margin-top: 2px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .tool-tabs {
                flex-direction: column;
            }

            .tab-btn {
                text-align: center;
                border-bottom: 1px solid #e9ecef;
                border-right: none;
            }

            .tab-btn.active {
                border-bottom: 1px solid #007bff;
                border-right: none;
            }

            .tool-content {
                padding: 20px;
            }

            .concept-cards {
                grid-template-columns: 1fr;
            }

            .demo-controls {
                flex-direction: column;
            }

            .demo-slider {
                min-width: auto;
            }

            .visual-equation {
                font-size: 1.2rem;
            }

            .learning-section {
                padding: 1.5rem;
            }

            .application-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .header p {
                font-size: 0.9rem;
            }

            .visual-equation {
                font-size: 1rem;
                padding: 1rem;
            }

            .learning-section {
                padding: 1rem;
            }

            .concept-card {
                padding: 1rem;
            }

            .interactive-demo {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="window.location.href='main.html'">← 返回数学主页</button>
    
    <div class="container">
        <div class="header">
            <h1>∞ 微积分可视化</h1>
            <p>探索导数和积分的奥秘 - 发现微积分在生活和工作中的实际应用</p>
        </div>

        <div class="calculus-workspace">
            <div class="tool-tabs">
                <button class="tab-btn active" data-tab="derivatives">
                    <span>📈</span> 导数可视化
                </button>
                <button class="tab-btn" data-tab="integrals">
                    <span>📊</span> 积分可视化
                </button>
                <button class="tab-btn" data-tab="applications">
                    <span>🌍</span> 实际应用
                </button>
                <button class="tab-btn" data-tab="interactive">
                    <span>🎮</span> 交互式探索
                </button>
            </div>

            <div class="tool-content">
                <!-- 导数可视化 -->
                <div class="tool-section active" id="derivatives">
                    <h3>导数：变化率的可视化</h3>
                    
                    <!-- Learning Section -->
                    <div class="learning-section">
                        <h3>🎓 导数基础概念</h3>
                        <p>导数描述函数在某一点的瞬时变化率，是微积分的核心概念之一。</p>
                        <div class="concept-cards">
                            <div class="concept-card">
                                <h4>几何意义</h4>
                                <p>导数表示函数图像在某点的切线斜率，反映函数在该点的变化趋势。</p>
                            </div>
                            <div class="concept-card">
                                <h4>物理意义</h4>
                                <p>位移对时间的导数是速度，速度对时间的导数是加速度。</p>
                            </div>
                            <div class="concept-card">
                                <h4>经济意义</h4>
                                <p>成本函数的导数是边际成本，收益函数的导数是边际收益。</p>
                            </div>
                            <div class="concept-card">
                                <h4>优化应用</h4>
                                <p>通过求导数为零的点，可以找到函数的极值，解决最优化问题。</p>
                            </div>
                        </div>
                    </div>

                    <!-- Interactive Demo -->
                    <div class="interactive-demo">
                        <h4>🎮 导数交互演示</h4>
                        <p>调整参数观察函数 f(x) = ax³ + bx² + cx + d 及其导数的变化</p>
                        <div class="demo-controls">
                            <div class="demo-slider">
                                <label>系数 a:</label>
                                <input type="range" id="deriv-a" min="-2" max="2" value="1" step="0.1" oninput="updateDerivativeDemo()">
                                <div class="demo-value" id="deriv-value-a">1</div>
                            </div>
                            <div class="demo-slider">
                                <label>系数 b:</label>
                                <input type="range" id="deriv-b" min="-5" max="5" value="0" step="0.1" oninput="updateDerivativeDemo()">
                                <div class="demo-value" id="deriv-value-b">0</div>
                            </div>
                            <div class="demo-slider">
                                <label>系数 c:</label>
                                <input type="range" id="deriv-c" min="-5" max="5" value="0" step="0.1" oninput="updateDerivativeDemo()">
                                <div class="demo-value" id="deriv-value-c">0</div>
                            </div>
                            <div class="demo-slider">
                                <label>系数 d:</label>
                                <input type="range" id="deriv-d" min="-5" max="5" value="0" step="0.1" oninput="updateDerivativeDemo()">
                                <div class="demo-value" id="deriv-value-d">0</div>
                            </div>
                        </div>
                        <div class="visual-equation" id="deriv-function">f(x) = x³</div>
                        <div class="visual-equation" id="deriv-derivative">f'(x) = 3x²</div>
                        <div class="graph-container">
                            <div class="canvas-container">
                                <canvas id="derivativeCanvas"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Real World Examples -->
                    <div class="real-world-examples">
                        <h4>🌍 导数在生活中的应用</h4>
                        
                        <div class="example-scenario">
                            <div class="scenario-title">🚗 汽车行驶分析</div>
                            <div class="scenario-description">
                                一辆汽车的位移函数为 s(t) = 2t³ - 9t² + 12t，其中 t 是时间（秒），s 是位移（米）。
                            </div>
                            <div class="scenario-math">
                                速度函数：v(t) = s'(t) = 6t² - 18t + 12<br>
                                加速度函数：a(t) = v'(t) = 12t - 18
                            </div>
                            <div class="scenario-result">
                                应用：通过导数可以分析汽车在任意时刻的速度和加速度，帮助优化驾驶策略。
                            </div>
                        </div>

                        <div class="example-scenario">
                            <div class="scenario-title">💰 利润最大化</div>
                            <div class="scenario-description">
                                某公司的利润函数为 P(x) = -2x² + 100x - 800，其中 x 是产量（件）。
                            </div>
                            <div class="scenario-math">
                                边际利润：P'(x) = -4x + 100<br>
                                令 P'(x) = 0：-4x + 100 = 0，解得 x = 25
                            </div>
                            <div class="scenario-result">
                                结论：当产量为25件时，利润达到最大值1450元。
                            </div>
                        </div>

                        <div class="example-scenario">
                            <div class="scenario-title">🌡️ 温度变化率</div>
                            <div class="scenario-description">
                                某地一天的温度函数为 T(t) = -0.5t² + 6t + 10，其中 t 是时间（小时），T 是温度（°C）。
                            </div>
                            <div class="scenario-math">
                                温度变化率：T'(t) = -t + 6<br>
                                最高温度时刻：T'(t) = 0，得 t = 6小时
                            </div>
                            <div class="scenario-result">
                                应用：预测温度变化趋势，为农业生产和日常生活提供指导。
                            </div>
                        </div>
                    </div>

                    <!-- Tips Section -->
                    <div class="tips-section">
                        <h4>💡 导数学习技巧</h4>
                        <div class="tip-item">
                            <div class="tip-icon">1</div>
                            <div>理解导数的几何意义：切线斜率反映函数的变化趋势</div>
                        </div>
                        <div class="tip-item">
                            <div class="tip-icon">2</div>
                            <div>掌握基本求导法则：幂函数、指数函数、对数函数的导数公式</div>
                        </div>
                        <div class="tip-item">
                            <div class="tip-icon">3</div>
                            <div>学会链式法则：复合函数求导的关键工具</div>
                        </div>
                        <div class="tip-item">
                            <div class="tip-icon">4</div>
                            <div>应用导数解决实际问题：最值问题、变化率问题</div>
                        </div>
                        <div class="tip-item">
                            <div class="tip-icon">5</div>
                            <div>通过图像理解：观察函数图像与导数图像的关系</div>
                        </div>
                    </div>
                </div>

                <!-- 积分可视化 -->
                <div class="tool-section" id="integrals">
                    <h3>积分：面积与累积的可视化</h3>
                    
                    <!-- Learning Section -->
                    <div class="learning-section">
                        <h3>🎓 积分基础概念</h3>
                        <p>积分是导数的逆运算，用于计算曲线下的面积和累积量。</p>
                        <div class="concept-cards">
                            <div class="concept-card">
                                <h4>几何意义</h4>
                                <p>定积分表示函数图像与x轴之间的有向面积。</p>
                            </div>
                            <div class="concept-card">
                                <h4>物理意义</h4>
                                <p>速度的积分是位移，加速度的积分是速度变化量。</p>
                            </div>
                            <div class="concept-card">
                                <h4>经济意义</h4>
                                <p>边际成本的积分是总成本增量，边际收益的积分是总收益增量。</p>
                            </div>
                            <div class="concept-card">
                                <h4>累积应用</h4>
                                <p>计算总量、平均值、概率等累积性质的问题。</p>
                            </div>
                        </div>
                    </div>

                    <!-- Interactive Demo -->
                    <div class="interactive-demo">
                        <h4>🎮 积分交互演示</h4>
                        <p>观察函数 f(x) = ax² + bx + c 在区间 [m, n] 上的定积分</p>
                        <div class="demo-controls">
                            <div class="demo-slider">
                                <label>系数 a:</label>
                                <input type="range" id="int-a" min="0.1" max="3" value="1" step="0.1" oninput="updateIntegralDemo()">
                                <div class="demo-value" id="int-value-a">1</div>
                            </div>
                            <div class="demo-slider">
                                <label>系数 b:</label>
                                <input type="range" id="int-b" min="-3" max="3" value="0" step="0.1" oninput="updateIntegralDemo()">
                                <div class="demo-value" id="int-value-b">0</div>
                            </div>
                            <div class="demo-slider">
                                <label>系数 c:</label>
                                <input type="range" id="int-c" min="-3" max="3" value="0" step="0.1" oninput="updateIntegralDemo()">
                                <div class="demo-value" id="int-value-c">0</div>
                            </div>
                            <div class="demo-slider">
                                <label>积分下限:</label>
                                <input type="range" id="int-lower" min="-3" max="1" value="-1" step="0.1" oninput="updateIntegralDemo()">
                                <div class="demo-value" id="int-value-lower">-1</div>
                            </div>
                            <div class="demo-slider">
                                <label>积分上限:</label>
                                <input type="range" id="int-upper" min="1" max="3" value="2" step="0.1" oninput="updateIntegralDemo()">
                                <div class="demo-value" id="int-value-upper">2</div>
                            </div>
                        </div>
                        <div class="visual-equation" id="int-function">f(x) = x²</div>
                        <div class="visual-equation" id="int-result">∫₋₁² x² dx = 3</div>
                        <div class="graph-container">
                            <div class="canvas-container">
                                <canvas id="integralCanvas"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Real World Examples -->
                    <div class="real-world-examples">
                        <h4>🌍 积分在生活中的应用</h4>
                        
                        <div class="example-scenario">
                            <div class="scenario-title">⚡ 电力消耗计算</div>
                            <div class="scenario-description">
                                某工厂的功率消耗函数为 P(t) = 100 + 50sin(πt/12)，其中 t 是时间（小时），P 是功率（千瓦）。
                            </div>
                            <div class="scenario-math">
                                24小时总耗电量：∫₀²⁴ P(t) dt = ∫₀²⁴ (100 + 50sin(πt/12)) dt<br>
                                = [100t - (600/π)cos(πt/12)]₀²⁴ = 2400 千瓦时
                            </div>
                            <div class="scenario-result">
                                应用：计算总电力消耗，制定用电计划和成本预算。
                            </div>
                        </div>

                        <div class="example-scenario">
                            <div class="scenario-title">🌊 水流量计算</div>
                            <div class="scenario-description">
                                河流的流速函数为 v(x) = 4 - x²/25，其中 x 是距离河岸的距离（米），河宽为10米。
                            </div>
                            <div class="scenario-math">
                                总流量：Q = ∫₀¹⁰ v(x) dx = ∫₀¹⁰ (4 - x²/25) dx<br>
                                = [4x - x³/75]₀¹⁰ = 40 - 1000/75 ≈ 26.67 立方米/秒
                            </div>
                            <div class="scenario-result">
                                应用：水利工程设计、洪水预警、水资源管理。
                            </div>
                        </div>

                        <div class="example-scenario">
                            <div class="scenario-title">📈 投资收益累积</div>
                            <div class="scenario-description">
                                某投资的收益率函数为 r(t) = 0.05 + 0.02t，其中 t 是投资年数。
                            </div>
                            <div class="scenario-math">
                                5年总收益率：∫₀⁵ r(t) dt = ∫₀⁵ (0.05 + 0.02t) dt<br>
                                = [0.05t + 0.01t²]₀⁵ = 0.25 + 0.25 = 0.5 (50%)
                            </div>
                            <div class="scenario-result">
                                应用：投资规划、风险评估、财务预测。
                            </div>
                        </div>
                    </div>

                    <!-- Tips Section -->
                    <div class="tips-section">
                        <h4>💡 积分学习技巧</h4>
                        <div class="tip-item">
                            <div class="tip-icon">1</div>
                            <div>理解积分的几何意义：面积的累积</div>
                        </div>
                        <div class="tip-item">
                            <div class="tip-icon">2</div>
                            <div>掌握基本积分公式：幂函数、三角函数、指数函数的积分</div>
                        </div>
                        <div class="tip-item">
                            <div class="tip-icon">3</div>
                            <div>学会换元积分法和分部积分法</div>
                        </div>
                        <div class="tip-item">
                            <div class="tip-icon">4</div>
                            <div>理解定积分与不定积分的区别和联系</div>
                        </div>
                        <div class="tip-item">
                            <div class="tip-icon">5</div>
                            <div>应用积分解决实际问题：面积、体积、物理量计算</div>
                        </div>
                    </div>
                </div>

                <!-- 实际应用 -->
                <div class="tool-section" id="applications">
                    <h3>微积分在各行业的实际应用</h3>
                    
                    <div class="learning-section">
                        <h3>🌟 微积分改变世界</h3>
                        <p>微积分不仅是数学工具，更是现代科技和工业发展的基石。从手机到火箭，从经济预测到医学诊断，微积分无处不在。</p>
                    </div>

                    <div class="application-grid">
                        <div class="application-card">
                            <div class="application-icon">🚀</div>
                            <div class="application-title">航空航天工程</div>
                            <div class="application-description">
                                <strong>轨道计算：</strong>使用微分方程计算卫星轨道和火箭发射轨迹。<br>
                                <strong>燃料优化：</strong>通过积分计算最优燃料消耗策略。<br>
                                <strong>实例：</strong>SpaceX使用微积分优化火箭回收着陆轨迹。
                            </div>
                        </div>

                        <div class="application-card">
                            <div class="application-icon">🏥</div>
                            <div class="application-title">医学与生物学</div>
                            <div class="application-description">
                                <strong>药物浓度：</strong>用微分方程模拟药物在体内的代谢过程。<br>
                                <strong>心电图分析：</strong>通过导数分析心率变化。<br>
                                <strong>实例：</strong>胰岛素泵使用微积分控制血糖水平。
                            </div>
                        </div>

                        <div class="application-card">
                            <div class="application-icon">💹</div>
                            <div class="application-title">金融与经济</div>
                            <div class="application-description">
                                <strong>期权定价：</strong>Black-Scholes模型使用偏微分方程。<br>
                                <strong>风险管理：</strong>通过积分计算投资组合风险。<br>
                                <strong>实例：</strong>高频交易算法使用微积分预测价格变化。
                            </div>
                        </div>

                        <div class="application-card">
                            <div class="application-icon">🤖</div>
                            <div class="application-title">人工智能</div>
                            <div class="application-description">
                                <strong>神经网络：</strong>反向传播算法基于链式法则。<br>
                                <strong>优化算法：</strong>梯度下降使用导数寻找最优解。<br>
                                <strong>实例：</strong>ChatGPT的训练过程大量使用微积分优化。
                            </div>
                        </div>

                        <div class="application-card">
                            <div class="application-icon">🏗️</div>
                            <div class="application-title">建筑与工程</div>
                            <div class="application-description">
                                <strong>结构分析：</strong>使用微分方程分析建筑物受力。<br>
                                <strong>材料优化：</strong>通过积分计算最优材料分布。<br>
                                <strong>实例：</strong>桥梁设计中的悬索曲线计算。
                            </div>
                        </div>

                        <div class="application-card">
                            <div class="application-icon">🌍</div>
                            <div class="application-title">环境科学</div>
                            <div class="application-description">
                                <strong>污染扩散：</strong>用微分方程模拟污染物传播。<br>
                                <strong>气候建模：</strong>通过积分计算全球温度变化。<br>
                                <strong>实例：</strong>碳排放量的累积计算和预测。
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Case Studies -->
                    <div class="real-world-examples">
                        <h4>📋 详细案例分析</h4>
                        
                        <div class="example-scenario">
                            <div class="scenario-title">📱 智能手机电池优化</div>
                            <div class="scenario-description">
                                现代智能手机使用微积分优化电池使用效率。电池电量消耗函数为 P(t) = P₀e^(-kt)，其中 k 取决于使用强度。
                            </div>
                            <div class="scenario-math">
                                剩余电量：Q(t) = ∫₀ᵗ P(τ) dτ = P₀/k (1 - e^(-kt))<br>
                                优化策略：通过调整 k 值（降低CPU频率、调暗屏幕）延长使用时间
                            </div>
                            <div class="scenario-result">
                                实际应用：iPhone的低电量模式、Android的自适应电池管理都基于这些数学模型。
                            </div>
                        </div>

                        <div class="example-scenario">
                            <div class="scenario-title">🚗 自动驾驶汽车</div>
                            <div class="scenario-description">
                                自动驾驶汽车需要实时计算最优行驶路径。路径规划使用变分法（微积分的高级应用）。
                            </div>
                            <div class="scenario-math">
                                最优路径：最小化 ∫ᵗ¹ᵗ² [½m(dx/dt)² + V(x)] dt<br>
                                其中 V(x) 是势能函数，包含障碍物、交通规则等约束
                            </div>
                            <div class="scenario-result">
                                实际应用：特斯拉Autopilot、百度Apollo等自动驾驶系统的核心算法。
                            </div>
                        </div>

                        <div class="example-scenario">
                            <div class="scenario-title">🎬 电影特效制作</div>
                            <div class="scenario-description">
                                电影中的水流、爆炸、烟雾等特效都使用流体力学方程（Navier-Stokes方程）模拟。
                            </div>
                            <div class="scenario-math">
                                流体运动：∂v/∂t + (v·∇)v = -∇p/ρ + ν∇²v<br>
                                通过数值积分求解，生成逼真的流体动画
                            </div>
                            <div class="scenario-result">
                                实际应用：《阿凡达》的海洋场景、《复仇者联盟》的爆炸特效都依赖这些计算。
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 交互式探索 -->
                <div class="tool-section" id="interactive">
                    <h3>交互式微积分探索</h3>
                    
                    <div class="learning-section">
                        <h3>🎮 动手实践</h3>
                        <p>通过交互式工具深入理解微积分概念，自己动手探索数学的奥秘。</p>
                    </div>

                    <!-- Function Explorer -->
                    <div class="interactive-demo">
                        <h4>🔍 函数探索器</h4>
                        <p>输入自定义函数，观察其导数和积分</p>
                        
                        <div class="input-group">
                            <label for="custom-function">输入函数 f(x) (支持: x^2, sin(x), cos(x), exp(x), log(x))</label>
                            <input type="text" id="custom-function" class="input-field" placeholder="x^2 + 2*x + 1" value="x^2">
                        </div>
                        
                        <div class="demo-controls">
                            <button class="btn btn-primary" onclick="plotCustomFunction()">
                                📈 绘制函数
                            </button>
                            <button class="btn btn-secondary" onclick="showDerivative()">
                                📊 显示导数
                            </button>
                            <button class="btn btn-secondary" onclick="showIntegral()">
                                📋 计算积分
                            </button>
                        </div>
                        
                        <div class="graph-container">
                            <div class="canvas-container">
                                <canvas id="explorerCanvas"></canvas>
                            </div>
                        </div>
                        
                        <div id="function-info" class="visual-equation">
                            输入函数开始探索
                        </div>
                    </div>

                    <!-- Optimization Problem Solver -->
                    <div class="interactive-demo">
                        <h4>🎯 优化问题求解器</h4>
                        <p>解决实际的最优化问题</p>
                        
                        <div class="input-group">
                            <label for="optimization-problem">选择优化问题类型</label>
                            <select id="optimization-problem" class="input-field" onchange="loadOptimizationProblem()">
                                <option value="box">纸盒最大体积问题</option>
                                <option value="fence">围栏最大面积问题</option>
                                <option value="profit">利润最大化问题</option>
                                <option value="distance">最短距离问题</option>
                                <option value="custom">自定义优化问题</option>
                            </select>
                        </div>
                        
                        <div id="problem-description" class="scenario-description">
                            选择一个问题类型查看详细描述
                        </div>
                        
                        <div class="demo-controls">
                            <button class="btn btn-primary" onclick="solveOptimization()">
                                🧮 求解
                            </button>
                            <button class="btn btn-secondary" onclick="showOptimizationSteps()">
                                📝 显示步骤
                            </button>
                        </div>
                        
                        <div id="optimization-result" class="visual-equation">
                            点击求解按钮开始计算
                        </div>
                        
                        <div class="graph-container">
                            <div class="canvas-container">
                                <canvas id="optimizationCanvas"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Calculus Calculator -->
                    <div class="interactive-demo">
                        <h4>🧮 微积分计算器</h4>
                        <p>计算导数和定积分，支持符号计算和数值计算</p>
                        
                        <div class="input-group">
                            <label for="calc-function">函数 f(x)</label>
                            <input type="text" id="calc-function" class="input-field" placeholder="x^3 + 2*x^2 - x + 1" value="x^2">
                            <small style="color: #666; margin-top: 0.5rem; display: block;">
                                支持: x^n, sin(x), cos(x), tan(x), exp(x), ln(x), sqrt(x), abs(x) 等
                            </small>
                        </div>
                        
                        <div class="demo-controls" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <h5 style="margin-bottom: 1rem; color: #007bff;">📈 导数计算</h5>
                                <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <button class="btn btn-primary" onclick="calculateDerivative()" style="flex: 1;">
                                        计算导数
                                    </button>
                                    <button class="btn btn-secondary" onclick="evaluateDerivativeAtPoint()" style="flex: 1;">
                                        特定点导数
                                    </button>
                                </div>
                                <div id="derivative-result" class="visual-equation" style="font-size: 0.9rem; padding: 0.8rem; min-height: 120px;">
                                    导数结果将显示在这里
                                </div>
                            </div>
                            
                            <div>
                                <h5 style="margin-bottom: 1rem; color: #28a745;">📊 积分计算</h5>
                                <div class="input-group" style="margin-bottom: 0.5rem;">
                                    <label>定积分区间</label>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <input type="number" id="integral-lower" class="input-field" placeholder="下限" value="0" style="flex: 1;">
                                        <input type="number" id="integral-upper" class="input-field" placeholder="上限" value="2" style="flex: 1;">
                                    </div>
                                </div>
                                <button class="btn btn-primary" onclick="calculateIntegral()" style="width: 100%; margin-bottom: 0.5rem;">
                                    计算定积分
                                </button>
                                <div id="integral-result" class="visual-equation" style="font-size: 0.9rem; padding: 0.8rem; min-height: 120px;">
                                    积分结果将显示在这里
                                </div>
                            </div>
                        </div>
                        
                        <!-- Quick Examples -->
                        <div style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                            <h6 style="margin-bottom: 0.5rem; color: #495057;">🚀 快速示例 (点击填入):</h6>
                            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                <button class="btn" style="background: #e9ecef; color: #495057; padding: 0.3rem 0.6rem; font-size: 0.8rem;" 
                                        onclick="document.getElementById('calc-function').value = 'x^3 - 3*x^2 + 2*x'">
                                    x³ - 3x² + 2x
                                </button>
                                <button class="btn" style="background: #e9ecef; color: #495057; padding: 0.3rem 0.6rem; font-size: 0.8rem;" 
                                        onclick="document.getElementById('calc-function').value = 'sin(x) + cos(x)'">
                                    sin(x) + cos(x)
                                </button>
                                <button class="btn" style="background: #e9ecef; color: #495057; padding: 0.3rem 0.6rem; font-size: 0.8rem;" 
                                        onclick="document.getElementById('calc-function').value = 'exp(x) - x^2'">
                                    e^x - x²
                                </button>
                                <button class="btn" style="background: #e9ecef; color: #495057; padding: 0.3rem 0.6rem; font-size: 0.8rem;" 
                                        onclick="document.getElementById('calc-function').value = 'ln(x) + sqrt(x)'">
                                    ln(x) + √x
                                </button>
                                <button class="btn" style="background: #e9ecef; color: #495057; padding: 0.3rem 0.6rem; font-size: 0.8rem;" 
                                        onclick="document.getElementById('calc-function').value = '1/(1+x^2)'">
                                    1/(1+x²)
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Tips for Interactive Learning -->
                    <div class="tips-section">
                        <h4>💡 交互学习建议</h4>
                        <div class="tip-item">
                            <div class="tip-icon">1</div>
                            <div>从简单函数开始：先尝试 x², x³ 等基本函数</div>
                        </div>
                        <div class="tip-item">
                            <div class="tip-icon">2</div>
                            <div>观察图像变化：调整参数时注意函数形状的改变</div>
                        </div>
                        <div class="tip-item">
                            <div class="tip-icon">3</div>
                            <div>验证计算结果：用已知公式检验计算器的结果</div>
                        </div>
                        <div class="tip-item">
                            <div class="tip-icon">4</div>
                            <div>联系实际问题：思考这些数学概念在现实中的应用</div>
                        </div>
                        <div class="tip-item">
                            <div class="tip-icon">5</div>
                            <div>多做练习：通过不同类型的问题加深理解</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching functionality
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // Remove active class from all tabs and sections
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tool-section').forEach(s => s.classList.remove('active'));
                
                // Add active class to clicked tab
                btn.classList.add('active');
                
                // Show corresponding section
                const tabId = btn.dataset.tab;
                document.getElementById(tabId).classList.add('active');
            });
        });

        // Canvas setup and drawing functions
        function setupCanvas(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return null;
            
            const ctx = canvas.getContext('2d');
            const container = canvas.parentElement;
            
            // Set canvas size
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            
            return { canvas, ctx };
        }

        function drawAxes(ctx, width, height) {
            const centerX = width / 2;
            const centerY = height / 2;
            
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            
            // Draw axes
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(width, centerY);
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, height);
            ctx.stroke();
            
            // Draw grid
            ctx.strokeStyle = '#f0f0f0';
            ctx.lineWidth = 0.5;
            
            for (let i = 0; i < width; i += 20) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, height);
                ctx.stroke();
            }
            
            for (let i = 0; i < height; i += 20) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(width, i);
                ctx.stroke();
            }
        }

        function plotFunction(ctx, width, height, func, color = '#007bff', lineWidth = 2) {
            const centerX = width / 2;
            const centerY = height / 2;
            const scale = 20; // pixels per unit
            
            ctx.strokeStyle = color;
            ctx.lineWidth = lineWidth;
            ctx.beginPath();
            
            let firstPoint = true;
            for (let px = 0; px < width; px += 1) {
                const x = (px - centerX) / scale;
                try {
                    const y = func(x);
                    const py = centerY - y * scale;
                    
                    if (isFinite(y) && py >= 0 && py <= height) {
                        if (firstPoint) {
                            ctx.moveTo(px, py);
                            firstPoint = false;
                        } else {
                            ctx.lineTo(px, py);
                        }
                    } else {
                        firstPoint = true;
                    }
                } catch (e) {
                    firstPoint = true;
                }
            }
            ctx.stroke();
        }

        // Derivative demo functions
        function updateDerivativeDemo() {
            const a = parseFloat(document.getElementById('deriv-a').value);
            const b = parseFloat(document.getElementById('deriv-b').value);
            const c = parseFloat(document.getElementById('deriv-c').value);
            const d = parseFloat(document.getElementById('deriv-d').value);
            
            // Update value displays
            document.getElementById('deriv-value-a').textContent = a;
            document.getElementById('deriv-value-b').textContent = b;
            document.getElementById('deriv-value-c').textContent = c;
            document.getElementById('deriv-value-d').textContent = d;
            
            // Update function display
            let funcStr = '';
            if (a !== 0) funcStr += `${a}x³`;
            if (b !== 0) funcStr += (funcStr ? (b > 0 ? ' + ' : ' - ') : (b < 0 ? '-' : '')) + `${Math.abs(b)}x²`;
            if (c !== 0) funcStr += (funcStr ? (c > 0 ? ' + ' : ' - ') : (c < 0 ? '-' : '')) + `${Math.abs(c)}x`;
            if (d !== 0) funcStr += (funcStr ? (d > 0 ? ' + ' : ' - ') : (d < 0 ? '-' : '')) + `${Math.abs(d)}`;
            if (!funcStr) funcStr = '0';
            
            document.getElementById('deriv-function').textContent = `f(x) = ${funcStr}`;
            
            // Update derivative display
            let derivStr = '';
            if (a !== 0) derivStr += `${3*a}x²`;
            if (b !== 0) derivStr += (derivStr ? (2*b > 0 ? ' + ' : ' - ') : (2*b < 0 ? '-' : '')) + `${Math.abs(2*b)}x`;
            if (c !== 0) derivStr += (derivStr ? (c > 0 ? ' + ' : ' - ') : (c < 0 ? '-' : '')) + `${Math.abs(c)}`;
            if (!derivStr) derivStr = '0';
            
            document.getElementById('deriv-derivative').textContent = `f'(x) = ${derivStr}`;
            
            // Draw the graph
            const setup = setupCanvas('derivativeCanvas');
            if (!setup) return;
            
            const { ctx, canvas } = setup;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawAxes(ctx, canvas.width, canvas.height);
            
            // Plot original function
            plotFunction(ctx, canvas.width, canvas.height, 
                x => a*x*x*x + b*x*x + c*x + d, '#007bff', 3);
            
            // Plot derivative
            plotFunction(ctx, canvas.width, canvas.height, 
                x => 3*a*x*x + 2*b*x + c, '#dc3545', 2);
            
            // Add legend
            ctx.fillStyle = '#007bff';
            ctx.font = '14px Arial';
            ctx.fillText('f(x)', 10, 20);
            ctx.fillStyle = '#dc3545';
            ctx.fillText("f'(x)", 10, 40);
        }

        // Integral demo functions
        function updateIntegralDemo() {
            const a = parseFloat(document.getElementById('int-a').value);
            const b = parseFloat(document.getElementById('int-b').value);
            const c = parseFloat(document.getElementById('int-c').value);
            const lower = parseFloat(document.getElementById('int-lower').value);
            const upper = parseFloat(document.getElementById('int-upper').value);
            
            // Update value displays
            document.getElementById('int-value-a').textContent = a;
            document.getElementById('int-value-b').textContent = b;
            document.getElementById('int-value-c').textContent = c;
            document.getElementById('int-value-lower').textContent = lower;
            document.getElementById('int-value-upper').textContent = upper;
            
            // Update function display
            let funcStr = '';
            if (a !== 0) funcStr += `${a}x²`;
            if (b !== 0) funcStr += (funcStr ? (b > 0 ? ' + ' : ' - ') : (b < 0 ? '-' : '')) + `${Math.abs(b)}x`;
            if (c !== 0) funcStr += (funcStr ? (c > 0 ? ' + ' : ' - ') : (c < 0 ? '-' : '')) + `${Math.abs(c)}`;
            if (!funcStr) funcStr = '0';
            
            document.getElementById('int-function').textContent = `f(x) = ${funcStr}`;
            
            // Calculate integral
            const integral = (a/3) * (upper*upper*upper - lower*lower*lower) + 
                           (b/2) * (upper*upper - lower*lower) + 
                           c * (upper - lower);
            
            document.getElementById('int-result').textContent = 
                `∫${lower}${upper} (${funcStr}) dx = ${integral.toFixed(3)}`;
            
            // Draw the graph
            const setup = setupCanvas('integralCanvas');
            if (!setup) return;
            
            const { ctx, canvas } = setup;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawAxes(ctx, canvas.width, canvas.height);
            
            // Plot function
            plotFunction(ctx, canvas.width, canvas.height, 
                x => a*x*x + b*x + c, '#007bff', 3);
            
            // Fill area under curve
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const scale = 20;
            
            ctx.fillStyle = 'rgba(0, 123, 255, 0.3)';
            ctx.beginPath();
            
            const lowerPx = centerX + lower * scale;
            const upperPx = centerX + upper * scale;
            
            ctx.moveTo(lowerPx, centerY);
            for (let px = lowerPx; px <= upperPx; px += 1) {
                const x = (px - centerX) / scale;
                const y = a*x*x + b*x + c;
                const py = centerY - y * scale;
                ctx.lineTo(px, py);
            }
            ctx.lineTo(upperPx, centerY);
            ctx.closePath();
            ctx.fill();
            
            // Draw integration bounds
            ctx.strokeStyle = '#dc3545';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            
            ctx.beginPath();
            ctx.moveTo(lowerPx, 0);
            ctx.lineTo(lowerPx, canvas.height);
            ctx.moveTo(upperPx, 0);
            ctx.lineTo(upperPx, canvas.height);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        // Enhanced function parser and evaluator
        class MathParser {
            constructor() {
                this.functions = {
                    'sin': Math.sin,
                    'cos': Math.cos,
                    'tan': Math.tan,
                    'exp': Math.exp,
                    'log': Math.log,
                    'ln': Math.log,
                    'sqrt': Math.sqrt,
                    'abs': Math.abs,
                    'floor': Math.floor,
                    'ceil': Math.ceil,
                    'round': Math.round
                };
            }

            parseFunction(expression) {
                // Clean and prepare expression
                let expr = expression.toLowerCase()
                    .replace(/\s+/g, '')
                    .replace(/\^/g, '**')
                    .replace(/(\d)([a-z])/g, '$1*$2')
                    .replace(/([a-z])(\d)/g, '$1*$2')
                    .replace(/(\))(\()/g, '$1*$2')
                    .replace(/(\d)(\()/g, '$1*$2')
                    .replace(/(\))(\d)/g, '$1*$2');

                // Replace function names
                Object.keys(this.functions).forEach(func => {
                    const regex = new RegExp(`\\b${func}\\b`, 'g');
                    expr = expr.replace(regex, `Math.${func}`);
                });

                // Replace constants
                expr = expr.replace(/\be\b/g, 'Math.E')
                          .replace(/\bpi\b/g, 'Math.PI');

                return new Function('x', `
                    try {
                        return ${expr};
                    } catch (e) {
                        return NaN;
                    }
                `);
            }

            // Numerical derivative calculation
            derivative(func, x, h = 0.0001) {
                return (func(x + h) - func(x - h)) / (2 * h);
            }

            // Numerical integration using Simpson's rule
            integrate(func, a, b, n = 1000) {
                if (n % 2 === 1) n++;
                const h = (b - a) / n;
                let sum = func(a) + func(b);
                
                for (let i = 1; i < n; i++) {
                    const x = a + i * h;
                    sum += (i % 2 === 0 ? 2 : 4) * func(x);
                }
                
                return (h / 3) * sum;
            }

            // Symbolic derivative for common functions
            getSymbolicDerivative(expression) {
                const expr = expression.toLowerCase().replace(/\s+/g, '');
                
                // Simple polynomial derivatives
                if (/^[\d\.\-\+\*x\^]+$/.test(expr)) {
                    return this.polynomialDerivative(expr);
                }
                
                // Trigonometric functions
                if (expr.includes('sin(x)')) return expr.replace(/sin\(x\)/g, 'cos(x)');
                if (expr.includes('cos(x)')) return expr.replace(/cos\(x\)/g, '-sin(x)');
                if (expr.includes('tan(x)')) return expr.replace(/tan\(x\)/g, 'sec²(x)');
                
                // Exponential and logarithmic
                if (expr.includes('exp(x)') || expr.includes('e^x')) return 'exp(x)';
                if (expr.includes('ln(x)') || expr.includes('log(x)')) return '1/x';
                
                return '数值导数';
            }

            polynomialDerivative(expr) {
                // Handle simple polynomials like x^3, 2*x^2, etc.
                return expr.replace(/(\d*)\*?x\^(\d+)/g, (match, coeff, power) => {
                    const c = coeff === '' ? 1 : parseFloat(coeff);
                    const p = parseInt(power);
                    if (p === 1) return c.toString();
                    return `${c * p}*x^${p - 1}`;
                }).replace(/(\d*)\*?x(?!\^)/g, (match, coeff) => {
                    const c = coeff === '' ? 1 : parseFloat(coeff);
                    return c.toString();
                }).replace(/^\d+$/, '0');
            }
        }

        const mathParser = new MathParser();
        let currentFunction = null;

        // Interactive functions
        function plotCustomFunction() {
            const funcStr = document.getElementById('custom-function').value;
            const info = document.getElementById('function-info');
            
            if (!funcStr.trim()) {
                info.textContent = '请输入一个函数';
                return;
            }
            
            try {
                currentFunction = mathParser.parseFunction(funcStr);
                
                const setup = setupCanvas('explorerCanvas');
                if (!setup) return;
                
                const { ctx, canvas } = setup;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawAxes(ctx, canvas.width, canvas.height);
                
                // Plot original function
                plotFunction(ctx, canvas.width, canvas.height, currentFunction, '#007bff', 3);
                
                // Add function label
                ctx.fillStyle = '#007bff';
                ctx.font = 'bold 14px Arial';
                ctx.fillText(`f(x) = ${funcStr}`, 10, 25);
                
                info.innerHTML = `
                    <strong>函数已绘制:</strong> f(x) = ${funcStr}<br>
                    <small>支持的函数: sin, cos, tan, exp, ln, sqrt, abs 等</small>
                `;
            } catch (e) {
                info.innerHTML = `
                    <span style="color: #dc3545;">函数格式错误:</span> ${e.message}<br>
                    <small>示例: x^2, sin(x), exp(x), 2*x^3 + x - 1</small>
                `;
            }
        }

        function showDerivative() {
            if (!currentFunction) {
                document.getElementById('function-info').innerHTML = 
                    '<span style="color: #dc3545;">请先绘制一个函数</span>';
                return;
            }

            const funcStr = document.getElementById('custom-function').value;
            const info = document.getElementById('function-info');
            
            try {
                const setup = setupCanvas('explorerCanvas');
                if (!setup) return;
                
                const { ctx, canvas } = setup;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawAxes(ctx, canvas.width, canvas.height);
                
                // Plot original function
                plotFunction(ctx, canvas.width, canvas.height, currentFunction, '#007bff', 3);
                
                // Plot derivative
                const derivativeFunc = (x) => mathParser.derivative(currentFunction, x);
                plotFunction(ctx, canvas.width, canvas.height, derivativeFunc, '#dc3545', 2);
                
                // Add labels
                ctx.fillStyle = '#007bff';
                ctx.font = 'bold 14px Arial';
                ctx.fillText(`f(x) = ${funcStr}`, 10, 25);
                ctx.fillStyle = '#dc3545';
                ctx.fillText(`f'(x) (导数)`, 10, 45);
                
                const symbolicDeriv = mathParser.getSymbolicDerivative(funcStr);
                info.innerHTML = `
                    <strong>原函数:</strong> f(x) = ${funcStr}<br>
                    <strong>导数:</strong> f'(x) = ${symbolicDeriv}<br>
                    <small>蓝线: 原函数, 红线: 导数</small>
                `;
            } catch (e) {
                info.innerHTML = `<span style="color: #dc3545;">计算导数时出错: ${e.message}</span>`;
            }
        }

        function showIntegral() {
            if (!currentFunction) {
                document.getElementById('function-info').innerHTML = 
                    '<span style="color: #dc3545;">请先绘制一个函数</span>';
                return;
            }

            const funcStr = document.getElementById('custom-function').value;
            const info = document.getElementById('function-info');
            
            try {
                const setup = setupCanvas('explorerCanvas');
                if (!setup) return;
                
                const { ctx, canvas } = setup;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawAxes(ctx, canvas.width, canvas.height);
                
                // Plot function
                plotFunction(ctx, canvas.width, canvas.height, currentFunction, '#007bff', 3);
                
                // Fill area under curve (from -2 to 2)
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const scale = 20;
                const lowerBound = -2;
                const upperBound = 2;
                
                ctx.fillStyle = 'rgba(0, 123, 255, 0.3)';
                ctx.beginPath();
                
                const lowerPx = centerX + lowerBound * scale;
                const upperPx = centerX + upperBound * scale;
                
                ctx.moveTo(lowerPx, centerY);
                for (let px = lowerPx; px <= upperPx; px += 2) {
                    const x = (px - centerX) / scale;
                    const y = currentFunction(x);
                    if (isFinite(y)) {
                        const py = centerY - y * scale;
                        ctx.lineTo(px, py);
                    }
                }
                ctx.lineTo(upperPx, centerY);
                ctx.closePath();
                ctx.fill();
                
                // Calculate integral
                const integralValue = mathParser.integrate(currentFunction, lowerBound, upperBound);
                
                // Add labels
                ctx.fillStyle = '#007bff';
                ctx.font = 'bold 14px Arial';
                ctx.fillText(`f(x) = ${funcStr}`, 10, 25);
                ctx.fillStyle = '#28a745';
                ctx.fillText(`∫₋₂² f(x)dx ≈ ${integralValue.toFixed(4)}`, 10, 45);
                
                info.innerHTML = `
                    <strong>函数:</strong> f(x) = ${funcStr}<br>
                    <strong>定积分:</strong> ∫₋₂² f(x)dx ≈ ${integralValue.toFixed(4)}<br>
                    <small>蓝色区域表示积分面积</small>
                `;
            } catch (e) {
                info.innerHTML = `<span style="color: #dc3545;">计算积分时出错: ${e.message}</span>`;
            }
        }

        // Enhanced optimization solver
        class OptimizationSolver {
            constructor() {
                this.predefinedProblems = {
                    box: {
                        title: '纸盒最大体积问题',
                        description: '从边长为20cm的正方形纸片四角切去边长为x的小正方形，然后折成无盖纸盒。求x为多少时体积最大？',
                        func: 'x*(20-2*x)^2',
                        domain: [0, 10],
                        variable: 'x',
                        unit: 'cm',
                        type: 'maximize'
                    },
                    fence: {
                        title: '围栏最大面积问题',
                        description: '用100米长的篱笆围成矩形菜园，一边靠墙不需要篱笆。求矩形的长和宽各为多少时面积最大？',
                        func: 'x*(100-2*x)',
                        domain: [0, 50],
                        variable: 'x',
                        unit: '米',
                        type: 'maximize'
                    },
                    profit: {
                        title: '利润最大化问题',
                        description: '某公司生产产品的成本函数为C(x) = 100 + 2x + 0.01x²，售价为每件10元。求产量为多少时利润最大？',
                        func: '8*x - 100 - 0.01*x^2',
                        domain: [0, 800],
                        variable: 'x',
                        unit: '件',
                        type: 'maximize'
                    },
                    distance: {
                        title: '最短距离问题',
                        description: '点P(3,4)到直线y = x的最短距离是多少？',
                        func: 'sqrt((x-3)^2 + (x-4)^2)',
                        domain: [0, 8],
                        variable: 'x',
                        unit: '',
                        type: 'minimize'
                    },
                    custom: {
                        title: '自定义优化问题',
                        description: '输入您自己的函数进行优化分析',
                        func: '',
                        domain: [-10, 10],
                        variable: 'x',
                        unit: '',
                        type: 'maximize'
                    }
                };
            }

            // Find critical points using numerical methods
            findCriticalPoints(func, domain, step = 0.01) {
                const [a, b] = domain;
                const criticalPoints = [];
                
                for (let x = a + step; x < b - step; x += step) {
                    const derivative = mathParser.derivative(func, x);
                    const prevDerivative = mathParser.derivative(func, x - step);
                    
                    // Check for sign change in derivative (critical point)
                    if (Math.sign(derivative) !== Math.sign(prevDerivative)) {
                        criticalPoints.push({
                            x: x,
                            y: func(x),
                            type: derivative > prevDerivative ? 'minimum' : 'maximum'
                        });
                    }
                }
                
                // Add endpoints
                criticalPoints.push(
                    { x: a, y: func(a), type: 'endpoint' },
                    { x: b, y: func(b), type: 'endpoint' }
                );
                
                return criticalPoints;
            }

            // Visualize optimization problem
            visualizeOptimization(func, domain, criticalPoints, canvasId) {
                const setup = setupCanvas(canvasId);
                if (!setup) return;
                
                const { ctx, canvas } = setup;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawAxes(ctx, canvas.width, canvas.height);
                
                // Plot function
                plotFunction(ctx, canvas.width, canvas.height, func, '#007bff', 3);
                
                // Mark critical points
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const scale = Math.min(canvas.width, canvas.height) / (domain[1] - domain[0] + 4);
                
                criticalPoints.forEach(point => {
                    const px = centerX + (point.x - (domain[0] + domain[1]) / 2) * scale;
                    const py = centerY - point.y * scale;
                    
                    if (px >= 0 && px <= canvas.width && py >= 0 && py <= canvas.height) {
                        ctx.fillStyle = point.type === 'maximum' ? '#28a745' : 
                                       point.type === 'minimum' ? '#dc3545' : '#ffc107';
                        ctx.beginPath();
                        ctx.arc(px, py, 6, 0, 2 * Math.PI);
                        ctx.fill();
                        
                        // Add label
                        ctx.fillStyle = '#000';
                        ctx.font = '12px Arial';
                        ctx.fillText(`(${point.x.toFixed(2)}, ${point.y.toFixed(2)})`, px + 10, py - 10);
                    }
                });
                
                // Add legend
                ctx.fillStyle = '#007bff';
                ctx.font = 'bold 14px Arial';
                ctx.fillText('函数图像', 10, 25);
                ctx.fillStyle = '#28a745';
                ctx.fillText('● 最大值', 10, 45);
                ctx.fillStyle = '#dc3545';
                ctx.fillText('● 最小值', 10, 65);
                ctx.fillStyle = '#ffc107';
                ctx.fillText('● 端点', 10, 85);
            }
        }

        const optimizationSolver = new OptimizationSolver();
        let currentOptimizationFunc = null;

        function loadOptimizationProblem() {
            const problemType = document.getElementById('optimization-problem').value;
            const problem = optimizationSolver.predefinedProblems[problemType];
            
            document.getElementById('problem-description').textContent = problem.description;
            document.getElementById('optimization-result').textContent = '点击求解按钮开始计算';
            
            // Show custom input fields for custom problems
            const customInputs = document.getElementById('custom-optimization-inputs');
            if (problemType === 'custom') {
                if (!customInputs) {
                    const inputsHtml = `
                        <div id="custom-optimization-inputs" style="margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                            <div class="input-group">
                                <label for="custom-opt-function">目标函数 f(x):</label>
                                <input type="text" id="custom-opt-function" class="input-field" placeholder="x^2 - 4*x + 3" value="x^2 - 4*x + 3">
                            </div>
                            <div style="display: flex; gap: 1rem;">
                                <div class="input-group" style="flex: 1;">
                                    <label for="custom-opt-min">定义域最小值:</label>
                                    <input type="number" id="custom-opt-min" class="input-field" value="-5">
                                </div>
                                <div class="input-group" style="flex: 1;">
                                    <label for="custom-opt-max">定义域最大值:</label>
                                    <input type="number" id="custom-opt-max" class="input-field" value="5">
                                </div>
                            </div>
                            <div class="input-group">
                                <label for="custom-opt-type">优化类型:</label>
                                <select id="custom-opt-type" class="input-field">
                                    <option value="maximize">求最大值</option>
                                    <option value="minimize">求最小值</option>
                                    <option value="both">求极值</option>
                                </select>
                            </div>
                        </div>
                    `;
                    document.getElementById('problem-description').insertAdjacentHTML('afterend', inputsHtml);
                }
            } else {
                if (customInputs) {
                    customInputs.remove();
                }
            }
        }

        function solveOptimization() {
            const problemType = document.getElementById('optimization-problem').value;
            let problem = optimizationSolver.predefinedProblems[problemType];
            
            // Handle custom optimization
            if (problemType === 'custom') {
                const funcStr = document.getElementById('custom-opt-function').value;
                const minVal = parseFloat(document.getElementById('custom-opt-min').value);
                const maxVal = parseFloat(document.getElementById('custom-opt-max').value);
                const optType = document.getElementById('custom-opt-type').value;
                
                if (!funcStr.trim()) {
                    document.getElementById('optimization-result').innerHTML = 
                        '<span style="color: #dc3545;">请输入目标函数</span>';
                    return;
                }
                
                problem = {
                    title: '自定义优化问题',
                    func: funcStr,
                    domain: [minVal, maxVal],
                    type: optType
                };
            }
            
            try {
                currentOptimizationFunc = mathParser.parseFunction(problem.func);
                const criticalPoints = optimizationSolver.findCriticalPoints(
                    currentOptimizationFunc, 
                    problem.domain
                );
                
                // Find optimal points
                let optimal = null;
                if (problem.type === 'maximize' || problem.type === 'both') {
                    optimal = criticalPoints.reduce((max, point) => 
                        point.y > max.y ? point : max
                    );
                } else if (problem.type === 'minimize') {
                    optimal = criticalPoints.reduce((min, point) => 
                        point.y < min.y ? point : min
                    );
                }
                
                // Display results
                let resultHtml = `<strong>${problem.title}</strong><br>`;
                resultHtml += `<strong>目标函数:</strong> f(x) = ${problem.func}<br>`;
                resultHtml += `<strong>定义域:</strong> [${problem.domain[0]}, ${problem.domain[1]}]<br><br>`;
                
                if (problem.type === 'both') {
                    const maximum = criticalPoints.filter(p => p.type === 'maximum' || p.type === 'endpoint')
                        .reduce((max, point) => point.y > max.y ? point : max);
                    const minimum = criticalPoints.filter(p => p.type === 'minimum' || p.type === 'endpoint')
                        .reduce((min, point) => point.y < min.y ? point : min);
                    
                    resultHtml += `<strong>最大值:</strong> f(${maximum.x.toFixed(4)}) = ${maximum.y.toFixed(4)}<br>`;
                    resultHtml += `<strong>最小值:</strong> f(${minimum.x.toFixed(4)}) = ${minimum.y.toFixed(4)}<br>`;
                } else {
                    const optimalType = problem.type === 'maximize' ? '最大值' : '最小值';
                    resultHtml += `<strong>${optimalType}:</strong> f(${optimal.x.toFixed(4)}) = ${optimal.y.toFixed(4)}<br>`;
                }
                
                resultHtml += `<br><strong>所有关键点:</strong><br>`;
                criticalPoints.forEach(point => {
                    const typeText = point.type === 'maximum' ? '极大值' : 
                                   point.type === 'minimum' ? '极小值' : '端点';
                    resultHtml += `• ${typeText}: (${point.x.toFixed(4)}, ${point.y.toFixed(4)})<br>`;
                });
                
                document.getElementById('optimization-result').innerHTML = resultHtml;
                
                // Visualize
                optimizationSolver.visualizeOptimization(
                    currentOptimizationFunc, 
                    problem.domain, 
                    criticalPoints, 
                    'optimizationCanvas'
                );
                
            } catch (e) {
                document.getElementById('optimization-result').innerHTML = 
                    `<span style="color: #dc3545;">求解错误: ${e.message}</span>`;
            }
        }

        function showOptimizationSteps() {
            if (!currentOptimizationFunc) {
                document.getElementById('optimization-result').innerHTML += 
                    '<br><span style="color: #dc3545;">请先求解优化问题</span>';
                return;
            }
            
            const result = document.getElementById('optimization-result');
            result.innerHTML += `
                <br><br><strong>求解步骤:</strong><br>
                1. 对目标函数求导数<br>
                2. 令导数等于零，求解关键点<br>
                3. 检查定义域端点<br>
                4. 比较所有候选点的函数值<br>
                5. 确定最优解<br>
                <em>图像中的彩色点标示了所有关键点位置</em>
            `;
        }

        // Enhanced calculus calculator
        class CalculusCalculator {
            constructor() {
                this.derivativeRules = {
                    // Power rule: x^n -> n*x^(n-1)
                    power: (expr) => {
                        return expr.replace(/(\d*\.?\d*)\*?x\^(\d+\.?\d*)/g, (match, coeff, power) => {
                            const c = coeff === '' || coeff === '1' ? '' : (coeff === '-1' ? '-' : coeff);
                            const p = parseFloat(power);
                            const newCoeff = c === '' ? p : (c === '-' ? -p : parseFloat(c) * p);
                            const newPower = p - 1;
                            
                            if (newPower === 0) return newCoeff.toString();
                            if (newPower === 1) return `${newCoeff}x`;
                            return `${newCoeff}x^${newPower}`;
                        });
                    },
                    
                    // Trigonometric functions
                    trig: (expr) => {
                        return expr
                            .replace(/sin\(x\)/g, 'cos(x)')
                            .replace(/cos\(x\)/g, '-sin(x)')
                            .replace(/tan\(x\)/g, 'sec²(x)')
                            .replace(/sec\(x\)/g, 'sec(x)tan(x)')
                            .replace(/csc\(x\)/g, '-csc(x)cot(x)')
                            .replace(/cot\(x\)/g, '-csc²(x)');
                    },
                    
                    // Exponential and logarithmic
                    expLog: (expr) => {
                        return expr
                            .replace(/e\^x/g, 'e^x')
                            .replace(/exp\(x\)/g, 'exp(x)')
                            .replace(/ln\(x\)/g, '1/x')
                            .replace(/log\(x\)/g, '1/(x*ln(10))');
                    }
                };
            }

            // Symbolic derivative calculation
            calculateSymbolicDerivative(expression) {
                let expr = expression.toLowerCase().replace(/\s+/g, '');
                
                // Handle constants
                if (!/x/.test(expr)) {
                    return '0';
                }
                
                // Apply derivative rules
                expr = this.derivativeRules.power(expr);
                expr = this.derivativeRules.trig(expr);
                expr = this.derivativeRules.expLog(expr);
                
                // Handle linear terms
                expr = expr.replace(/(\d*\.?\d*)\*?x(?!\^)/g, (match, coeff) => {
                    return coeff === '' || coeff === '1' ? '1' : coeff;
                });
                
                // Clean up
                expr = expr.replace(/\+\s*0/g, '').replace(/^0\s*\+\s*/, '');
                
                return expr || '0';
            }

            // Numerical derivative at a point
            numericalDerivative(func, x, h = 0.0001) {
                try {
                    return (func(x + h) - func(x - h)) / (2 * h);
                } catch (e) {
                    return NaN;
                }
            }

            // Numerical integration
            numericalIntegral(func, a, b, method = 'simpson') {
                if (method === 'simpson') {
                    return this.simpsonRule(func, a, b, 1000);
                } else if (method === 'trapezoidal') {
                    return this.trapezoidalRule(func, a, b, 1000);
                }
            }

            simpsonRule(func, a, b, n) {
                if (n % 2 === 1) n++;
                const h = (b - a) / n;
                let sum = func(a) + func(b);
                
                for (let i = 1; i < n; i++) {
                    const x = a + i * h;
                    sum += (i % 2 === 0 ? 2 : 4) * func(x);
                }
                
                return (h / 3) * sum;
            }

            trapezoidalRule(func, a, b, n) {
                const h = (b - a) / n;
                let sum = (func(a) + func(b)) / 2;
                
                for (let i = 1; i < n; i++) {
                    sum += func(a + i * h);
                }
                
                return h * sum;
            }

            // Get step-by-step derivative explanation
            getDerivativeSteps(expression) {
                const steps = [];
                let expr = expression.toLowerCase().replace(/\s+/g, '');
                
                steps.push(`原函数: f(x) = ${expression}`);
                
                // Identify terms
                const terms = expr.split(/(?=[+-])/).filter(term => term.trim());
                steps.push(`分解为项: ${terms.join(', ')}`);
                
                // Apply rules to each term
                const derivedTerms = terms.map(term => {
                    if (term.includes('x^')) {
                        const match = term.match(/(\d*\.?\d*)\*?x\^(\d+\.?\d*)/);
                        if (match) {
                            const coeff = match[1] || '1';
                            const power = match[2];
                            steps.push(`${term}: 幂函数法则 → ${coeff}×${power}×x^${power-1}`);
                            return this.derivativeRules.power(term);
                        }
                    } else if (term.includes('sin') || term.includes('cos') || term.includes('tan')) {
                        steps.push(`${term}: 三角函数法则`);
                        return this.derivativeRules.trig(term);
                    } else if (term.includes('x')) {
                        steps.push(`${term}: 线性函数法则 → 常数`);
                        return term.replace(/(\d*\.?\d*)\*?x/, '$1');
                    } else {
                        steps.push(`${term}: 常数法则 → 0`);
                        return '0';
                    }
                });
                
                const result = derivedTerms.join(' + ').replace(/\+\s*0/g, '').replace(/^\s*\+\s*/, '');
                steps.push(`最终结果: f'(x) = ${result || '0'}`);
                
                return steps;
            }
        }

        const calculusCalculator = new CalculusCalculator();

        function calculateDerivative() {
            const funcStr = document.getElementById('calc-function').value;
            const result = document.getElementById('derivative-result');
            
            if (!funcStr.trim()) {
                result.innerHTML = '<span style="color: #dc3545;">请输入函数</span>';
                return;
            }
            
            try {
                // Try symbolic derivative first
                const symbolicResult = calculusCalculator.calculateSymbolicDerivative(funcStr);
                
                // Also calculate numerical derivative at x=1 for verification
                const func = mathParser.parseFunction(funcStr);
                const numericalAtOne = calculusCalculator.numericalDerivative(func, 1);
                
                // Get step-by-step explanation
                const steps = calculusCalculator.getDerivativeSteps(funcStr);
                
                result.innerHTML = `
                    <strong>符号导数:</strong> f'(x) = ${symbolicResult}<br>
                    <strong>在 x=1 处的数值:</strong> f'(1) ≈ ${numericalAtOne.toFixed(6)}<br>
                    <details style="margin-top: 0.5rem;">
                        <summary style="cursor: pointer; color: #007bff;">查看求导步骤</summary>
                        <div style="margin-top: 0.5rem; font-size: 0.9rem;">
                            ${steps.map(step => `<div style="margin: 0.2rem 0;">${step}</div>`).join('')}
                        </div>
                    </details>
                `;
            } catch (e) {
                result.innerHTML = `<span style="color: #dc3545;">计算错误: ${e.message}</span>`;
            }
        }

        function calculateIntegral() {
            const funcStr = document.getElementById('calc-function').value;
            const lower = parseFloat(document.getElementById('integral-lower').value);
            const upper = parseFloat(document.getElementById('integral-upper').value);
            const result = document.getElementById('integral-result');
            
            if (!funcStr.trim()) {
                result.innerHTML = '<span style="color: #dc3545;">请输入函数</span>';
                return;
            }
            
            if (isNaN(lower) || isNaN(upper)) {
                result.innerHTML = '<span style="color: #dc3545;">请输入有效的积分区间</span>';
                return;
            }
            
            try {
                const func = mathParser.parseFunction(funcStr);
                
                // Calculate using different methods
                const simpsonResult = calculusCalculator.numericalIntegral(func, lower, upper, 'simpson');
                const trapezoidalResult = calculusCalculator.numericalIntegral(func, lower, upper, 'trapezoidal');
                
                // Calculate error estimate
                const error = Math.abs(simpsonResult - trapezoidalResult);
                
                result.innerHTML = `
                    <strong>定积分结果:</strong><br>
                    ∫<sub>${lower}</sub><sup>${upper}</sup> (${funcStr}) dx<br><br>
                    <strong>辛普森法则:</strong> ${simpsonResult.toFixed(6)}<br>
                    <strong>梯形法则:</strong> ${trapezoidalResult.toFixed(6)}<br>
                    <strong>误差估计:</strong> ±${error.toFixed(6)}<br>
                    <small style="color: #666;">推荐使用辛普森法则结果，精度更高</small>
                `;
                
                // Add geometric interpretation for simple cases
                if (upper > lower) {
                    const avgValue = simpsonResult / (upper - lower);
                    result.innerHTML += `<br><br><strong>几何意义:</strong><br>`;
                    result.innerHTML += `曲线下面积: ${Math.abs(simpsonResult).toFixed(4)}<br>`;
                    result.innerHTML += `平均函数值: ${avgValue.toFixed(4)}`;
                }
                
            } catch (e) {
                result.innerHTML = `<span style="color: #dc3545;">计算错误: ${e.message}</span>`;
            }
        }

        // Add function to evaluate derivative at specific point
        function evaluateDerivativeAtPoint() {
            const funcStr = document.getElementById('calc-function').value;
            const point = prompt('请输入要计算导数的点 x =', '1');
            
            if (point === null || point.trim() === '') return;
            
            const x = parseFloat(point);
            if (isNaN(x)) {
                alert('请输入有效的数值');
                return;
            }
            
            try {
                const func = mathParser.parseFunction(funcStr);
                const derivativeValue = calculusCalculator.numericalDerivative(func, x);
                const functionValue = func(x);
                
                const result = document.getElementById('derivative-result');
                result.innerHTML += `<br><br><strong>在 x = ${x} 处:</strong><br>`;
                result.innerHTML += `f(${x}) = ${functionValue.toFixed(6)}<br>`;
                result.innerHTML += `f'(${x}) = ${derivativeValue.toFixed(6)}<br>`;
                result.innerHTML += `<small>切线斜率为 ${derivativeValue.toFixed(6)}</small>`;
            } catch (e) {
                alert(`计算错误: ${e.message}`);
            }
        }

        // Initialize demos when page loads
        document.addEventListener('DOMContentLoaded', function() {
            updateDerivativeDemo();
            updateIntegralDemo();
            loadOptimizationProblem();
        });

        // Handle window resize
        window.addEventListener('resize', function() {
            setTimeout(() => {
                updateDerivativeDemo();
                updateIntegralDemo();
            }, 100);
        });
    </script>
</body>
</html> 