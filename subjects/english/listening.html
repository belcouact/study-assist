<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>听力训练 - 英语学习助手</title>
    <link rel="icon" href="../../assets/icons/logo_btrfly.ico" type="image/x-icon">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/components.css">
    <link rel="stylesheet" href="../../css/utilities.css">
    <link rel="stylesheet" href="../../css/responsive.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .listening-hero {
            background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%);
            color: white;
            padding: 4rem 0;
            text-align: center;
        }

        .listening-hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .listening-hero p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .listening-tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin: 2rem 0;
            overflow: hidden;
        }

        .listening-tab {
            flex: 1;
            padding: 1rem 2rem;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .listening-tab.active {
            background: linear-gradient(135deg, #fd79a8, #e84393);
            color: white;
        }

        .listening-tab:hover:not(.active) {
            background: #e9ecef;
        }

        .listening-content {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .listening-panel {
            display: none;
        }

        .listening-panel.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .exercise-types-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .exercise-type-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .exercise-type-card:hover {
            background: #e9ecef;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .exercise-type-card.selected {
            border-color: #fd79a8;
            background: linear-gradient(135deg, rgba(253, 121, 168, 0.1), rgba(232, 67, 147, 0.1));
        }

        .exercise-type-card h3 {
            color: #fd79a8;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .audio-player {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
            margin: 2rem 0;
            text-align: center;
        }

        .audio-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .audio-btn {
            background: #fd79a8;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 1rem 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
            font-weight: 500;
        }

        .audio-btn:hover {
            background: #e84393;
            transform: translateY(-2px);
        }

        .audio-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .play-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            font-size: 2rem;
            padding: 0;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            margin: 1rem 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #fd79a8, #e84393);
            transition: width 0.3s ease;
        }

        .time-display {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #636e72;
        }

        .listening-exercise {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            margin-top: 2rem;
            border-left: 4px solid #fd79a8;
        }

        .exercise-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2d3436;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .exercise-description {
            color: #636e72;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .question-container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .question-text {
            font-weight: 600;
            margin-bottom: 1rem;
            color: #2d3436;
        }

        .question-options {
            display: grid;
            gap: 0.5rem;
        }

        .question-option {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .question-option:hover {
            border-color: #fd79a8;
            background: rgba(253, 121, 168, 0.05);
        }

        .question-option.selected {
            border-color: #fd79a8;
            background: rgba(253, 121, 168, 0.1);
        }

        .question-option.correct {
            border-color: #00b894;
            background: rgba(0, 184, 148, 0.2);
        }

        .question-option.incorrect {
            border-color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
        }

        .transcript-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 2rem;
            margin-top: 2rem;
            display: none;
        }

        .transcript-text {
            line-height: 1.8;
            font-size: 1.1rem;
        }

        .highlight-word {
            background: linear-gradient(135deg, rgba(253, 121, 168, 0.3), rgba(232, 67, 147, 0.3));
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            cursor: pointer;
        }

        .speed-controls {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .speed-btn {
            background: #e9ecef;
            border: none;
            border-radius: 20px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .speed-btn.active {
            background: #fd79a8;
            color: white;
        }

        .difficulty-selector {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
        }

        .difficulty-btn {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            padding: 0.8rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .difficulty-btn.active {
            border-color: #fd79a8;
            background: rgba(253, 121, 168, 0.1);
            color: #fd79a8;
        }

        .score-display {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(253, 121, 168, 0.1), rgba(232, 67, 147, 0.1));
            border-radius: 15px;
            margin: 2rem 0;
        }

        .score-number {
            font-size: 3rem;
            font-weight: 700;
            color: #fd79a8;
            margin-bottom: 0.5rem;
        }

        .listening-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
        }

        .stat-icon {
            font-size: 2rem;
            color: #fd79a8;
            margin-bottom: 1rem;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3436;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #636e72;
            font-size: 0.9rem;
        }

        .accent-selector {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .accent-btn {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 20px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .accent-btn.active {
            border-color: #fd79a8;
            background: rgba(253, 121, 168, 0.1);
            color: #fd79a8;
        }

        @media (max-width: 768px) {
            .listening-tabs {
                flex-direction: column;
            }

            .listening-tab {
                padding: 0.8rem 1rem;
            }

            .listening-hero h1 {
                font-size: 2rem;
            }

            .exercise-types-grid {
                grid-template-columns: 1fr;
            }

            .audio-controls {
                flex-direction: column;
                align-items: center;
            }

            .difficulty-selector {
                flex-direction: column;
                align-items: center;
            }

            .accent-selector {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="../../index.html">
                        <i class="fas fa-graduation-cap" style="background: linear-gradient(90deg, #4361ee, #7209b7); -webkit-background-clip: text; background-clip: text; color: transparent;"></i>
                        <span class="gradient-text">Alex的学习助手</span>
                    </a>
                </div>
                <nav class="main-nav">
                    <ul>
                        <li><a href="../../index.html">首页</a></li>
                        <li><a href="../../index.html#subjects">科目</a></li>
                        <li><a href="../../tts.html">语音</a></li>
                        <li><a href="../../draw.html">绘图</a></li>
                        <li><a href="main.html">返回英语</a></li>
                    </ul>
                </nav>
                <button class="mobile-menu-toggle" aria-label="切换菜单">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <main>
        <!-- Hero Section -->
        <section class="listening-hero">
            <div class="container">
                <h1><i class="fas fa-headphones"></i> 听力训练</h1>
                <p>通过多样化的听力练习和真实场景对话提高英语听力理解能力</p>
            </div>
        </section>

        <!-- Main Content -->
        <section class="main-content">
            <div class="container">
                <!-- Listening Tabs -->
                <div class="listening-tabs">
                    <button class="listening-tab active" data-tab="exercises">
                        <i class="fas fa-play-circle"></i> 听力练习
                    </button>
                    <button class="listening-tab" data-tab="scenarios">
                        <i class="fas fa-comments"></i> 场景对话
                    </button>
                    <button class="listening-tab" data-tab="dictation">
                        <i class="fas fa-keyboard"></i> 听写练习
                    </button>
                    <button class="listening-tab" data-tab="progress">
                        <i class="fas fa-chart-line"></i> 学习进度
                    </button>
                </div>

                <!-- Exercises Panel -->
                <div id="exercises-panel" class="listening-content listening-panel active">
                    <h2><i class="fas fa-play-circle"></i> 选择练习类型</h2>
                    
                    <div class="difficulty-selector">
                        <button class="difficulty-btn active" data-difficulty="beginner">
                            <i class="fas fa-seedling"></i> 初级
                        </button>
                        <button class="difficulty-btn" data-difficulty="intermediate">
                            <i class="fas fa-tree"></i> 中级
                        </button>
                        <button class="difficulty-btn" data-difficulty="advanced">
                            <i class="fas fa-mountain"></i> 高级
                        </button>
                    </div>

                    <div class="exercise-types-grid">
                        <div class="exercise-type-card" data-type="conversation">
                            <h3><i class="fas fa-users"></i> 日常对话</h3>
                            <p>听取日常生活中的对话，理解语境和细节</p>
                        </div>
                        <div class="exercise-type-card" data-type="news">
                            <h3><i class="fas fa-newspaper"></i> 新闻播报</h3>
                            <p>收听英语新闻，提高对正式语言的理解</p>
                        </div>
                        <div class="exercise-type-card" data-type="lecture">
                            <h3><i class="fas fa-chalkboard-teacher"></i> 学术讲座</h3>
                            <p>聆听学术内容，训练专业词汇理解</p>
                        </div>
                        <div class="exercise-type-card" data-type="interview">
                            <h3><i class="fas fa-microphone"></i> 访谈节目</h3>
                            <p>听取访谈对话，理解不同观点和表达</p>
                        </div>
                        <div class="exercise-type-card" data-type="story">
                            <h3><i class="fas fa-book-open"></i> 故事朗读</h3>
                            <p>聆听英语故事，提高叙述理解能力</p>
                        </div>
                        <div class="exercise-type-card" data-type="pronunciation">
                            <h3><i class="fas fa-volume-up"></i> 发音练习</h3>
                            <p>专注于语音识别和发音对比</p>
                        </div>
                    </div>

                    <div id="exercise-content" style="display: none;">
                        <div class="accent-selector">
                            <button class="accent-btn active" data-accent="american">美式英语</button>
                            <button class="accent-btn" data-accent="british">英式英语</button>
                            <button class="accent-btn" data-accent="australian">澳式英语</button>
                        </div>

                        <div class="audio-player">
                            <div class="exercise-title">
                                <i class="fas fa-headphones"></i>
                                <span id="exercise-title-text">听力练习</span>
                            </div>
                            <div class="exercise-description" id="exercise-description">
                                请仔细聆听音频内容，然后回答相关问题。
                            </div>

                            <div class="audio-controls">
                                <button class="audio-btn play-btn" id="play-btn">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button class="audio-btn" id="pause-btn" style="display: none;">
                                    <i class="fas fa-pause"></i> 暂停
                                </button>
                                <button class="audio-btn" id="replay-btn">
                                    <i class="fas fa-redo"></i> 重播
                                </button>
                                <button class="audio-btn" id="show-transcript">
                                    <i class="fas fa-file-alt"></i> 显示文本
                                </button>
                            </div>

                            <div class="progress-bar">
                                <div class="progress-fill" id="audio-progress" style="width: 0%"></div>
                            </div>
                            <div class="time-display">
                                <span id="current-time">00:00</span>
                                <span id="total-time">00:00</span>
                            </div>

                            <div class="speed-controls">
                                <button class="speed-btn" data-speed="0.5">0.5x</button>
                                <button class="speed-btn" data-speed="0.75">0.75x</button>
                                <button class="speed-btn active" data-speed="1">1x</button>
                                <button class="speed-btn" data-speed="1.25">1.25x</button>
                                <button class="speed-btn" data-speed="1.5">1.5x</button>
                            </div>
                        </div>

                        <div id="questions-container" class="listening-exercise">
                            <!-- Questions will be loaded here -->
                        </div>

                        <div id="transcript-container" class="transcript-container">
                            <h3><i class="fas fa-file-alt"></i> 音频文本</h3>
                            <div class="transcript-text" id="transcript-text">
                                <!-- Transcript will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Scenarios Panel -->
                <div id="scenarios-panel" class="listening-content listening-panel">
                    <h2><i class="fas fa-comments"></i> 场景对话练习</h2>
                    <p>通过真实生活场景的对话练习提高听力理解能力</p>
                    
                    <div class="exercise-types-grid">
                        <div class="exercise-type-card" data-scenario="restaurant">
                            <h3><i class="fas fa-utensils"></i> 餐厅点餐</h3>
                            <p>学习餐厅用餐相关的对话和词汇</p>
                        </div>
                        <div class="exercise-type-card" data-scenario="shopping">
                            <h3><i class="fas fa-shopping-cart"></i> 购物对话</h3>
                            <p>掌握购物时的常用表达和交流</p>
                        </div>
                        <div class="exercise-type-card" data-scenario="airport">
                            <h3><i class="fas fa-plane"></i> 机场对话</h3>
                            <p>熟悉机场和旅行相关的听力内容</p>
                        </div>
                        <div class="exercise-type-card" data-scenario="hotel">
                            <h3><i class="fas fa-bed"></i> 酒店服务</h3>
                            <p>了解酒店入住和服务相关对话</p>
                        </div>
                        <div class="exercise-type-card" data-scenario="medical">
                            <h3><i class="fas fa-stethoscope"></i> 医疗咨询</h3>
                            <p>学习医疗和健康相关的对话</p>
                        </div>
                        <div class="exercise-type-card" data-scenario="business">
                            <h3><i class="fas fa-briefcase"></i> 商务会议</h3>
                            <p>掌握商务场合的专业对话</p>
                        </div>
                    </div>

                    <div id="scenario-content" style="display: none;">
                        <!-- Scenario content will be loaded here -->
                    </div>
                </div>

                <!-- Dictation Panel -->
                <div id="dictation-panel" class="listening-content listening-panel">
                    <h2><i class="fas fa-keyboard"></i> 听写练习</h2>
                    <p>通过听写练习提高听力精确度和拼写能力</p>
                    
                    <div class="form-group">
                        <label for="dictation-level">选择难度级别：</label>
                        <select id="dictation-level" class="form-control">
                            <option value="word">单词听写</option>
                            <option value="sentence" selected>句子听写</option>
                            <option value="paragraph">段落听写</option>
                        </select>
                    </div>
                    
                    <button id="start-dictation" class="btn btn-primary">
                        <i class="fas fa-play"></i> 开始听写
                    </button>

                    <div id="dictation-exercise" style="display: none;">
                        <div class="audio-player">
                            <div class="audio-controls">
                                <button class="audio-btn" id="dictation-play">
                                    <i class="fas fa-play"></i> 播放
                                </button>
                                <button class="audio-btn" id="dictation-replay">
                                    <i class="fas fa-redo"></i> 重播
                                </button>
                            </div>
                        </div>

                        <div class="listening-exercise">
                            <h3>请输入您听到的内容：</h3>
                            <textarea id="dictation-input" class="form-control" rows="5" placeholder="在这里输入您听到的内容..."></textarea>
                            <button id="check-dictation" class="btn btn-primary" style="margin-top: 1rem;">
                                <i class="fas fa-check"></i> 检查答案
                            </button>
                            <div id="dictation-result" style="display: none; margin-top: 1rem;">
                                <!-- Results will be shown here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Progress Panel -->
                <div id="progress-panel" class="listening-content listening-panel">
                    <h2><i class="fas fa-chart-line"></i> 学习进度</h2>
                    
                    <div class="score-display">
                        <div class="score-number">78%</div>
                        <h3>总体听力水平</h3>
                        <p>您已完成 25 个听力练习</p>
                    </div>

                    <div class="listening-stats">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-value">45</div>
                            <div class="stat-label">练习小时</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-bullseye"></i>
                            </div>
                            <div class="stat-value">82%</div>
                            <div class="stat-label">平均正确率</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="stat-value">15</div>
                            <div class="stat-label">完成测试</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-fire"></i>
                            </div>
                            <div class="stat-value">7</div>
                            <div class="stat-label">连续天数</div>
                        </div>
                    </div>

                    <div class="listening-exercise">
                        <h3><i class="fas fa-chart-bar"></i> 技能分析</h3>
                        <div class="skill-progress">
                            <div style="margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>日常对话理解</span>
                                    <span>85%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 85%"></div>
                                </div>
                            </div>
                            <div style="margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>新闻播报理解</span>
                                    <span>72%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 72%"></div>
                                </div>
                            </div>
                            <div style="margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>学术内容理解</span>
                                    <span>68%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 68%"></div>
                                </div>
                            </div>
                            <div style="margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>发音识别</span>
                                    <span>90%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 90%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script src="../../js/common.js"></script>
    <script src="../../js/navigation.js"></script>
    <script src="../../js/profile.js"></script>
    <script>
        // Listening exercise data
        const listeningExercises = {
            conversation: {
                title: "日常对话练习",
                description: "听取两人之间的日常对话，理解对话内容和语境。",
                audio: "conversation_sample.mp3",
                transcript: "A: Hi Sarah, how was your weekend?\nB: It was great! I went hiking with my family in the mountains. The weather was perfect and the views were amazing.\nA: That sounds wonderful! I love hiking too. Which trail did you take?\nB: We took the Blue Ridge Trail. It's about 5 miles long and has some challenging parts, but it's totally worth it.\nA: I'll have to try that trail sometime. Did you see any wildlife?\nB: Yes! We saw several deer and even a family of rabbits. My kids were so excited.",
                questions: [
                    {
                        question: "What did Sarah do over the weekend?",
                        options: [
                            "She went shopping with friends",
                            "She went hiking with her family",
                            "She stayed home and relaxed",
                            "She visited her grandparents"
                        ],
                        correct: 1,
                        explanation: "Sarah mentions that she went hiking with her family in the mountains."
                    },
                    {
                        question: "How long is the Blue Ridge Trail?",
                        options: ["3 miles", "4 miles", "5 miles", "6 miles"],
                        correct: 2,
                        explanation: "Sarah specifically states that the Blue Ridge Trail is about 5 miles long."
                    },
                    {
                        question: "What wildlife did they see?",
                        options: [
                            "Bears and eagles",
                            "Deer and rabbits",
                            "Squirrels and birds",
                            "Foxes and raccoons"
                        ],
                        correct: 1,
                        explanation: "Sarah mentions seeing several deer and a family of rabbits during their hike."
                    }
                ]
            },
            news: {
                title: "新闻播报练习",
                description: "收听英语新闻播报，理解新闻内容和关键信息。",
                audio: "news_sample.mp3",
                transcript: "Good evening, I'm Jennifer Smith with the 6 o'clock news. Our top story tonight: The city council has approved a new public transportation project that will add 20 electric buses to the current fleet. The $2.5 million initiative aims to reduce carbon emissions and improve air quality in downtown areas. Construction of new bus stops will begin next month and is expected to be completed by the end of the year. Mayor Johnson called it 'a significant step toward a greener future for our city.' In other news, the annual food festival will take place this weekend at Central Park, featuring over 50 local restaurants and food trucks.",
                questions: [
                    {
                        question: "How many electric buses will be added?",
                        options: ["15", "20", "25", "30"],
                        correct: 1,
                        explanation: "The news report states that 20 electric buses will be added to the current fleet."
                    },
                    {
                        question: "What is the cost of the transportation project?",
                        options: ["$2 million", "$2.5 million", "$3 million", "$3.5 million"],
                        correct: 1,
                        explanation: "The report mentions that the initiative costs $2.5 million."
                    }
                ]
            }
        };

        const scenarioDialogues = {
            restaurant: {
                title: "餐厅点餐对话",
                description: "学习在餐厅点餐时的常用对话和表达。",
                dialogue: [
                    { speaker: "Waiter", text: "Good evening! Welcome to Mario's Italian Restaurant. How many people are in your party?" },
                    { speaker: "Customer", text: "Good evening. Table for two, please." },
                    { speaker: "Waiter", text: "Perfect! Right this way. Here are your menus. Can I start you off with something to drink?" },
                    { speaker: "Customer", text: "I'll have a glass of red wine, and my friend will have sparkling water." },
                    { speaker: "Waiter", text: "Excellent choice. I'll be right back with your drinks. Take your time looking at the menu." }
                ]
            },
            shopping: {
                title: "购物对话",
                description: "掌握购物时的常用表达和交流方式。",
                dialogue: [
                    { speaker: "Salesperson", text: "Good afternoon! Can I help you find anything today?" },
                    { speaker: "Customer", text: "Yes, I'm looking for a winter coat. Something warm but not too heavy." },
                    { speaker: "Salesperson", text: "What size are you looking for? And do you have a color preference?" },
                    { speaker: "Customer", text: "I'm a medium, and I prefer dark colors like black or navy blue." },
                    { speaker: "Salesperson", text: "Perfect! I have several options that would work well. Let me show you our latest arrivals." }
                ]
            }
        };

        let currentAudio = null;
        let currentExercise = null;
        let currentSpeed = 1;

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            initListeningTabs();
            initExerciseTypes();
            initDifficultySelector();
            initAudioControls();
            initSpeedControls();
            initAccentSelector();
            initScenarios();
            initDictation();
        });

        // Tab system
        function initListeningTabs() {
            const tabs = document.querySelectorAll('.listening-tab');
            const panels = document.querySelectorAll('.listening-panel');

            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetPanel = this.getAttribute('data-tab') + '-panel';
                    
                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update active panel
                    panels.forEach(p => p.classList.remove('active'));
                    document.getElementById(targetPanel).classList.add('active');
                });
            });
        }

        // Exercise types
        function initExerciseTypes() {
            const typeCards = document.querySelectorAll('.exercise-type-card[data-type]');
            const exerciseContent = document.getElementById('exercise-content');

            typeCards.forEach(card => {
                card.addEventListener('click', function() {
                    const type = this.getAttribute('data-type');
                    
                    // Update selected card
                    typeCards.forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    // Load exercise
                    loadExercise(type, exerciseContent);
                });
            });
        }

        function loadExercise(type, container) {
            const exercise = listeningExercises[type];
            if (!exercise) {
                // Show placeholder for exercises not yet implemented
                container.style.display = 'block';
                document.getElementById('exercise-title-text').textContent = `${type} 练习`;
                document.getElementById('exercise-description').textContent = '此练习类型正在开发中，敬请期待！';
                document.getElementById('questions-container').innerHTML = '<p>练习内容即将推出...</p>';
                return;
            }

            currentExercise = exercise;
            container.style.display = 'block';
            
            // Update title and description
            document.getElementById('exercise-title-text').textContent = exercise.title;
            document.getElementById('exercise-description').textContent = exercise.description;
            
            // Load questions
            loadQuestions(exercise.questions);
            
            // Load transcript
            document.getElementById('transcript-text').textContent = exercise.transcript;
        }

        function loadQuestions(questions) {
            const container = document.getElementById('questions-container');
            let html = '<h3><i class="fas fa-question-circle"></i> 理解问题</h3>';
            
            questions.forEach((q, index) => {
                html += `
                    <div class="question-container">
                        <div class="question-text">${index + 1}. ${q.question}</div>
                        <div class="question-options">
                            ${q.options.map((option, optIndex) => `
                                <div class="question-option" data-question="${index}" data-option="${optIndex}">
                                    ${String.fromCharCode(65 + optIndex)}. ${option}
                                </div>
                            `).join('')}
                        </div>
                        <div id="explanation-${index}" class="explanation-box" style="display: none;">
                            <strong>解释：</strong> ${q.explanation}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // Add click handlers
            container.querySelectorAll('.question-option').forEach(option => {
                option.addEventListener('click', function() {
                    const questionIndex = parseInt(this.getAttribute('data-question'));
                    const optionIndex = parseInt(this.getAttribute('data-option'));
                    const question = questions[questionIndex];
                    
                    // Remove previous selections
                    container.querySelectorAll(`[data-question="${questionIndex}"]`).forEach(opt => {
                        opt.classList.remove('selected', 'correct', 'incorrect');
                    });
                    
                    // Mark selected
                    this.classList.add('selected');
                    
                    // Show results after delay
                    setTimeout(() => {
                        container.querySelectorAll(`[data-question="${questionIndex}"]`).forEach((opt, idx) => {
                            if (idx === question.correct) {
                                opt.classList.add('correct');
                            } else if (idx === optionIndex && idx !== question.correct) {
                                opt.classList.add('incorrect');
                            }
                        });
                        
                        document.getElementById(`explanation-${questionIndex}`).style.display = 'block';
                    }, 500);
                });
            });
        }

        // Difficulty selector
        function initDifficultySelector() {
            const difficultyBtns = document.querySelectorAll('.difficulty-btn');
            
            difficultyBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    difficultyBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const difficulty = this.getAttribute('data-difficulty');
                    console.log('Selected difficulty:', difficulty);
                });
            });
        }

        // Audio controls
        function initAudioControls() {
            const playBtn = document.getElementById('play-btn');
            const pauseBtn = document.getElementById('pause-btn');
            const replayBtn = document.getElementById('replay-btn');
            const showTranscriptBtn = document.getElementById('show-transcript');

            if (playBtn) {
                playBtn.addEventListener('click', function() {
                    playAudio();
                });
            }

            if (pauseBtn) {
                pauseBtn.addEventListener('click', function() {
                    pauseAudio();
                });
            }

            if (replayBtn) {
                replayBtn.addEventListener('click', function() {
                    replayAudio();
                });
            }

            if (showTranscriptBtn) {
                showTranscriptBtn.addEventListener('click', function() {
                    toggleTranscript();
                });
            }
        }

        function playAudio() {
            // Simulate audio playback
            const playBtn = document.getElementById('play-btn');
            const pauseBtn = document.getElementById('pause-btn');
            
            playBtn.style.display = 'none';
            pauseBtn.style.display = 'inline-flex';
            
            // Simulate progress
            simulateAudioProgress();
            
            // Use Web Speech API to read the transcript
            if (currentExercise && 'speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(currentExercise.transcript);
                utterance.lang = 'en-US';
                utterance.rate = currentSpeed;
                
                utterance.onend = function() {
                    playBtn.style.display = 'inline-flex';
                    pauseBtn.style.display = 'none';
                };
                
                currentAudio = utterance;
                speechSynthesis.speak(utterance);
            }
        }

        function pauseAudio() {
            const playBtn = document.getElementById('play-btn');
            const pauseBtn = document.getElementById('pause-btn');
            
            playBtn.style.display = 'inline-flex';
            pauseBtn.style.display = 'none';
            
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
            }
        }

        function replayAudio() {
            pauseAudio();
            setTimeout(() => {
                playAudio();
            }, 100);
        }

        function toggleTranscript() {
            const transcriptContainer = document.getElementById('transcript-container');
            const btn = document.getElementById('show-transcript');
            
            if (transcriptContainer.style.display === 'none' || !transcriptContainer.style.display) {
                transcriptContainer.style.display = 'block';
                btn.innerHTML = '<i class="fas fa-eye-slash"></i> 隐藏文本';
            } else {
                transcriptContainer.style.display = 'none';
                btn.innerHTML = '<i class="fas fa-file-alt"></i> 显示文本';
            }
        }

        function simulateAudioProgress() {
            const progressBar = document.getElementById('audio-progress');
            const currentTimeSpan = document.getElementById('current-time');
            const totalTimeSpan = document.getElementById('total-time');
            
            let progress = 0;
            const duration = 30; // Simulate 30 second audio
            totalTimeSpan.textContent = formatTime(duration);
            
            const interval = setInterval(() => {
                progress += 1;
                const percentage = (progress / duration) * 100;
                progressBar.style.width = percentage + '%';
                currentTimeSpan.textContent = formatTime(progress);
                
                if (progress >= duration) {
                    clearInterval(interval);
                }
            }, 1000);
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Speed controls
        function initSpeedControls() {
            const speedBtns = document.querySelectorAll('.speed-btn');
            
            speedBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    speedBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    currentSpeed = parseFloat(this.getAttribute('data-speed'));
                    console.log('Speed changed to:', currentSpeed);
                });
            });
        }

        // Accent selector
        function initAccentSelector() {
            const accentBtns = document.querySelectorAll('.accent-btn');
            
            accentBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    accentBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const accent = this.getAttribute('data-accent');
                    console.log('Accent changed to:', accent);
                });
            });
        }

        // Scenarios
        function initScenarios() {
            const scenarioCards = document.querySelectorAll('.exercise-type-card[data-scenario]');
            const scenarioContent = document.getElementById('scenario-content');

            scenarioCards.forEach(card => {
                card.addEventListener('click', function() {
                    const scenario = this.getAttribute('data-scenario');
                    
                    // Update selected card
                    scenarioCards.forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    // Load scenario
                    loadScenario(scenario, scenarioContent);
                });
            });
        }

        function loadScenario(scenario, container) {
            const dialogue = scenarioDialogues[scenario];
            if (!dialogue) {
                container.style.display = 'block';
                container.innerHTML = `
                    <div class="listening-exercise">
                        <h3>${scenario} 对话练习</h3>
                        <p>此场景对话正在开发中，敬请期待！</p>
                    </div>
                `;
                return;
            }

            let html = `
                <div class="listening-exercise">
                    <h3><i class="fas fa-comments"></i> ${dialogue.title}</h3>
                    <p>${dialogue.description}</p>
                    
                    <div class="audio-controls">
                        <button class="audio-btn" onclick="playScenarioAudio('${scenario}')">
                            <i class="fas fa-play"></i> 播放对话
                        </button>
                    </div>
                    
                    <div class="dialogue-content">
                        ${dialogue.dialogue.map(line => `
                            <div class="dialogue-line" style="margin-bottom: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                                <strong>${line.speaker}:</strong> ${line.text}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
            container.style.display = 'block';
        }

        function playScenarioAudio(scenario) {
            const dialogue = scenarioDialogues[scenario];
            if (!dialogue || !('speechSynthesis' in window)) return;
            
            const fullText = dialogue.dialogue.map(line => `${line.speaker} says: ${line.text}`).join('. ');
            const utterance = new SpeechSynthesisUtterance(fullText);
            utterance.lang = 'en-US';
            utterance.rate = 0.8;
            speechSynthesis.speak(utterance);
        }

        // Dictation
        function initDictation() {
            const startBtn = document.getElementById('start-dictation');
            const checkBtn = document.getElementById('check-dictation');
            
            if (startBtn) {
                startBtn.addEventListener('click', function() {
                    startDictationExercise();
                });
            }
            
            if (checkBtn) {
                checkBtn.addEventListener('click', function() {
                    checkDictationAnswer();
                });
            }
        }

        function startDictationExercise() {
            const level = document.getElementById('dictation-level').value;
            const exerciseDiv = document.getElementById('dictation-exercise');
            
            exerciseDiv.style.display = 'block';
            
            // Sample dictation content
            const dictationContent = {
                word: "Listen carefully and write the word you hear.",
                sentence: "The quick brown fox jumps over the lazy dog.",
                paragraph: "Technology has revolutionized the way we communicate. Social media platforms allow us to connect with people around the world instantly."
            };
            
            const content = dictationContent[level];
            
            // Add play button functionality
            document.getElementById('dictation-play').onclick = function() {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(content);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.8;
                    speechSynthesis.speak(utterance);
                }
            };
            
            document.getElementById('dictation-replay').onclick = function() {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(content);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.6; // Slower for dictation
                    speechSynthesis.speak(utterance);
                }
            };
            
            // Store correct answer for checking
            window.currentDictationAnswer = content;
        }

        function checkDictationAnswer() {
            const userInput = document.getElementById('dictation-input').value.trim();
            const correctAnswer = window.currentDictationAnswer;
            const resultDiv = document.getElementById('dictation-result');
            
            if (!userInput) {
                alert('请先输入您听到的内容。');
                return;
            }
            
            // Simple comparison (in real implementation, would use more sophisticated matching)
            const similarity = calculateSimilarity(userInput.toLowerCase(), correctAnswer.toLowerCase());
            const score = Math.round(similarity * 100);
            
            let feedback = '';
            if (score >= 90) {
                feedback = '<div style="color: #00b894;"><i class="fas fa-check-circle"></i> 优秀！您的听写非常准确。</div>';
            } else if (score >= 70) {
                feedback = '<div style="color: #fdcb6e;"><i class="fas fa-exclamation-circle"></i> 不错！还有一些小错误需要注意。</div>';
            } else {
                feedback = '<div style="color: #e74c3c;"><i class="fas fa-times-circle"></i> 需要多练习。请仔细听音频内容。</div>';
            }
            
            resultDiv.innerHTML = `
                <div class="score-display">
                    <div class="score-number">${score}%</div>
                    ${feedback}
                    <div style="margin-top: 1rem;">
                        <strong>正确答案：</strong><br>
                        <div style="background: #e8f5e8; padding: 1rem; border-radius: 8px; margin-top: 0.5rem;">
                            ${correctAnswer}
                        </div>
                    </div>
                </div>
            `;
            resultDiv.style.display = 'block';
        }

        function calculateSimilarity(str1, str2) {
            // Simple similarity calculation (Levenshtein distance based)
            const longer = str1.length > str2.length ? str1 : str2;
            const shorter = str1.length > str2.length ? str2 : str1;
            
            if (longer.length === 0) return 1.0;
            
            const editDistance = levenshteinDistance(longer, shorter);
            return (longer.length - editDistance) / longer.length;
        }

        function levenshteinDistance(str1, str2) {
            const matrix = [];
            
            for (let i = 0; i <= str2.length; i++) {
                matrix[i] = [i];
            }
            
            for (let j = 0; j <= str1.length; j++) {
                matrix[0][j] = j;
            }
            
            for (let i = 1; i <= str2.length; i++) {
                for (let j = 1; j <= str1.length; j++) {
                    if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }
            
            return matrix[str2.length][str1.length];
        }
    </script>
</body>
</html>