<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>语法掌握 - 英语学习助手</title>
    <link rel="icon" href="../../assets/icons/logo_btrfly.ico" type="image/x-icon">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/components.css">
    <link rel="stylesheet" href="../../css/utilities.css">
    <link rel="stylesheet" href="../../css/responsive.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .grammar-hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4rem 0;
            text-align: center;
        }

        .grammar-hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .grammar-hero p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .grammar-tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin: 2rem 0;
            overflow: hidden;
        }

        .grammar-tab {
            flex: 1;
            padding: 1rem 2rem;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .grammar-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .grammar-tab:hover:not(.active) {
            background: #e9ecef;
        }

        .grammar-content {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .grammar-panel {
            display: none;
        }

        .grammar-panel.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .topic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .topic-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .topic-card:hover {
            background: #e9ecef;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .topic-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
        }

        .topic-card h3 {
            color: #667eea;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .exercise-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .exercise-question {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid #667eea;
        }

        .exercise-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .exercise-option {
            background: #e9ecef;
            border: none;
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            min-height: 48px;
        }

        .exercise-option:hover {
            background: #dee2e6;
        }

        .exercise-option.selected {
            background: #667eea;
            color: white;
        }

        .exercise-option.correct {
            background: #28a745;
            color: white;
        }

        .exercise-option.incorrect {
            background: #dc3545;
            color: white;
        }

        .explanation-box {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 1rem;
            border-left: 4px solid #667eea;
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 10px;
            margin: 1rem 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea, #764ba2);
            height: 100%;
            transition: width 0.3s ease;
        }

        .score-display {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-radius: 15px;
            margin: 2rem 0;
        }

        .score-number {
            font-size: 3rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .grammar-rule {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid #28a745;
        }

        .example-sentence {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem 0;
            font-style: italic;
        }

        .highlight {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-weight: 600;
        }

        .tense-chart {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .tense-box {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            transition: all 0.3s ease;
        }

        .tense-box:hover {
            border-color: #667eea;
            background: white;
        }

        .modal-showcase {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .modal-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .modal-card:hover {
            border-color: #667eea;
            background: white;
        }

        .conditional-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .conditional-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            border-left: 4px solid #007bff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .conditional-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        @media (max-width: 1024px) {
            .grammar-hero h1 {
                font-size: 2.5rem;
            }
            
            .tense-chart,
            .modal-showcase,
            .conditional-types {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .grammar-tabs {
                flex-direction: column;
            }

            .grammar-tab {
                padding: 0.8rem 1rem;
            }

            .grammar-hero h1 {
                font-size: 2rem;
            }

            .grammar-hero p {
                font-size: 1rem;
            }

            .topic-grid {
                grid-template-columns: 1fr;
            }

            .exercise-options {
                grid-template-columns: 1fr;
            }

            .tense-chart,
            .modal-showcase,
            .conditional-types {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .grammar-content {
                padding: 1rem;
            }
            
            .exercise-container {
                padding: 1rem;
            }
            
            .grammar-hero {
                padding: 2rem 0;
            }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="../../index.html">
                        <i class="fas fa-graduation-cap" style="background: linear-gradient(90deg, #4361ee, #7209b7); -webkit-background-clip: text; background-clip: text; color: transparent;"></i>
                        <span class="gradient-text">Alex的学习助手</span>
                    </a>
                </div>
                <nav class="main-nav">
                    <ul>
                        <li><a href="../../index.html">首页</a></li>
                        <li><a href="../../index.html#subjects">科目</a></li>
                        <li><a href="../../tts.html">语音</a></li>
                        <li><a href="../../draw.html">绘图</a></li>
                        <li><a href="main.html">返回英语</a></li>
                    </ul>
                </nav>
                <button class="mobile-menu-toggle" aria-label="切换菜单">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <main>
        <!-- Hero Section -->
        <section class="grammar-hero">
            <div class="container">
                <h1><i class="fas fa-spell-check"></i> 语法掌握</h1>
                <p>通过互动练习和详细解释掌握英语语法规则，提高语言运用能力</p>
            </div>
        </section>

        <!-- Main Content -->
        <section class="main-content">
            <div class="container">
                <!-- Grammar Tabs -->
                <div class="grammar-tabs">
                    <button class="grammar-tab active" data-tab="learn">
                        <i class="fas fa-book-open"></i> 学习语法
                    </button>
                    <button class="grammar-tab" data-tab="reference">
                        <i class="fas fa-bookmark"></i> 语法手册
                    </button>
                    <button class="grammar-tab" data-tab="practice">
                        <i class="fas fa-dumbbell"></i> 练习题目
                    </button>
                    <button class="grammar-tab" data-tab="test">
                        <i class="fas fa-clipboard-check"></i> 语法测试
                    </button>
                </div>

                <!-- Learn Panel -->
                <div id="learn-panel" class="grammar-content grammar-panel active">
                    <h2><i class="fas fa-lightbulb"></i> 选择语法主题</h2>
                    <div class="topic-grid">
                        <div class="topic-card" data-topic="tenses">
                            <h3><i class="fas fa-clock"></i> 时态</h3>
                            <p>学习全部12种时态：现在时、过去时、将来时及其完成式、进行式</p>
                        </div>
                        <div class="topic-card" data-topic="articles">
                            <h3><i class="fas fa-font"></i> 冠词</h3>
                            <p>掌握 a, an, the 的正确使用方法和零冠词的使用</p>
                        </div>
                        <div class="topic-card" data-topic="prepositions">
                            <h3><i class="fas fa-arrows-alt"></i> 介词</h3>
                            <p>学习时间、地点、方向介词的用法和搭配</p>
                        </div>
                        <div class="topic-card" data-topic="conditionals">
                            <h3><i class="fas fa-question-circle"></i> 条件句</h3>
                            <p>掌握零条件句、第一、二、三条件句和混合条件句的结构和用法</p>
                        </div>
                        <div class="topic-card" data-topic="passive">
                            <h3><i class="fas fa-exchange-alt"></i> 被动语态</h3>
                            <p>学习各种时态的被动语态构成和使用场合</p>
                        </div>
                        <div class="topic-card" data-topic="modals">
                            <h3><i class="fas fa-cog"></i> 情态动词</h3>
                            <p>掌握 can, could, should, must, may, might, will, would 等的用法</p>
                        </div>
                    </div>
                    <div id="topic-content" class="exercise-container" style="display: none;">
                        <!-- Topic content will be loaded here -->
                    </div>
                </div>

                <!-- Practice Panel -->
                <div id="practice-panel" class="grammar-content grammar-panel">
                    <h2><i class="fas fa-dumbbell"></i> 语法练习</h2>
                    <div class="form-group">
                        <label for="practice-topic">选择练习主题：</label>
                        <select id="practice-topic" class="form-control">
                            <option value="mixed">综合练习</option>
                            <option value="tenses">时态练习</option>
                            <option value="articles">冠词练习</option>
                            <option value="prepositions">介词练习</option>
                            <option value="conditionals">条件句练习</option>
                            <option value="passive">被动语态练习</option>
                            <option value="modals">情态动词练习</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="practice-difficulty">难度级别：</label>
                        <select id="practice-difficulty" class="form-control">
                            <option value="elementary">初级</option>
                            <option value="intermediate" selected>中级</option>
                            <option value="advanced">高级</option>
                        </select>
                    </div>
                    <button id="start-practice" class="btn btn-primary">
                        <i class="fas fa-play"></i> 开始练习
                    </button>
                    <div id="practice-container" style="display: none;">
                        <div class="progress-bar">
                            <div id="practice-progress" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <div id="practice-questions"></div>
                        <div id="practice-results" style="display: none;"></div>
                    </div>
                </div>

                <!-- Test Panel -->
                <div id="test-panel" class="grammar-content grammar-panel">
                    <h2><i class="fas fa-clipboard-check"></i> 语法测试</h2>
                    <p>通过综合测试评估您的语法水平</p>
                    <div class="form-group">
                        <label for="test-level">测试级别：</label>
                        <select id="test-level" class="form-control">
                            <option value="elementary">初级测试 (20题)</option>
                            <option value="intermediate" selected>中级测试 (25题)</option>
                            <option value="advanced">高级测试 (30题)</option>
                        </select>
                    </div>
                    <button id="start-test" class="btn btn-primary">
                        <i class="fas fa-play-circle"></i> 开始测试
                    </button>
                    <div id="test-container" style="display: none;">
                        <div class="progress-bar">
                            <div id="test-progress" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <div id="test-questions"></div>
                        <div id="test-results" style="display: none;"></div>
                    </div>
                </div>

                <!-- Reference Panel -->
                <div id="reference-panel" class="grammar-content grammar-panel">
                    <h2><i class="fas fa-bookmark"></i> 语法手册</h2>
                    <p>快速查阅常用语法规则和例句</p>
                    <div class="topic-grid">
                        <div class="topic-card" data-reference="tenses">
                            <h3><i class="fas fa-clock"></i> 时态总览</h3>
                            <p>所有时态的构成和用法总结</p>
                        </div>
                        <div class="topic-card" data-reference="articles">
                            <h3><i class="fas fa-font"></i> 冠词用法</h3>
                            <p>定冠词、不定冠词和零冠词的用法规则</p>
                        </div>
                        <div class="topic-card" data-reference="prepositions">
                            <h3><i class="fas fa-arrows-alt"></i> 介词手册</h3>
                            <p>常用介词分类及用法示例</p>
                        </div>
                        <div class="topic-card" data-reference="conditionals">
                            <h3><i class="fas fa-question-circle"></i> 条件句结构</h3>
                            <p>各类条件句的构成方式与典型例句</p>
                        </div>
                        <div class="topic-card" data-reference="passive">
                            <h3><i class="fas fa-exchange-alt"></i> 被动语态指南</h3>
                            <p>各时态被动语态的结构与转换方法</p>
                        </div>
                        <div class="topic-card" data-reference="modals">
                            <h3><i class="fas fa-cog"></i> 情态动词参考</h3>
                            <p>各类情态动词的用法与区别</p>
                        </div>
                        <div class="topic-card" data-reference="sentence-structure">
                            <h3><i class="fas fa-sitemap"></i> 句子结构</h3>
                            <p>简单句、复合句、复杂句的构成</p>
                        </div>
                        <div class="topic-card" data-reference="common-errors">
                            <h3><i class="fas fa-exclamation-triangle"></i> 常见错误</h3>
                            <p>中国学生常犯的语法错误及纠正</p>
                        </div>
                        <div class="topic-card" data-reference="irregular-verbs">
                            <h3><i class="fas fa-list"></i> 不规则动词</h3>
                            <p>常用不规则动词变化表</p>
                        </div>
                        <div class="topic-card" data-reference="verb-patterns">
                            <h3><i class="fas fa-code-branch"></i> 动词搭配</h3>
                            <p>常见动词搭配模式与固定用法</p>
                        </div>
                        <div class="topic-card" data-reference="conjunctions">
                            <h3><i class="fas fa-link"></i> 连接词用法</h3>
                            <p>并列连词、从属连词及其用法</p>
                        </div>
                        <div class="topic-card" data-reference="phrasal-verbs">
                            <h3><i class="fas fa-puzzle-piece"></i> 短语动词</h3>
                            <p>常用短语动词及其含义</p>
                        </div>
                    </div>
                    <div id="reference-content" class="exercise-container" style="display: none;">
                        <!-- Reference content will be loaded here -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <p class="copyright-text">study-llm.me域名为Alex所有。保留所有权利。</p>
                <div class="profile-section">
                    <button id="profile-button" class="profile-button">
                        <i class="fas fa-user-circle"></i>
                        学习阶段
                    </button>
                    <div id="profile-display" class="profile-display"></div>
                </div>
            </div>
        </div>
    </footer>

    <script src="../../js/navigation.js"></script>
    <script src="../../js/profile.js"></script>
    <script>
        // Comprehensive Grammar learning data
        const grammarData = {
            tenses: {
                title: "时态",
                rules: [
                    {
                        name: "一般现在时 (Simple Present)",
                        structure: "主语 + 动词原形/动词-s",
                        usage: "表示经常性动作、习惯、事实或真理",
                        examples: [
                            "I <span class='highlight'>go</span> to school every day. (经常性动作)",
                            "She <span class='highlight'>likes</span> reading books. (习惯)",
                            "The sun <span class='highlight'>rises</span> in the east. (事实)"
                        ]
                    },
                    {
                        name: "现在进行时 (Present Continuous)",
                        structure: "主语 + am/is/are + 动词-ing",
                        usage: "表示正在进行的动作或现阶段的动作",
                        examples: [
                            "I <span class='highlight'>am reading</span> a book now. (正在进行)",
                            "They <span class='highlight'>are studying</span> hard this semester. (现阶段)",
                            "She <span class='highlight'>is always complaining</span>. (表达情感)"
                        ]
                    },
                    {
                        name: "现在完成时 (Present Perfect)",
                        structure: "主语 + have/has + 过去分词",
                        usage: "表示过去发生但对现在有影响的动作，或从过去持续到现在的动作",
                        examples: [
                            "I <span class='highlight'>have finished</span> my homework. (过去完成，现在可以休息)",
                            "She <span class='highlight'>has lived</span> here for 5 years. (从过去持续到现在)",
                            "They <span class='highlight'>have never been</span> to China. (经历)"
                        ]
                    },
                    {
                        name: "现在完成进行时 (Present Perfect Continuous)",
                        structure: "主语 + have/has + been + 动词-ing",
                        usage: "表示从过去某时开始一直持续到现在的动作，强调持续性",
                        examples: [
                            "I <span class='highlight'>have been waiting</span> for two hours. (强调等待的持续)",
                            "She <span class='highlight'>has been studying</span> English since 2020. (持续学习)",
                            "It <span class='highlight'>has been raining</span> all day. (持续下雨)"
                        ]
                    },
                    {
                        name: "一般过去时 (Simple Past)",
                        structure: "主语 + 动词过去式",
                        usage: "表示过去发生的动作或状态",
                        examples: [
                            "I <span class='highlight'>went</span> to Beijing last year. (过去的动作)",
                            "She <span class='highlight'>was</span> a teacher. (过去的状态)",
                            "They <span class='highlight'>played</span> games yesterday. (过去的活动)"
                        ]
                    },
                    {
                        name: "过去进行时 (Past Continuous)",
                        structure: "主语 + was/were + 动词-ing",
                        usage: "表示过去某时正在进行的动作",
                        examples: [
                            "I <span class='highlight'>was reading</span> when he called. (过去某时正在进行)",
                            "They <span class='highlight'>were playing</span> at 3 o'clock yesterday. (过去特定时间)",
                            "She <span class='highlight'>was always helping</span> others. (过去习惯性动作)"
                        ]
                    },
                    {
                        name: "过去完成时 (Past Perfect)",
                        structure: "主语 + had + 过去分词",
                        usage: "表示过去某时间前已经完成的动作（过去的过去）",
                        examples: [
                            "I <span class='highlight'>had finished</span> the work before he came. (过去的过去)",
                            "She <span class='highlight'>had left</span> when I arrived. (先后顺序)",
                            "They <span class='highlight'>had never seen</span> such a beautiful place. (过去的经历)"
                        ]
                    },
                    {
                        name: "过去完成进行时 (Past Perfect Continuous)",
                        structure: "主语 + had + been + 动词-ing",
                        usage: "表示到过去某时为止一直在进行的动作",
                        examples: [
                            "I <span class='highlight'>had been waiting</span> for an hour when she arrived. (持续到过去某时)",
                            "She <span class='highlight'>had been working</span> there for 3 years before she quit. (过去的持续)",
                            "It <span class='highlight'>had been raining</span> for days. (过去的持续状态)"
                        ]
                    },
                    {
                        name: "一般将来时 (Simple Future)",
                        structure: "主语 + will + 动词原形 / 主语 + be going to + 动词原形",
                        usage: "表示将来的动作或状态",
                        examples: [
                            "I <span class='highlight'>will go</span> to school tomorrow. (意愿/预测)",
                            "She <span class='highlight'>is going to study</span> abroad. (计划/打算)",
                            "It <span class='highlight'>will rain</span> tomorrow. (预测)"
                        ]
                    },
                    {
                        name: "将来进行时 (Future Continuous)",
                        structure: "主语 + will be + 动词-ing",
                        usage: "表示将来某时正在进行的动作",
                        examples: [
                            "I <span class='highlight'>will be working</span> at 9 tomorrow. (将来某时的动作)",
                            "She <span class='highlight'>will be travelling</span> next month. (将来的计划)",
                            "They <span class='highlight'>will be sleeping</span> when we arrive. (将来的状态)"
                        ]
                    },
                    {
                        name: "将来完成时 (Future Perfect)",
                        structure: "主语 + will have + 过去分词",
                        usage: "表示到将来某时将要完成的动作",
                        examples: [
                            "I <span class='highlight'>will have finished</span> the project by next week. (将来完成)",
                            "She <span class='highlight'>will have graduated</span> by June. (将来的成就)",
                            "They <span class='highlight'>will have left</span> before you arrive. (将来的先后)"
                        ]
                    },
                    {
                        name: "将来完成进行时 (Future Perfect Continuous)",
                        structure: "主语 + will have been + 动词-ing",
                        usage: "表示到将来某时为止一直在进行的动作",
                        examples: [
                            "By 2025, I <span class='highlight'>will have been working</span> here for 10 years. (将来的持续)",
                            "She <span class='highlight'>will have been studying</span> for 6 hours by then. (将来的时长)",
                            "They <span class='highlight'>will have been living</span> there for a decade. (将来的持续状态)"
                        ]
                    }
                ]
            },
            articles: {
                title: "冠词",
                rules: [
                    {
                        name: "不定冠词 a/an",
                        structure: "a + 辅音音素开头的词, an + 元音音素开头的词",
                        usage: "表示泛指，第一次提到某物，表示'一个'的概念",
                        examples: [
                            "I have <span class='highlight'>a</span> cat. (泛指一只猫)",
                            "She is <span class='highlight'>an</span> engineer. (职业)",
                            "There is <span class='highlight'>a</span> university here. (虽然u开头，但读作/ju/，辅音音素)"
                        ]
                    },
                    {
                        name: "定冠词 the",
                        structure: "the + 名词",
                        usage: "表示特指，双方都知道的事物，独一无二的事物",
                        examples: [
                            "<span class='highlight'>The</span> book on the table is mine. (特指桌上的书)",
                            "I like <span class='highlight'>the</span> music you played. (特指你演奏的音乐)",
                            "<span class='highlight'>The</span> sun is shining. (独一无二的太阳)"
                        ]
                    },
                    {
                        name: "零冠词",
                        structure: "不使用冠词",
                        usage: "复数可数名词泛指，不可数名词泛指，专有名词等",
                        examples: [
                            "<span class='highlight'>Books</span> are important. (书籍泛指)",
                            "I like <span class='highlight'>music</span>. (音乐泛指)",
                            "<span class='highlight'>Beijing</span> is a beautiful city. (专有名词)"
                        ]
                    }
                ]
            },
            prepositions: {
                title: "介词",
                rules: [
                    {
                        name: "时间介词",
                        structure: "at/in/on + 时间",
                        usage: "at用于具体时刻，in用于月份/年份/季节，on用于具体日期/星期",
                        examples: [
                            "I get up <span class='highlight'>at</span> 7 o'clock. (具体时刻)",
                            "She was born <span class='highlight'>in</span> 1990. (年份)",
                            "We have a meeting <span class='highlight'>on</span> Monday. (星期)",
                            "The flowers bloom <span class='highlight'>in</span> spring. (季节)"
                        ]
                    },
                    {
                        name: "地点介词",
                        structure: "at/in/on + 地点",
                        usage: "at用于小地点/具体位置，in用于大地点/内部，on用于表面",
                        examples: [
                            "I'm <span class='highlight'>at</span> the bus stop. (具体位置)",
                            "He lives <span class='highlight'>in</span> Beijing. (大地点)",
                            "The book is <span class='highlight'>on</span> the table. (表面)",
                            "There are many people <span class='highlight'>in</span> the park. (内部)"
                        ]
                    },
                    {
                        name: "方向介词",
                        structure: "to/from/into/out of + 地点",
                        usage: "to表示朝向，from表示来自，into表示进入，out of表示从...出来",
                        examples: [
                            "I'm going <span class='highlight'>to</span> school. (朝向)",
                            "She comes <span class='highlight'>from</span> China. (来自)",
                            "He walked <span class='highlight'>into</span> the room. (进入)",
                            "They came <span class='highlight'>out of</span> the building. (从...出来)"
                        ]
                    }
                ]
            },
            conditionals: {
                title: "条件句",
                rules: [
                    {
                        name: "零条件句 (Zero Conditional)",
                        structure: "If + 一般现在时, 一般现在时",
                        usage: "表示客观事实、科学真理或普遍规律，条件成立则结果必然发生",
                        examples: [
                            "If you <span class='highlight'>heat</span> water to 100°C, it <span class='highlight'>boils</span>. (如果你把水加热到100度，它就会沸腾。)",
                            "If it <span class='highlight'>rains</span>, the ground <span class='highlight'>gets</span> wet. (如果下雨，地面就会湿。)",
                            "If you <span class='highlight'>press</span> this button, the door <span class='highlight'>opens</span>. (如果你按这个按钮，门就会开。)"
                        ]
                    },
                    {
                        name: "第一条件句 (First Conditional)",
                        structure: "If + 一般现在时, will/shall/can/may + 动词原形",
                        usage: "表示对将来可能发生的事情的假设，说话人认为条件实现的可能性较大",
                        examples: [
                            "If it <span class='highlight'>rains</span> tomorrow, we <span class='highlight'>will stay</span> at home. (如果明天下雨，我们就呆在家里。)",
                            "If you <span class='highlight'>study</span> hard, you <span class='highlight'>will pass</span> the exam. (如果你努力学习，你就会通过考试。)",
                            "If I <span class='highlight'>finish</span> my work early, I <span class='highlight'>can help</span> you. (如果我早点完成工作，我可以帮你。)"
                        ]
                    },
                    {
                        name: "第二条件句 (Second Conditional)",
                        structure: "If + 一般过去时, would/could/might + 动词原形",
                        usage: "表示对现在或将来不太可能发生的事情的假设，或与现在事实相反的假设",
                        examples: [
                            "If I <span class='highlight'>won</span> the lottery, I <span class='highlight'>would travel</span> around the world. (如果我中彩票，我会环游世界。)",
                            "If I <span class='highlight'>were</span> you, I <span class='highlight'>would tell</span> him the truth. (如果我是你，我会告诉他真相。)",
                            "If we <span class='highlight'>had</span> more time, we <span class='highlight'>could visit</span> the museum. (如果我们有更多时间，我们可以参观博物馆。)"
                        ]
                    },
                    {
                        name: "第三条件句 (Third Conditional)",
                        structure: "If + 过去完成时, would/could/might + have + 过去分词",
                        usage: "表示对过去未曾发生的事情的假设，与过去事实相反的假设",
                        examples: [
                            "If I <span class='highlight'>had studied</span> harder, I <span class='highlight'>would have passed</span> the exam. (如果我当时学习更努力，我就会通过考试。)",
                            "If you <span class='highlight'>had told</span> me, I <span class='highlight'>could have helped</span> you. (如果你告诉我，我本可以帮助你。)",
                            "If it <span class='highlight'>hadn't rained</span>, we <span class='highlight'>would have gone</span> to the beach. (如果没下雨，我们本会去海滩。)"
                        ]
                    },
                    {
                        name: "混合条件句 (Mixed Conditionals)",
                        structure: "混合不同时间的条件句结构",
                        usage: "条件和结果可能发生在不同的时间",
                        examples: [
                            "If I <span class='highlight'>had studied</span> medicine, I <span class='highlight'>would be</span> a doctor now. (如果我曾经学医，我现在就是医生了。)",
                            "If you <span class='highlight'>had taken</span> my advice, you <span class='highlight'>wouldn't have</span> these problems now. (如果你当时接受了我的建议，你现在就不会有这些问题了。)",
                            "If I <span class='highlight'>weren't</span> so busy, I <span class='highlight'>would have visited</span> you yesterday. (如果我不是这么忙，我昨天就会拜访你了。)",
                            "If he <span class='highlight'>were</span> more careful, he <span class='highlight'>wouldn't have made</span> that mistake. (如果他更小心，他就不会犯那个错误了。)"
                        ]
                    }
                ]
            },
            passive: {
                title: "被动语态",
                rules: [
                    {
                        name: "一般现在时被动语态",
                        structure: "主语 + am/is/are + 过去分词",
                        usage: "表示现在经常性的被动动作或状态",
                        examples: [
                            "English <span class='highlight'>is spoken</span> in many countries. (经常性状态)",
                            "The letters <span class='highlight'>are delivered</span> every morning. (定期动作)",
                            "This song <span class='highlight'>is loved</span> by everyone. (普遍状态)"
                        ]
                    },
                    {
                        name: "一般过去时被动语态",
                        structure: "主语 + was/were + 过去分词",
                        usage: "表示过去发生的被动动作",
                        examples: [
                            "The house <span class='highlight'>was built</span> in 1990. (过去的动作)",
                            "Many trees <span class='highlight'>were planted</span> last year. (过去的活动)",
                            "The letter <span class='highlight'>was written</span> by him. (过去的行为)"
                        ]
                    },
                    {
                        name: "一般将来时被动语态",
                        structure: "主语 + will be + 过去分词",
                        usage: "表示将来的被动动作",
                        examples: [
                            "A new bridge <span class='highlight'>will be built</span> next year. (将来的计划)",
                            "The meeting <span class='highlight'>will be held</span> tomorrow. (将来的安排)",
                            "The problem <span class='highlight'>will be solved</span> soon. (将来的预期)"
                        ]
                    },
                    {
                        name: "现在完成时被动语态",
                        structure: "主语 + have/has been + 过去分词",
                        usage: "表示已经完成的被动动作对现在的影响",
                        examples: [
                            "The work <span class='highlight'>has been finished</span>. (已完成的工作)",
                            "Many mistakes <span class='highlight'>have been corrected</span>. (已纠正的错误)",
                            "The book <span class='highlight'>has been translated</span> into Chinese. (已翻译的书)"
                        ]
                    },
                    {
                        name: "含情态动词的被动语态",
                        structure: "主语 + 情态动词 + be + 过去分词",
                        usage: "表示带有情态意义的被动动作",
                        examples: [
                            "This problem <span class='highlight'>must be solved</span> immediately. (必须)",
                            "The door <span class='highlight'>should be locked</span>. (应该)",
                            "English <span class='highlight'>can be learned</span> easily. (能够)"
                        ]
                    }
                ]
            },
            modals: {
                title: "情态动词",
                rules: [
                    {
                        name: "can / could",
                        structure: "主语 + can/could + 动词原形",
                        usage: "can表示能力、许可、可能性；could表示过去的能力、委婉请求",
                        examples: [
                            "I <span class='highlight'>can</span> swim. (能力)",
                            "You <span class='highlight'>can</span> go now. (许可)",
                            "<span class='highlight'>Could</span> you help me? (委婉请求)",
                            "She <span class='highlight'>could</span> play piano when she was young. (过去能力)"
                        ]
                    },
                    {
                        name: "may / might",
                        structure: "主语 + may/might + 动词原形",
                        usage: "may表示许可、可能性；might表示更小的可能性或委婉语气",
                        examples: [
                            "<span class='highlight'>May</span> I come in? (正式请求许可)",
                            "It <span class='highlight'>may</span> rain tomorrow. (可能性)",
                            "He <span class='highlight'>might</span> be late. (较小可能性)",
                            "You <span class='highlight'>might</span> want to check this. (委婉建议)"
                        ]
                    },
                    {
                        name: "must / have to",
                        structure: "主语 + must/have to + 动词原形",
                        usage: "must表示强烈义务、推测；have to表示客观需要",
                        examples: [
                            "You <span class='highlight'>must</span> finish your homework. (强烈义务)",
                            "She <span class='highlight'>must</span> be tired. (推测)",
                            "I <span class='highlight'>have to</span> go to work. (客观需要)",
                            "Students <span class='highlight'>have to</span> wear uniforms. (规定)"
                        ]
                    },
                    {
                        name: "should / ought to",
                        structure: "主语 + should/ought to + 动词原形",
                        usage: "表示建议、义务、应该做的事",
                        examples: [
                            "You <span class='highlight'>should</span> study more. (建议)",
                            "We <span class='highlight'>should</span> respect our parents. (道德义务)",
                            "You <span class='highlight'>ought to</span> help others. (应该)",
                            "Students <span class='highlight'>should</span> listen carefully. (期望)"
                        ]
                    },
                    {
                        name: "will / would",
                        structure: "主语 + will/would + 动词原形",
                        usage: "will表示意愿、将来；would表示过去习惯、委婉请求",
                        examples: [
                            "I <span class='highlight'>will</span> help you. (意愿)",
                            "It <span class='highlight'>will</span> be sunny tomorrow. (将来)",
                            "<span class='highlight'>Would</span> you like some tea? (委婉邀请)",
                            "He <span class='highlight'>would</span> often visit us. (过去习惯)"
                        ]
                    },
                    {
                        name: "need / dare",
                        structure: "主语 + need/dare + 动词原形 (否定疑问句)",
                        usage: "need表示需要；dare表示敢于",
                        examples: [
                            "You <span class='highlight'>needn't</span> worry. (不需要)",
                            "<span class='highlight'>Need</span> I say more? (需要吗？)",
                            "He <span class='highlight'>daren't</span> speak. (不敢)",
                            "<span class='highlight'>Dare</span> you jump? (敢吗？)"
                        ]
                    }
                ]
            }
        };

        // Enhanced Practice questions data
        const practiceQuestions = {
            tenses: [
                {
                    question: "I _____ to school every day.",
                    options: ["go", "goes", "going", "went"],
                    correct: 0,
                    explanation: "主语是I，一般现在时用动词原形。"
                },
                {
                    question: "She _____ her homework now.",
                    options: ["do", "does", "is doing", "did"],
                    correct: 2,
                    explanation: "now表示现在进行时，结构是be + doing。"
                },
                {
                    question: "They _____ to the park yesterday.",
                    options: ["go", "goes", "going", "went"],
                    correct: 3,
                    explanation: "yesterday表示过去时间，用过去式went。"
                },
                {
                    question: "I _____ this book already.",
                    options: ["read", "have read", "am reading", "will read"],
                    correct: 1,
                    explanation: "already表示现在完成时，结构是have/has + 过去分词。"
                },
                {
                    question: "By next year, I _____ here for 5 years.",
                    options: ["work", "worked", "will work", "will have worked"],
                    correct: 3,
                    explanation: "by next year表示将来完成时，结构是will have + 过去分词。"
                },
                {
                    question: "I _____ for you when you arrived.",
                    options: ["wait", "waited", "was waiting", "have waited"],
                    correct: 2,
                    explanation: "when you arrived表示过去某时正在进行的动作，用过去进行时。"
                }
            ],
            articles: [
                {
                    question: "I saw _____ elephant at the zoo.",
                    options: ["a", "an", "the", "/"],
                    correct: 1,
                    explanation: "elephant以元音音素开头，用an。"
                },
                {
                    question: "_____ book you lent me is very interesting.",
                    options: ["A", "An", "The", "/"],
                    correct: 2,
                    explanation: "特指你借给我的那本书，用the。"
                },
                {
                    question: "I like _____ music.",
                    options: ["a", "an", "the", "/"],
                    correct: 3,
                    explanation: "music是不可数名词，泛指时不用冠词。"
                },
                {
                    question: "_____ sun is very bright today.",
                    options: ["A", "An", "The", "/"],
                    correct: 2,
                    explanation: "sun是独一无二的事物，用定冠词the。"
                }
            ],
            prepositions: [
                {
                    question: "I was born _____ 1990.",
                    options: ["at", "in", "on", "by"],
                    correct: 1,
                    explanation: "年份前用介词in。"
                },
                {
                    question: "The meeting is _____ 3 o'clock.",
                    options: ["at", "in", "on", "by"],
                    correct: 0,
                    explanation: "具体时刻前用介词at。"
                },
                {
                    question: "I live _____ Beijing.",
                    options: ["at", "in", "on", "by"],
                    correct: 1,
                    explanation: "大地点（城市）前用介词in。"
                },
                {
                    question: "We have a party _____ Friday night.",
                    options: ["at", "in", "on", "by"],
                    correct: 2,
                    explanation: "具体的某天晚上用介词on。"
                }
            ],
            conditionals: [
                {
                    question: "If it _____ tomorrow, we will stay home.",
                    options: ["rain", "rains", "rained", "will rain"],
                    correct: 1,
                    explanation: "第一条件句：If + 一般现在时, will + 动词原形。"
                },
                {
                    question: "If I _____ rich, I would travel the world.",
                    options: ["am", "was", "were", "will be"],
                    correct: 2,
                    explanation: "第二条件句用虚拟语气，be动词用were。"
                },
                {
                    question: "If I _____ harder, I would have passed the exam.",
                    options: ["studied", "had studied", "study", "will study"],
                    correct: 1,
                    explanation: "第三条件句：If + 过去完成时, would have + 过去分词。"
                },
                {
                    question: "If you heat ice, it _____.",
                    options: ["melt", "melts", "melted", "will melt"],
                    correct: 1,
                    explanation: "零条件句表示客观事实，两个分句都用一般现在时。"
                }
            ],
            passive: [
                {
                    question: "English _____ in many countries.",
                    options: ["speaks", "is spoken", "was spoken", "has spoken"],
                    correct: 1,
                    explanation: "一般现在时被动语态：is/are + 过去分词。"
                },
                {
                    question: "The house _____ in 1990.",
                    options: ["builds", "built", "was built", "has built"],
                    correct: 2,
                    explanation: "一般过去时被动语态：was/were + 过去分词。"
                },
                {
                    question: "A new school _____ next year.",
                    options: ["builds", "will build", "will be built", "has built"],
                    correct: 2,
                    explanation: "一般将来时被动语态：will be + 过去分词。"
                },
                {
                    question: "The work _____ already.",
                    options: ["finishes", "finished", "has finished", "has been finished"],
                    correct: 3,
                    explanation: "现在完成时被动语态：have/has been + 过去分词。"
                }
            ],
            modals: [
                {
                    question: "You _____ finish your homework before playing.",
                    options: ["can", "may", "must", "might"],
                    correct: 2,
                    explanation: "must表示强烈的义务和必要性。"
                },
                {
                    question: "_____ I borrow your pen?",
                    options: ["Must", "Should", "May", "Need"],
                    correct: 2,
                    explanation: "May用于正式的请求许可。"
                },
                {
                    question: "You _____ study harder if you want to pass.",
                    options: ["can", "should", "may", "might"],
                    correct: 1,
                    explanation: "should表示建议和忠告。"
                },
                {
                    question: "She _____ swim when she was 5 years old.",
                    options: ["can", "could", "may", "might"],
                    correct: 1,
                    explanation: "could表示过去的能力。"
                }
            ]
        };

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            initGrammarTabs();
            initTopicCards();
            initPracticeSystem();
            initTestSystem();
            initReferenceSystem();
        });

        // Tab system
        function initGrammarTabs() {
            const tabs = document.querySelectorAll('.grammar-tab');
            const panels = document.querySelectorAll('.grammar-panel');

            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetPanel = this.getAttribute('data-tab') + '-panel';
                    
                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update active panel
                    panels.forEach(p => p.classList.remove('active'));
                    document.getElementById(targetPanel).classList.add('active');
                });
            });
        }

        // Topic cards in learn panel
        function initTopicCards() {
            const topicCards = document.querySelectorAll('[data-topic]');
            const topicContent = document.getElementById('topic-content');

            topicCards.forEach(card => {
                card.addEventListener('click', function() {
                    const topic = this.getAttribute('data-topic');
                    
                    // Update selected card
                    topicCards.forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    // Load topic content
                    loadTopicContent(topic, topicContent);
                });
            });
        }

        function loadTopicContent(topic, container) {
            const data = grammarData[topic];
            if (!data) return;

            let html = `<h3><i class="fas fa-book-open"></i> ${data.title}</h3>`;
            
            // Special layout for tenses
            if (topic === 'tenses') {
                html += `<div class="tense-chart">`;
                data.rules.forEach(rule => {
                    html += `
                        <div class="tense-box">
                            <h4>${rule.name}</h4>
                            <p><strong>结构：</strong>${rule.structure}</p>
                            <p><strong>用法：</strong>${rule.usage}</p>
                            <div class="examples">
                                ${rule.examples.map(ex => `<div class="example-sentence">${ex}</div>`).join('')}
                            </div>
                        </div>
                    `;
                });
                html += `</div>`;
            }
            // Special layout for conditionals
            else if (topic === 'conditionals') {
                html += `<div class="conditional-types">`;
                data.rules.forEach(rule => {
                    html += `
                        <div class="conditional-card">
                            <h4>${rule.name}</h4>
                            <p><strong>结构：</strong>${rule.structure}</p>
                            <p><strong>用法：</strong>${rule.usage}</p>
                            <div class="examples">
                                <strong>例句：</strong>
                                ${rule.examples.map(ex => `<div class="example-sentence">${ex}</div>`).join('')}
                            </div>
                        </div>
                    `;
                });
                html += `</div>`;
            }
            // Special layout for modals
            else if (topic === 'modals') {
                html += `<div class="modal-showcase">`;
                data.rules.forEach(rule => {
                    html += `
                        <div class="modal-card">
                            <h4>${rule.name}</h4>
                            <p><strong>结构：</strong>${rule.structure}</p>
                            <p><strong>用法：</strong>${rule.usage}</p>
                            <div class="examples">
                                ${rule.examples.map(ex => `<div class="example-sentence">${ex}</div>`).join('')}
                            </div>
                        </div>
                    `;
                });
                html += `</div>`;
            }
            // Default layout for other topics
            else {
            data.rules.forEach(rule => {
                html += `
                    <div class="grammar-rule">
                        <h4>${rule.name}</h4>
                        <p><strong>结构：</strong>${rule.structure}</p>
                        <p><strong>用法：</strong>${rule.usage}</p>
                        <div class="examples">
                            <strong>例句：</strong>
                            ${rule.examples.map(ex => `<div class="example-sentence">${ex}</div>`).join('')}
                        </div>
                    </div>
                `;
            });
            }

            container.innerHTML = html;
            container.style.display = 'block';
        }

        // Practice system
        function initPracticeSystem() {
            const startBtn = document.getElementById('start-practice');
            const container = document.getElementById('practice-container');
            const questionsDiv = document.getElementById('practice-questions');
            const progressBar = document.getElementById('practice-progress');

            let currentQuestions = [];
            let currentQuestionIndex = 0;
            let score = 0;

            startBtn.addEventListener('click', function() {
                const topic = document.getElementById('practice-topic').value;
                const difficulty = document.getElementById('practice-difficulty').value;
                
                startPractice(topic, difficulty);
            });

            function startPractice(topic, difficulty) {
                currentQuestions = generatePracticeQuestions(topic, difficulty);
                currentQuestionIndex = 0;
                score = 0;
                
                container.style.display = 'block';
                showQuestion();
            }

            function generatePracticeQuestions(topic, difficulty) {
                if (topic === 'mixed') {
                    let questions = [];
                    Object.keys(practiceQuestions).forEach(key => {
                        questions = questions.concat(practiceQuestions[key]);
                    });
                    return shuffleArray(questions).slice(0, 15);
                } else if (practiceQuestions[topic]) {
                    return shuffleArray(practiceQuestions[topic]);
                } else {
                    return generateDefaultQuestions(topic, difficulty);
                }
            }

            function generateDefaultQuestions(topic, difficulty) {
                return [
                    {
                        question: `这是一个${topic}的${difficulty}级别练习题。`,
                        options: ["选项A", "选项B", "选项C", "选项D"],
                        correct: 0,
                        explanation: "这是示例解释。"
                    }
                ];
            }

            function showQuestion() {
                if (currentQuestionIndex >= currentQuestions.length) {
                    showPracticeResults();
                    return;
                }

                const question = currentQuestions[currentQuestionIndex];
                const progress = ((currentQuestionIndex + 1) / currentQuestions.length) * 100;
                progressBar.style.width = progress + '%';

                questionsDiv.innerHTML = `
                    <div class="exercise-question">
                        <h4>题目 ${currentQuestionIndex + 1}/${currentQuestions.length}</h4>
                        <p>${question.question}</p>
                        <div class="exercise-options">
                            ${question.options.map((option, index) => 
                                `<button class="exercise-option" data-index="${index}">${option}</button>`
                            ).join('')}
                        </div>
                        <div id="question-explanation" style="display: none;"></div>
                        <button id="next-question" class="btn btn-primary" style="display: none; margin-top: 1rem;">下一题</button>
                    </div>
                `;

                // Add option click handlers
                const options = questionsDiv.querySelectorAll('.exercise-option');
                options.forEach(option => {
                    option.addEventListener('click', function() {
                        const selectedIndex = parseInt(this.getAttribute('data-index'));
                        checkAnswer(selectedIndex, question);
                    });
                });

                // Add next question handler
                document.getElementById('next-question').addEventListener('click', function() {
                    currentQuestionIndex++;
                    showQuestion();
                });
            }

            function checkAnswer(selectedIndex, question) {
                const options = questionsDiv.querySelectorAll('.exercise-option');
                const explanationDiv = document.getElementById('question-explanation');
                const nextBtn = document.getElementById('next-question');

                options.forEach((option, index) => {
                    option.disabled = true;
                    if (index === question.correct) {
                        option.classList.add('correct');
                    } else if (index === selectedIndex && index !== question.correct) {
                        option.classList.add('incorrect');
                    }
                });

                if (selectedIndex === question.correct) {
                    score++;
                }

                explanationDiv.innerHTML = `
                    <div class="explanation-box">
                        <h5><i class="fas fa-lightbulb"></i> 解释</h5>
                        <p>${question.explanation}</p>
                    </div>
                `;
                explanationDiv.style.display = 'block';
                nextBtn.style.display = 'block';
            }

            function showPracticeResults() {
                const percentage = Math.round((score / currentQuestions.length) * 100);
                const resultsDiv = document.getElementById('practice-results');
                
                resultsDiv.innerHTML = `
                    <div class="score-display">
                        <div class="score-number">${percentage}%</div>
                        <p>您答对了 ${score}/${currentQuestions.length} 题</p>
                        <button class="btn btn-primary" onclick="location.reload()">重新练习</button>
                    </div>
                `;
                
                questionsDiv.style.display = 'none';
                resultsDiv.style.display = 'block';
            }
        }

        // Test system (enhanced)
        function initTestSystem() {
            const startBtn = document.getElementById('start-test');
            const container = document.getElementById('test-container');
            const questionsDiv = document.getElementById('test-questions');
            const progressBar = document.getElementById('test-progress');

            let currentQuestions = [];
            let currentQuestionIndex = 0;
            let score = 0;
            
            startBtn.addEventListener('click', function() {
                const level = document.getElementById('test-level').value;
                startTest(level);
            });

            function startTest(level) {
                currentQuestions = generateTestQuestions(level);
                currentQuestionIndex = 0;
                score = 0;
                
                container.style.display = 'block';
                showTestQuestion();
            }

            function generateTestQuestions(level) {
                let questions = [];
                Object.keys(practiceQuestions).forEach(key => {
                    questions = questions.concat(practiceQuestions[key]);
                });
                
                const questionCount = level === 'elementary' ? 20 : 
                                    level === 'intermediate' ? 25 : 30;
                
                return shuffleArray(questions).slice(0, questionCount);
            }

            function showTestQuestion() {
                if (currentQuestionIndex >= currentQuestions.length) {
                    showTestResults();
                    return;
                }

                const question = currentQuestions[currentQuestionIndex];
                const progress = ((currentQuestionIndex + 1) / currentQuestions.length) * 100;
                progressBar.style.width = progress + '%';

                questionsDiv.innerHTML = `
                    <div class="exercise-question">
                        <h4>测试题目 ${currentQuestionIndex + 1}/${currentQuestions.length}</h4>
                        <p>${question.question}</p>
                        <div class="exercise-options">
                            ${question.options.map((option, index) => 
                                `<button class="exercise-option" data-index="${index}">${option}</button>`
                            ).join('')}
                        </div>
                        <button id="next-test-question" class="btn btn-primary" style="display: none; margin-top: 1rem;">下一题</button>
                    </div>
                `;

                // Add option click handlers
                const options = questionsDiv.querySelectorAll('.exercise-option');
                options.forEach(option => {
                    option.addEventListener('click', function() {
                        const selectedIndex = parseInt(this.getAttribute('data-index'));
                        
                        // Mark selection
                        options.forEach(opt => opt.classList.remove('selected'));
                        this.classList.add('selected');
                        
                        // Check answer
                        if (selectedIndex === question.correct) {
                            score++;
                        }
                        
                        // Show next button
                        document.getElementById('next-test-question').style.display = 'block';
                    });
                });

                // Add next question handler
                document.getElementById('next-test-question').addEventListener('click', function() {
                    currentQuestionIndex++;
                    showTestQuestion();
                });
            }

            function showTestResults() {
                const percentage = Math.round((score / currentQuestions.length) * 100);
                const resultsDiv = document.getElementById('test-results');
                
                let level = '';
                if (percentage >= 90) level = '优秀';
                else if (percentage >= 80) level = '良好';
                else if (percentage >= 70) level = '中等';
                else if (percentage >= 60) level = '及格';
                else level = '需要加强';
                
                resultsDiv.innerHTML = `
                    <div class="score-display">
                        <div class="score-number">${percentage}%</div>
                        <p>您答对了 ${score}/${currentQuestions.length} 题</p>
                        <p>评级：<strong>${level}</strong></p>
                        <button class="btn btn-primary" onclick="location.reload()">重新测试</button>
                    </div>
                `;
                
                questionsDiv.style.display = 'none';
                resultsDiv.style.display = 'block';
            }
        }

        // Reference system
        function initReferenceSystem() {
            const referenceCards = document.querySelectorAll('[data-reference]');
            const referenceContent = document.getElementById('reference-content');

            referenceCards.forEach(card => {
                card.addEventListener('click', function() {
                    const reference = this.getAttribute('data-reference');
                    
                    referenceCards.forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    loadReferenceContent(reference, referenceContent);
                });
            });
        }

        function loadReferenceContent(reference, container) {
            let html = '';
            
            switch(reference) {
                case 'tenses':
                    html = `
                        <h3><i class="fas fa-clock"></i> 时态总览</h3>
                        <div class="tense-chart">
                            <div class="tense-box">
                            <h4>现在时态</h4>
                                <p><strong>一般现在时：</strong>I work (我工作)</p>
                                <p><strong>基本结构：</strong>主语 + 动词原形(第三人称单数+s)</p>
                                <p><strong>主要用法：</strong>表达事实、习惯、经常性动作</p>
                                <div class="example-sentence">He plays basketball every week.</div>
                                
                                <p><strong>现在进行时：</strong>I am working (我正在工作)</p>
                                <p><strong>基本结构：</strong>主语 + am/is/are + 动词ing形式</p>
                                <p><strong>主要用法：</strong>表示正在进行的动作、临时性动作</p>
                                <div class="example-sentence">They are studying for the exam.</div>
                                
                                <p><strong>现在完成时：</strong>I have worked (我已经工作了)</p>
                                <p><strong>基本结构：</strong>主语 + have/has + 过去分词</p>
                                <p><strong>主要用法：</strong>表示过去发生且与现在有联系的动作</p>
                                <div class="example-sentence">She has lived here for ten years.</div>
                                
                                <p><strong>现在完成进行时：</strong>I have been working (我一直在工作)</p>
                                <p><strong>基本结构：</strong>主语 + have/has been + 动词ing形式</p>
                                <p><strong>主要用法：</strong>强调动作从过去持续到现在的过程</p>
                                <div class="example-sentence">It has been raining all day.</div>
                        </div>
                            
                            <div class="tense-box">
                            <h4>过去时态</h4>
                                <p><strong>一般过去时：</strong>I worked (我工作了)</p>
                                <p><strong>基本结构：</strong>主语 + 动词过去式</p>
                                <p><strong>主要用法：</strong>表示过去某个时间发生的动作</p>
                                <div class="example-sentence">They visited Paris last summer.</div>
                                
                                <p><strong>过去进行时：</strong>I was working (我当时正在工作)</p>
                                <p><strong>基本结构：</strong>主语 + was/were + 动词ing形式</p>
                                <p><strong>主要用法：</strong>表示过去某时正在进行的动作</p>
                                <div class="example-sentence">She was reading when I called.</div>
                                
                                <p><strong>过去完成时：</strong>I had worked (我已经工作过了)</p>
                                <p><strong>基本结构：</strong>主语 + had + 过去分词</p>
                                <p><strong>主要用法：</strong>表示过去某动作之前发生的动作</p>
                                <div class="example-sentence">He had finished his homework before dinner.</div>
                                
                                <p><strong>过去完成进行时：</strong>I had been working (我一直在工作)</p>
                                <p><strong>基本结构：</strong>主语 + had been + 动词ing形式</p>
                                <p><strong>主要用法：</strong>强调过去某时刻之前持续进行的动作</p>
                                <div class="example-sentence">They had been waiting for three hours when the bus arrived.</div>
                        </div>
                            
                            <div class="tense-box">
                            <h4>将来时态</h4>
                                <p><strong>一般将来时：</strong>I will work / I am going to work</p>
                                <p><strong>基本结构：</strong>主语 + will + 动词原形 / 主语 + be going to + 动词原形</p>
                                <p><strong>主要用法：</strong>表示将来要发生的动作或状态</p>
                                <div class="example-sentence">We will visit you next week. (临时决定)</div>
                                <div class="example-sentence">We are going to visit you next week. (计划)</div>
                                
                                <p><strong>将来进行时：</strong>I will be working (我将正在工作)</p>
                                <p><strong>基本结构：</strong>主语 + will be + 动词ing形式</p>
                                <p><strong>主要用法：</strong>表示将来某时刻正在进行的动作</p>
                                <div class="example-sentence">This time tomorrow, I will be flying to Beijing.</div>
                                
                                <p><strong>将来完成时：</strong>I will have worked (我将已经工作)</p>
                                <p><strong>基本结构：</strong>主语 + will have + 过去分词</p>
                                <p><strong>主要用法：</strong>表示到将来某时为止已经完成的动作</p>
                                <div class="example-sentence">By next year, he will have graduated from college.</div>
                                
                                <p><strong>将来完成进行时：</strong>I will have been working</p>
                                <p><strong>基本结构：</strong>主语 + will have been + 动词ing形式</p>
                                <p><strong>主要用法：</strong>表示到将来某时为止一直在进行的动作</p>
                                <div class="example-sentence">By next month, I will have been working here for five years.</div>
                            </div>
                            
                            <div class="tense-box">
                                <h4>时态选择要点</h4>
                                <p><strong>选择一般时态：</strong>表达事实、习惯、重复动作</p>
                                <p><strong>选择进行时态：</strong>强调动作正在进行或暂时性</p>
                                <p><strong>选择完成时态：</strong>表达动作的完成、结果或影响</p>
                                <p><strong>选择完成进行时态：</strong>强调动作的持续性和延续性</p>
                                <p><strong>时态一致性：</strong>在复合句中保持主从句时态的合理搭配</p>
                            </div>
                        </div>
                    `;
                    break;
                case 'sentence-structure':
                    html = `
                        <h3><i class="fas fa-sitemap"></i> 句子结构</h3>
                        <div class="grammar-rule">
                            <h4>简单句 (Simple Sentence)</h4>
                            <p>只包含一个独立子句（一个主语和一个谓语）</p>
                            <p><strong>五种基本句型：</strong></p>
                            <p>1. 主语 + 谓语：<span class="highlight">Birds fly.</span> (鸟儿飞。)</p>
                            <p>2. 主语 + 谓语 + 宾语：<span class="highlight">I love music.</span> (我喜欢音乐。)</p>
                            <p>3. 主语 + 谓语 + 间接宾语 + 直接宾语：<span class="highlight">She gave me a book.</span> (她给了我一本书。)</p>
                            <p>4. 主语 + 谓语 + 宾语 + 宾语补足语：<span class="highlight">They made him chairman.</span> (他们选他当主席。)</p>
                            <p>5. 主语 + 系动词 + 表语：<span class="highlight">The food tastes delicious.</span> (这食物尝起来很美味。)</p>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>复合句 (Compound Sentence)</h4>
                            <p>由两个或多个独立子句通过并列连词连接而成</p>
                            <p><strong>常用并列连词：</strong></p>
                            <p>and (和)：<span class="highlight">She cooked dinner, and he washed the dishes.</span></p>
                            <p>but (但是)：<span class="highlight">I wanted to go, but it was raining.</span></p>
                            <p>or (或者)：<span class="highlight">You can study now, or you can fail the exam.</span></p>
                            <p>so (所以)：<span class="highlight">It was late, so we took a taxi.</span></p>
                            <p>yet (然而)：<span class="highlight">He tried hard, yet he failed.</span></p>
                            <p>for (因为)：<span class="highlight">I went to bed early, for I was tired.</span></p>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>复杂句 (Complex Sentence)</h4>
                            <p>包含一个主句和一个或多个从句</p>
                            <p><strong>从句的类型：</strong></p>
                            <p>1. 名词性从句：作主语、宾语、表语或同位语</p>
                            <div class="example-sentence">What you said is important. (主语从句)</div>
                            <div class="example-sentence">I know that she will come. (宾语从句)</div>
                            <div class="example-sentence">The fact is that he lied. (表语从句)</div>
                            
                            <p>2. 定语从句：修饰名词或代词</p>
                            <div class="example-sentence">The book which I bought yesterday is interesting. (限制性定语从句)</div>
                            <div class="example-sentence">My father, who is a doctor, works in that hospital. (非限制性定语从句)</div>
                            
                            <p>3. 状语从句：修饰动词、形容词、副词或整个句子</p>
                            <div class="example-sentence">When it rains, I stay at home. (时间状语从句)</div>
                            <div class="example-sentence">I will go wherever you go. (地点状语从句)</div>
                            <div class="example-sentence">Because he was ill, he didn't come. (原因状语从句)</div>
                            <div class="example-sentence">If it rains tomorrow, we will stay at home. (条件状语从句)</div>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>复合复杂句 (Compound-Complex Sentence)</h4>
                            <p>包含两个或多个主句和一个或多个从句</p>
                            <div class="example-sentence">When I arrived home, my wife was cooking dinner, and my children were watching TV.</div>
                            <div class="example-sentence">I believe that he will succeed, but many people doubt whether he has the ability.</div>
                        </div>
                    `;
                    break;
                case 'common-errors':
                    html = `
                        <h3><i class="fas fa-exclamation-triangle"></i> 常见错误</h3>
                        <div class="grammar-rule">
                            <h4>主谓一致错误</h4>
                            <p>❌ He <span class="highlight">don't</span> like it. ✅ He <span class="highlight">doesn't</span> like it.</p>
                            <p>❌ There <span class="highlight">is</span> many books. ✅ There <span class="highlight">are</span> many books.</p>
                            <p>❌ Everyone <span class="highlight">are</span> ready. ✅ Everyone <span class="highlight">is</span> ready.</p>
                            <p>❌ The number of students <span class="highlight">are</span> increasing. ✅ The number of students <span class="highlight">is</span> increasing.</p>
                            <p>❌ Neither of them <span class="highlight">are</span> right. ✅ Neither of them <span class="highlight">is</span> right.</p>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>时态错误</h4>
                            <p>❌ I <span class="highlight">am go</span> to school. ✅ I <span class="highlight">go</span> to school. / I <span class="highlight">am going</span> to school.</p>
                            <p>❌ I <span class="highlight">have went</span> there. ✅ I <span class="highlight">have gone</span> there. / I <span class="highlight">went</span> there.</p>
                            <p>❌ I <span class="highlight">am</span> living here since 2010. ✅ I <span class="highlight">have been</span> living here since 2010.</p>
                            <p>❌ I <span class="highlight">finish</span> my homework yesterday. ✅ I <span class="highlight">finished</span> my homework yesterday.</p>
                            <p>❌ She <span class="highlight">will</span> come when she <span class="highlight">will finish</span> work. ✅ She <span class="highlight">will</span> come when she <span class="highlight">finishes</span> work.</p>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>冠词错误</h4>
                            <p>❌ I have <span class="highlight">a</span> apple. ✅ I have <span class="highlight">an</span> apple.</p>
                            <p>❌ I like <span class="highlight">the</span> music. ✅ I like <span class="highlight">∅</span> music. (泛指)</p>
                            <p>❌ She is <span class="highlight">∅</span> university student. ✅ She is <span class="highlight">a</span> university student.</p>
                            <p>❌ <span class="highlight">The</span> Mount Everest is the highest mountain. ✅ <span class="highlight">∅</span> Mount Everest is the highest mountain.</p>
                            <p>❌ I go to <span class="highlight">∅</span> school that is near my home. ✅ I go to <span class="highlight">the</span> school that is near my home.</p>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>介词错误</h4>
                            <p>❌ I arrive <span class="highlight">to</span> school. ✅ I arrive <span class="highlight">at</span> school.</p>
                            <p>❌ <span class="highlight">In</span> Monday morning. ✅ <span class="highlight">On</span> Monday morning.</p>
                            <p>❌ I'm afraid <span class="highlight">from</span> dogs. ✅ I'm afraid <span class="highlight">of</span> dogs.</p>
                            <p>❌ She's married <span class="highlight">with</span> my brother. ✅ She's married <span class="highlight">to</span> my brother.</p>
                            <p>❌ I'm looking <span class="highlight">∅</span> your help. ✅ I'm looking <span class="highlight">for</span> your help.</p>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>可数与不可数名词错误</h4>
                            <p>❌ I need some <span class="highlight">informations</span>. ✅ I need some <span class="highlight">information</span>.</p>
                            <p>❌ How <span class="highlight">many</span> money do you have? ✅ How <span class="highlight">much</span> money do you have?</p>
                            <p>❌ He gave me <span class="highlight">an advice</span>. ✅ He gave me <span class="highlight">some advice</span> / <span class="highlight">a piece of advice</span>.</p>
                            <p>❌ I bought <span class="highlight">a new furniture</span>. ✅ I bought <span class="highlight">some new furniture</span> / <span class="highlight">a piece of new furniture</span>.</p>
                            <p>❌ I need <span class="highlight">a bread</span>. ✅ I need <span class="highlight">some bread</span> / <span class="highlight">a loaf of bread</span> / <span class="highlight">a slice of bread</span>.</p>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>代词错误</h4>
                            <p>❌ <span class="highlight">Me</span> and my friend went to the movies. ✅ <span class="highlight">My friend and I</span> went to the movies.</p>
                            <p>❌ Between you and <span class="highlight">I</span>. ✅ Between you and <span class="highlight">me</span>.</p>
                            <p>❌ Everyone has <span class="highlight">their</span> own opinion. ✅ Everyone has <span class="highlight">his or her</span> own opinion.</p>
                            <p>❌ Give it to <span class="highlight">they</span>. ✅ Give it to <span class="highlight">them</span>.</p>
                        </div>
                    `;
                    break;
                case 'irregular-verbs':
                    html = `
                        <h3><i class="fas fa-list"></i> 不规则动词表</h3>
                        <div class="grammar-rule">
                            <h4>AAA型（三种形式相同）</h4>
                            <table style="width:100%; border-collapse: collapse; margin: 10px 0;">
                                <tr style="background: #f5f5f5;">
                                    <th style="padding: 8px; border: 1px solid #ddd;">原形</th>
                                    <th style="padding: 8px; border: 1px solid #ddd;">过去式</th>
                                    <th style="padding: 8px; border: 1px solid #ddd;">过去分词</th>
                                    <th style="padding: 8px; border: 1px solid #ddd;">中文意思</th>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ddd;">cut</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">cut</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">cut</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">切，割</td>
                                </tr>
                                <tr style="background: #f5f5f5;">
                                    <td style="padding: 8px; border: 1px solid #ddd;">hit</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">hit</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">hit</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">打，击中</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ddd;">put</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">put</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">put</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">放，置</td>
                                </tr>
                                <tr style="background: #f5f5f5;">
                                    <td style="padding: 8px; border: 1px solid #ddd;">cost</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">cost</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">cost</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">花费</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ddd;">hurt</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">hurt</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">hurt</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">伤害</td>
                                </tr>
                                <tr style="background: #f5f5f5;">
                                    <td style="padding: 8px; border: 1px solid #ddd;">let</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">let</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">let</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">让，允许</td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>ABA型（第一和第三形式相同）</h4>
                            <table style="width:100%; border-collapse: collapse; margin: 10px 0;">
                                <tr style="background: #f5f5f5;">
                                    <th style="padding: 8px; border: 1px solid #ddd;">原形</th>
                                    <th style="padding: 8px; border: 1px solid #ddd;">过去式</th>
                                    <th style="padding: 8px; border: 1px solid #ddd;">过去分词</th>
                                    <th style="padding: 8px; border: 1px solid #ddd;">中文意思</th>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ddd;">come</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">came</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">come</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">来</td>
                                </tr>
                                <tr style="background: #f5f5f5;">
                                    <td style="padding: 8px; border: 1px solid #ddd;">become</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">became</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">become</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">成为</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ddd;">run</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">ran</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">run</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">跑</td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>ABB型（第二和第三形式相同）</h4>
                            <table style="width:100%; border-collapse: collapse; margin: 10px 0;">
                                <tr style="background: #f5f5f5;">
                                    <th style="padding: 8px; border: 1px solid #ddd;">原形</th>
                                    <th style="padding: 8px; border: 1px solid #ddd;">过去式</th>
                                    <th style="padding: 8px; border: 1px solid #ddd;">过去分词</th>
                                    <th style="padding: 8px; border: 1px solid #ddd;">中文意思</th>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ddd;">bring</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">brought</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">brought</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">带来</td>
                                </tr>
                                <tr style="background: #f5f5f5;">
                                    <td style="padding: 8px; border: 1px solid #ddd;">buy</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">bought</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">bought</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">买</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ddd;">teach</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">taught</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">taught</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">教</td>
                                </tr>
                                <tr style="background: #f5f5f5;">
                                    <td style="padding: 8px; border: 1px solid #ddd;">think</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">thought</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">thought</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">想</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ddd;">catch</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">caught</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">caught</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">抓住</td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>ABC型（三种形式都不同）</h4>
                            <table style="width:100%; border-collapse: collapse; margin: 10px 0;">
                                <tr style="background: #f5f5f5;">
                                    <th style="padding: 8px; border: 1px solid #ddd;">原形</th>
                                    <th style="padding: 8px; border: 1px solid #ddd;">过去式</th>
                                    <th style="padding: 8px; border: 1px solid #ddd;">过去分词</th>
                                    <th style="padding: 8px; border: 1px solid #ddd;">中文意思</th>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ddd;">be</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">was/were</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">been</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">是</td>
                                </tr>
                                <tr style="background: #f5f5f5;">
                                    <td style="padding: 8px; border: 1px solid #ddd;">do</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">did</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">done</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">做</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ddd;">go</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">went</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">gone</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">去</td>
                                </tr>
                                <tr style="background: #f5f5f5;">
                                    <td style="padding: 8px; border: 1px solid #ddd;">see</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">saw</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">seen</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">看见</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ddd;">write</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">wrote</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">written</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">写</td>
                                </tr>
                                <tr style="background: #f5f5f5;">
                                    <td style="padding: 8px; border: 1px solid #ddd;">eat</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">ate</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">eaten</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">吃</td>
                                </tr>
                            </table>
                        </div>
                    `;
                    break;
                case 'articles':
                    html = `
                        <h3><i class="fas fa-font"></i> 冠词用法</h3>
                        <div class="grammar-rule">
                            <h4>不定冠词 a/an</h4>
                            <p><strong>基本用法：</strong>a用于辅音音素开头的词前，an用于元音音素开头的词前</p>
                            <p><strong>主要功能：</strong></p>
                            <ol>
                                <li>表示"一个"的概念（可数名词单数）</li>
                                <div class="example-sentence">I need <span class="highlight">a</span> pen. (我需要一支钢笔。)</div>
                                
                                <li>首次提到某人或某物</li>
                                <div class="example-sentence">I saw <span class="highlight">a</span> dog. The dog was black. (我看见一只狗。那只狗是黑色的。)</div>
                                
                                <li>表示职业、身份、信仰等</li>
                                <div class="example-sentence">She is <span class="highlight">an</span> engineer. (她是一名工程师。)</div>
                                
                                <li>表示"每一"的概念</li>
                                <div class="example-sentence">Take this medicine three times <span class="highlight">a</span> day. (一天服用三次这种药。)</div>
                            </ol>
                            
                            <p><strong>特殊情况：</strong></p>
                            <p>- 以字母u开头但发辅音/ju:/音的词用a：<span class="highlight">a university</span>, <span class="highlight">a useful book</span></p>
                            <p>- 以字母h开头但h不发音的词用an：<span class="highlight">an hour</span>, <span class="highlight">an honest man</span></p>
                            <p>- 缩写词按照发音决定：<span class="highlight">an MBA</span> (读作/em bi: ei/), <span class="highlight">a UFO</span> (读作/ju: ef əʊ/)</p>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>定冠词 the</h4>
                            <p><strong>基本用法：</strong>用于特指双方都知道的人或事物</p>
                            <p><strong>主要功能：</strong></p>
                            <ol>
                                <li>特指前面提到过的人或物</li>
                                <div class="example-sentence">I bought a book. <span class="highlight">The</span> book is interesting. (我买了一本书。这本书很有趣。)</div>
                                
                                <li>特指上下文中明确的人或物</li>
                                <div class="example-sentence">Could you close <span class="highlight">the</span> door, please? (请关门好吗？)</div>
                                
                                <li>特指世界上独一无二的事物</li>
                                <div class="example-sentence"><span class="highlight">The</span> sun rises in the east. (太阳从东方升起。)</div>
                                
                                <li>用于形容词最高级和序数词前</li>
                                <div class="example-sentence">She is <span class="highlight">the</span> tallest girl in her class. (她是班上最高的女孩。)</div>
                                <div class="example-sentence">He was <span class="highlight">the</span> first person to arrive. (他是第一个到达的人。)</div>
                                
                                <li>用于表示整个群体</li>
                                <div class="example-sentence"><span class="highlight">The</span> Chinese are known for their hospitality. (中国人以好客著称。)</div>
                                
                                <li>用于乐器名称前</li>
                                <div class="example-sentence">She plays <span class="highlight">the</span> piano well. (她钢琴弹得很好。)</div>
                            </ol>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>零冠词（不用冠词的情况）</h4>
                            <p><strong>主要情况：</strong></p>
                            <ol>
                                <li>复数名词表示泛指</li>
                                <div class="example-sentence"><span class="highlight">Books</span> are important for students. (书对学生很重要。)</div>
                                
                                <li>不可数名词表示泛指</li>
                                <div class="example-sentence">I like <span class="highlight">music</span>. (我喜欢音乐。)</div>
                                
                                <li>专有名词</li>
                                <div class="example-sentence"><span class="highlight">Tom</span> is my friend. (汤姆是我的朋友。)</div>
                                <div class="example-sentence">I've never been to <span class="highlight">France</span>. (我从未去过法国。)</div>
                                
                                <li>学科、运动和语言</li>
                                <div class="example-sentence">She studies <span class="highlight">chemistry</span>. (她学习化学。)</div>
                                <div class="example-sentence">They play <span class="highlight">football</span> every Sunday. (他们每周日踢足球。)</div>
                                <div class="example-sentence">He speaks <span class="highlight">English</span> fluently. (他英语说得很流利。)</div>
                                
                                <li>三餐前</li>
                                <div class="example-sentence">We usually have <span class="highlight">breakfast</span> at 7:00. (我们通常7点吃早饭。)</div>
                                
                                <li>称呼头衔</li>
                                <div class="example-sentence"><span class="highlight">President</span> Biden visited China last year. (拜登总统去年访问了中国。)</div>
                            </ol>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>常见易错点</h4>
                            <p>1. 含有"of"结构的短语通常用定冠词：the color of the flower (花的颜色)</p>
                            <p>2. 国家名称大多不用冠词，但有些复数形式或含有普通名词的国名用the：the United States, the United Kingdom</p>
                            <p>3. 表示一类人/物时，既可用复数名词不带冠词，也可用单数名词加the：Lions/The lion are/is dangerous.</p>
                            <p>4. 在"go to"结构中，某些场所不用冠词：go to school/bed/church/hospital/prison</p>
                            <p>5. 某些固定搭配中冠词的使用：at night (夜间，不用冠词), in the morning (早上，用定冠词)</p>
                        </div>
                    `;
                    break;
                case 'prepositions':
                    html = `
                        <h3><i class="fas fa-arrows-alt"></i> 介词手册</h3>
                        <div class="grammar-rule">
                            <h4>时间介词</h4>
                            <p><strong>at</strong> - 用于确切时刻</p>
                            <div class="example-sentence">at 3 o'clock (在3点钟)</div>
                            <div class="example-sentence">at noon/midnight (在中午/午夜)</div>
                            <div class="example-sentence">at Christmas/Easter (在圣诞节/复活节)</div>
                            
                            <p><strong>in</strong> - 用于较长时间段</p>
                            <div class="example-sentence">in the morning/afternoon/evening (在早上/下午/晚上)</div>
                            <div class="example-sentence">in January/2023 (在1月/2023年)</div>
                            <div class="example-sentence">in summer/winter (在夏天/冬天)</div>
                            <div class="example-sentence">in the 21st century (在21世纪)</div>
                            
                            <p><strong>on</strong> - 用于日期和星期几</p>
                            <div class="example-sentence">on Monday (在星期一)</div>
                            <div class="example-sentence">on July 4th (在7月4日)</div>
                            <div class="example-sentence">on New Year's Day (在新年第一天)</div>
                            <div class="example-sentence">on a cold day (在寒冷的一天)</div>
                            
                            <p><strong>其他时间介词</strong></p>
                            <div class="example-sentence"><strong>during</strong>: during the meeting (会议期间)</div>
                            <div class="example-sentence"><strong>for</strong>: for two hours (持续两小时)</div>
                            <div class="example-sentence"><strong>since</strong>: since 2010 (自2010年以来)</div>
                            <div class="example-sentence"><strong>by</strong>: by next week (到下周为止)</div>
                            <div class="example-sentence"><strong>until/till</strong>: until tomorrow (直到明天)</div>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>地点介词</h4>
                            <p><strong>at</strong> - 用于确切地点，表示点</p>
                            <div class="example-sentence">at the bus stop (在公交车站)</div>
                            <div class="example-sentence">at the entrance (在入口处)</div>
                            <div class="example-sentence">at home/work/school (在家/工作/学校)</div>
                            
                            <p><strong>in</strong> - 用于较大地点，表示在...之内</p>
                            <div class="example-sentence">in Beijing (在北京)</div>
                            <div class="example-sentence">in a room/car/box (在房间/车/盒子里)</div>
                            <div class="example-sentence">in a building (在大楼里)</div>
                            <div class="example-sentence">in the garden (在花园里)</div>
                            
                            <p><strong>on</strong> - 用于表面接触</p>
                            <div class="example-sentence">on the wall (在墙上)</div>
                            <div class="example-sentence">on the floor (在地板上)</div>
                            <div class="example-sentence">on the page (在页面上)</div>
                            <div class="example-sentence">on a bus/train/plane (在公交车/火车/飞机上)</div>
                            
                            <p><strong>其他地点介词</strong></p>
                            <div class="example-sentence"><strong>above/over</strong>: The picture is above/over the sofa. (图画在沙发上方。)</div>
                            <div class="example-sentence"><strong>under/below</strong>: The cat is under the table. (猫在桌子下面。)</div>
                            <div class="example-sentence"><strong>near/by/beside/next to</strong>: The school is near the park. (学校靠近公园。)</div>
                            <div class="example-sentence"><strong>between</strong>: The book is between two dictionaries. (书在两本词典之间。)</div>
                            <div class="example-sentence"><strong>among</strong>: She was standing among a group of students. (她站在一群学生中间。)</div>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>方向介词</h4>
                            <p><strong>to</strong> - 表示朝向</p>
                            <div class="example-sentence">go to school (去学校)</div>
                            <div class="example-sentence">walk to the park (走向公园)</div>
                            
                            <p><strong>from</strong> - 表示来源</p>
                            <div class="example-sentence">come from China (来自中国)</div>
                            <div class="example-sentence">take a book from the shelf (从书架上拿一本书)</div>
                            
                            <p><strong>into</strong> - 表示从外到内的移动</p>
                            <div class="example-sentence">walk into the room (走进房间)</div>
                            <div class="example-sentence">jump into the water (跳入水中)</div>
                            
                            <p><strong>out of</strong> - 表示从内到外的移动</p>
                            <div class="example-sentence">get out of the car (下车)</div>
                            <div class="example-sentence">take the book out of the bag (从包里拿出书)</div>
                            
                            <p><strong>through</strong> - 表示穿过</p>
                            <div class="example-sentence">walk through the forest (穿过森林)</div>
                            <div class="example-sentence">look through the window (透过窗户看)</div>
                            
                            <p><strong>across</strong> - 表示横过</p>
                            <div class="example-sentence">walk across the street (穿过街道)</div>
                            <div class="example-sentence">swim across the river (游过河)</div>
                            
                            <p><strong>along</strong> - 表示沿着</p>
                            <div class="example-sentence">walk along the river (沿着河边走)</div>
                            <div class="example-sentence">drive along the coast (沿着海岸线开车)</div>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>常见介词搭配</h4>
                            <p><strong>动词+介词</strong></p>
                            <div class="example-sentence">look at (看着) / look for (寻找) / look after (照顾)</div>
                            <div class="example-sentence">wait for (等待) / listen to (听) / depend on (依靠)</div>
                            <div class="example-sentence">apologize for (为...道歉) / apply for (申请) / belong to (属于)</div>
                            
                            <p><strong>形容词+介词</strong></p>
                            <div class="example-sentence">afraid of (害怕) / interested in (对...感兴趣) / good at (擅长)</div>
                            <div class="example-sentence">famous for (因...出名) / satisfied with (对...满意) / sorry for (为...抱歉)</div>
                            <div class="example-sentence">tired of (厌倦) / worried about (担忧) / responsible for (负责)</div>
                            
                            <p><strong>名词+介词</strong></p>
                            <div class="example-sentence">reason for (...的原因) / solution to (对...的解决方案)</div>
                            <div class="example-sentence">attitude towards (对...的态度) / respect for (对...的尊重)</div>
                        </div>
                    `;
                    break;
                case 'conditionals':
                    html = `
                        <h3><i class="fas fa-question-circle"></i> 条件句结构</h3>
                        <div class="grammar-rule">
                            <h4>零条件句 (Zero Conditional)</h4>
                            <p><strong>结构：</strong>If + 一般现在时, 一般现在时</p>
                            <p><strong>用法：</strong>表示客观事实、科学真理或普遍规律，条件成立则结果必然发生</p>
                            <div class="example-sentence">If you <span class="highlight">heat</span> water to 100°C, it <span class="highlight">boils</span>. (如果你把水加热到100度，它就会沸腾。)</div>
                            <div class="example-sentence">If it <span class="highlight">rains</span>, the ground <span class="highlight">gets</span> wet. (如果下雨，地面就会湿。)</div>
                            <div class="example-sentence">If you <span class="highlight">press</span> this button, the door <span class="highlight">opens</span>. (如果你按这个按钮，门就会开。)</div>
                            <p><strong>注意：</strong>零条件句中也可以用when代替if</p>
                            <div class="example-sentence">When ice <span class="highlight">melts</span>, it <span class="highlight">becomes</span> water. (当冰融化时，它变成水。)</div>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>第一条件句 (First Conditional)</h4>
                            <p><strong>结构：</strong>If + 一般现在时, will/shall/can/may + 动词原形</p>
                            <p><strong>用法：</strong>表示对将来可能发生的事情的假设，说话人认为条件实现的可能性较大</p>
                            <div class="example-sentence">If it <span class="highlight">rains</span> tomorrow, we <span class="highlight">will stay</span> at home. (如果明天下雨，我们就呆在家里。)</div>
                            <div class="example-sentence">If you <span class="highlight">study</span> hard, you <span class="highlight">will pass</span> the exam. (如果你努力学习，你就会通过考试。)</div>
                            <div class="example-sentence">If I <span class="highlight">finish</span> my work early, I <span class="highlight">can help</span> you. (如果我早点完成工作，我可以帮你。)</div>
                            <p><strong>变体：</strong>unless（除非）+ 一般现在时, will + 动词原形</p>
                            <div class="example-sentence">Unless it <span class="highlight">rains</span>, we <span class="highlight">will go</span> for a picnic. (除非下雨，否则我们会去野餐。)</div>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>第二条件句 (Second Conditional)</h4>
                            <p><strong>结构：</strong>If + 一般过去时, would/could/might + 动词原形</p>
                            <p><strong>用法：</strong>表示对现在或将来不太可能发生的事情的假设，或与现在事实相反的假设</p>
                            <div class="example-sentence">If I <span class="highlight">won</span> the lottery, I <span class="highlight">would travel</span> around the world. (如果我中彩票，我会环游世界。)</div>
                            <div class="example-sentence">If I <span class="highlight">were</span> you, I <span class="highlight">would tell</span> him the truth. (如果我是你，我会告诉他真相。)</div>
                            <div class="example-sentence">If we <span class="highlight">had</span> more time, we <span class="highlight">could visit</span> the museum. (如果我们有更多时间，我们可以参观博物馆。)</div>
                            <p><strong>注意：</strong>如果主语是I, he, she, it，be动词用were而不是was（尤其在正式场合）</p>
                            <div class="example-sentence">If he <span class="highlight">were</span> here, he <span class="highlight">would help</span> us. (如果他在这里，他会帮助我们。)</div>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>第三条件句 (Third Conditional)</h4>
                            <p><strong>结构：</strong>If + 过去完成时, would/could/might + have + 过去分词</p>
                            <p><strong>用法：</strong>表示对过去未曾发生的事情的假设，与过去事实相反的假设</p>
                            <div class="example-sentence">If I <span class="highlight">had studied</span> harder, I <span class="highlight">would have passed</span> the exam. (如果我当时学习更努力，我就会通过考试。)</div>
                            <div class="example-sentence">If you <span class="highlight">had told</span> me, I <span class="highlight">could have helped</span> you. (如果你告诉我，我本可以帮助你。)</div>
                            <div class="example-sentence">If it <span class="highlight">hadn't rained</span>, we <span class="highlight">would have gone</span> to the beach. (如果没下雨，我们本会去海滩。)</div>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>混合条件句 (Mixed Conditionals)</h4>
                            <p><strong>用法：</strong>条件和结果可能发生在不同的时间</p>
                            <p><strong>类型1：</strong>过去的条件影响现在的结果 (If + 过去完成时, would/could/might + 动词原形)</p>
                            <div class="example-sentence">If I <span class="highlight">had studied</span> medicine, I <span class="highlight">would be</span> a doctor now. (如果我曾经学医，我现在就是医生了。)</div>
                            <div class="example-sentence">If you <span class="highlight">had taken</span> my advice, you <span class="highlight">wouldn't have</span> these problems now. (如果你当时接受了我的建议，你现在就不会有这些问题了。)</div>
                            
                            <p><strong>类型2：</strong>现在的条件影响过去的结果 (If + 一般过去时, would/could/might + have + 过去分词)</p>
                            <div class="example-sentence">If I <span class="highlight">weren't</span> so busy, I <span class="highlight">would have visited</span> you yesterday. (如果我不是这么忙，我昨天就会拜访你了。)</div>
                            <div class="example-sentence">If he <span class="highlight">were</span> more careful, he <span class="highlight">wouldn't have made</span> that mistake. (如果他更小心，他就不会犯那个错误了。)</div>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>其他条件句形式</h4>
                            <p><strong>省略if的条件句：</strong>使用倒装结构</p>
                            <div class="example-sentence"><span class="highlight">Were</span> I you, I would accept the offer. (= If I were you...)</div>
                            <div class="example-sentence"><span class="highlight">Had</span> I known, I would have told you. (= If I had known...)</div>
                            <div class="example-sentence"><span class="highlight">Should</span> you need any help, please call me. (= If you should need...)</div>
                            
                            <p><strong>含有wish的虚拟语气：</strong>表达与现实相反的愿望</p>
                            <div class="example-sentence">I wish I <span class="highlight">were</span> taller. (我希望我更高。) - 与现在事实相反</div>
                            <div class="example-sentence">I wish I <span class="highlight">had studied</span> harder. (我希望我当时学习更努力。) - 与过去事实相反</div>
                            <div class="example-sentence">I wish it <span class="highlight">would stop</span> raining. (我希望雨能停。) - 对将来的愿望</div>
                        </div>
                    `;
                    break;
                case 'passive':
                    html = `
                        <h3><i class="fas fa-exchange-alt"></i> 被动语态指南</h3>
                        <div class="grammar-rule">
                            <h4>被动语态的基本结构</h4>
                            <p><strong>基本公式：</strong>be + 过去分词 (+ by + 执行者)</p>
                            <p>被动语态用于强调动作的接受者，而不是执行者，或者当执行者不重要或不知道时。</p>
                            <p><strong>主动变被动的基本步骤：</strong></p>
                            <ol>
                                <li>将主动句的宾语变为被动句的主语</li>
                                <li>适当形式的be动词 + 主动句谓语动词的过去分词</li>
                                <li>主动句的主语前加by，作为被动句的执行者（可省略）</li>
                            </ol>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>各种时态的被动语态</h4>
                            <table style="width:100%; border-collapse: collapse; margin: 10px 0;">
                                <tr style="background: #f5f5f5;">
                                    <th style="padding: 8px; border: 1px solid #ddd;">时态</th>
                                    <th style="padding: 8px; border: 1px solid #ddd;">主动语态</th>
                                    <th style="padding: 8px; border: 1px solid #ddd;">被动语态</th>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ddd;">一般现在时</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">They clean the room.</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">The room <span class="highlight">is cleaned</span> (by them).</td>
                                </tr>
                                <tr style="background: #f5f5f5;">
                                    <td style="padding: 8px; border: 1px solid #ddd;">一般过去时</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">They cleaned the room.</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">The room <span class="highlight">was cleaned</span> (by them).</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ddd;">一般将来时</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">They will clean the room.</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">The room <span class="highlight">will be cleaned</span> (by them).</td>
                                </tr>
                                <tr style="background: #f5f5f5;">
                                    <td style="padding: 8px; border: 1px solid #ddd;">现在进行时</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">They are cleaning the room.</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">The room <span class="highlight">is being cleaned</span> (by them).</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ddd;">过去进行时</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">They were cleaning the room.</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">The room <span class="highlight">was being cleaned</span> (by them).</td>
                                </tr>
                                <tr style="background: #f5f5f5;">
                                    <td style="padding: 8px; border: 1px solid #ddd;">现在完成时</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">They have cleaned the room.</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">The room <span class="highlight">has been cleaned</span> (by them).</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ddd;">过去完成时</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">They had cleaned the room.</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">The room <span class="highlight">had been cleaned</span> (by them).</td>
                                </tr>
                                <tr style="background: #f5f5f5;">
                                    <td style="padding: 8px; border: 1px solid #ddd;">将来完成时</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">They will have cleaned the room.</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">The room <span class="highlight">will have been cleaned</span> (by them).</td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>含情态动词的被动语态</h4>
                            <p><strong>结构：</strong>情态动词 + be + 过去分词</p>
                            <div class="example-sentence">The work <span class="highlight">must be finished</span> by tomorrow. (这项工作必须在明天之前完成。)</div>
                            <div class="example-sentence">The letter <span class="highlight">should be sent</span> immediately. (这封信应该立即寄出。)</div>
                            <div class="example-sentence">The door <span class="highlight">can't be opened</span>. (这门打不开。)</div>
                            <div class="example-sentence">The meeting <span class="highlight">may be postponed</span>. (会议可能会推迟。)</div>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>带有两个宾语的动词的被动语态</h4>
                            <p>有些动词可以带两个宾语（间接宾语和直接宾语），这类动词变被动语态时，任何一个宾语都可以作被动语态的主语。</p>
                            <p><strong>主动语态：</strong>They gave me a book.</p>
                            <p><strong>被动语态1：</strong>I <span class="highlight">was given</span> a book (by them). (间接宾语作主语)</p>
                            <p><strong>被动语态2：</strong>A book <span class="highlight">was given</span> to me (by them). (直接宾语作主语)</p>
                            <p><strong>常见的双宾语动词：</strong>give, offer, send, show, teach, tell, bring, buy, lend, promise等</p>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>使用被动语态的场合</h4>
                            <ol>
                                <li>当执行者不重要或不知道时</li>
                                <div class="example-sentence">My car <span class="highlight">was stolen</span> last night. (我的车昨晚被偷了。)</div>
                                
                                <li>当想强调动作的接受者时</li>
                                <div class="example-sentence">The Mona Lisa <span class="highlight">was painted</span> by Leonardo da Vinci. (蒙娜丽莎是达芬奇画的。)</div>
                                
                                <li>在科学和学术写作中，使描述更客观</li>
                                <div class="example-sentence">The experiment <span class="highlight">was conducted</span> under strict conditions. (实验是在严格条件下进行的。)</div>
                                
                                <li>在新闻报道和官方通知中</li>
                                <div class="example-sentence">The new policy <span class="highlight">will be implemented</span> next month. (新政策将于下个月实施。)</div>
                            </ol>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>特殊结构的被动语态</h4>
                            <p><strong>1. 不定式的被动语态：</strong>to be + 过去分词</p>
                            <div class="example-sentence">The work needs <span class="highlight">to be finished</span>. (这项工作需要被完成。)</div>
                            <div class="example-sentence">I want <span class="highlight">to be informed</span> about any changes. (我想被告知任何变化。)</div>
                            
                            <p><strong>2. 动名词的被动语态：</strong>being + 过去分词</p>
                            <div class="example-sentence">He doesn't like <span class="highlight">being criticized</span>. (他不喜欢被批评。)</div>
                            <div class="example-sentence">I appreciate <span class="highlight">being invited</span> to the party. (我很感谢被邀请参加聚会。)</div>
                            
                            <p><strong>3. have/get something done结构：</strong>表示"请某人做某事"</p>
                            <div class="example-sentence">I had my hair <span class="highlight">cut</span> yesterday. (我昨天理发了。)</div>
                            <div class="example-sentence">We got our house <span class="highlight">painted</span> last month. (我们上个月请人粉刷了房子。)</div>
                        </div>
                    `;
                    break;
                case 'modals':
                    html = `
                        <h3><i class="fas fa-cog"></i> 情态动词参考</h3>
                        <div class="grammar-rule">
                            <h4>can / could</h4>
                            <p><strong>用法：</strong>can表示能力、许可、可能性；could表示过去的能力、委婉请求</p>
                            <div class="example-sentence">I <span class="highlight">can</span> swim. (能力)</div>
                            <div class="example-sentence">You <span class="highlight">can</span> go now. (许可)</div>
                            <div class="example-sentence"><span class="highlight">Could</span> you help me? (委婉请求)</div>
                            <div class="example-sentence">She <span class="highlight">could</span> play piano when she was young. (过去能力)</div>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>may / might</h4>
                            <p><strong>用法：</strong>may表示许可、可能性；might表示更小的可能性或委婉语气</p>
                            <div class="example-sentence"><span class="highlight">May</span> I come in? (正式请求许可)</div>
                            <div class="example-sentence">It <span class="highlight">may</span> rain tomorrow. (可能性)</div>
                            <div class="example-sentence">He <span class="highlight">might</span> be late. (较小可能性)</div>
                            <div class="example-sentence">You <span class="highlight">might</span> want to check this. (委婉建议)</div>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>must / have to</h4>
                            <p><strong>用法：</strong>must表示强烈义务、推测；have to表示客观需要</p>
                            <div class="example-sentence">You <span class="highlight">must</span> finish your homework. (强烈义务)</div>
                            <div class="example-sentence">She <span class="highlight">must</span> be tired. (推测)</div>
                            <div class="example-sentence">I <span class="highlight">have to</span> go to work. (客观需要)</div>
                            <div class="example-sentence">Students <span class="highlight">have to</span> wear uniforms. (规定)</div>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>should / ought to</h4>
                            <p><strong>用法：</strong>表示建议、义务、应该做的事</p>
                            <div class="example-sentence">You <span class="highlight">should</span> study more. (建议)</div>
                            <div class="example-sentence">We <span class="highlight">should</span> respect our parents. (道德义务)</div>
                            <div class="example-sentence">You <span class="highlight">ought to</span> help others. (应该)</div>
                            <div class="example-sentence">Students <span class="highlight">should</span> listen carefully. (期望)</div>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>will / would</h4>
                            <p><strong>用法：</strong>will表示意愿、将来；would表示过去习惯、委婉请求</p>
                            <div class="example-sentence">I <span class="highlight">will</span> help you. (意愿)</div>
                            <div class="example-sentence">It <span class="highlight">will</span> be sunny tomorrow. (将来)</div>
                            <div class="example-sentence"><span class="highlight">Would</span> you like some tea? (委婉邀请)</div>
                            <div class="example-sentence">He <span class="highlight">would</span> often visit us. (过去习惯)</div>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>need / dare</h4>
                            <p><strong>用法：</strong>need表示需要；dare表示敢于</p>
                            <div class="example-sentence">You <span class="highlight">needn't</span> worry. (不需要)</div>
                            <div class="example-sentence"><span class="highlight">Need</span> I say more? (需要吗？)</div>
                            <div class="example-sentence">He <span class="highlight">daren't</span> speak. (不敢)</div>
                            <div class="example-sentence"><span class="highlight">Dare</span> you jump? (敢吗？)</div>
                        </div>
                    `;
                    break;
                case 'verb-patterns':
                    html = `
                        <h3><i class="fas fa-code-branch"></i> 动词搭配</h3>
                        <div class="grammar-rule">
                            <h4>动词+不定式</h4>
                            <p><strong>常见动词：</strong>agree, arrange, ask, decide, expect, hope, learn, offer, plan, promise, refuse, seem, want, wish等</p>
                            <div class="example-sentence">I <span class="highlight">want to study</span> abroad. (我想去国外学习。)</div>
                            <div class="example-sentence">She <span class="highlight">promised to help</span> me. (她答应帮助我。)</div>
                            <div class="example-sentence">They <span class="highlight">decided to leave</span> early. (他们决定提早离开。)</div>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>动词+动名词</h4>
                            <p><strong>常见动词：</strong>admit, avoid, consider, deny, enjoy, finish, keep, mind, miss, practice, suggest等</p>
                            <div class="example-sentence">I <span class="highlight">enjoy reading</span> novels. (我喜欢读小说。)</div>
                            <div class="example-sentence">She <span class="highlight">admitted stealing</span> the money. (她承认偷了钱。)</div>
                            <div class="example-sentence">They <span class="highlight">suggested going</span> to the beach. (他们建议去海滩。)</div>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>动词+不定式或动名词（意义相同）</h4>
                            <p><strong>常见动词：</strong>begin, continue, hate, like, love, prefer, start等</p>
                            <div class="example-sentence">It <span class="highlight">began to rain</span> / <span class="highlight">began raining</span>. (开始下雨了。)</div>
                            <div class="example-sentence">I <span class="highlight">like to swim</span> / <span class="highlight">like swimming</span>. (我喜欢游泳。)</div>
                            <div class="example-sentence">He <span class="highlight">continued to work</span> / <span class="highlight">continued working</span>. (他继续工作。)</div>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>动词+不定式或动名词（意义不同）</h4>
                            <p><strong>常见动词：</strong>forget, remember, regret, stop, try等</p>
                            <div class="example-sentence">I <span class="highlight">remembered to lock</span> the door. (我记得要锁门。) - 记得要做某事</div>
                            <div class="example-sentence">I <span class="highlight">remembered locking</span> the door. (我记得锁门了。) - 记得做过某事</div>
                            
                            <div class="example-sentence">She <span class="highlight">stopped to rest</span>. (她停下来休息。) - 停下来做某事</div>
                            <div class="example-sentence">She <span class="highlight">stopped smoking</span>. (她戒烟了。) - 停止做某事</div>
                            
                            <div class="example-sentence">I <span class="highlight">regret to inform</span> you of this. (我遗憾地通知你这件事。) - 对将要做的事感到遗憾</div>
                            <div class="example-sentence">I <span class="highlight">regret telling</span> him the secret. (我后悔告诉他这个秘密。) - 对已做过的事感到遗憾</div>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>动词+宾语+不定式</h4>
                            <p><strong>常见动词：</strong>advise, allow, ask, encourage, expect, force, invite, order, persuade, remind, tell, warn等</p>
                            <div class="example-sentence">She <span class="highlight">advised me to study</span> harder. (她建议我更努力地学习。)</div>
                            <div class="example-sentence">They <span class="highlight">invited us to join</span> them. (他们邀请我们加入。)</div>
                            <div class="example-sentence">The teacher <span class="highlight">told the students to be</span> quiet. (老师叫学生们安静。)</div>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>动词+宾语+宾语补足语</h4>
                            <p><strong>带形容词补足语的动词：</strong>consider, find, keep, leave, make等</p>
                            <div class="example-sentence">We <span class="highlight">consider her intelligent</span>. (我们认为她很聪明。)</div>
                            <div class="example-sentence">They <span class="highlight">found the work difficult</span>. (他们发现这项工作很难。)</div>
                            
                            <p><strong>带名词补足语的动词：</strong>appoint, call, elect, make, name等</p>
                            <div class="example-sentence">They <span class="highlight">appointed him manager</span>. (他们任命他为经理。)</div>
                            <div class="example-sentence">We <span class="highlight">call her Mary</span>. (我们叫她玛丽。)</div>
                        </div>
                    `;
                    break;
                case 'conjunctions':
                    html = `
                        <h3><i class="fas fa-link"></i> 连接词用法</h3>
                        <div class="grammar-rule">
                            <h4>并列连词</h4>
                            <p>用于连接结构相同的词、短语或句子</p>
                            <p><strong>and</strong> (和，并且) - 表示添加</p>
                            <div class="example-sentence">She likes tea <span class="highlight">and</span> coffee. (她喜欢茶和咖啡。)</div>
                            
                            <p><strong>but</strong> (但是) - 表示转折</p>
                            <div class="example-sentence">He is rich <span class="highlight">but</span> unhappy. (他很富有但不快乐。)</div>
                            
                            <p><strong>or</strong> (或者) - 表示选择</p>
                            <div class="example-sentence">You can go by bus <span class="highlight">or</span> by train. (你可以坐公交车或火车去。)</div>
                            
                            <p><strong>so</strong> (所以) - 表示结果</p>
                            <div class="example-sentence">It was raining, <span class="highlight">so</span> we stayed at home. (下雨了，所以我们呆在家里。)</div>
                            
                            <p><strong>for</strong> (因为) - 表示原因</p>
                            <div class="example-sentence">He must be tired, <span class="highlight">for</span> he has worked all day. (他一定累了，因为他工作了一整天。)</div>
                            
                            <p><strong>yet</strong> (然而) - 表示出乎意料的转折</p>
                            <div class="example-sentence">She is very young, <span class="highlight">yet</span> she knows a lot. (她很年轻，然而她知道很多。)</div>
                            
                            <p><strong>nor</strong> (也不) - 表示否定的添加</p>
                            <div class="example-sentence">I can't speak French, <span class="highlight">nor</span> can my wife. (我不会说法语，我妻子也不会。)</div>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>从属连词</h4>
                            <p>用于引导从句，使其依附于主句</p>
                            
                            <p><strong>时间从属连词：</strong></p>
                            <p>when (当...时候), while (当...的时候), before (在...之前), after (在...之后), as (正当...时), until/till (直到), since (自从), as soon as (一...就)</p>
                            <div class="example-sentence"><span class="highlight">When</span> I arrived, the meeting had already started. (当我到达时，会议已经开始了。)</div>
                            <div class="example-sentence">I will wait <span class="highlight">until</span> you come back. (我会等到你回来。)</div>
                            
                            <p><strong>地点从属连词：</strong></p>
                            <p>where (在...地方), wherever (无论在哪里)</p>
                            <div class="example-sentence">I will go <span class="highlight">where</span> you go. (我会去你去的地方。)</div>
                            
                            <p><strong>原因从属连词：</strong></p>
                            <p>because (因为), as (由于), since (既然)</p>
                            <div class="example-sentence">He stayed at home <span class="highlight">because</span> it was raining. (他呆在家里因为下雨了。)</div>
                            <div class="example-sentence"><span class="highlight">Since</span> you are here, we can start the meeting. (既然你在这里，我们可以开始会议了。)</div>
                            
                            <p><strong>目的从属连词：</strong></p>
                            <p>so that (为了), in order that (为了)</p>
                            <div class="example-sentence">I saved money <span class="highlight">so that</span> I could buy a car. (我省钱是为了能买车。)</div>
                            
                            <p><strong>结果从属连词：</strong></p>
                            <p>so...that (如此...以至于), such...that (如此...以至于)</p>
                            <div class="example-sentence">It was <span class="highlight">so</span> cold <span class="highlight">that</span> I couldn't sleep. (天气如此寒冷以至于我无法入睡。)</div>
                            <div class="example-sentence">It was <span class="highlight">such</span> a good film <span class="highlight">that</span> everyone liked it. (这是如此好的一部电影以至于每个人都喜欢它。)</div>
                            
                            <p><strong>条件从属连词：</strong></p>
                            <p>if (如果), unless (除非), provided/providing (that) (如果), as/so long as (只要)</p>
                            <div class="example-sentence"><span class="highlight">If</span> it rains, we will stay at home. (如果下雨，我们会呆在家里。)</div>
                            <div class="example-sentence"><span class="highlight">Unless</span> you study hard, you will fail. (除非你努力学习，否则你会失败。)</div>
                            
                            <p><strong>让步从属连词：</strong></p>
                            <p>although/though (虽然), even though/if (即使), no matter (无论), whatever/whoever/whenever (无论)</p>
                            <div class="example-sentence"><span class="highlight">Although</span> he was tired, he continued working. (尽管他累了，他继续工作。)</div>
                            <div class="example-sentence"><span class="highlight">Whatever</span> happens, I will support you. (无论发生什么，我都会支持你。)</div>
                            
                            <p><strong>比较从属连词：</strong></p>
                            <p>than (比), as...as (和...一样), not so/as...as (不如...)</p>
                            <div class="example-sentence">He is taller <span class="highlight">than</span> I am. (他比我高。)</div>
                            <div class="example-sentence">She is <span class="highlight">as</span> clever <span class="highlight">as</span> her sister. (她和她姐姐一样聪明。)</div>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>连接副词</h4>
                            <p>连接两个独立句子，表达它们之间的逻辑关系</p>
                            
                            <p><strong>表示添加：</strong>furthermore, moreover, in addition, besides</p>
                            <div class="example-sentence">The restaurant is expensive. <span class="highlight">Moreover</span>, the service is poor. (这家餐厅很贵。而且，服务也差。)</div>
                            
                            <p><strong>表示对比：</strong>however, nevertheless, on the other hand, in contrast</p>
                            <div class="example-sentence">I wanted to go. <span class="highlight">However</span>, I had no time. (我想去。然而，我没有时间。)</div>
                            
                            <p><strong>表示结果：</strong>therefore, thus, consequently, as a result</p>
                            <div class="example-sentence">He didn't study. <span class="highlight">Therefore</span>, he failed the exam. (他没学习。因此，他考试不及格。)</div>
                            
                            <p><strong>表示顺序：</strong>first, second, next, finally, then</p>
                            <div class="example-sentence"><span class="highlight">First</span>, preheat the oven. <span class="highlight">Then</span>, prepare the ingredients. (首先，预热烤箱。然后，准备食材。)</div>
                        </div>
                    `;
                    break;
                case 'phrasal-verbs':
                    html = `
                        <h3><i class="fas fa-puzzle-piece"></i> 短语动词</h3>
                        <div class="grammar-rule">
                            <h4>什么是短语动词</h4>
                            <p>短语动词由一个动词加一个或两个副词或介词组成，整体具有特定的含义，往往与动词本身的意思有很大不同。</p>
                            <div class="example-sentence">look up (查找) ≠ look (看) + up (向上)</div>
                            <div class="example-sentence">give up (放弃) ≠ give (给) + up (向上)</div>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>短语动词的类型</h4>
                            <p><strong>不及物短语动词：</strong>不需要宾语</p>
                            <div class="example-sentence">The plane has <span class="highlight">taken off</span>. (飞机已经起飞了。)</div>
                            <div class="example-sentence">Please <span class="highlight">sit down</span>. (请坐下。)</div>
                            
                            <p><strong>及物短语动词：</strong>需要宾语</p>
                            <div class="example-sentence">I <span class="highlight">looked up</span> the word in the dictionary. (我在字典里查了那个单词。)</div>
                            <div class="example-sentence">She <span class="highlight">turned down</span> the offer. (她拒绝了那个提议。)</div>
                            
                            <p><strong>可分短语动词：</strong>动词和副词可以被宾语分开</p>
                            <div class="example-sentence">He <span class="highlight">turned on</span> the light. / He <span class="highlight">turned</span> the light <span class="highlight">on</span>. (他打开了灯。)</div>
                            
                            <p><strong>不可分短语动词：</strong>动词和副词/介词不能被宾语分开</p>
                            <div class="example-sentence">I <span class="highlight">ran into</span> an old friend yesterday. (我昨天偶遇了一位老朋友。)</div>
                            <div class="example-sentence">They are <span class="highlight">looking after</span> their grandchildren. (他们正在照顾孙子孙女。)</div>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>常见短语动词</h4>
                            <table style="width:100%; border-collapse: collapse; margin: 10px 0;">
                                <tr style="background: #f5f5f5;">
                                    <th style="padding: 8px; border: 1px solid #ddd;">短语动词</th>
                                    <th style="padding: 8px; border: 1px solid #ddd;">意思</th>
                                    <th style="padding: 8px; border: 1px solid #ddd;">例句</th>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ddd;">break down</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">故障；崩溃</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">My car broke down on the way to work.</td>
                                </tr>
                                <tr style="background: #f5f5f5;">
                                    <td style="padding: 8px; border: 1px solid #ddd;">bring up</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">抚养；提出</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">She was brought up by her grandparents.</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ddd;">call off</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">取消</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">The meeting was called off due to bad weather.</td>
                                </tr>
                                <tr style="background: #f5f5f5;">
                                    <td style="padding: 8px; border: 1px solid #ddd;">carry out</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">执行</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">They carried out the experiment successfully.</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ddd;">come across</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">偶然发现</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">I came across an old photo while cleaning.</td>
                                </tr>
                                <tr style="background: #f5f5f5;">
                                    <td style="padding: 8px; border: 1px solid #ddd;">give up</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">放弃</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">He gave up smoking last year.</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ddd;">look after</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">照顾</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">Can you look after my dog while I'm away?</td>
                                </tr>
                                <tr style="background: #f5f5f5;">
                                    <td style="padding: 8px; border: 1px solid #ddd;">look for</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">寻找</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">I'm looking for my keys.</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ddd;">put off</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">推迟</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">The meeting has been put off until next week.</td>
                                </tr>
                                <tr style="background: #f5f5f5;">
                                    <td style="padding: 8px; border: 1px solid #ddd;">run out of</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">用完</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">We've run out of milk.</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ddd;">take care of</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">照顾</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">I'll take care of the arrangements.</td>
                                </tr>
                                <tr style="background: #f5f5f5;">
                                    <td style="padding: 8px; border: 1px solid #ddd;">turn down</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">拒绝；调低</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">She turned down the job offer.</td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="grammar-rule">
                            <h4>短语动词的使用技巧</h4>
                            <ol>
                                <li><strong>代词宾语的位置：</strong>代词宾语必须放在可分短语动词的中间</li>
                                <div class="example-sentence">Turn <span class="highlight">it</span> off. (正确) / Turn off <span class="highlight">it</span>. (错误)</div>
                                
                                <li><strong>长宾语的位置：</strong>较长的宾语通常放在短语动词之后</li>
                                <div class="example-sentence">Turn off <span class="highlight">all the lights in the building</span>. (比 Turn all the lights in the building off. 更自然)</div>
                                
                                <li><strong>被动语态：</strong>短语动词在被动语态中保持完整</li>
                                <div class="example-sentence">The meeting has been <span class="highlight">put off</span>. (会议已被推迟。)</div>
                                <div class="example-sentence">My grandmother was <span class="highlight">looked after</span> by the nurses. (我祖母被护士照顾。)</div>
                            </ol>
                        </div>
                    `;
                    break;
            }
            
            container.innerHTML = html;
            container.style.display = 'block';
        }

        // Utility functions
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
    </script>
</body>
</html> 