<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>语法掌握 - 英语学习助手</title>
    <link rel="icon" href="../../assets/icons/logo_btrfly.ico" type="image/x-icon">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/components.css">
    <link rel="stylesheet" href="../../css/utilities.css">
    <link rel="stylesheet" href="../../css/responsive.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .grammar-hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4rem 0;
            text-align: center;
        }

        .grammar-hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .grammar-hero p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .grammar-tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin: 2rem 0;
            overflow: hidden;
        }

        .grammar-tab {
            flex: 1;
            padding: 1rem 2rem;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .grammar-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .grammar-tab:hover:not(.active) {
            background: #e9ecef;
        }

        .grammar-content {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .grammar-panel {
            display: none;
        }

        .grammar-panel.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .topic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .topic-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .topic-card:hover {
            background: #e9ecef;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .topic-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
        }

        .topic-card h3 {
            color: #667eea;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .exercise-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .exercise-question {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid #667eea;
        }

        .exercise-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .exercise-option {
            background: #e9ecef;
            border: none;
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            min-height: 48px;
        }

        .exercise-option:hover {
            background: #dee2e6;
        }

        .exercise-option.selected {
            background: #667eea;
            color: white;
        }

        .exercise-option.correct {
            background: #28a745;
            color: white;
        }

        .exercise-option.incorrect {
            background: #dc3545;
            color: white;
        }

        .explanation-box {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 1rem;
            border-left: 4px solid #667eea;
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 10px;
            margin: 1rem 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea, #764ba2);
            height: 100%;
            transition: width 0.3s ease;
        }

        .score-display {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-radius: 15px;
            margin: 2rem 0;
        }

        .score-number {
            font-size: 3rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .grammar-rule {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid #28a745;
        }

        .example-sentence {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem 0;
            font-style: italic;
        }

        .highlight {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-weight: 600;
        }

        .tense-chart {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .tense-box {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            transition: all 0.3s ease;
        }

        .tense-box:hover {
            border-color: #667eea;
            background: white;
        }

        .modal-showcase {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .modal-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .modal-card:hover {
            border-color: #667eea;
            background: white;
        }

        .conditional-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .conditional-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            border-left: 4px solid #007bff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .conditional-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        @media (max-width: 1024px) {
            .grammar-hero h1 {
                font-size: 2.5rem;
            }
            
            .tense-chart,
            .modal-showcase,
            .conditional-types {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .grammar-tabs {
                flex-direction: column;
            }

            .grammar-tab {
                padding: 0.8rem 1rem;
            }

            .grammar-hero h1 {
                font-size: 2rem;
            }

            .grammar-hero p {
                font-size: 1rem;
            }

            .topic-grid {
                grid-template-columns: 1fr;
            }

            .exercise-options {
                grid-template-columns: 1fr;
            }

            .tense-chart,
            .modal-showcase,
            .conditional-types {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .grammar-content {
                padding: 1rem;
            }
            
            .exercise-container {
                padding: 1rem;
            }
            
            .grammar-hero {
                padding: 2rem 0;
            }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="../../index.html">
                        <i class="fas fa-graduation-cap" style="background: linear-gradient(90deg, #4361ee, #7209b7); -webkit-background-clip: text; background-clip: text; color: transparent;"></i>
                        <span class="gradient-text">Alex的学习助手</span>
                    </a>
                </div>
                <nav class="main-nav">
                    <ul>
                        <li><a href="../../index.html">首页</a></li>
                        <li><a href="../../index.html#subjects">科目</a></li>
                        <li><a href="../../tts.html">语音</a></li>
                        <li><a href="../../draw.html">绘图</a></li>
                        <li><a href="main.html">返回英语</a></li>
                    </ul>
                </nav>
                <button class="mobile-menu-toggle" aria-label="切换菜单">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <main>
        <!-- Hero Section -->
        <section class="grammar-hero">
            <div class="container">
                <h1><i class="fas fa-spell-check"></i> 语法掌握</h1>
                <p>通过互动练习和详细解释掌握英语语法规则，提高语言运用能力</p>
            </div>
        </section>

        <!-- Main Content -->
        <section class="main-content">
            <div class="container">
                <!-- Grammar Tabs -->
                <div class="grammar-tabs">
                    <button class="grammar-tab active" data-tab="learn">
                        <i class="fas fa-book-open"></i> 学习语法
                    </button>
                    <button class="grammar-tab" data-tab="practice">
                        <i class="fas fa-dumbbell"></i> 练习题目
                    </button>
                    <button class="grammar-tab" data-tab="test">
                        <i class="fas fa-clipboard-check"></i> 语法测试
                    </button>
                    <button class="grammar-tab" data-tab="reference">
                        <i class="fas fa-bookmark"></i> 语法手册
                    </button>
                </div>

                <!-- Learn Panel -->
                <div id="learn-panel" class="grammar-content grammar-panel active">
                    <h2><i class="fas fa-lightbulb"></i> 选择语法主题</h2>
                    <div class="topic-grid">
                        <div class="topic-card" data-topic="tenses">
                            <h3><i class="fas fa-clock"></i> 时态</h3>
                            <p>学习全部12种时态：现在时、过去时、将来时及其完成式、进行式</p>
                        </div>
                        <div class="topic-card" data-topic="articles">
                            <h3><i class="fas fa-font"></i> 冠词</h3>
                            <p>掌握 a, an, the 的正确使用方法和零冠词的使用</p>
                        </div>
                        <div class="topic-card" data-topic="prepositions">
                            <h3><i class="fas fa-arrows-alt"></i> 介词</h3>
                            <p>学习时间、地点、方向介词的用法和搭配</p>
                        </div>
                        <div class="topic-card" data-topic="conditionals">
                            <h3><i class="fas fa-question-circle"></i> 条件句</h3>
                            <p>掌握零条件句、第一、二、三条件句和混合条件句的结构和用法</p>
                        </div>
                        <div class="topic-card" data-topic="passive">
                            <h3><i class="fas fa-exchange-alt"></i> 被动语态</h3>
                            <p>学习各种时态的被动语态构成和使用场合</p>
                        </div>
                        <div class="topic-card" data-topic="modals">
                            <h3><i class="fas fa-cog"></i> 情态动词</h3>
                            <p>掌握 can, could, should, must, may, might, will, would 等的用法</p>
                        </div>
                    </div>
                    <div id="topic-content" class="exercise-container" style="display: none;">
                        <!-- Topic content will be loaded here -->
                    </div>
                </div>

                <!-- Practice Panel -->
                <div id="practice-panel" class="grammar-content grammar-panel">
                    <h2><i class="fas fa-dumbbell"></i> 语法练习</h2>
                    <div class="form-group">
                        <label for="practice-topic">选择练习主题：</label>
                        <select id="practice-topic" class="form-control">
                            <option value="mixed">综合练习</option>
                            <option value="tenses">时态练习</option>
                            <option value="articles">冠词练习</option>
                            <option value="prepositions">介词练习</option>
                            <option value="conditionals">条件句练习</option>
                            <option value="passive">被动语态练习</option>
                            <option value="modals">情态动词练习</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="practice-difficulty">难度级别：</label>
                        <select id="practice-difficulty" class="form-control">
                            <option value="elementary">初级</option>
                            <option value="intermediate" selected>中级</option>
                            <option value="advanced">高级</option>
                        </select>
                    </div>
                    <button id="start-practice" class="btn btn-primary">
                        <i class="fas fa-play"></i> 开始练习
                    </button>
                    <div id="practice-container" style="display: none;">
                        <div class="progress-bar">
                            <div id="practice-progress" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <div id="practice-questions"></div>
                        <div id="practice-results" style="display: none;"></div>
                    </div>
                </div>

                <!-- Test Panel -->
                <div id="test-panel" class="grammar-content grammar-panel">
                    <h2><i class="fas fa-clipboard-check"></i> 语法测试</h2>
                    <p>通过综合测试评估您的语法水平</p>
                    <div class="form-group">
                        <label for="test-level">测试级别：</label>
                        <select id="test-level" class="form-control">
                            <option value="elementary">初级测试 (20题)</option>
                            <option value="intermediate" selected>中级测试 (25题)</option>
                            <option value="advanced">高级测试 (30题)</option>
                        </select>
                    </div>
                    <button id="start-test" class="btn btn-primary">
                        <i class="fas fa-play-circle"></i> 开始测试
                    </button>
                    <div id="test-container" style="display: none;">
                        <div class="progress-bar">
                            <div id="test-progress" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <div id="test-questions"></div>
                        <div id="test-results" style="display: none;"></div>
                    </div>
                </div>

                <!-- Reference Panel -->
                <div id="reference-panel" class="grammar-content grammar-panel">
                    <h2><i class="fas fa-bookmark"></i> 语法手册</h2>
                    <p>快速查阅常用语法规则和例句</p>
                    <div class="topic-grid">
                        <div class="topic-card" data-reference="tenses">
                            <h3><i class="fas fa-clock"></i> 时态总览</h3>
                            <p>所有时态的构成和用法总结</p>
                        </div>
                        <div class="topic-card" data-reference="sentence-structure">
                            <h3><i class="fas fa-sitemap"></i> 句子结构</h3>
                            <p>简单句、复合句、复杂句的构成</p>
                        </div>
                        <div class="topic-card" data-reference="common-errors">
                            <h3><i class="fas fa-exclamation-triangle"></i> 常见错误</h3>
                            <p>中国学生常犯的语法错误及纠正</p>
                        </div>
                        <div class="topic-card" data-reference="irregular-verbs">
                            <h3><i class="fas fa-list"></i> 不规则动词</h3>
                            <p>常用不规则动词变化表</p>
                        </div>
                    </div>
                    <div id="reference-content" class="exercise-container" style="display: none;">
                        <!-- Reference content will be loaded here -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <p class="copyright-text">study-llm.me域名为Alex所有。保留所有权利。</p>
                <div class="profile-section">
                    <button id="profile-button" class="profile-button">
                        <i class="fas fa-user-circle"></i>
                        学习阶段
                    </button>
                    <div id="profile-display" class="profile-display"></div>
                </div>
            </div>
        </div>
    </footer>

    <script src="../../js/navigation.js"></script>
    <script src="../../js/profile.js"></script>
    <script>
        // Comprehensive Grammar learning data
        const grammarData = {
            tenses: {
                title: "时态",
                rules: [
                    {
                        name: "一般现在时 (Simple Present)",
                        structure: "主语 + 动词原形/动词-s",
                        usage: "表示经常性动作、习惯、事实或真理",
                        examples: [
                            "I <span class='highlight'>go</span> to school every day. (经常性动作)",
                            "She <span class='highlight'>likes</span> reading books. (习惯)",
                            "The sun <span class='highlight'>rises</span> in the east. (事实)"
                        ]
                    },
                    {
                        name: "现在进行时 (Present Continuous)",
                        structure: "主语 + am/is/are + 动词-ing",
                        usage: "表示正在进行的动作或现阶段的动作",
                        examples: [
                            "I <span class='highlight'>am reading</span> a book now. (正在进行)",
                            "They <span class='highlight'>are studying</span> hard this semester. (现阶段)",
                            "She <span class='highlight'>is always complaining</span>. (表达情感)"
                        ]
                    },
                    {
                        name: "现在完成时 (Present Perfect)",
                        structure: "主语 + have/has + 过去分词",
                        usage: "表示过去发生但对现在有影响的动作，或从过去持续到现在的动作",
                        examples: [
                            "I <span class='highlight'>have finished</span> my homework. (过去完成，现在可以休息)",
                            "She <span class='highlight'>has lived</span> here for 5 years. (从过去持续到现在)",
                            "They <span class='highlight'>have never been</span> to China. (经历)"
                        ]
                    },
                    {
                        name: "现在完成进行时 (Present Perfect Continuous)",
                        structure: "主语 + have/has + been + 动词-ing",
                        usage: "表示从过去某时开始一直持续到现在的动作，强调持续性",
                        examples: [
                            "I <span class='highlight'>have been waiting</span> for two hours. (强调等待的持续)",
                            "She <span class='highlight'>has been studying</span> English since 2020. (持续学习)",
                            "It <span class='highlight'>has been raining</span> all day. (持续下雨)"
                        ]
                    },
                    {
                        name: "一般过去时 (Simple Past)",
                        structure: "主语 + 动词过去式",
                        usage: "表示过去发生的动作或状态",
                        examples: [
                            "I <span class='highlight'>went</span> to Beijing last year. (过去的动作)",
                            "She <span class='highlight'>was</span> a teacher. (过去的状态)",
                            "They <span class='highlight'>played</span> games yesterday. (过去的活动)"
                        ]
                    },
                    {
                        name: "过去进行时 (Past Continuous)",
                        structure: "主语 + was/were + 动词-ing",
                        usage: "表示过去某时正在进行的动作",
                        examples: [
                            "I <span class='highlight'>was reading</span> when he called. (过去某时正在进行)",
                            "They <span class='highlight'>were playing</span> at 3 o'clock yesterday. (过去特定时间)",
                            "She <span class='highlight'>was always helping</span> others. (过去习惯性动作)"
                        ]
                    },
                    {
                        name: "过去完成时 (Past Perfect)",
                        structure: "主语 + had + 过去分词",
                        usage: "表示过去某时间前已经完成的动作（过去的过去）",
                        examples: [
                            "I <span class='highlight'>had finished</span> the work before he came. (过去的过去)",
                            "She <span class='highlight'>had left</span> when I arrived. (先后顺序)",
                            "They <span class='highlight'>had never seen</span> such a beautiful place. (过去的经历)"
                        ]
                    },
                    {
                        name: "过去完成进行时 (Past Perfect Continuous)",
                        structure: "主语 + had + been + 动词-ing",
                        usage: "表示到过去某时为止一直在进行的动作",
                        examples: [
                            "I <span class='highlight'>had been waiting</span> for an hour when she arrived. (持续到过去某时)",
                            "She <span class='highlight'>had been working</span> there for 3 years before she quit. (过去的持续)",
                            "It <span class='highlight'>had been raining</span> for days. (过去的持续状态)"
                        ]
                    },
                    {
                        name: "一般将来时 (Simple Future)",
                        structure: "主语 + will + 动词原形 / 主语 + be going to + 动词原形",
                        usage: "表示将来的动作或状态",
                        examples: [
                            "I <span class='highlight'>will go</span> to school tomorrow. (意愿/预测)",
                            "She <span class='highlight'>is going to study</span> abroad. (计划/打算)",
                            "It <span class='highlight'>will rain</span> tomorrow. (预测)"
                        ]
                    },
                    {
                        name: "将来进行时 (Future Continuous)",
                        structure: "主语 + will be + 动词-ing",
                        usage: "表示将来某时正在进行的动作",
                        examples: [
                            "I <span class='highlight'>will be working</span> at 9 tomorrow. (将来某时的动作)",
                            "She <span class='highlight'>will be travelling</span> next month. (将来的计划)",
                            "They <span class='highlight'>will be sleeping</span> when we arrive. (将来的状态)"
                        ]
                    },
                    {
                        name: "将来完成时 (Future Perfect)",
                        structure: "主语 + will have + 过去分词",
                        usage: "表示到将来某时将要完成的动作",
                        examples: [
                            "I <span class='highlight'>will have finished</span> the project by next week. (将来完成)",
                            "She <span class='highlight'>will have graduated</span> by June. (将来的成就)",
                            "They <span class='highlight'>will have left</span> before you arrive. (将来的先后)"
                        ]
                    },
                    {
                        name: "将来完成进行时 (Future Perfect Continuous)",
                        structure: "主语 + will have been + 动词-ing",
                        usage: "表示到将来某时为止一直在进行的动作",
                        examples: [
                            "By 2025, I <span class='highlight'>will have been working</span> here for 10 years. (将来的持续)",
                            "She <span class='highlight'>will have been studying</span> for 6 hours by then. (将来的时长)",
                            "They <span class='highlight'>will have been living</span> there for a decade. (将来的持续状态)"
                        ]
                    }
                ]
            },
            articles: {
                title: "冠词",
                rules: [
                    {
                        name: "不定冠词 a/an",
                        structure: "a + 辅音音素开头的词, an + 元音音素开头的词",
                        usage: "表示泛指，第一次提到某物，表示'一个'的概念",
                        examples: [
                            "I have <span class='highlight'>a</span> cat. (泛指一只猫)",
                            "She is <span class='highlight'>an</span> engineer. (职业)",
                            "There is <span class='highlight'>a</span> university here. (虽然u开头，但读作/ju/，辅音音素)"
                        ]
                    },
                    {
                        name: "定冠词 the",
                        structure: "the + 名词",
                        usage: "表示特指，双方都知道的事物，独一无二的事物",
                        examples: [
                            "<span class='highlight'>The</span> book on the table is mine. (特指桌上的书)",
                            "I like <span class='highlight'>the</span> music you played. (特指你演奏的音乐)",
                            "<span class='highlight'>The</span> sun is shining. (独一无二的太阳)"
                        ]
                    },
                    {
                        name: "零冠词",
                        structure: "不使用冠词",
                        usage: "复数可数名词泛指，不可数名词泛指，专有名词等",
                        examples: [
                            "<span class='highlight'>Books</span> are important. (书籍泛指)",
                            "I like <span class='highlight'>music</span>. (音乐泛指)",
                            "<span class='highlight'>Beijing</span> is a beautiful city. (专有名词)"
                        ]
                    }
                ]
            },
            prepositions: {
                title: "介词",
                rules: [
                    {
                        name: "时间介词",
                        structure: "at/in/on + 时间",
                        usage: "at用于具体时刻，in用于月份/年份/季节，on用于具体日期/星期",
                        examples: [
                            "I get up <span class='highlight'>at</span> 7 o'clock. (具体时刻)",
                            "She was born <span class='highlight'>in</span> 1990. (年份)",
                            "We have a meeting <span class='highlight'>on</span> Monday. (星期)",
                            "The flowers bloom <span class='highlight'>in</span> spring. (季节)"
                        ]
                    },
                    {
                        name: "地点介词",
                        structure: "at/in/on + 地点",
                        usage: "at用于小地点/具体位置，in用于大地点/内部，on用于表面",
                        examples: [
                            "I'm <span class='highlight'>at</span> the bus stop. (具体位置)",
                            "He lives <span class='highlight'>in</span> Beijing. (大地点)",
                            "The book is <span class='highlight'>on</span> the table. (表面)",
                            "There are many people <span class='highlight'>in</span> the park. (内部)"
                        ]
                    },
                    {
                        name: "方向介词",
                        structure: "to/from/into/out of + 地点",
                        usage: "to表示朝向，from表示来自，into表示进入，out of表示从...出来",
                        examples: [
                            "I'm going <span class='highlight'>to</span> school. (朝向)",
                            "She comes <span class='highlight'>from</span> China. (来自)",
                            "He walked <span class='highlight'>into</span> the room. (进入)",
                            "They came <span class='highlight'>out of</span> the building. (从...出来)"
                        ]
                    }
                ]
            },
            conditionals: {
                title: "条件句",
                rules: [
                    {
                        name: "零条件句 (Zero Conditional)",
                        structure: "If + 一般现在时, 一般现在时",
                        usage: "表示客观事实、科学真理或习惯",
                        examples: [
                            "If you <span class='highlight'>heat</span> water to 100°C, it <span class='highlight'>boils</span>. (科学事实)",
                            "If I <span class='highlight'>don't sleep</span> well, I <span class='highlight'>feel</span> tired. (习惯性结果)",
                            "If you <span class='highlight'>press</span> this button, the machine <span class='highlight'>starts</span>. (操作说明)"
                        ]
                    },
                    {
                        name: "第一条件句 (First Conditional)",
                        structure: "If + 一般现在时, will + 动词原形",
                        usage: "表示对将来真实或可能发生的情况的假设",
                        examples: [
                            "If it <span class='highlight'>rains</span> tomorrow, we <span class='highlight'>will stay</span> home. (可能的将来)",
                            "If you <span class='highlight'>study</span> hard, you <span class='highlight'>will pass</span> the exam. (现实的建议)",
                            "If she <span class='highlight'>comes</span> early, we <span class='highlight'>will start</span> the meeting. (可能的计划)"
                        ]
                    },
                    {
                        name: "第二条件句 (Second Conditional)",
                        structure: "If + 一般过去时, would + 动词原形",
                        usage: "表示对现在或将来不太可能发生的情况的假设",
                        examples: [
                            "If I <span class='highlight'>won</span> the lottery, I <span class='highlight'>would travel</span> around the world. (不太可能)",
                            "If I <span class='highlight'>were</span> you, I <span class='highlight'>would study</span> harder. (假设建议)",
                            "If she <span class='highlight'>had</span> more time, she <span class='highlight'>would learn</span> piano. (假想情况)"
                        ]
                    },
                    {
                        name: "第三条件句 (Third Conditional)",
                        structure: "If + 过去完成时, would have + 过去分词",
                        usage: "表示对过去情况的假设，与事实相反",
                        examples: [
                            "If I <span class='highlight'>had studied</span> harder, I <span class='highlight'>would have passed</span> the exam. (过去的遗憾)",
                            "If you <span class='highlight'>had told</span> me earlier, I <span class='highlight'>would have helped</span> you. (错过的机会)",
                            "If it <span class='highlight'>hadn't rained</span>, we <span class='highlight'>would have gone</span> to the park. (过去的假设)"
                        ]
                    },
                    {
                        name: "混合条件句 (Mixed Conditionals)",
                        structure: "混合不同时间的条件句结构",
                        usage: "条件和结果发生在不同的时间",
                        examples: [
                            "If I <span class='highlight'>had studied</span> medicine, I <span class='highlight'>would be</span> a doctor now. (过去的条件，现在的结果)",
                            "If I <span class='highlight'>were</span> taller, I <span class='highlight'>would have joined</span> the basketball team. (现在的条件，过去的结果)",
                            "If you <span class='highlight'>had left</span> earlier, you <span class='highlight'>wouldn't be</span> late now. (过去的条件，现在的结果)"
                        ]
                    }
                ]
            },
            passive: {
                title: "被动语态",
                rules: [
                    {
                        name: "一般现在时被动语态",
                        structure: "主语 + am/is/are + 过去分词",
                        usage: "表示现在经常性的被动动作或状态",
                        examples: [
                            "English <span class='highlight'>is spoken</span> in many countries. (经常性状态)",
                            "The letters <span class='highlight'>are delivered</span> every morning. (定期动作)",
                            "This song <span class='highlight'>is loved</span> by everyone. (普遍状态)"
                        ]
                    },
                    {
                        name: "一般过去时被动语态",
                        structure: "主语 + was/were + 过去分词",
                        usage: "表示过去发生的被动动作",
                        examples: [
                            "The house <span class='highlight'>was built</span> in 1990. (过去的动作)",
                            "Many trees <span class='highlight'>were planted</span> last year. (过去的活动)",
                            "The letter <span class='highlight'>was written</span> by him. (过去的行为)"
                        ]
                    },
                    {
                        name: "一般将来时被动语态",
                        structure: "主语 + will be + 过去分词",
                        usage: "表示将来的被动动作",
                        examples: [
                            "A new bridge <span class='highlight'>will be built</span> next year. (将来的计划)",
                            "The meeting <span class='highlight'>will be held</span> tomorrow. (将来的安排)",
                            "The problem <span class='highlight'>will be solved</span> soon. (将来的预期)"
                        ]
                    },
                    {
                        name: "现在完成时被动语态",
                        structure: "主语 + have/has been + 过去分词",
                        usage: "表示已经完成的被动动作对现在的影响",
                        examples: [
                            "The work <span class='highlight'>has been finished</span>. (已完成的工作)",
                            "Many mistakes <span class='highlight'>have been corrected</span>. (已纠正的错误)",
                            "The book <span class='highlight'>has been translated</span> into Chinese. (已翻译的书)"
                        ]
                    },
                    {
                        name: "含情态动词的被动语态",
                        structure: "主语 + 情态动词 + be + 过去分词",
                        usage: "表示带有情态意义的被动动作",
                        examples: [
                            "This problem <span class='highlight'>must be solved</span> immediately. (必须)",
                            "The door <span class='highlight'>should be locked</span>. (应该)",
                            "English <span class='highlight'>can be learned</span> easily. (能够)"
                        ]
                    }
                ]
            },
            modals: {
                title: "情态动词",
                rules: [
                    {
                        name: "can / could",
                        structure: "主语 + can/could + 动词原形",
                        usage: "can表示能力、许可、可能性；could表示过去的能力、委婉请求",
                        examples: [
                            "I <span class='highlight'>can</span> swim. (能力)",
                            "You <span class='highlight'>can</span> go now. (许可)",
                            "<span class='highlight'>Could</span> you help me? (委婉请求)",
                            "She <span class='highlight'>could</span> play piano when she was young. (过去能力)"
                        ]
                    },
                    {
                        name: "may / might",
                        structure: "主语 + may/might + 动词原形",
                        usage: "may表示许可、可能性；might表示更小的可能性或委婉语气",
                        examples: [
                            "<span class='highlight'>May</span> I come in? (正式请求许可)",
                            "It <span class='highlight'>may</span> rain tomorrow. (可能性)",
                            "He <span class='highlight'>might</span> be late. (较小可能性)",
                            "You <span class='highlight'>might</span> want to check this. (委婉建议)"
                        ]
                    },
                    {
                        name: "must / have to",
                        structure: "主语 + must/have to + 动词原形",
                        usage: "must表示强烈义务、推测；have to表示客观需要",
                        examples: [
                            "You <span class='highlight'>must</span> finish your homework. (强烈义务)",
                            "She <span class='highlight'>must</span> be tired. (推测)",
                            "I <span class='highlight'>have to</span> go to work. (客观需要)",
                            "Students <span class='highlight'>have to</span> wear uniforms. (规定)"
                        ]
                    },
                    {
                        name: "should / ought to",
                        structure: "主语 + should/ought to + 动词原形",
                        usage: "表示建议、义务、应该做的事",
                        examples: [
                            "You <span class='highlight'>should</span> study more. (建议)",
                            "We <span class='highlight'>should</span> respect our parents. (道德义务)",
                            "You <span class='highlight'>ought to</span> help others. (应该)",
                            "Students <span class='highlight'>should</span> listen carefully. (期望)"
                        ]
                    },
                    {
                        name: "will / would",
                        structure: "主语 + will/would + 动词原形",
                        usage: "will表示意愿、将来；would表示过去习惯、委婉请求",
                        examples: [
                            "I <span class='highlight'>will</span> help you. (意愿)",
                            "It <span class='highlight'>will</span> be sunny tomorrow. (将来)",
                            "<span class='highlight'>Would</span> you like some tea? (委婉邀请)",
                            "He <span class='highlight'>would</span> often visit us. (过去习惯)"
                        ]
                    },
                    {
                        name: "need / dare",
                        structure: "主语 + need/dare + 动词原形 (否定疑问句)",
                        usage: "need表示需要；dare表示敢于",
                        examples: [
                            "You <span class='highlight'>needn't</span> worry. (不需要)",
                            "<span class='highlight'>Need</span> I say more? (需要吗？)",
                            "He <span class='highlight'>daren't</span> speak. (不敢)",
                            "<span class='highlight'>Dare</span> you jump? (敢吗？)"
                        ]
                    }
                ]
            }
        };

        // Enhanced Practice questions data
        const practiceQuestions = {
            tenses: [
                {
                    question: "I _____ to school every day.",
                    options: ["go", "goes", "going", "went"],
                    correct: 0,
                    explanation: "主语是I，一般现在时用动词原形。"
                },
                {
                    question: "She _____ her homework now.",
                    options: ["do", "does", "is doing", "did"],
                    correct: 2,
                    explanation: "now表示现在进行时，结构是be + doing。"
                },
                {
                    question: "They _____ to the park yesterday.",
                    options: ["go", "goes", "going", "went"],
                    correct: 3,
                    explanation: "yesterday表示过去时间，用过去式went。"
                },
                {
                    question: "I _____ this book already.",
                    options: ["read", "have read", "am reading", "will read"],
                    correct: 1,
                    explanation: "already表示现在完成时，结构是have/has + 过去分词。"
                },
                {
                    question: "By next year, I _____ here for 5 years.",
                    options: ["work", "worked", "will work", "will have worked"],
                    correct: 3,
                    explanation: "by next year表示将来完成时，结构是will have + 过去分词。"
                },
                {
                    question: "I _____ for you when you arrived.",
                    options: ["wait", "waited", "was waiting", "have waited"],
                    correct: 2,
                    explanation: "when you arrived表示过去某时正在进行的动作，用过去进行时。"
                }
            ],
            articles: [
                {
                    question: "I saw _____ elephant at the zoo.",
                    options: ["a", "an", "the", "/"],
                    correct: 1,
                    explanation: "elephant以元音音素开头，用an。"
                },
                {
                    question: "_____ book you lent me is very interesting.",
                    options: ["A", "An", "The", "/"],
                    correct: 2,
                    explanation: "特指你借给我的那本书，用the。"
                },
                {
                    question: "I like _____ music.",
                    options: ["a", "an", "the", "/"],
                    correct: 3,
                    explanation: "music是不可数名词，泛指时不用冠词。"
                },
                {
                    question: "_____ sun is very bright today.",
                    options: ["A", "An", "The", "/"],
                    correct: 2,
                    explanation: "sun是独一无二的事物，用定冠词the。"
                }
            ],
            prepositions: [
                {
                    question: "I was born _____ 1990.",
                    options: ["at", "in", "on", "by"],
                    correct: 1,
                    explanation: "年份前用介词in。"
                },
                {
                    question: "The meeting is _____ 3 o'clock.",
                    options: ["at", "in", "on", "by"],
                    correct: 0,
                    explanation: "具体时刻前用介词at。"
                },
                {
                    question: "I live _____ Beijing.",
                    options: ["at", "in", "on", "by"],
                    correct: 1,
                    explanation: "大地点（城市）前用介词in。"
                },
                {
                    question: "We have a party _____ Friday night.",
                    options: ["at", "in", "on", "by"],
                    correct: 2,
                    explanation: "具体的某天晚上用介词on。"
                }
            ],
            conditionals: [
                {
                    question: "If it _____ tomorrow, we will stay home.",
                    options: ["rain", "rains", "rained", "will rain"],
                    correct: 1,
                    explanation: "第一条件句：If + 一般现在时, will + 动词原形。"
                },
                {
                    question: "If I _____ rich, I would travel the world.",
                    options: ["am", "was", "were", "will be"],
                    correct: 2,
                    explanation: "第二条件句用虚拟语气，be动词用were。"
                },
                {
                    question: "If I _____ harder, I would have passed the exam.",
                    options: ["studied", "had studied", "study", "will study"],
                    correct: 1,
                    explanation: "第三条件句：If + 过去完成时, would have + 过去分词。"
                },
                {
                    question: "If you heat ice, it _____.",
                    options: ["melt", "melts", "melted", "will melt"],
                    correct: 1,
                    explanation: "零条件句表示客观事实，两个分句都用一般现在时。"
                }
            ],
            passive: [
                {
                    question: "English _____ in many countries.",
                    options: ["speaks", "is spoken", "was spoken", "has spoken"],
                    correct: 1,
                    explanation: "一般现在时被动语态：is/are + 过去分词。"
                },
                {
                    question: "The house _____ in 1990.",
                    options: ["builds", "built", "was built", "has built"],
                    correct: 2,
                    explanation: "一般过去时被动语态：was/were + 过去分词。"
                },
                {
                    question: "A new school _____ next year.",
                    options: ["builds", "will build", "will be built", "has built"],
                    correct: 2,
                    explanation: "一般将来时被动语态：will be + 过去分词。"
                },
                {
                    question: "The work _____ already.",
                    options: ["finishes", "finished", "has finished", "has been finished"],
                    correct: 3,
                    explanation: "现在完成时被动语态：have/has been + 过去分词。"
                }
            ],
            modals: [
                {
                    question: "You _____ finish your homework before playing.",
                    options: ["can", "may", "must", "might"],
                    correct: 2,
                    explanation: "must表示强烈的义务和必要性。"
                },
                {
                    question: "_____ I borrow your pen?",
                    options: ["Must", "Should", "May", "Need"],
                    correct: 2,
                    explanation: "May用于正式的请求许可。"
                },
                {
                    question: "You _____ study harder if you want to pass.",
                    options: ["can", "should", "may", "might"],
                    correct: 1,
                    explanation: "should表示建议和忠告。"
                },
                {
                    question: "She _____ swim when she was 5 years old.",
                    options: ["can", "could", "may", "might"],
                    correct: 1,
                    explanation: "could表示过去的能力。"
                }
            ]
        };

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            initGrammarTabs();
            initTopicCards();
            initPracticeSystem();
            initTestSystem();
            initReferenceSystem();
        });

        // Tab system
        function initGrammarTabs() {
            const tabs = document.querySelectorAll('.grammar-tab');
            const panels = document.querySelectorAll('.grammar-panel');

            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetPanel = this.getAttribute('data-tab') + '-panel';
                    
                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update active panel
                    panels.forEach(p => p.classList.remove('active'));
                    document.getElementById(targetPanel).classList.add('active');
                });
            });
        }

        // Topic cards in learn panel
        function initTopicCards() {
            const topicCards = document.querySelectorAll('[data-topic]');
            const topicContent = document.getElementById('topic-content');

            topicCards.forEach(card => {
                card.addEventListener('click', function() {
                    const topic = this.getAttribute('data-topic');
                    
                    // Update selected card
                    topicCards.forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    // Load topic content
                    loadTopicContent(topic, topicContent);
                });
            });
        }

        function loadTopicContent(topic, container) {
            const data = grammarData[topic];
            if (!data) return;

            let html = `<h3><i class="fas fa-book-open"></i> ${data.title}</h3>`;
            
            // Special layout for tenses
            if (topic === 'tenses') {
                html += `<div class="tense-chart">`;
                data.rules.forEach(rule => {
                    html += `
                        <div class="tense-box">
                            <h4>${rule.name}</h4>
                            <p><strong>结构：</strong>${rule.structure}</p>
                            <p><strong>用法：</strong>${rule.usage}</p>
                            <div class="examples">
                                ${rule.examples.map(ex => `<div class="example-sentence">${ex}</div>`).join('')}
                            </div>
                        </div>
                    `;
                });
                html += `</div>`;
            }
            // Special layout for conditionals
            else if (topic === 'conditionals') {
                html += `<div class="conditional-types">`;
                data.rules.forEach(rule => {
                    html += `
                        <div class="conditional-card">
                            <h4>${rule.name}</h4>
                            <p><strong>结构：</strong>${rule.structure}</p>
                            <p><strong>用法：</strong>${rule.usage}</p>
                            <div class="examples">
                                <strong>例句：</strong>
                                ${rule.examples.map(ex => `<div class="example-sentence">${ex}</div>`).join('')}
                            </div>
                        </div>
                    `;
                });
                html += `</div>`;
            }
            // Special layout for modals
            else if (topic === 'modals') {
                html += `<div class="modal-showcase">`;
                data.rules.forEach(rule => {
                    html += `
                        <div class="modal-card">
                            <h4>${rule.name}</h4>
                            <p><strong>结构：</strong>${rule.structure}</p>
                            <p><strong>用法：</strong>${rule.usage}</p>
                            <div class="examples">
                                ${rule.examples.map(ex => `<div class="example-sentence">${ex}</div>`).join('')}
                            </div>
                        </div>
                    `;
                });
                html += `</div>`;
            }
            // Default layout for other topics
            else {
                data.rules.forEach(rule => {
                    html += `
                        <div class="grammar-rule">
                            <h4>${rule.name}</h4>
                            <p><strong>结构：</strong>${rule.structure}</p>
                            <p><strong>用法：</strong>${rule.usage}</p>
                            <div class="examples">
                                <strong>例句：</strong>
                                ${rule.examples.map(ex => `<div class="example-sentence">${ex}</div>`).join('')}
                            </div>
                        </div>
                    `;
                });
            }

            container.innerHTML = html;
            container.style.display = 'block';
        }

        // Practice system
        function initPracticeSystem() {
            const startBtn = document.getElementById('start-practice');
            const container = document.getElementById('practice-container');
            const questionsDiv = document.getElementById('practice-questions');
            const progressBar = document.getElementById('practice-progress');

            let currentQuestions = [];
            let currentQuestionIndex = 0;
            let score = 0;

            startBtn.addEventListener('click', function() {
                const topic = document.getElementById('practice-topic').value;
                const difficulty = document.getElementById('practice-difficulty').value;
                
                startPractice(topic, difficulty);
            });

            function startPractice(topic, difficulty) {
                currentQuestions = generatePracticeQuestions(topic, difficulty);
                currentQuestionIndex = 0;
                score = 0;
                
                container.style.display = 'block';
                showQuestion();
            }

            function generatePracticeQuestions(topic, difficulty) {
                if (topic === 'mixed') {
                    let questions = [];
                    Object.keys(practiceQuestions).forEach(key => {
                        questions = questions.concat(practiceQuestions[key]);
                    });
                    return shuffleArray(questions).slice(0, 15);
                } else if (practiceQuestions[topic]) {
                    return shuffleArray(practiceQuestions[topic]);
                } else {
                    return generateDefaultQuestions(topic, difficulty);
                }
            }

            function generateDefaultQuestions(topic, difficulty) {
                return [
                    {
                        question: `这是一个${topic}的${difficulty}级别练习题。`,
                        options: ["选项A", "选项B", "选项C", "选项D"],
                        correct: 0,
                        explanation: "这是示例解释。"
                    }
                ];
            }

            function showQuestion() {
                if (currentQuestionIndex >= currentQuestions.length) {
                    showPracticeResults();
                    return;
                }

                const question = currentQuestions[currentQuestionIndex];
                const progress = ((currentQuestionIndex + 1) / currentQuestions.length) * 100;
                progressBar.style.width = progress + '%';

                questionsDiv.innerHTML = `
                    <div class="exercise-question">
                        <h4>题目 ${currentQuestionIndex + 1}/${currentQuestions.length}</h4>
                        <p>${question.question}</p>
                        <div class="exercise-options">
                            ${question.options.map((option, index) => 
                                `<button class="exercise-option" data-index="${index}">${option}</button>`
                            ).join('')}
                        </div>
                        <div id="question-explanation" style="display: none;"></div>
                        <button id="next-question" class="btn btn-primary" style="display: none; margin-top: 1rem;">下一题</button>
                    </div>
                `;

                // Add option click handlers
                const options = questionsDiv.querySelectorAll('.exercise-option');
                options.forEach(option => {
                    option.addEventListener('click', function() {
                        const selectedIndex = parseInt(this.getAttribute('data-index'));
                        checkAnswer(selectedIndex, question);
                    });
                });

                // Add next question handler
                document.getElementById('next-question').addEventListener('click', function() {
                    currentQuestionIndex++;
                    showQuestion();
                });
            }

            function checkAnswer(selectedIndex, question) {
                const options = questionsDiv.querySelectorAll('.exercise-option');
                const explanationDiv = document.getElementById('question-explanation');
                const nextBtn = document.getElementById('next-question');

                options.forEach((option, index) => {
                    option.disabled = true;
                    if (index === question.correct) {
                        option.classList.add('correct');
                    } else if (index === selectedIndex && index !== question.correct) {
                        option.classList.add('incorrect');
                    }
                });

                if (selectedIndex === question.correct) {
                    score++;
                }

                explanationDiv.innerHTML = `
                    <div class="explanation-box">
                        <h5><i class="fas fa-lightbulb"></i> 解释</h5>
                        <p>${question.explanation}</p>
                    </div>
                `;
                explanationDiv.style.display = 'block';
                nextBtn.style.display = 'block';
            }

            function showPracticeResults() {
                const percentage = Math.round((score / currentQuestions.length) * 100);
                const resultsDiv = document.getElementById('practice-results');
                
                resultsDiv.innerHTML = `
                    <div class="score-display">
                        <div class="score-number">${percentage}%</div>
                        <p>您答对了 ${score}/${currentQuestions.length} 题</p>
                        <button class="btn btn-primary" onclick="location.reload()">重新练习</button>
                    </div>
                `;
                
                questionsDiv.style.display = 'none';
                resultsDiv.style.display = 'block';
            }
        }

        // Test system (enhanced)
        function initTestSystem() {
            const startBtn = document.getElementById('start-test');
            const container = document.getElementById('test-container');
            const questionsDiv = document.getElementById('test-questions');
            const progressBar = document.getElementById('test-progress');

            let currentQuestions = [];
            let currentQuestionIndex = 0;
            let score = 0;

            startBtn.addEventListener('click', function() {
                const level = document.getElementById('test-level').value;
                startTest(level);
            });

            function startTest(level) {
                currentQuestions = generateTestQuestions(level);
                currentQuestionIndex = 0;
                score = 0;
                
                container.style.display = 'block';
                showTestQuestion();
            }

            function generateTestQuestions(level) {
                let questions = [];
                Object.keys(practiceQuestions).forEach(key => {
                    questions = questions.concat(practiceQuestions[key]);
                });
                
                const questionCount = level === 'elementary' ? 20 : 
                                    level === 'intermediate' ? 25 : 30;
                
                return shuffleArray(questions).slice(0, questionCount);
            }

            function showTestQuestion() {
                if (currentQuestionIndex >= currentQuestions.length) {
                    showTestResults();
                    return;
                }

                const question = currentQuestions[currentQuestionIndex];
                const progress = ((currentQuestionIndex + 1) / currentQuestions.length) * 100;
                progressBar.style.width = progress + '%';

                questionsDiv.innerHTML = `
                    <div class="exercise-question">
                        <h4>测试题目 ${currentQuestionIndex + 1}/${currentQuestions.length}</h4>
                        <p>${question.question}</p>
                        <div class="exercise-options">
                            ${question.options.map((option, index) => 
                                `<button class="exercise-option" data-index="${index}">${option}</button>`
                            ).join('')}
                        </div>
                        <button id="next-test-question" class="btn btn-primary" style="display: none; margin-top: 1rem;">下一题</button>
                    </div>
                `;

                // Add option click handlers
                const options = questionsDiv.querySelectorAll('.exercise-option');
                options.forEach(option => {
                    option.addEventListener('click', function() {
                        const selectedIndex = parseInt(this.getAttribute('data-index'));
                        
                        // Mark selection
                        options.forEach(opt => opt.classList.remove('selected'));
                        this.classList.add('selected');
                        
                        // Check answer
                        if (selectedIndex === question.correct) {
                            score++;
                        }
                        
                        // Show next button
                        document.getElementById('next-test-question').style.display = 'block';
                    });
                });

                // Add next question handler
                document.getElementById('next-test-question').addEventListener('click', function() {
                    currentQuestionIndex++;
                    showTestQuestion();
                });
            }

            function showTestResults() {
                const percentage = Math.round((score / currentQuestions.length) * 100);
                const resultsDiv = document.getElementById('test-results');
                
                let level = '';
                if (percentage >= 90) level = '优秀';
                else if (percentage >= 80) level = '良好';
                else if (percentage >= 70) level = '中等';
                else if (percentage >= 60) level = '及格';
                else level = '需要加强';
                
                resultsDiv.innerHTML = `
                    <div class="score-display">
                        <div class="score-number">${percentage}%</div>
                        <p>您答对了 ${score}/${currentQuestions.length} 题</p>
                        <p>评级：<strong>${level}</strong></p>
                        <button class="btn btn-primary" onclick="location.reload()">重新测试</button>
                    </div>
                `;
                
                questionsDiv.style.display = 'none';
                resultsDiv.style.display = 'block';
            }
        }

        // Reference system
        function initReferenceSystem() {
            const referenceCards = document.querySelectorAll('[data-reference]');
            const referenceContent = document.getElementById('reference-content');

            referenceCards.forEach(card => {
                card.addEventListener('click', function() {
                    const reference = this.getAttribute('data-reference');
                    
                    referenceCards.forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    loadReferenceContent(reference, referenceContent);
                });
            });
        }

        function loadReferenceContent(reference, container) {
            let html = '';
            
            switch(reference) {
                case 'tenses':
                    html = `
                        <h3><i class="fas fa-clock"></i> 时态总览</h3>
                        <div class="tense-chart">
                            <div class="tense-box">
                                <h4>现在时态</h4>
                                <p><strong>一般现在时：</strong>I work</p>
                                <p><strong>现在进行时：</strong>I am working</p>
                                <p><strong>现在完成时：</strong>I have worked</p>
                                <p><strong>现在完成进行时：</strong>I have been working</p>
                            </div>
                            <div class="tense-box">
                                <h4>过去时态</h4>
                                <p><strong>一般过去时：</strong>I worked</p>
                                <p><strong>过去进行时：</strong>I was working</p>
                                <p><strong>过去完成时：</strong>I had worked</p>
                                <p><strong>过去完成进行时：</strong>I had been working</p>
                            </div>
                            <div class="tense-box">
                                <h4>将来时态</h4>
                                <p><strong>一般将来时：</strong>I will work</p>
                                <p><strong>将来进行时：</strong>I will be working</p>
                                <p><strong>将来完成时：</strong>I will have worked</p>
                                <p><strong>将来完成进行时：</strong>I will have been working</p>
                            </div>
                        </div>
                    `;
                    break;
                case 'sentence-structure':
                    html = `
                        <h3><i class="fas fa-sitemap"></i> 句子结构</h3>
                        <div class="grammar-rule">
                            <h4>简单句 (Simple Sentence)</h4>
                            <p>只有一个主谓结构：I like apples.</p>
                            <p>基本句型：主语 + 谓语 (+宾语) (+补语)</p>
                        </div>
                        <div class="grammar-rule">
                            <h4>复合句 (Compound Sentence)</h4>
                            <p>两个或多个独立句子用连词连接：I like apples, but she likes oranges.</p>
                            <p>常用连词：and, but, or, so, for, nor, yet</p>
                        </div>
                        <div class="grammar-rule">
                            <h4>复杂句 (Complex Sentence)</h4>
                            <p>包含主句和从句：I know that you are right.</p>
                            <p>从句类型：名词性从句、定语从句、状语从句</p>
                        </div>
                        <div class="grammar-rule">
                            <h4>复合复杂句 (Compound-Complex Sentence)</h4>
                            <p>既有并列关系又有主从关系：I know you are busy, but I hope you can help me.</p>
                        </div>
                    `;
                    break;
                case 'common-errors':
                    html = `
                        <h3><i class="fas fa-exclamation-triangle"></i> 常见错误</h3>
                        <div class="grammar-rule">
                            <h4>主谓一致错误</h4>
                            <p>❌ He don't like it. ✅ He doesn't like it.</p>
                            <p>❌ There is many books. ✅ There are many books.</p>
                        </div>
                        <div class="grammar-rule">
                            <h4>时态错误</h4>
                            <p>❌ I am go to school. ✅ I go to school. / I am going to school.</p>
                            <p>❌ I have went there. ✅ I have been there. / I went there.</p>
                        </div>
                        <div class="grammar-rule">
                            <h4>冠词错误</h4>
                            <p>❌ I have a apple. ✅ I have an apple.</p>
                            <p>❌ I like the music. ✅ I like music. (泛指)</p>
                        </div>
                        <div class="grammar-rule">
                            <h4>介词错误</h4>
                            <p>❌ I arrive to school. ✅ I arrive at school.</p>
                            <p>❌ In Monday morning. ✅ On Monday morning.</p>
                        </div>
                        <div class="grammar-rule">
                            <h4>可数与不可数名词错误</h4>
                            <p>❌ I need some informations. ✅ I need some information.</p>
                            <p>❌ How many money do you have? ✅ How much money do you have?</p>
                        </div>
                    `;
                    break;
                case 'irregular-verbs':
                    html = `
                        <h3><i class="fas fa-list"></i> 不规则动词表</h3>
                        <div class="grammar-rule">
                            <h4>AAA型（三种形式相同）</h4>
                            <p>cut - cut - cut (切) | hit - hit - hit (打击)</p>
                            <p>put - put - put (放) | shut - shut - shut (关闭)</p>
                            <p>cost - cost - cost (花费) | hurt - hurt - hurt (伤害)</p>
                        </div>
                        <div class="grammar-rule">
                            <h4>ABA型（第一和第三形式相同）</h4>
                            <p>come - came - come (来) | run - ran - run (跑)</p>
                            <p>become - became - become (成为)</p>
                        </div>
                        <div class="grammar-rule">
                            <h4>ABB型（第二和第三形式相同）</h4>
                            <p>bring - brought - brought (带来) | buy - bought - bought (买)</p>
                            <p>think - thought - thought (想) | catch - caught - caught (抓住)</p>
                            <p>teach - taught - taught (教) | fight - fought - fought (打架)</p>
                        </div>
                        <div class="grammar-rule">
                            <h4>ABC型（三种形式都不同）</h4>
                            <p>be - was/were - been (是) | go - went - gone (去)</p>
                            <p>do - did - done (做) | see - saw - seen (看见)</p>
                            <p>take - took - taken (拿) | give - gave - given (给)</p>
                            <p>write - wrote - written (写) | know - knew - known (知道)</p>
                            <p>eat - ate - eaten (吃) | speak - spoke - spoken (说)</p>
                        </div>
                    `;
                    break;
            }
            
            container.innerHTML = html;
            container.style.display = 'block';
        }

        // Utility functions
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
    </script>
</body>
</html> 