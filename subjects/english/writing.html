<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>写作提升 - 英语学习助手</title>
    <link rel="icon" href="../../assets/icons/logo_btrfly.ico" type="image/x-icon">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/components.css">
    <link rel="stylesheet" href="../../css/utilities.css">
    <link rel="stylesheet" href="../../css/responsive.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .writing-hero {
            background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
            color: white;
            padding: 4rem 0;
            text-align: center;
        }

        .writing-hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .writing-hero p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .writing-tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin: 2rem 0;
            overflow: hidden;
        }

        .writing-tab {
            flex: 1;
            padding: 1rem 2rem;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .writing-tab.active {
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            color: white;
        }

        .writing-tab:hover:not(.active) {
            background: #e9ecef;
        }

        .writing-content {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .writing-panel {
            display: none;
        }

        .writing-panel.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .writing-types-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .writing-type-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .writing-type-card:hover {
            background: #e9ecef;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .writing-type-card.selected {
            border-color: #6c5ce7;
            background: linear-gradient(135deg, rgba(108, 92, 231, 0.1), rgba(162, 155, 254, 0.1));
        }

        .writing-type-card h3 {
            color: #6c5ce7;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .writing-editor {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .editor-toolbar {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .toolbar-btn {
            background: #6c5ce7;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .toolbar-btn:hover {
            background: #5a4fcf;
        }

        .writing-textarea {
            width: 100%;
            min-height: 300px;
            padding: 1.5rem;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            line-height: 1.6;
            resize: vertical;
            font-family: 'Poppins', sans-serif;
        }

        .writing-textarea:focus {
            outline: none;
            border-color: #6c5ce7;
            box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.1);
        }

        .writing-stats {
            display: flex;
            gap: 2rem;
            margin: 1rem 0;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #6c5ce7;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #636e72;
        }

        .feedback-container {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .feedback-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid #6c5ce7;
        }

        .feedback-section.grammar {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.1), rgba(192, 57, 43, 0.1));
            border-left-color: #e74c3c;
        }

        .feedback-section.style {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.1), rgba(41, 128, 185, 0.1));
            border-left-color: #3498db;
        }

        .feedback-section.structure {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(39, 174, 96, 0.1));
            border-left-color: #2ecc71;
        }

        .feedback-section.vocabulary {
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.1), rgba(142, 68, 173, 0.1));
            border-left-color: #9b59b6;
        }

        .feedback-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .feedback-item {
            background: white;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-left: 3px solid #6c5ce7;
        }

        .feedback-text {
            margin-bottom: 0.5rem;
        }

        .feedback-suggestion {
            color: #27ae60;
            font-style: italic;
            font-size: 0.9rem;
        }

        .prompt-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid #6c5ce7;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .prompt-card:hover {
            background: #f8f9fa;
            transform: translateX(5px);
        }

        .prompt-title {
            font-weight: 600;
            color: #2d3436;
            margin-bottom: 0.5rem;
        }

        .prompt-description {
            color: #636e72;
            font-size: 0.9rem;
        }

        .template-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .template-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border: 1px solid #e9ecef;
        }

        .template-title {
            font-weight: 600;
            color: #6c5ce7;
            margin-bottom: 1rem;
        }

        .template-content {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 1rem;
            font-family: monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-line;
        }

        .score-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: conic-gradient(#6c5ce7 0deg, #6c5ce7 var(--score-deg), #e9ecef var(--score-deg), #e9ecef 360deg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            position: relative;
        }

        .score-circle::before {
            content: '';
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: white;
            position: absolute;
        }

        .score-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #6c5ce7;
            z-index: 1;
        }

        @media (max-width: 768px) {
            .writing-tabs {
                flex-direction: column;
            }

            .writing-tab {
                padding: 0.8rem 1rem;
            }

            .writing-hero h1 {
                font-size: 2rem;
            }

            .writing-types-grid {
                grid-template-columns: 1fr;
            }

            .writing-stats {
                flex-direction: column;
                gap: 1rem;
            }

            .editor-toolbar {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="../../index.html">
                        <i class="fas fa-graduation-cap" style="background: linear-gradient(90deg, #4361ee, #7209b7); -webkit-background-clip: text; background-clip: text; color: transparent;"></i>
                        <span class="gradient-text">Alex的学习助手</span>
                    </a>
                </div>
                <nav class="main-nav">
                    <ul>
                        <li><a href="../../index.html">首页</a></li>
                        <li><a href="../../index.html#subjects">科目</a></li>
                        <li><a href="../../tts.html">语音</a></li>
                        <li><a href="../../draw.html">绘图</a></li>
                        <li><a href="main.html">返回英语</a></li>
                    </ul>
                </nav>
                <button class="mobile-menu-toggle" aria-label="切换菜单">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <main>
        <!-- Hero Section -->
        <section class="writing-hero">
            <div class="container">
                <h1><i class="fas fa-pen-fancy"></i> 写作提升</h1>
                <p>通过AI辅导和专业反馈提高您的英语写作技能，掌握各种写作类型</p>
            </div>
        </section>

        <!-- Main Content -->
        <section class="main-content">
            <div class="container">
                <!-- Writing Tabs -->
                <div class="writing-tabs">
                    <button class="writing-tab active" data-tab="editor">
                        <i class="fas fa-edit"></i> 写作编辑器
                    </button>
                    <button class="writing-tab" data-tab="prompts">
                        <i class="fas fa-lightbulb"></i> 写作提示
                    </button>
                    <button class="writing-tab" data-tab="templates">
                        <i class="fas fa-file-alt"></i> 写作模板
                    </button>
                    <button class="writing-tab" data-tab="analysis">
                        <i class="fas fa-chart-line"></i> 写作分析
                    </button>
                </div>

                <!-- Editor Panel -->
                <div id="editor-panel" class="writing-content writing-panel active">
                    <h2><i class="fas fa-edit"></i> 选择写作类型</h2>
                    <div class="writing-types-grid">
                        <div class="writing-type-card" data-type="essay">
                            <h3><i class="fas fa-graduation-cap"></i> 议论文</h3>
                            <p>学术写作，表达观点和论证</p>
                        </div>
                        <div class="writing-type-card" data-type="letter">
                            <h3><i class="fas fa-envelope"></i> 信件/邮件</h3>
                            <p>正式和非正式的书信写作</p>
                        </div>
                        <div class="writing-type-card" data-type="report">
                            <h3><i class="fas fa-chart-bar"></i> 报告</h3>
                            <p>商务报告和研究报告</p>
                        </div>
                        <div class="writing-type-card" data-type="creative">
                            <h3><i class="fas fa-magic"></i> 创意写作</h3>
                            <p>故事、诗歌和创意表达</p>
                        </div>
                        <div class="writing-type-card" data-type="review">
                            <h3><i class="fas fa-star"></i> 评论</h3>
                            <p>产品、电影、书籍评论</p>
                        </div>
                        <div class="writing-type-card" data-type="description">
                            <h3><i class="fas fa-image"></i> 描述文</h3>
                            <p>人物、地点、事物描述</p>
                        </div>
                    </div>

                    <div id="writing-editor" class="writing-editor" style="display: none;">
                        <div class="editor-toolbar">
                            <button class="toolbar-btn" onclick="insertText('**', '**')">
                                <i class="fas fa-bold"></i> 加粗
                            </button>
                            <button class="toolbar-btn" onclick="insertText('*', '*')">
                                <i class="fas fa-italic"></i> 斜体
                            </button>
                            <button class="toolbar-btn" onclick="insertText('\n- ', '')">
                                <i class="fas fa-list-ul"></i> 列表
                            </button>
                            <button class="toolbar-btn" onclick="insertText('\n> ', '')">
                                <i class="fas fa-quote-right"></i> 引用
                            </button>
                            <button class="toolbar-btn" onclick="clearEditor()">
                                <i class="fas fa-trash"></i> 清空
                            </button>
                            <button class="toolbar-btn" onclick="analyzeWriting()">
                                <i class="fas fa-search"></i> 分析
                            </button>
                        </div>
                        
                        <textarea id="writing-textarea" class="writing-textarea" placeholder="开始您的写作..."></textarea>
                        
                        <div class="writing-stats">
                            <div class="stat-item">
                                <div id="word-count" class="stat-number">0</div>
                                <div class="stat-label">单词</div>
                            </div>
                            <div class="stat-item">
                                <div id="char-count" class="stat-number">0</div>
                                <div class="stat-label">字符</div>
                            </div>
                            <div class="stat-item">
                                <div id="sentence-count" class="stat-number">0</div>
                                <div class="stat-label">句子</div>
                            </div>
                            <div class="stat-item">
                                <div id="paragraph-count" class="stat-number">0</div>
                                <div class="stat-label">段落</div>
                            </div>
                        </div>
                    </div>

                    <div id="feedback-container" class="feedback-container" style="display: none;">
                        <!-- Feedback will be displayed here -->
                    </div>
                </div>

                <!-- Prompts Panel -->
                <div id="prompts-panel" class="writing-content writing-panel">
                    <h2><i class="fas fa-lightbulb"></i> 写作提示</h2>
                    <div class="form-group">
                        <label for="prompt-category">选择提示类别：</label>
                        <select id="prompt-category" class="form-control">
                            <option value="academic">学术写作</option>
                            <option value="creative">创意写作</option>
                            <option value="business">商务写作</option>
                            <option value="personal">个人写作</option>
                        </select>
                    </div>
                    <button id="load-prompts" class="btn btn-primary">
                        <i class="fas fa-refresh"></i> 加载提示
                    </button>
                    <div id="prompts-content" class="template-section" style="display: none;">
                        <!-- Prompts will be loaded here -->
                    </div>
                </div>

                <!-- Templates Panel -->
                <div id="templates-panel" class="writing-content writing-panel">
                    <h2><i class="fas fa-file-alt"></i> 写作模板</h2>
                    <div class="form-group">
                        <label for="template-type">选择模板类型：</label>
                        <select id="template-type" class="form-control">
                            <option value="essay">议论文模板</option>
                            <option value="letter">信件模板</option>
                            <option value="report">报告模板</option>
                            <option value="email">邮件模板</option>
                        </select>
                    </div>
                    <button id="load-templates" class="btn btn-primary">
                        <i class="fas fa-download"></i> 加载模板
                    </button>
                    <div id="templates-content" class="template-section" style="display: none;">
                        <!-- Templates will be loaded here -->
                    </div>
                </div>

                <!-- Analysis Panel -->
                <div id="analysis-panel" class="writing-content writing-panel">
                    <h2><i class="fas fa-chart-line"></i> 写作分析</h2>
                    <p>上传或粘贴您的文本进行详细分析</p>
                    <div class="writing-editor">
                        <textarea id="analysis-textarea" class="writing-textarea" placeholder="粘贴您要分析的文本..."></textarea>
                        <button id="start-analysis" class="btn btn-primary">
                            <i class="fas fa-play"></i> 开始分析
                        </button>
                    </div>
                    <div id="analysis-results" class="feedback-container" style="display: none;">
                        <!-- Analysis results will be displayed here -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <p class="copyright-text">study-llm.me域名为Alex所有。保留所有权利。</p>
                <div class="profile-section">
                    <button id="profile-button" class="profile-button">
                        <i class="fas fa-user-circle"></i>
                        学习阶段
                    </button>
                    <div id="profile-display" class="profile-display"></div>
                </div>
            </div>
        </div>
    </footer>

    <script src="../../js/common.js"></script>
    <script src="../../js/navigation.js"></script>
    <script src="../../js/profile.js"></script>
    <script>
        // Writing data
        const writingPrompts = {
            academic: [
                {
                    title: "环境保护议论文",
                    description: "讨论气候变化对全球的影响，并提出解决方案",
                    prompt: "Climate change is one of the most pressing issues of our time. Discuss the main causes of climate change and propose practical solutions that individuals and governments can implement."
                },
                {
                    title: "教育技术",
                    description: "分析技术在现代教育中的作用",
                    prompt: "Technology has revolutionized education in recent years. Analyze the benefits and drawbacks of using technology in classrooms and discuss its impact on student learning."
                },
                {
                    title: "社交媒体影响",
                    description: "探讨社交媒体对社会的正面和负面影响",
                    prompt: "Social media has become an integral part of modern life. Examine both the positive and negative effects of social media on society and personal relationships."
                }
            ],
            creative: [
                {
                    title: "时间旅行故事",
                    description: "写一个关于时间旅行的短故事",
                    prompt: "You discover an old pocket watch that allows you to travel through time. Write a story about your first journey and what you learn about yourself."
                },
                {
                    title: "未来世界",
                    description: "描述100年后的世界",
                    prompt: "Imagine the world 100 years from now. Describe a day in the life of someone living in this future world, including technology, society, and environment."
                },
                {
                    title: "神秘信件",
                    description: "基于一封神秘信件创作故事",
                    prompt: "You receive a letter addressed to someone who lived in your house 50 years ago. The letter contains a mysterious message. Write about what happens next."
                }
            ],
            business: [
                {
                    title: "商业提案",
                    description: "为新产品写一份商业提案",
                    prompt: "Write a business proposal for a new eco-friendly product. Include market analysis, target audience, and financial projections."
                },
                {
                    title: "客户投诉回复",
                    description: "回复一位不满客户的邮件",
                    prompt: "A customer has complained about a delayed order and poor customer service. Write a professional response that addresses their concerns and offers solutions."
                }
            ],
            personal: [
                {
                    title: "人生转折点",
                    description: "描述改变您人生的一个时刻",
                    prompt: "Write about a moment that changed your perspective on life. Describe the situation, your feelings, and how it influenced your future decisions."
                },
                {
                    title: "理想假期",
                    description: "描述您的理想假期",
                    prompt: "Describe your ideal vacation. Where would you go, what would you do, and who would you travel with? Explain why this would be perfect for you."
                }
            ]
        };

        const writingTemplates = {
            essay: {
                title: "五段式议论文模板",
                content: `Introduction:
- Hook: An interesting opening statement
- Background information
- Thesis statement: Your main argument

Body Paragraph 1:
- Topic sentence
- Supporting evidence
- Explanation
- Concluding sentence

Body Paragraph 2:
- Topic sentence
- Supporting evidence
- Explanation
- Concluding sentence

Body Paragraph 3:
- Topic sentence
- Supporting evidence
- Explanation
- Concluding sentence

Conclusion:
- Restate thesis
- Summarize main points
- Call to action or final thought`
            },
            letter: {
                title: "正式信件模板",
                content: `[Your Address]
[City, State, ZIP Code]
[Date]

[Recipient's Name]
[Recipient's Title]
[Company/Organization]
[Address]

Dear [Mr./Ms. Last Name],

Opening paragraph:
- State the purpose of your letter
- Provide context if necessary

Body paragraph(s):
- Present your main points
- Provide supporting details
- Use clear and concise language

Closing paragraph:
- Summarize your request or main point
- Indicate next steps
- Express appreciation

Sincerely,
[Your signature]
[Your typed name]`
            },
            report: {
                title: "商务报告模板",
                content: `EXECUTIVE SUMMARY
- Brief overview of the report
- Key findings
- Main recommendations

1. INTRODUCTION
- Purpose of the report
- Scope and methodology
- Background information

2. FINDINGS
- Present data and analysis
- Use headings and subheadings
- Include charts/graphs if applicable

3. ANALYSIS
- Interpret the findings
- Discuss implications
- Compare with benchmarks

4. RECOMMENDATIONS
- Specific action items
- Timeline for implementation
- Resource requirements

5. CONCLUSION
- Summary of key points
- Final thoughts
- Next steps`
            },
            email: {
                title: "商务邮件模板",
                content: `Subject: [Clear and specific subject line]

Dear [Name],

Opening:
- Greeting
- Brief context or reference

Body:
- Main message
- Key points in logical order
- Clear action items if needed

Closing:
- Summary or next steps
- Professional closing

Best regards,
[Your name]
[Your title]
[Contact information]`
            }
        };

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            initWritingTabs();
            initWritingTypes();
            initTextEditor();
            initPromptsSystem();
            initTemplatesSystem();
            initAnalysisSystem();
        });

        // Tab system
        function initWritingTabs() {
            const tabs = document.querySelectorAll('.writing-tab');
            const panels = document.querySelectorAll('.writing-panel');

            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetPanel = this.getAttribute('data-tab') + '-panel';
                    
                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update active panel
                    panels.forEach(p => p.classList.remove('active'));
                    document.getElementById(targetPanel).classList.add('active');
                });
            });
        }

        // Writing types
        function initWritingTypes() {
            const typeCards = document.querySelectorAll('.writing-type-card');
            const editor = document.getElementById('writing-editor');

            typeCards.forEach(card => {
                card.addEventListener('click', function() {
                    const type = this.getAttribute('data-type');
                    
                    // Update selected card
                    typeCards.forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    // Show editor
                    editor.style.display = 'block';
                    
                    // Set placeholder based on type
                    setEditorPlaceholder(type);
                });
            });
        }

        function setEditorPlaceholder(type) {
            const textarea = document.getElementById('writing-textarea');
            const placeholders = {
                essay: "开始写您的议论文...\n\n提示：\n1. 明确您的论点\n2. 提供支持证据\n3. 考虑反对观点\n4. 得出结论",
                letter: "开始写您的信件...\n\n提示：\n1. 使用适当的称呼\n2. 清楚说明写信目的\n3. 保持礼貌和专业\n4. 以合适的结尾",
                report: "开始写您的报告...\n\n提示：\n1. 提供执行摘要\n2. 使用清晰的标题\n3. 包含数据和分析\n4. 给出具体建议",
                creative: "释放您的创意...\n\n提示：\n1. 创造生动的场景\n2. 发展有趣的角色\n3. 使用描述性语言\n4. 保持读者兴趣",
                review: "开始写您的评论...\n\n提示：\n1. 简要介绍评论对象\n2. 分析优缺点\n3. 提供具体例子\n4. 给出总体评价",
                description: "开始您的描述...\n\n提示：\n1. 使用五感描述\n2. 选择生动的形容词\n3. 创造清晰的画面\n4. 组织逻辑结构"
            };
            textarea.placeholder = placeholders[type] || "开始您的写作...";
        }

        // Text editor functionality
        function initTextEditor() {
            const textarea = document.getElementById('writing-textarea');
            
            textarea.addEventListener('input', updateStats);
            textarea.addEventListener('input', debounce(autoSave, 2000));
        }

        function updateStats() {
            const textarea = document.getElementById('writing-textarea');
            const text = textarea.value;
            
            const wordCount = text.trim() ? text.trim().split(/\s+/).length : 0;
            const charCount = text.length;
            const sentenceCount = text.split(/[.!?]+/).filter(s => s.trim().length > 0).length;
            const paragraphCount = text.split(/\n\s*\n/).filter(p => p.trim().length > 0).length;
            
            document.getElementById('word-count').textContent = wordCount;
            document.getElementById('char-count').textContent = charCount;
            document.getElementById('sentence-count').textContent = sentenceCount;
            document.getElementById('paragraph-count').textContent = paragraphCount;
        }

        function insertText(before, after) {
            const textarea = document.getElementById('writing-textarea');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            const newText = before + selectedText + after;
            textarea.value = textarea.value.substring(0, start) + newText + textarea.value.substring(end);
            
            // Set cursor position
            const newCursorPos = start + before.length + selectedText.length;
            textarea.setSelectionRange(newCursorPos, newCursorPos);
            textarea.focus();
            
            updateStats();
        }

        function clearEditor() {
            if (confirm('确定要清空编辑器内容吗？')) {
                document.getElementById('writing-textarea').value = '';
                updateStats();
            }
        }

        function analyzeWriting() {
            const text = document.getElementById('writing-textarea').value;
            if (!text.trim()) {
                alert('请先输入一些文本再进行分析。');
                return;
            }
            
            const feedbackContainer = document.getElementById('feedback-container');
            feedbackContainer.style.display = 'block';
            
            // Simulate analysis
            feedbackContainer.innerHTML = '<div class="loading">正在分析您的写作，请稍候...</div>';
            
            setTimeout(() => {
                showWritingFeedback(text, feedbackContainer);
            }, 2000);
        }

        function showWritingFeedback(text, container) {
            const wordCount = text.trim().split(/\s+/).length;
            const score = Math.min(95, Math.max(60, 70 + Math.random() * 25));
            
            container.innerHTML = `
                <div style="text-align: center; margin-bottom: 2rem;">
                    <div class="score-circle" style="--score-deg: ${score * 3.6}deg;">
                        <div class="score-number">${Math.round(score)}</div>
                    </div>
                    <h3>写作质量评分</h3>
                </div>
                
                <div class="feedback-section grammar">
                    <div class="feedback-title">
                        <i class="fas fa-spell-check"></i> 语法和拼写
                    </div>
                    <div class="feedback-item">
                        <div class="feedback-text">检测到 2 个语法问题</div>
                        <div class="feedback-suggestion">建议：检查主谓一致和时态使用</div>
                    </div>
                </div>
                
                <div class="feedback-section style">
                    <div class="feedback-title">
                        <i class="fas fa-paint-brush"></i> 写作风格
                    </div>
                    <div class="feedback-item">
                        <div class="feedback-text">句子长度变化良好</div>
                        <div class="feedback-suggestion">建议：增加更多过渡词来改善流畅性</div>
                    </div>
                </div>
                
                <div class="feedback-section structure">
                    <div class="feedback-title">
                        <i class="fas fa-sitemap"></i> 结构组织
                    </div>
                    <div class="feedback-item">
                        <div class="feedback-text">段落结构清晰</div>
                        <div class="feedback-suggestion">建议：加强结论段的总结性</div>
                    </div>
                </div>
                
                <div class="feedback-section vocabulary">
                    <div class="feedback-title">
                        <i class="fas fa-book"></i> 词汇使用
                    </div>
                    <div class="feedback-item">
                        <div class="feedback-text">词汇多样性: 中等</div>
                        <div class="feedback-suggestion">建议：使用更多高级词汇和同义词</div>
                    </div>
                </div>
            `;
        }

        // Prompts system
        function initPromptsSystem() {
            const loadBtn = document.getElementById('load-prompts');
            const container = document.getElementById('prompts-content');

            loadBtn.addEventListener('click', function() {
                const category = document.getElementById('prompt-category').value;
                loadPrompts(category, container);
            });
        }

        function loadPrompts(category, container) {
            const prompts = writingPrompts[category];
            if (!prompts) return;

            let html = `<h3><i class="fas fa-lightbulb"></i> ${getCategoryName(category)}提示</h3>`;
            
            prompts.forEach(prompt => {
                html += `
                    <div class="prompt-card" onclick="usePrompt('${prompt.prompt.replace(/'/g, "\\'")}')">
                        <div class="prompt-title">${prompt.title}</div>
                        <div class="prompt-description">${prompt.description}</div>
                    </div>
                `;
            });

            container.innerHTML = html;
            container.style.display = 'block';
        }

        function usePrompt(promptText) {
            // Switch to editor tab
            document.querySelector('[data-tab="editor"]').click();
            
            // Set the prompt in the textarea
            const textarea = document.getElementById('writing-textarea');
            textarea.value = `写作提示：${promptText}\n\n开始您的写作：\n\n`;
            textarea.focus();
            
            // Show editor
            document.getElementById('writing-editor').style.display = 'block';
            updateStats();
        }

        // Templates system
        function initTemplatesSystem() {
            const loadBtn = document.getElementById('load-templates');
            const container = document.getElementById('templates-content');

            loadBtn.addEventListener('click', function() {
                const type = document.getElementById('template-type').value;
                loadTemplate(type, container);
            });
        }

        function loadTemplate(type, container) {
            const template = writingTemplates[type];
            if (!template) return;

            container.innerHTML = `
                <div class="template-card">
                    <div class="template-title">${template.title}</div>
                    <div class="template-content">${template.content}</div>
                    <button class="btn btn-primary" onclick="useTemplate('${template.content.replace(/'/g, "\\'")}')">
                        <i class="fas fa-copy"></i> 使用此模板
                    </button>
                </div>
            `;
            container.style.display = 'block';
        }

        function useTemplate(templateContent) {
            // Switch to editor tab
            document.querySelector('[data-tab="editor"]').click();
            
            // Set the template in the textarea
            const textarea = document.getElementById('writing-textarea');
            textarea.value = templateContent;
            textarea.focus();
            
            // Show editor
            document.getElementById('writing-editor').style.display = 'block';
            updateStats();
        }

        // Analysis system
        function initAnalysisSystem() {
            const startBtn = document.getElementById('start-analysis');
            const textarea = document.getElementById('analysis-textarea');
            const container = document.getElementById('analysis-results');

            startBtn.addEventListener('click', function() {
                const text = textarea.value;
                if (!text.trim()) {
                    alert('请输入要分析的文本。');
                    return;
                }
                
                container.style.display = 'block';
                container.innerHTML = '<div class="loading">正在分析文本，请稍候...</div>';
                
                setTimeout(() => {
                    showDetailedAnalysis(text, container);
                }, 2000);
            });
        }

        function showDetailedAnalysis(text, container) {
            const wordCount = text.trim().split(/\s+/).length;
            const readabilityScore = Math.round(60 + Math.random() * 30);
            const sentimentScore = Math.round(40 + Math.random() * 20);
            
            container.innerHTML = `
                <h3><i class="fas fa-chart-line"></i> 详细分析报告</h3>
                
                <div class="writing-stats">
                    <div class="stat-item">
                        <div class="stat-number">${wordCount}</div>
                        <div class="stat-label">总词数</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">${readabilityScore}</div>
                        <div class="stat-label">可读性评分</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">${sentimentScore}</div>
                        <div class="stat-label">情感倾向</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">${Math.round(wordCount / 4.7)}</div>
                        <div class="stat-label">平均句长</div>
                    </div>
                </div>
                
                <div class="feedback-section">
                    <div class="feedback-title">
                        <i class="fas fa-eye"></i> 可读性分析
                    </div>
                    <div class="feedback-item">
                        <div class="feedback-text">文本可读性: ${readabilityScore > 70 ? '良好' : readabilityScore > 50 ? '中等' : '需要改进'}</div>
                        <div class="feedback-suggestion">建议：${readabilityScore > 70 ? '保持当前写作风格' : '简化句子结构，使用更常见的词汇'}</div>
                    </div>
                </div>
                
                <div class="feedback-section">
                    <div class="feedback-title">
                        <i class="fas fa-heart"></i> 情感分析
                    </div>
                    <div class="feedback-item">
                        <div class="feedback-text">情感倾向: ${sentimentScore > 60 ? '积极' : sentimentScore > 40 ? '中性' : '消极'}</div>
                        <div class="feedback-suggestion">文本整体情感倾向为${sentimentScore > 60 ? '积极正面' : sentimentScore > 40 ? '中性客观' : '消极负面'}</div>
                    </div>
                </div>
            `;
        }

        // Utility functions
        function getCategoryName(category) {
            const names = {
                academic: '学术',
                creative: '创意',
                business: '商务',
                personal: '个人'
            };
            return names[category] || category;
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function autoSave() {
            const text = document.getElementById('writing-textarea').value;
            localStorage.setItem('writing-draft', text);
            console.log('Draft auto-saved');
        }

        // Load draft on page load
        window.addEventListener('load', function() {
            const draft = localStorage.getItem('writing-draft');
            if (draft) {
                document.getElementById('writing-textarea').value = draft;
                updateStats();
            }
        });
    </script>
</body>
</html> 