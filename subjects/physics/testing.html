<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>能力测试 - 物理学习助手</title>
    <link rel="icon" href="../../assets/icons/logo_btrfly.ico" type="image/x-icon">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/components.css">
    <link rel="stylesheet" href="../../css/utilities.css">
    <link rel="stylesheet" href="../../css/responsive.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        .testing-hero {
            background: linear-gradient(135deg, #4361ee 0%, #7209b7 100%);
            color: white;
            padding: 4rem 0;
            text-align: center;
        }

        .testing-hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .testing-hero p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .testing-tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin: 2rem 0;
            overflow: hidden;
            flex-wrap: wrap;
        }

        .testing-tab {
            flex: 1;
            min-width: 150px;
            padding: 1rem 2rem;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .testing-tab.active {
            background: linear-gradient(135deg, #4361ee, #7209b7);
            color: white;
        }

        .testing-tab:hover:not(.active) {
            background: #e9ecef;
        }

        .testing-content {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .testing-panel {
            display: none;
        }

        .testing-panel.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .test-type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .test-type-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            text-align: center;
        }

        .test-type-card:hover {
            background: #e9ecef;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .test-type-card.selected {
            border-color: #4361ee;
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.1), rgba(114, 9, 183, 0.1));
        }

        .test-type-card h3 {
            color: #4361ee;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .test-icon {
            font-size: 2.5rem;
            color: #4361ee;
            margin-bottom: 1rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-control:focus {
            border-color: #4361ee;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.25);
            outline: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4361ee, #7209b7);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: 1rem;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.3);
        }

        .test-question {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .question-text {
            font-weight: 600;
            margin-bottom: 1rem;
            color: #2d3436;
            line-height: 1.6;
        }

        .options-list {
            list-style: none;
            padding: 0;
        }

        .option-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option-item:hover {
            border-color: #4361ee;
            background: rgba(67, 97, 238, 0.05);
        }

        .option-item.selected {
            border-color: #4361ee;
            background: rgba(67, 97, 238, 0.1);
        }

        .option-item.correct {
            border-color: #00b894;
            background: rgba(0, 184, 148, 0.1);
        }

        .option-item.incorrect {
            border-color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
        }

        /* 结果显示样式 */
        .result-summary {
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.1), rgba(114, 9, 183, 0.1));
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .score-display {
            font-size: 3rem;
            font-weight: 700;
            color: #4361ee;
            margin-bottom: 1rem;
        }

        .level-badge {
            display: inline-block;
            background: #4361ee;
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            font-weight: 600;
            margin-bottom: 1.5rem;
        }

        .question-result {
            background: white;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            border-left: 4px solid #ddd;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .question-result.correct {
            border-left-color: #28a745;
        }

        .question-result.incorrect {
            border-left-color: #dc3545;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e9ecef;
        }

        .question-number {
            font-weight: 600;
            font-size: 1.1rem;
            color: #4361ee;
        }

        .question-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
        }

        .question-status .fa-check-circle {
            color: #28a745;
        }

        .question-status .fa-times-circle {
            color: #dc3545;
        }

        .original-question {
            margin-bottom: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 6px;
            line-height: 1.6;
        }

        .answer-analysis {
            margin-bottom: 1rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .user-answer, .correct-answer {
            padding: 0.75rem;
            border-radius: 6px;
            background: #f8f9fa;
        }

        .answer-option {
            display: block;
            margin-top: 0.5rem;
            padding: 0.5rem;
            border-radius: 4px;
            font-weight: 500;
        }

        .answer-option.correct-answer {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .user-answer.correct {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .user-answer.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .explanation-content {
            background: #e8f4fd;
            border: 1px solid #bee5eb;
            border-radius: 6px;
            padding: 1rem;
        }

        .explanation-content strong {
            color: #4361ee;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .explanation-text {
            line-height: 1.7;
            color: #2d3436;
            background: white;
            padding: 1rem;
            border-radius: 4px;
            border-left: 3px solid #4361ee;
        }

        .result-actions {
            margin-top: 2rem;
            text-align: center;
            padding-top: 1.5rem;
            border-top: 1px solid #e9ecef;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .testing-tabs {
                flex-direction: column;
            }
            
            .testing-tab {
                min-width: unset;
            }
            
            .test-type-grid {
                grid-template-columns: 1fr;
            }
            
            .btn-secondary {
                margin-left: 0;
                margin-top: 0.5rem;
            }
            
            .testing-hero h1 {
                font-size: 2.5rem;
            }

            .answer-analysis {
                grid-template-columns: 1fr;
            }

            .result-actions {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="../../index.html">
                        <i class="fas fa-graduation-cap" style="background: linear-gradient(90deg, #4361ee, #7209b7); -webkit-background-clip: text; background-clip: text; color: transparent;"></i>
                        <span>Alex的学习助手</span>
                    </a>
                </div>
                <nav class="main-nav">
                    <ul>
                        <li><a href="../../index.html">首页</a></li>
                        <li><a href="../../index.html#subjects">科目</a></li>
                        <li><a href="../../textbook.html">电子课本</a></li>
                        <li><a href="../../tts.html">语音</a></li>
                        <li><a href="../../draw.html">绘图</a></li>
                    </ul>
                </nav>
                <button class="mobile-menu-toggle" aria-label="切换菜单">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <main>
        <!-- 英雄部分 -->
        <section class="testing-hero">
            <div class="container">
                <h1><i class="fas fa-atom"></i> 物理能力测试</h1>
                <p>通过AI生成的个性化测试，全面评估您的物理学习能力，发现强项与不足，制定专属学习计划</p>
            </div>
        </section>

        <!-- 测试内容部分 -->
        <section class="main-content">
            <div class="container">
                <!-- 测试类型选择标签 -->
                <div class="testing-tabs">
                    <button class="testing-tab active" data-tab="mechanics">
                        <i class="fas fa-cogs"></i> 力学
                    </button>
                    <button class="testing-tab" data-tab="electromagnetism">
                        <i class="fas fa-bolt"></i> 电磁学
                    </button>
                    <button class="testing-tab" data-tab="thermodynamics">
                        <i class="fas fa-thermometer-half"></i> 热学
                    </button>
                    <button class="testing-tab" data-tab="optics">
                        <i class="fas fa-eye"></i> 光学
                    </button>
                    <button class="testing-tab" data-tab="modern">
                        <i class="fas fa-atom"></i> 现代物理
                    </button>
                </div>
                
                <!-- AI Quiz Panel -->
                <div id="ai-quiz-panel" class="testing-content testing-panel active">
                    <h2><i class="fas fa-brain"></i> AI智能测试</h2>
                    <p>基于AI技术生成个性化物理测试题目，支持多种话题和难度级别</p>
                    
                    <div class="ai-quiz-config">
                        <h3><i class="fas fa-cog"></i> 测试配置</h3>
                        
                        <!-- Topic Selection -->
                        <div class="form-group">
                            <label><strong>选择测试话题：</strong></label>
                            <div class="topic-grid" id="topic-grid">
                                <div class="topic-card" data-topic="mechanics">
                                    <div class="topic-icon"><i class="fas fa-cogs"></i></div>
                                    <h4>力学基础</h4>
                                    <p>运动学与动力学</p>
                                </div>
                                <div class="topic-card" data-topic="waves">
                                    <div class="topic-icon"><i class="fas fa-wave-square"></i></div>
                                    <h4>波动光学</h4>
                                    <p>机械波与光学</p>
                                </div>
                                <div class="topic-card" data-topic="electricity">
                                    <div class="topic-icon"><i class="fas fa-bolt"></i></div>
                                    <h4>电磁学</h4>
                                    <p>电场与磁场</p>
                                </div>
                                <div class="topic-card" data-topic="thermodynamics">
                                    <div class="topic-icon"><i class="fas fa-thermometer-half"></i></div>
                                    <h4>热力学</h4>
                                    <p>温度与热量</p>
                                </div>
                                <div class="topic-card" data-topic="quantum">
                                    <div class="topic-icon"><i class="fas fa-atom"></i></div>
                                    <h4>量子物理</h4>
                                    <p>原子与量子</p>
                                </div>
                                <div class="topic-card" data-topic="relativity">
                                    <div class="topic-icon"><i class="fas fa-rocket"></i></div>
                                    <h4>相对论</h4>
                                    <p>时空与引力</p>
                                </div>
                                <div class="topic-card" data-topic="nuclear">
                                    <div class="topic-icon"><i class="fas fa-radiation"></i></div>
                                    <h4>核物理</h4>
                                    <p>原子核与辐射</p>
                                </div>
                                <div class="topic-card" data-topic="experiments">
                                    <div class="topic-icon"><i class="fas fa-flask"></i></div>
                                    <h4>物理实验</h4>
                                    <p>实验设计与分析</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Difficulty Selection -->
                        <div class="form-group">
                            <label><strong>选择难度级别：</strong></label>
                            <div class="difficulty-selector" id="difficulty-selector">
                                <button class="difficulty-btn" data-difficulty="middle">
                                    <i class="fas fa-tree"></i> 初中
                                </button>
                                <button class="difficulty-btn" data-difficulty="high">
                                    <i class="fas fa-mountain"></i> 高中
                                </button>
                                <button class="difficulty-btn" data-difficulty="university">
                                    <i class="fas fa-graduation-cap"></i> 大学
                                </button>
                            </div>
                        </div>
                        
                        <!-- Question Count -->
                        <div class="form-group">
                            <label for="question-count"><strong>题目数量：</strong></label>
                            <select id="question-count" class="form-control" style="max-width: 200px;">
                                <option value="5">5题</option>
                                <option value="10" selected>10题</option>
                                <option value="15">15题</option>
                                <option value="20">20题</option>
                            </select>
                        </div>
                        
                        <!-- Custom Topic -->
                        <div class="form-group">
                            <label for="custom-topic"><strong>自定义话题（可选）：</strong></label>
                            <input type="text" id="custom-topic" class="form-control" placeholder="例如：万有引力、电磁感应、光的干涉等">
                        </div>
                        
                        <div class="form-group">
                            <button id="generate-ai-quiz" class="btn btn-primary">
                                <i class="fas fa-magic"></i> 生成AI测试
                            </button>
                        </div>
                    </div>
                    
                    <!-- Quiz Display Area -->
                    <div id="ai-quiz-container" style="display: none;">
                        <!-- AI generated quiz will appear here -->
                    </div>
                </div>

                <!-- 力学测试内容 -->
                <div class="testing-content">
                    <div id="mechanics-panel" class="testing-panel active">
                        <h2><i class="fas fa-cogs"></i> 力学能力测试</h2>
                        <p>测试您对运动学、动力学、能量守恒等力学概念的理解和应用能力</p>
                        
                        <div class="test-type-grid">
                            <div class="test-type-card" data-type="kinematics">
                                <div class="test-icon"><i class="fas fa-route"></i></div>
                                <h3>运动学</h3>
                                <p>直线运动、曲线运动、相对运动</p>
                            </div>
                            <div class="test-type-card" data-type="dynamics">
                                <div class="test-icon"><i class="fas fa-weight"></i></div>
                                <h3>动力学</h3>
                                <p>牛顿定律、力的分析、运动方程</p>
                            </div>
                            <div class="test-type-card" data-type="energy">
                                <div class="test-icon"><i class="fas fa-battery-three-quarters"></i></div>
                                <h3>能量守恒</h3>
                                <p>功能关系、机械能守恒、碰撞</p>
                            </div>
                            <div class="test-type-card" data-type="oscillation">
                                <div class="test-icon"><i class="fas fa-wave-square"></i></div>
                                <h3>振动波动</h3>
                                <p>简谐振动、机械波、共振现象</p>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="mechanics-level">年级水平：</label>
                            <select id="mechanics-level" class="form-control">
                                <option value="middle">初中</option>
                                <option value="high" selected>高中</option>
                                <option value="university">大学</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="mechanics-difficulty">难度等级：</label>
                            <select id="mechanics-difficulty" class="form-control">
                                <option value="easy">基础</option>
                                <option value="medium" selected>中等</option>
                                <option value="hard">困难</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <button id="start-mechanics-test" class="btn btn-primary">
                                <i class="fas fa-play"></i> 开始力学测试
                            </button>
                        </div>
                        
                        <div id="mechanics-test-container" style="display: none;"></div>
                    </div>

                    <!-- 电磁学测试内容 -->
                    <div id="electromagnetism-panel" class="testing-panel">
                        <h2><i class="fas fa-bolt"></i> 电磁学能力测试</h2>
                        <p>测试您对电场、磁场、电磁感应等电磁学概念的理解和计算能力</p>
                        
                        <div class="test-type-grid">
                            <div class="test-type-card" data-type="electrostatics">
                                <div class="test-icon"><i class="fas fa-plus-circle"></i></div>
                                <h3>静电学</h3>
                                <p>库仑定律、电场强度、电势</p>
                            </div>
                            <div class="test-type-card" data-type="current">
                                <div class="test-icon"><i class="fas fa-plug"></i></div>
                                <h3>电流电路</h3>
                                <p>欧姆定律、电路分析、功率计算</p>
                            </div>
                            <div class="test-type-card" data-type="magnetism">
                                <div class="test-icon"><i class="fas fa-magnet"></i></div>
                                <h3>磁学</h3>
                                <p>磁场、安培力、洛伦兹力</p>
                            </div>
                            <div class="test-type-card" data-type="induction">
                                <div class="test-icon"><i class="fas fa-sync-alt"></i></div>
                                <h3>电磁感应</h3>
                                <p>法拉第定律、楞次定律、自感互感</p>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="em-level">年级水平：</label>
                            <select id="em-level" class="form-control">
                                <option value="middle">初中</option>
                                <option value="high" selected>高中</option>
                                <option value="university">大学</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="em-difficulty">难度等级：</label>
                            <select id="em-difficulty" class="form-control">
                                <option value="easy">基础</option>
                                <option value="medium" selected>中等</option>
                                <option value="hard">困难</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <button id="start-em-test" class="btn btn-primary">
                                <i class="fas fa-play"></i> 开始电磁学测试
                            </button>
                        </div>
                        
                        <div id="em-test-container" style="display: none;"></div>
                    </div>

                    <!-- 热学测试内容 -->
                    <div id="thermodynamics-panel" class="testing-panel">
                        <h2><i class="fas fa-thermometer-half"></i> 热学能力测试</h2>
                        <p>测试您对热力学定律、分子运动论、相变等热学知识的掌握程度</p>
                        
                        <div class="test-type-grid">
                            <div class="test-type-card" data-type="kinetic-theory">
                                <div class="test-icon"><i class="fas fa-atom"></i></div>
                                <h3>分子运动论</h3>
                                <p>理想气体状态方程、分子动能</p>
                            </div>
                            <div class="test-type-card" data-type="heat-transfer">
                                <div class="test-icon"><i class="fas fa-fire"></i></div>
                                <h3>热传递</h3>
                                <p>传导、对流、辐射、热平衡</p>
                            </div>
                            <div class="test-type-card" data-type="thermodynamic-laws">
                                <div class="test-icon"><i class="fas fa-balance-scale"></i></div>
                                <h3>热力学定律</h3>
                                <p>内能、焓、熵、自由能</p>
                            </div>
                            <div class="test-type-card" data-type="phase-changes">
                                <div class="test-icon"><i class="fas fa-snowflake"></i></div>
                                <h3>相变</h3>
                                <p>固液气相变、相图、潜热</p>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="thermo-level">年级水平：</label>
                            <select id="thermo-level" class="form-control">
                                <option value="middle">初中</option>
                                <option value="high" selected>高中</option>
                                <option value="university">大学</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="thermo-difficulty">难度等级：</label>
                            <select id="thermo-difficulty" class="form-control">
                                <option value="easy">基础</option>
                                <option value="medium" selected>中等</option>
                                <option value="hard">困难</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <button id="start-thermo-test" class="btn btn-primary">
                                <i class="fas fa-play"></i> 开始热学测试
                            </button>
                        </div>
                        
                        <div id="thermo-test-container" style="display: none;"></div>
                    </div>

                    <!-- 光学测试内容 -->
                    <div id="optics-panel" class="testing-panel">
                        <h2><i class="fas fa-eye"></i> 光学能力测试</h2>
                        <p>测试您对几何光学、波动光学、光的传播和成像规律的理解</p>
                        
                        <div class="test-type-grid">
                            <div class="test-type-card" data-type="geometric-optics">
                                <div class="test-icon"><i class="fas fa-search"></i></div>
                                <h3>几何光学</h3>
                                <p>反射、折射、透镜成像</p>
                            </div>
                            <div class="test-type-card" data-type="wave-optics">
                                <div class="test-icon"><i class="fas fa-water"></i></div>
                                <h3>波动光学</h3>
                                <p>干涉、衍射、偏振现象</p>
                            </div>
                            <div class="test-type-card" data-type="optical-instruments">
                                <div class="test-icon"><i class="fas fa-microscope"></i></div>
                                <h3>光学仪器</h3>
                                <p>显微镜、望远镜、摄像机</p>
                            </div>
                            <div class="test-type-card" data-type="laser">
                                <div class="test-icon"><i class="fas fa-laser-pointer"></i></div>
                                <h3>激光光学</h3>
                                <p>激光原理、全息、光纤</p>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="optics-level">年级水平：</label>
                            <select id="optics-level" class="form-control">
                                <option value="middle">初中</option>
                                <option value="high" selected>高中</option>
                                <option value="university">大学</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="optics-difficulty">难度等级：</label>
                            <select id="optics-difficulty" class="form-control">
                                <option value="easy">基础</option>
                                <option value="medium" selected>中等</option>
                                <option value="hard">困难</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <button id="start-optics-test" class="btn btn-primary">
                                <i class="fas fa-play"></i> 开始光学测试
                            </button>
                        </div>
                        
                        <div id="optics-test-container" style="display: none;"></div>
                    </div>

                    <!-- 现代物理测试内容 -->
                    <div id="modern-panel" class="testing-panel">
                        <h2><i class="fas fa-atom"></i> 现代物理能力测试</h2>
                        <p>测试您对量子力学、相对论、原子物理等现代物理理论的理解</p>
                        
                        <div class="test-type-grid">
                            <div class="test-type-card" data-type="quantum">
                                <div class="test-icon"><i class="fas fa-braille"></i></div>
                                <h3>量子力学</h3>
                                <p>波粒二象性、不确定性原理</p>
                            </div>
                            <div class="test-type-card" data-type="relativity">
                                <div class="test-icon"><i class="fas fa-rocket"></i></div>
                                <h3>相对论</h3>
                                <p>狭义相对论、广义相对论</p>
                            </div>
                            <div class="test-type-card" data-type="atomic">
                                <div class="test-icon"><i class="fas fa-atom"></i></div>
                                <h3>原子物理</h3>
                                <p>原子结构、核反应、放射性</p>
                            </div>
                            <div class="test-type-card" data-type="particle">
                                <div class="test-icon"><i class="fas fa-circle-notch"></i></div>
                                <h3>粒子物理</h3>
                                <p>基本粒子、标准模型</p>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="modern-level">年级水平：</label>
                            <select id="modern-level" class="form-control">
                                <option value="high">高中</option>
                                <option value="university" selected>大学</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="modern-difficulty">难度等级：</label>
                            <select id="modern-difficulty" class="form-control">
                                <option value="easy">基础</option>
                                <option value="medium" selected>中等</option>
                                <option value="hard">困难</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <button id="start-modern-test" class="btn btn-primary">
                                <i class="fas fa-play"></i> 开始现代物理测试
                            </button>
                        </div>
                        
                        <div id="modern-test-container" style="display: none;"></div>
                    </div>
                </div>

                <!-- Results Panel -->
                <div id="results-panel" class="testing-content testing-panel">
                    <h2><i class="fas fa-chart-bar"></i> 测试报告</h2>
                    <p>查看你的物理能力测试结果和个性化学习建议</p>
                    
                    <div id="no-results-message">
                        <p class="text-center">你还没有完成任何测试。请完成至少一项测试以查看报告。</p>
                    </div>
                    
                    <div id="results-container" style="display: none;">
                        <div class="result-summary">
                            <h3>综合物理水平</h3>
                            <div class="score-display" id="overall-score">良好</div>
                            <div class="level-badge" id="level-description">中等水平</div>
                            <p>基于你的测试结果，你的物理水平达到了<strong>中等</strong>水平。</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <p class="copyright-text">所有内容源于AI。study-llm.me域名为Alex所有。</p>
                <div class="profile-section">
                    <button id="profile-button" class="profile-button">
                        <i class="fas fa-user-circle"></i>
                        学习阶段
                    </button>
                    <div id="profile-display" class="profile-display"></div>
                </div>
            </div>
        </div>
    </footer>

    <script src="../../js/common.js"></script>
    <script src="../../js/navigation.js"></script>
    <script src="../../js/profile.js"></script>
    
    <script>
        let currentTestType = '';
        let currentQuestions = [];
        let currentResults = null;

        // MathJax configuration
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            }
        };

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializeTabs();
            initializeTestCards();
            initializeTestButtons();
        });

        function initializeTabs() {
            const tabs = document.querySelectorAll('.testing-tab');
            const panels = document.querySelectorAll('.testing-panel');

            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Remove active class from all tabs and panels
                    tabs.forEach(t => t.classList.remove('active'));
                    panels.forEach(p => p.classList.remove('active'));
                    
                    // Add active class to clicked tab and corresponding panel
                    this.classList.add('active');
                    document.getElementById(targetTab + '-panel').classList.add('active');
                });
            });
        }

        function initializeTestCards() {
            const testCards = document.querySelectorAll('.test-type-card');
            
            testCards.forEach(card => {
                card.addEventListener('click', function() {
                    // Remove selected class from all cards in the same panel
                    const panel = this.closest('.testing-panel');
                    const panelCards = panel.querySelectorAll('.test-type-card');
                    panelCards.forEach(c => c.classList.remove('selected'));
                    
                    // Add selected class to clicked card
                    this.classList.add('selected');
                    currentTestType = this.getAttribute('data-type');
                });
            });
        }

        function initializeTestButtons() {
            // 力学测试
            document.getElementById('start-mechanics-test').addEventListener('click', function() {
                const level = document.getElementById('mechanics-level').value;
                const difficulty = document.getElementById('mechanics-difficulty').value;
                const container = document.getElementById('mechanics-test-container');
                
                if (!currentTestType) {
                    alert('请先选择一个测试类型');
                    return;
                }
                
                startPhysicsTest('mechanics', currentTestType, level, difficulty, container);
            });

            // 电磁学测试
            document.getElementById('start-em-test').addEventListener('click', function() {
                const level = document.getElementById('em-level').value;
                const difficulty = document.getElementById('em-difficulty').value;
                const container = document.getElementById('em-test-container');
                
                if (!currentTestType) {
                    alert('请先选择一个测试类型');
                    return;
                }
                
                startPhysicsTest('electromagnetism', currentTestType, level, difficulty, container);
            });

            // 热学测试
            document.getElementById('start-thermo-test').addEventListener('click', function() {
                const level = document.getElementById('thermo-level').value;
                const difficulty = document.getElementById('thermo-difficulty').value;
                const container = document.getElementById('thermo-test-container');
                
                if (!currentTestType) {
                    alert('请先选择一个测试类型');
                    return;
                }
                
                startPhysicsTest('thermodynamics', currentTestType, level, difficulty, container);
            });

            // 光学测试
            document.getElementById('start-optics-test').addEventListener('click', function() {
                const level = document.getElementById('optics-level').value;
                const difficulty = document.getElementById('optics-difficulty').value;
                const container = document.getElementById('optics-test-container');
                
                if (!currentTestType) {
                    alert('请先选择一个测试类型');
                    return;
                }
                
                startPhysicsTest('optics', currentTestType, level, difficulty, container);
            });

            // 现代物理测试
            document.getElementById('start-modern-test').addEventListener('click', function() {
                const level = document.getElementById('modern-level').value;
                const difficulty = document.getElementById('modern-difficulty').value;
                const container = document.getElementById('modern-test-container');
                
                if (!currentTestType) {
                    alert('请先选择一个测试类型');
                    return;
                }
                
                startPhysicsTest('modern', currentTestType, level, difficulty, container);
            });
        }

        async function startPhysicsTest(subject, type, level, difficulty, container) {
            container.style.display = 'block';
            container.innerHTML = '<div class="text-center"><i class="fas fa-spinner fa-spin"></i> 正在生成物理测试，请稍候...</div>';
            
            const subjectNames = {
                'mechanics': '力学',
                'electromagnetism': '电磁学',
                'thermodynamics': '热学',
                'optics': '光学',
                'modern': '现代物理'
            };

            const typeNames = {
                // 力学
                'kinematics': '运动学',
                'dynamics': '动力学',
                'energy': '能量守恒',
                'oscillation': '振动波动',
                // 电磁学
                'electrostatics': '静电学',
                'current': '电流电路',
                'magnetism': '磁学',
                'induction': '电磁感应',
                // 热学
                'kinetic-theory': '分子运动论',
                'heat-transfer': '热传递',
                'thermodynamic-laws': '热力学定律',
                'phase-changes': '相变',
                // 光学
                'geometric-optics': '几何光学',
                'wave-optics': '波动光学',
                'optical-instruments': '光学仪器',
                'laser': '激光光学',
                // 现代物理
                'quantum': '量子力学',
                'relativity': '相对论',
                'atomic': '原子物理',
                'particle': '粒子物理'
            };

            const difficultyNames = {
                'easy': '基础',
                'medium': '中等',
                'hard': '困难'
            };

            const levelNames = {
                'middle': '初中',
                'high': '高中',
                'university': '大学'
            };

            try {
                const prompt = `请生成5道${subjectNames[subject]}中${typeNames[type]}的${levelNames[level]}${difficultyNames[difficulty]}测试题目。

难度要求：
1. 难度等级：${difficultyNames[difficulty]}
2. 教育水平：${levelNames[level]}
3. 必须达到真实考试的难度水平
4. 题目应该有一定的计算量和物理思维含量

具体要求：
1. 每道题必须是单选题，有4个选项(A、B、C、D)
2. 题目要符合${levelNames[level]}实际考试难度
3. 重点测试${typeNames[type]}的概念理解和计算应用能力
4. 物理公式和数学表达式请使用LaTeX格式，用$符号包围
5. 设置合理的干扰项，错误选项要有一定的迷惑性
6. 正确答案必须随机分布在A、B、C、D选项中
7. 每道题的explanation必须包含详细的物理原理分析和解题过程

请按以下格式返回：

{
  "questions": [
    {
      "question": "题目内容",
      "options": ["选项A", "选项B", "选项C", "选项D"],
      "correct": 正确答案的索引(0-3),
      "explanation": "详细解题步骤：1. 物理原理分析... 2. 公式应用... 3. 计算过程... 4. 结果验证..."
    }
  ]
}

注意：explanation必须包含完整的物理解题过程，包括原理分析、公式推导、计算步骤、结果验证等`;

                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ prompt: prompt })
                });

                if (!response.ok) {
                    throw new Error(`HTTP错误: ${response.status}`);
                }

                const result = await response.json();
                
                if (result.error) {
                    throw new Error(result.message || 'AI生成失败');
                }

                const test = parseAIQuizResponse(result.output);
                currentQuestions = test.questions;
                displayPhysicsTest(test, container, subjectNames[subject], typeNames[type]);
                
            } catch (error) {
                console.error('生成物理测试失败:', error);
                // Fallback content
                const fallbackTest = {
                    questions: [
                        {
                            question: "一个物体从静止开始做匀加速直线运动，在前2秒内的位移为8米，则物体的加速度为：",
                            options: ["2 m/s²", "4 m/s²", "6 m/s²", "8 m/s²"],
                            correct: 1,
                            explanation: "根据运动学公式：$s = \\frac{1}{2}at^2$，代入s=8m，t=2s，解得a=4m/s²"
                        }
                    ]
                };
                currentQuestions = fallbackTest.questions;
                displayPhysicsTest(fallbackTest, container, subjectNames[subject], typeNames[type]);
            }
        }

        function parseAIQuizResponse(response) {
            try {
                // Try to parse as JSON first
                if (response.startsWith('{')) {
                    return JSON.parse(response);
                }
                
                // Extract JSON from markdown code block
                const jsonMatch = response.match(/```(?:json)?\s*(\{[\s\S]*?\})\s*```/);
                if (jsonMatch) {
                    return JSON.parse(jsonMatch[1]);
                }
                
                // Extract JSON from text
                const jsonStart = response.indexOf('{');
                const jsonEnd = response.lastIndexOf('}') + 1;
                if (jsonStart !== -1 && jsonEnd > jsonStart) {
                    const jsonString = response.substring(jsonStart, jsonEnd);
                    return JSON.parse(jsonString);
                }
                
                throw new Error('无法解析AI响应');
            } catch (error) {
                console.error('解析AI响应失败:', error);
                return {
                    questions: [
                        {
                            question: "示例物理题目",
                            options: ["选项A", "选项B", "选项C", "选项D"],
                            correct: 0,
                            explanation: "这是一个示例解释"
                        }
                    ]
                };
            }
        }

        function displayPhysicsTest(test, container, subjectName, typeName) {
            let html = `<h3>${subjectName} - ${typeName}测试</h3>`;
            
            if (test.questions && Array.isArray(test.questions)) {
                test.questions.forEach((question, index) => {
                    html += `
                        <div class="test-question">
                            <div class="question-text">${index + 1}. ${question.question}</div>
                            <ul class="options-list">
                    `;
                    
                    question.options.forEach((option, optionIndex) => {
                        html += `
                            <li class="option-item" data-question="${index}" data-option="${optionIndex}" data-correct="${question.correct}">
                                ${String.fromCharCode(65 + optionIndex)}. ${option}
                            </li>
                        `;
                    });
                    
                    html += '</ul></div>';
                });
            }
            
            html += `
                <div class="form-group">
                    <button id="submit-physics-test" class="btn btn-primary">
                        <i class="fas fa-check"></i> 提交答案
                    </button>
                </div>
            `;
            
            container.innerHTML = html;
            
            // Render MathJax
            renderMathJaxSafely(container);
            
            // Add click handlers for options
            const options = container.querySelectorAll('.option-item');
            options.forEach(option => {
                option.addEventListener('click', function() {
                    const questionId = this.getAttribute('data-question');
                    const questionOptions = document.querySelectorAll(`.option-item[data-question="${questionId}"]`);
                    questionOptions.forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
            
            // Add submit handler
            const submitBtn = container.querySelector('#submit-physics-test');
            submitBtn.addEventListener('click', function() {
                const selectedOptions = container.querySelectorAll('.option-item.selected');
                if (selectedOptions.length < (test.questions?.length || 1)) {
                    alert('请回答所有问题');
                    return;
                }
                
                showPhysicsTestResults(test, selectedOptions, container);
            });
        }

        function showPhysicsTestResults(test, selectedOptions, container) {
            let score = 0;
            let userAnswers = [];
            
            // 收集用户答案
            selectedOptions.forEach(selectedOption => {
                const questionIndex = parseInt(selectedOption.getAttribute('data-question'));
                const selectedIndex = parseInt(selectedOption.getAttribute('data-option'));
                const correctIndex = parseInt(selectedOption.getAttribute('data-correct'));
                
                userAnswers[questionIndex] = {
                    selected: selectedIndex,
                    correct: correctIndex,
                    isCorrect: selectedIndex === correctIndex
                };
                
                if (selectedIndex === correctIndex) {
                    score++;
                }
            });

            const percentage = Math.round((score / test.questions.length) * 100);
            
            // 显示结果
            let resultsHtml = `
                <div class="result-summary">
                    <div class="score-display">${percentage}%</div>
                    <div class="level-badge">${getPhysicsLevel(percentage)}</div>
                    <p>您答对了 ${score} 道题，共 ${test.questions.length} 道题</p>
                </div>
                
                <h4><i class="fas fa-clipboard-list"></i> 详细结果分析</h4>
            `;
            
            // 详细题目分析
            test.questions.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                const isCorrect = userAnswer.isCorrect;
                
                resultsHtml += `
                    <div class="question-result ${isCorrect ? 'correct' : 'incorrect'}">
                        <div class="question-header">
                            <div class="question-number">题目 ${index + 1}</div>
                            <div class="question-status">
                                <i class="fas ${isCorrect ? 'fa-check-circle' : 'fa-times-circle'}"></i>
                                ${isCorrect ? '正确' : '错误'}
                            </div>
                        </div>
                        
                        <div class="original-question">${question.question}</div>
                        
                        <div class="answer-analysis">
                            <div class="user-answer ${isCorrect ? 'correct' : 'incorrect'}">
                                <strong>您的答案：</strong>
                                <span class="answer-option">${String.fromCharCode(65 + userAnswer.selected)}. ${question.options[userAnswer.selected]}</span>
                            </div>
                            <div class="correct-answer">
                                <strong>正确答案：</strong>
                                <span class="answer-option correct-answer">${String.fromCharCode(65 + question.correct)}. ${question.options[question.correct]}</span>
                            </div>
                        </div>
                        
                        <div class="explanation-content">
                            <strong><i class="fas fa-lightbulb"></i> 解题思路：</strong>
                            <div class="explanation-text">${question.explanation}</div>
                        </div>
                    </div>
                `;
            });
            
            resultsHtml += `
                <div class="result-actions">
                    <button class="btn btn-primary" onclick="location.reload()">
                        <i class="fas fa-redo"></i> 重新测试
                    </button>
                    <button class="btn btn-secondary" onclick="window.location.href='main.html'">
                        <i class="fas fa-home"></i> 返回首页
                    </button>
                </div>
            `;
            
            container.innerHTML = resultsHtml;
            renderMathJaxSafely(container);
        }

        function getPhysicsLevel(percentage) {
            if (percentage >= 90) return '物理学霸';
            if (percentage >= 80) return '物理高手';
            if (percentage >= 70) return '物理能手';
            if (percentage >= 60) return '物理学徒';
            return '需要加强';
        }

        function renderMathJaxSafely(element) {
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise([element]).catch(function(err) {
                    console.error('MathJax渲染错误:', err);
                });
            }
        }
    </script>
</body>
</html> 