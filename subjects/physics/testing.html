<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>能力测试 - 物理学习助手</title>
    <link rel="icon" href="assets/icons/alex.ico" type="image/x-icon">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/components.css">
    <link rel="stylesheet" href="../../css/utilities.css">
    <link rel="stylesheet" href="../../css/responsive.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        .testing-hero {
            background: linear-gradient(135deg, #4361ee 0%, #7209b7 100%);
            color: white;
            padding: 4rem 0;
            text-align: center;
        }

        .testing-hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .testing-hero p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto 2rem auto;
        }

        .test-guide {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .guide-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .guide-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }

        .guide-icon {
            font-size: 2.5rem;
            color: #ffd700;
            margin-bottom: 1rem;
        }

        .guide-card h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: white;
        }

        .guide-card p {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        .guide-topics {
            font-size: 0.9rem;
            opacity: 0.8;
            line-height: 1.4;
        }

        .testing-tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin: 2rem 0;
            overflow: hidden;
            flex-wrap: wrap;
        }

        .testing-tab {
            flex: 1;
            min-width: 150px;
            padding: 1rem 2rem;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .testing-tab.active {
            background: linear-gradient(135deg, #4361ee, #7209b7);
            color: white;
        }

        .testing-tab:hover:not(.active) {
            background: #e9ecef;
        }

        .testing-content {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .testing-panel {
            display: none;
        }

        .testing-panel.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .test-type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .test-type-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            text-align: center;
        }

        .test-type-card:hover {
            background: #e9ecef;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .test-type-card.selected {
            border-color: #4361ee;
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.1), rgba(114, 9, 183, 0.1));
        }

        .test-type-card h3 {
            color: #4361ee;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        /* Learning Objectives Styles */
        .learning-objectives {
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.05), rgba(114, 9, 183, 0.05));
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(67, 97, 238, 0.1);
        }

        .learning-objectives h4 {
            color: #4361ee;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.1rem;
        }

        .objectives-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .objective-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #4361ee;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .objective-level {
            background: linear-gradient(135deg, #4361ee, #7209b7);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            align-self: flex-start;
        }

        /* Card Keywords Styles */
        .card-keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .keyword {
            background: rgba(67, 97, 238, 0.1);
            color: #4361ee;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            border: 1px solid rgba(67, 97, 238, 0.2);
        }

        .card-description {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.4;
            margin-bottom: 0.5rem;
        }

        /* Comprehensive Test Card Styles */
        .test-type-card.comprehensive {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 140, 0, 0.1));
            border: 2px solid rgba(255, 140, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .test-type-card.comprehensive::before {
            content: "综合";
            position: absolute;
            top: 5px;
            right: 5px;
            background: linear-gradient(135deg, #ff8c00, #ffd700);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .test-type-card.comprehensive:hover {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 140, 0, 0.15));
            border-color: rgba(255, 140, 0, 0.5);
            transform: translateY(-8px);
        }

        .test-type-card.comprehensive .test-icon {
            background: linear-gradient(135deg, #ff8c00, #ffd700);
        }

        /* Progress Section Styles */
        .progress-section {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(67, 97, 238, 0.1);
        }

        .progress-section h3 {
            color: #4361ee;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.3rem;
        }

        .progress-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        .progress-card {
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.05), rgba(114, 9, 183, 0.05));
            border-radius: 12px;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            border: 1px solid rgba(67, 97, 238, 0.1);
            transition: all 0.3s ease;
        }

        .progress-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.1);
        }

        .progress-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: linear-gradient(135deg, #4361ee, #7209b7);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .progress-info h4 {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .progress-info span {
            font-size: 1.5rem;
            font-weight: 700;
            color: #4361ee;
        }

        /* Learning Suggestion Styles */
        .learning-suggestion {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border-left: 4px solid #4361ee;
        }

        .learning-suggestion h4 {
            color: #4361ee;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.1rem;
        }

        .learning-suggestion p {
            line-height: 1.6;
            color: #2d3436;
            margin: 0;
            background: white;
            padding: 1rem;
            border-radius: 6px;
            border: 1px solid rgba(67, 97, 238, 0.1);
        }

        .test-icon {
            font-size: 2.5rem;
            color: #4361ee;
            margin-bottom: 1rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-control:focus {
            border-color: #4361ee;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.25);
            outline: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4361ee, #7209b7);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: 1rem;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.3);
        }

        /* Quiz Display Styles */
        .test-question {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
        }

        .question-text {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2d3436;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .options-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .option-item {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            line-height: 1.5;
        }

        .option-item:hover {
            background: #e3f2fd;
            border-color: #4361ee;
            transform: translateX(5px);
        }

        .option-item.selected {
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.1), rgba(114, 9, 183, 0.1));
            border-color: #4361ee;
            color: #4361ee;
            font-weight: 600;
        }

        /* Results Display Styles */
        .result-summary {
            text-align: center;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .score-display {
            font-size: 3rem;
            font-weight: 700;
            color: #4361ee;
            margin-bottom: 0.5rem;
        }

        .level-badge {
            display: inline-block;
            background: linear-gradient(135deg, #4361ee, #7209b7);
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 25px;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .question-result {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #28a745;
        }

        .question-result.incorrect {
            border-left-color: #dc3545;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .question-number {
            font-weight: 600;
            color: #495057;
        }

        .question-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .question-status .fa-check-circle {
            color: #28a745;
        }

        .question-status .fa-times-circle {
            color: #dc3545;
        }

        .original-question {
            font-weight: 600;
            margin-bottom: 1rem;
            color: #2d3436;
        }

        .answer-analysis {
            display: grid;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .user-answer, .correct-answer {
            padding: 0.75rem;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .user-answer.correct {
            background: #d4edda;
            border: 1px solid #c3e6cb;
        }

        .user-answer.incorrect {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
        }

        .correct-answer {
            background: #d4edda;
            border: 1px solid #c3e6cb;
        }

        .answer-option {
            font-weight: 600;
            margin-left: 0.5rem;
        }

        .explanation-content {
            background: #e3f2fd;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
        }

        .explanation-text {
            margin-top: 0.5rem;
            line-height: 1.6;
        }

        .result-actions {
            text-align: center;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e9ecef;
        }

        /* Responsive Design - Mobile First */
        @media (max-width: 768px) {
            .testing-hero {
                padding: 2rem 0;
            }
            
            .testing-hero h1 {
                font-size: 2rem;
            }
            
            .testing-hero p {
                font-size: 1rem;
                padding: 0 1rem;
            }
            
            .testing-tabs {
                flex-direction: column;
                margin: 1rem 0;
            }
            
            .testing-tab {
                min-width: 100%;
                padding: 1rem;
                font-size: 0.9rem;
            }
            
            .testing-content {
                padding: 1rem;
                margin-bottom: 1rem;
            }
            
            .test-type-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .test-type-card {
                padding: 1rem;
            }
            
            .test-icon {
                font-size: 2rem;
            }
            
            .test-question {
                padding: 1rem;
                margin-bottom: 1rem;
            }
            
            .question-text {
                font-size: 1rem;
            }
            
            .option-item {
                padding: 0.75rem;
                font-size: 0.9rem;
                margin-bottom: 0.75rem;
            }
            
            .option-item:hover {
                transform: none;
            }
            
            .result-summary {
                padding: 1.5rem;
            }
            
            .score-display {
                font-size: 2.5rem;
            }
            
            .question-result {
                padding: 1rem;
            }
            
            .question-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .answer-analysis {
                grid-template-columns: 1fr;
            }
            
            .explanation-content {
                padding: 0.75rem;
            }
            
            .btn-primary, .btn-secondary {
                width: 100%;
                margin: 0.5rem 0;
                justify-content: center;
            }
            
            .btn-secondary {
                margin-left: 0;
            }
        }

        @media (min-width: 769px) and (max-width: 1024px) {
            .testing-tabs {
                flex-wrap: wrap;
            }
            
            .testing-tab {
                min-width: calc(50% - 0.5rem);
            }
            
            .test-type-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1025px) {
            .testing-tabs {
                flex-wrap: nowrap;
            }
            
            .testing-tab {
                min-width: 150px;
            }
            
            .test-type-grid {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            }
            
            .option-item:hover {
                transform: translateX(5px);
            }
        }

        .test-question {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .question-text {
            font-weight: 600;
            margin-bottom: 1rem;
            color: #2d3436;
            line-height: 1.6;
        }

        .options-list {
            list-style: none;
            padding: 0;
        }

        .option-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option-item:hover {
            border-color: #4361ee;
            background: rgba(67, 97, 238, 0.05);
        }

        .option-item.selected {
            border-color: #4361ee;
            background: rgba(67, 97, 238, 0.1);
        }

        .option-item.correct {
            border-color: #00b894;
            background: rgba(0, 184, 148, 0.1);
        }

        .option-item.incorrect {
            border-color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
        }

        /* 结果显示样式 */
        .result-summary {
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.1), rgba(114, 9, 183, 0.1));
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .score-display {
            font-size: 3rem;
            font-weight: 700;
            color: #4361ee;
            margin-bottom: 1rem;
        }

        .level-badge {
            display: inline-block;
            background: #4361ee;
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            font-weight: 600;
            margin-bottom: 1.5rem;
        }

        .question-result {
            background: white;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            border-left: 4px solid #ddd;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .question-result.correct {
            border-left-color: #28a745;
        }

        .question-result.incorrect {
            border-left-color: #dc3545;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e9ecef;
        }

        .question-number {
            font-weight: 600;
            font-size: 1.1rem;
            color: #4361ee;
        }

        .question-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
        }

        .question-status .fa-check-circle {
            color: #28a745;
        }

        .question-status .fa-times-circle {
            color: #dc3545;
        }

        .original-question {
            margin-bottom: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 6px;
            line-height: 1.6;
        }

        .answer-analysis {
            margin-bottom: 1rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .user-answer, .correct-answer {
            padding: 0.75rem;
            border-radius: 6px;
            background: #f8f9fa;
        }

        .answer-option {
            display: block;
            margin-top: 0.5rem;
            padding: 0.5rem;
            border-radius: 4px;
            font-weight: 500;
        }

        .answer-option.correct-answer {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .user-answer.correct {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .user-answer.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .explanation-content {
            background: #e8f4fd;
            border: 1px solid #bee5eb;
            border-radius: 6px;
            padding: 1rem;
        }

        .explanation-content strong {
            color: #4361ee;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .explanation-text {
            line-height: 1.7;
            color: #2d3436;
            background: white;
            padding: 1rem;
            border-radius: 4px;
            border-left: 3px solid #4361ee;
        }

        .result-actions {
            margin-top: 2rem;
            text-align: center;
            padding-top: 1.5rem;
            border-top: 1px solid #e9ecef;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .testing-tabs {
                flex-direction: column;
            }
            
            .testing-tab {
                min-width: unset;
            }
            
            .test-type-grid {
                grid-template-columns: 1fr;
            }
            
            .btn-secondary {
                margin-left: 0;
                margin-top: 0.5rem;
            }
            
            .testing-hero h1 {
                font-size: 2.5rem;
            }

            .answer-analysis {
                grid-template-columns: 1fr;
            }

            .result-actions {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="../../index.html">
                        <i class="fas fa-graduation-cap" style="background: linear-gradient(90deg, #4361ee, #7209b7); -webkit-background-clip: text; background-clip: text; color: transparent;"></i>
                        <span>Alex的学习助手</span>
                    </a>
                </div>
                <nav class="main-nav">
                    <ul>
                        <li><a href="../../index.html">首页</a></li>
                        <li><a href="../../index.html#subjects">科目</a></li>
                        <li><a href="../../textbook.html">电子课本</a></li>
                        <li><a href="../../tts.html">语音</a></li>
                        <li><a href="../../draw.html">绘图</a></li>
                    </ul>
                </nav>
                <button class="mobile-menu-toggle" aria-label="切换菜单">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <main>
        <!-- 英雄部分 -->
        <section class="testing-hero">
            <div class="container">
                <h1><i class="fas fa-clipboard-check"></i> 物理能力测试</h1>
                <p>基于中国教学大纲的系统化测试平台，精准评估您的物理学习水平，提供个性化学习建议</p>
                
                <!-- 测试导航指南 -->
                <div class="test-guide">
                    <div class="guide-card">
                        <div class="guide-icon"><i class="fas fa-seedling"></i></div>
                        <h3>初中物理</h3>
                        <p>基础概念、现象理解</p>
                        <div class="guide-topics">力学基础 • 电学基础 • 热学现象 • 光学现象</div>
                    </div>
                    <div class="guide-card">
                        <div class="guide-icon"><i class="fas fa-rocket"></i></div>
                        <h3>高中物理</h3>
                        <p>定律应用、公式计算</p>
                        <div class="guide-topics">经典力学 • 电磁学 • 热力学 • 光学 • 现代物理</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 测试内容部分 -->
        <section class="main-content">
            <div class="container">
                <!-- 学习进度跟踪 -->
                <div class="progress-section">
                    <h3><i class="fas fa-chart-line"></i> 学习进度跟踪</h3>
                    <div class="progress-cards">
                        <div class="progress-card">
                            <div class="progress-icon"><i class="fas fa-trophy"></i></div>
                            <div class="progress-info">
                                <h4>已完成测试</h4>
                                <span id="completed-tests">0</span>
                            </div>
                        </div>
                        <div class="progress-card">
                            <div class="progress-icon"><i class="fas fa-star"></i></div>
                            <div class="progress-info">
                                <h4>平均分数</h4>
                                <span id="average-score">--</span>
                            </div>
                        </div>
                        <div class="progress-card">
                            <div class="progress-icon"><i class="fas fa-target"></i></div>
                            <div class="progress-info">
                                <h4>建议练习</h4>
                                <span id="suggested-topic">选择主题开始</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 测试类型选择标签 -->
                <div class="testing-tabs">
                    <button class="testing-tab active" data-tab="mechanics">
                        <i class="fas fa-cogs"></i> 力学
                    </button>
                    <button class="testing-tab" data-tab="electromagnetism">
                        <i class="fas fa-bolt"></i> 电磁学
                    </button>
                    <button class="testing-tab" data-tab="thermodynamics">
                        <i class="fas fa-thermometer-half"></i> 热学
                    </button>
                    <button class="testing-tab" data-tab="optics">
                        <i class="fas fa-eye"></i> 光学
                    </button>
                    <button class="testing-tab" data-tab="modern">
                        <i class="fas fa-atom"></i> 现代物理
                    </button>
                </div>
                
                <!-- 力学测试内容 -->
                <div class="testing-content">
                    <div id="mechanics-panel" class="testing-panel active">
                        <h2><i class="fas fa-cogs"></i> 力学能力测试</h2>
                        <p>基于中国教学大纲，系统测试您的力学知识掌握程度和应用能力</p>
                        
                        <!-- 学习目标说明 -->
                        <div class="learning-objectives">
                            <h4><i class="fas fa-bullseye"></i> 学习目标</h4>
                            <div class="objectives-grid">
                                <div class="objective-item">
                                    <span class="objective-level">初中</span>
                                    <span>机械运动、重力压强、功和功率基础概念</span>
                                </div>
                                <div class="objective-item">
                                    <span class="objective-level">高中</span>
                                    <span>牛顿定律、圆周运动、机械能守恒定律</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="test-type-grid">
                            <div class="test-type-card" data-type="kinematics">
                                <div class="test-icon"><i class="fas fa-route"></i></div>
                                <h3>运动学</h3>
                                <p class="card-description">位移速度、加速度、运动图像分析</p>
                                <div class="card-keywords">
                                    <span class="keyword">匀速直线运动</span>
                                    <span class="keyword">加速度</span>
                                    <span class="keyword">自由落体</span>
                                </div>
                            </div>
                            <div class="test-type-card" data-type="dynamics">
                                <div class="test-icon"><i class="fas fa-weight"></i></div>
                                <h3>动力学</h3>
                                <p class="card-description">牛顿三定律、力的合成与分解</p>
                                <div class="card-keywords">
                                    <span class="keyword">牛顿定律</span>
                                    <span class="keyword">摩擦力</span>
                                    <span class="keyword">弹力</span>
                                </div>
                            </div>
                            <div class="test-type-card" data-type="energy">
                                <div class="test-icon"><i class="fas fa-battery-three-quarters"></i></div>
                                <h3>功和能</h3>
                                <p class="card-description">功能关系、动能定理、机械能守恒</p>
                                <div class="card-keywords">
                                    <span class="keyword">功率</span>
                                    <span class="keyword">动能</span>
                                    <span class="keyword">势能</span>
                                </div>
                            </div>
                            <div class="test-type-card" data-type="oscillation">
                                <div class="test-icon"><i class="fas fa-wave-square"></i></div>
                                <h3>振动波动</h3>
                                <p class="card-description">简谐运动、机械波传播、共振现象</p>
                                <div class="card-keywords">
                                    <span class="keyword">单摆</span>
                                    <span class="keyword">波长频率</span>
                                    <span class="keyword">声波</span>
                                </div>
                            </div>
                            <div class="test-type-card comprehensive" data-type="comprehensive">
                                <div class="test-icon"><i class="fas fa-clipboard-list"></i></div>
                                <h3>综合测试</h3>
                                <p class="card-description">力学各分支知识的综合应用</p>
                                <div class="card-keywords">
                                    <span class="keyword">综合运用</span>
                                    <span class="keyword">跨主题</span>
                                    <span class="keyword">解题技巧</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="mechanics-level">年级水平：</label>
                            <select id="mechanics-level" class="form-control">
                                <option value="middle">初中</option>
                                <option value="high" selected>高中</option>
                                <option value="university">大学</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="mechanics-difficulty">难度等级：</label>
                            <select id="mechanics-difficulty" class="form-control">
                                <option value="easy">基础</option>
                                <option value="medium" selected>中等</option>
                                <option value="hard">困难</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="mechanics-question-count">题目数量：</label>
                            <select id="mechanics-question-count" class="form-control">
                                <option value="5">5题</option>
                                <option value="10" selected>10题</option>
                                <option value="15">15题</option>
                                <option value="20">20题</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <button id="start-mechanics-test" class="btn btn-primary">
                                <i class="fas fa-play"></i> 开始力学测试
                            </button>
                        </div>
                        
                        <div id="mechanics-test-container" style="display: none;"></div>
                    </div>

                    <!-- 电磁学测试内容 -->
                    <div id="electromagnetism-panel" class="testing-panel">
                        <h2><i class="fas fa-bolt"></i> 电磁学能力测试</h2>
                        <p>基于中国教学大纲，全面评估您的电磁学知识掌握和应用能力</p>
                        
                        <!-- 学习目标说明 -->
                        <div class="learning-objectives">
                            <h4><i class="fas fa-bullseye"></i> 学习目标</h4>
                            <div class="objectives-grid">
                                <div class="objective-item">
                                    <span class="objective-level">初中</span>
                                    <span>摩擦起电、电路组成、欧姆定律、电功电功率</span>
                                </div>
                                <div class="objective-item">
                                    <span class="objective-level">高中</span>
                                    <span>库仑定律、电场磁场、电磁感应、交变电流</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="test-type-grid">
                            <div class="test-type-card" data-type="electrostatics">
                                <div class="test-icon"><i class="fas fa-plus-circle"></i></div>
                                <h3>静电学</h3>
                                <p class="card-description">电荷、电场强度、电势能</p>
                                <div class="card-keywords">
                                    <span class="keyword">库仑定律</span>
                                    <span class="keyword">电场线</span>
                                    <span class="keyword">电容器</span>
                                </div>
                            </div>
                            <div class="test-type-card" data-type="current">
                                <div class="test-icon"><i class="fas fa-plug"></i></div>
                                <h3>电流电路</h3>
                                <p class="card-description">欧姆定律、串并联电路、电功电功率</p>
                                <div class="card-keywords">
                                    <span class="keyword">电阻</span>
                                    <span class="keyword">电压</span>
                                    <span class="keyword">电流</span>
                                </div>
                            </div>
                            <div class="test-type-card" data-type="magnetism">
                                <div class="test-icon"><i class="fas fa-magnet"></i></div>
                                <h3>磁学</h3>
                                <p class="card-description">磁感应强度、安培力、洛伦兹力</p>
                                <div class="card-keywords">
                                    <span class="keyword">磁场</span>
                                    <span class="keyword">磁感线</span>
                                    <span class="keyword">右手定则</span>
                                </div>
                            </div>
                            <div class="test-type-card" data-type="induction">
                                <div class="test-icon"><i class="fas fa-sync-alt"></i></div>
                                <h3>电磁感应</h3>
                                <p class="card-description">法拉第定律、楞次定律、交变电流</p>
                                <div class="card-keywords">
                                    <span class="keyword">感应电动势</span>
                                    <span class="keyword">自感</span>
                                    <span class="keyword">发电机</span>
                                </div>
                            </div>
                            <div class="test-type-card comprehensive" data-type="comprehensive">
                                <div class="test-icon"><i class="fas fa-clipboard-list"></i></div>
                                <h3>综合测试</h3>
                                <p class="card-description">电磁学各分支知识的综合应用</p>
                                <div class="card-keywords">
                                    <span class="keyword">电磁综合</span>
                                    <span class="keyword">电路分析</span>
                                    <span class="keyword">实验设计</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="em-level">年级水平：</label>
                            <select id="em-level" class="form-control">
                                <option value="middle">初中</option>
                                <option value="high" selected>高中</option>
                                <option value="university">大学</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="em-difficulty">难度等级：</label>
                            <select id="em-difficulty" class="form-control">
                                <option value="easy">基础</option>
                                <option value="medium" selected>中等</option>
                                <option value="hard">困难</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="em-question-count">题目数量：</label>
                            <select id="em-question-count" class="form-control">
                                <option value="5">5题</option>
                                <option value="10" selected>10题</option>
                                <option value="15">15题</option>
                                <option value="20">20题</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <button id="start-em-test" class="btn btn-primary">
                                <i class="fas fa-play"></i> 开始电磁学测试
                            </button>
                        </div>
                        
                        <div id="em-test-container" style="display: none;"></div>
                    </div>

                    <!-- 热学测试内容 -->
                    <div id="thermodynamics-panel" class="testing-panel">
                        <h2><i class="fas fa-thermometer-half"></i> 热学能力测试</h2>
                        <p>测试您对热力学定律、分子运动论、相变等热学知识的掌握程度</p>
                        
                        <div class="test-type-grid">
                            <div class="test-type-card" data-type="kinetic-theory">
                                <div class="test-icon"><i class="fas fa-atom"></i></div>
                                <h3>分子运动论</h3>
                                <p>理想气体状态方程、分子动能</p>
                            </div>
                            <div class="test-type-card" data-type="heat-transfer">
                                <div class="test-icon"><i class="fas fa-fire"></i></div>
                                <h3>热传递</h3>
                                <p>传导、对流、辐射、热平衡</p>
                            </div>
                            <div class="test-type-card" data-type="thermodynamic-laws">
                                <div class="test-icon"><i class="fas fa-balance-scale"></i></div>
                                <h3>热力学定律</h3>
                                <p>内能、焓、熵、自由能</p>
                            </div>
                            <div class="test-type-card" data-type="phase-changes">
                                <div class="test-icon"><i class="fas fa-snowflake"></i></div>
                                <h3>相变</h3>
                                <p>固液气相变、相图、潜热</p>
                            </div>
                            <div class="test-type-card comprehensive" data-type="comprehensive">
                                <div class="test-icon"><i class="fas fa-clipboard-list"></i></div>
                                <h3>综合测试</h3>
                                <p class="card-description">热学各分支知识的综合应用</p>
                                <div class="card-keywords">
                                    <span class="keyword">热力学综合</span>
                                    <span class="keyword">能量转换</span>
                                    <span class="keyword">实际应用</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="thermo-level">年级水平：</label>
                            <select id="thermo-level" class="form-control">
                                <option value="middle">初中</option>
                                <option value="high" selected>高中</option>
                                <option value="university">大学</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="thermo-difficulty">难度等级：</label>
                            <select id="thermo-difficulty" class="form-control">
                                <option value="easy">基础</option>
                                <option value="medium" selected>中等</option>
                                <option value="hard">困难</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="thermo-question-count">题目数量：</label>
                            <select id="thermo-question-count" class="form-control">
                                <option value="5">5题</option>
                                <option value="10" selected>10题</option>
                                <option value="15">15题</option>
                                <option value="20">20题</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <button id="start-thermo-test" class="btn btn-primary">
                                <i class="fas fa-play"></i> 开始热学测试
                            </button>
                        </div>
                        
                        <div id="thermo-test-container" style="display: none;"></div>
                    </div>

                    <!-- 光学测试内容 -->
                    <div id="optics-panel" class="testing-panel">
                        <h2><i class="fas fa-eye"></i> 光学能力测试</h2>
                        <p>测试您对几何光学、波动光学、光的传播和成像规律的理解</p>
                        
                        <div class="test-type-grid">
                            <div class="test-type-card" data-type="geometric-optics">
                                <div class="test-icon"><i class="fas fa-search"></i></div>
                                <h3>几何光学</h3>
                                <p>反射、折射、透镜成像</p>
                            </div>
                            <div class="test-type-card" data-type="wave-optics">
                                <div class="test-icon"><i class="fas fa-water"></i></div>
                                <h3>波动光学</h3>
                                <p>干涉、衍射、偏振现象</p>
                            </div>
                            <div class="test-type-card" data-type="optical-instruments">
                                <div class="test-icon"><i class="fas fa-microscope"></i></div>
                                <h3>光学仪器</h3>
                                <p>显微镜、望远镜、摄像机</p>
                            </div>
                            <div class="test-type-card" data-type="laser">
                                <div class="test-icon"><i class="fas fa-laser-pointer"></i></div>
                                <h3>激光光学</h3>
                                <p>激光原理、全息、光纤</p>
                            </div>
                            <div class="test-type-card comprehensive" data-type="comprehensive">
                                <div class="test-icon"><i class="fas fa-clipboard-list"></i></div>
                                <h3>综合测试</h3>
                                <p class="card-description">光学各分支知识的综合应用</p>
                                <div class="card-keywords">
                                    <span class="keyword">光学综合</span>
                                    <span class="keyword">成像系统</span>
                                    <span class="keyword">光学设计</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="optics-level">年级水平：</label>
                            <select id="optics-level" class="form-control">
                                <option value="middle">初中</option>
                                <option value="high" selected>高中</option>
                                <option value="university">大学</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="optics-difficulty">难度等级：</label>
                            <select id="optics-difficulty" class="form-control">
                                <option value="easy">基础</option>
                                <option value="medium" selected>中等</option>
                                <option value="hard">困难</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="optics-question-count">题目数量：</label>
                            <select id="optics-question-count" class="form-control">
                                <option value="5">5题</option>
                                <option value="10" selected>10题</option>
                                <option value="15">15题</option>
                                <option value="20">20题</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <button id="start-optics-test" class="btn btn-primary">
                                <i class="fas fa-play"></i> 开始光学测试
                            </button>
                        </div>
                        
                        <div id="optics-test-container" style="display: none;"></div>
                    </div>

                    <!-- 现代物理测试内容 -->
                    <div id="modern-panel" class="testing-panel">
                        <h2><i class="fas fa-atom"></i> 现代物理能力测试</h2>
                        <p>测试您对量子力学、相对论、原子物理等现代物理理论的理解</p>
                        
                        <div class="test-type-grid">
                            <div class="test-type-card" data-type="quantum">
                                <div class="test-icon"><i class="fas fa-braille"></i></div>
                                <h3>量子力学</h3>
                                <p>波粒二象性、不确定性原理</p>
                            </div>
                            <div class="test-type-card" data-type="relativity">
                                <div class="test-icon"><i class="fas fa-rocket"></i></div>
                                <h3>相对论</h3>
                                <p>狭义相对论、广义相对论</p>
                            </div>
                            <div class="test-type-card" data-type="atomic">
                                <div class="test-icon"><i class="fas fa-atom"></i></div>
                                <h3>原子物理</h3>
                                <p>原子结构、核反应、放射性</p>
                            </div>
                            <div class="test-type-card" data-type="particle">
                                <div class="test-icon"><i class="fas fa-circle-notch"></i></div>
                                <h3>粒子物理</h3>
                                <p>基本粒子、标准模型</p>
                            </div>
                            <div class="test-type-card comprehensive" data-type="comprehensive">
                                <div class="test-icon"><i class="fas fa-clipboard-list"></i></div>
                                <h3>综合测试</h3>
                                <p class="card-description">现代物理各分支知识的综合应用</p>
                                <div class="card-keywords">
                                    <span class="keyword">现代物理综合</span>
                                    <span class="keyword">理论应用</span>
                                    <span class="keyword">前沿科学</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="modern-level">年级水平：</label>
                            <select id="modern-level" class="form-control">
                                <option value="high">高中</option>
                                <option value="university" selected>大学</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="modern-difficulty">难度等级：</label>
                            <select id="modern-difficulty" class="form-control">
                                <option value="easy">基础</option>
                                <option value="medium" selected>中等</option>
                                <option value="hard">困难</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="modern-question-count">题目数量：</label>
                            <select id="modern-question-count" class="form-control">
                                <option value="5">5题</option>
                                <option value="10" selected>10题</option>
                                <option value="15">15题</option>
                                <option value="20">20题</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <button id="start-modern-test" class="btn btn-primary">
                                <i class="fas fa-play"></i> 开始现代物理测试
                            </button>
                        </div>
                        
                        <div id="modern-test-container" style="display: none;"></div>
                    </div>
                </div>

                <!-- Results Panel -->
                <div id="results-panel" class="testing-content testing-panel">
                    <h2><i class="fas fa-chart-bar"></i> 测试报告</h2>
                    <p>查看你的物理能力测试结果和个性化学习建议</p>
                    
                    <div id="no-results-message">
                        <p class="text-center">你还没有完成任何测试。请完成至少一项测试以查看报告。</p>
                    </div>
                    
                    <div id="results-container" style="display: none;">
                        <div class="result-summary">
                            <h3>综合物理水平</h3>
                            <div class="score-display" id="overall-score">良好</div>
                            <div class="level-badge" id="level-description">中等水平</div>
                            <p>基于你的测试结果，你的物理水平达到了<strong>中等</strong>水平。</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <p class="copyright-text">所有内容源于AI。study-llm.me域名为Alex所有。</p>
                <div class="profile-section">
                    <button id="profile-button" class="profile-button">
                        <i class="fas fa-user-circle"></i>
                        学习阶段
                    </button>
                    <div id="profile-display" class="profile-display"></div>
                </div>
            </div>
        </div>
    </footer>

    <script src="../../js/common.js"></script>
    <script src="../../js/navigation.js"></script>
    <script src="../../js/profile.js"></script>
    
    <script>
        let currentTestType = '';
        let currentQuestions = [];
        let currentResults = null;

        // MathJax configuration
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            }
        };

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializeTabs();
            initializeTestCards();
            initializeTestButtons();
            updateProgressDisplay();
        });

        // 进度跟踪功能
        function updateProgressDisplay() {
            const progress = getTestProgress();
            document.getElementById('completed-tests').textContent = progress.completed;
            document.getElementById('average-score').textContent = progress.averageScore + '%';
            document.getElementById('suggested-topic').textContent = getSuggestedTopic(progress);
        }

        function getTestProgress() {
            const saved = localStorage.getItem('physicsTestProgress');
            if (saved) {
                return JSON.parse(saved);
            }
            return {
                completed: 0,
                totalScore: 0,
                averageScore: 0,
                subjects: {},
                lastTest: null
            };
        }

        function saveTestResult(subject, type, score, level, difficulty) {
            let progress = getTestProgress();
            
            const testKey = `${subject}-${type}-${level}`;
            if (!progress.subjects[testKey]) {
                progress.completed++;
            }
            
            progress.subjects[testKey] = {
                score: score,
                level: level,
                difficulty: difficulty,
                timestamp: new Date().toISOString()
            };
            
            // 计算平均分
            const scores = Object.values(progress.subjects).map(test => test.score);
            progress.totalScore = scores.reduce((sum, score) => sum + score, 0);
            progress.averageScore = Math.round(progress.totalScore / scores.length);
            progress.lastTest = testKey;
            
            localStorage.setItem('physicsTestProgress', JSON.stringify(progress));
            updateProgressDisplay();
        }

        function getSuggestedTopic(progress) {
            if (progress.completed === 0) {
                return '建议从力学基础开始';
            }
            
            const weakSubjects = [];
            const strongSubjects = [];
            
            for (const [testKey, result] of Object.entries(progress.subjects)) {
                if (result.score < 70) {
                    weakSubjects.push(testKey);
                } else if (result.score >= 85) {
                    strongSubjects.push(testKey);
                }
            }
            
            if (weakSubjects.length > 0) {
                const subject = weakSubjects[0].split('-')[0];
                const subjectNames = {
                    'mechanics': '力学',
                    'electromagnetism': '电磁学',
                    'thermodynamics': '热学',
                    'optics': '光学',
                    'modern': '现代物理'
                };
                return `加强 ${subjectNames[subject]} 练习`;
            }
            
            if (progress.averageScore >= 80) {
                return '尝试更高难度测试';
            }
            
            return '继续多主题练习';
        }

        function getCurrentSubject() {
            const activeTab = document.querySelector('.testing-tab.active');
            return activeTab ? activeTab.getAttribute('data-tab') : 'mechanics';
        }

        function getLearningAdvice(score, subject, type) {
            const subjectNames = {
                'mechanics': '力学',
                'electromagnetism': '电磁学',
                'thermodynamics': '热学',
                'optics': '光学',
                'modern': '现代物理'
            };
            
            if (score >= 90) {
                return `优秀！您已很好地掌握了${subjectNames[subject]}知识，建议尝试更高难度的题目或学习其他物理分支。`;
            } else if (score >= 80) {
                return `良好！${subjectNames[subject]}基础扎实，建议针对错题重点复习，加强薄弱环节。`;
            } else if (score >= 70) {
                return `及格！${subjectNames[subject]}还需要加强，建议重新学习相关概念，多做练习题。`;
            } else if (score >= 60) {
                return `需要努力！${subjectNames[subject]}基础不够牢固，建议从课本开始，系统学习基础知识。`;
            } else {
                return `急需加强！建议回到课本，从最基础的概念开始学习${subjectNames[subject]}。`;
            }
        }

        function initializeTabs() {
            const tabs = document.querySelectorAll('.testing-tab');
            const panels = document.querySelectorAll('.testing-panel');

            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Remove active class from all tabs and panels
                    tabs.forEach(t => t.classList.remove('active'));
                    panels.forEach(p => p.classList.remove('active'));
                    
                    // Add active class to clicked tab and corresponding panel
                    this.classList.add('active');
                    document.getElementById(targetTab + '-panel').classList.add('active');
                });
            });
        }

        function initializeTestCards() {
            const testCards = document.querySelectorAll('.test-type-card');
            
            testCards.forEach(card => {
                card.addEventListener('click', function() {
                    // Remove selected class from all cards in the same panel
                    const panel = this.closest('.testing-panel');
                    const panelCards = panel.querySelectorAll('.test-type-card');
                    panelCards.forEach(c => c.classList.remove('selected'));
                    
                    // Add selected class to clicked card
                    this.classList.add('selected');
                    currentTestType = this.getAttribute('data-type');
                });
            });
        }

        function getCurriculumScope(level, subject, type) {
            const curriculum = {
                'middle': {
                    'mechanics': {
                        'kinematics': `
**初中运动学教学内容：**
- 机械运动的概念：参照物、运动和静止的相对性
- 长度和时间的测量：刻度尺、停表的使用
- 运动的描述：路程、时间、速度的概念
- 匀速直线运动：速度公式 v=s/t，速度单位换算
- 平均速度的计算：总路程/总时间
- 速度-时间图像的简单分析
- 生活中的运动现象：步行、骑车、汽车运动等实例`,
                        
                        'dynamics': `
**初中动力学教学内容：**
- 力的概念：力的作用效果、力的三要素
- 重力：重力的大小 G=mg，重力的方向，重心
- 弹力：弹簧测力计的使用，胡克定律的简单应用
- 摩擦力：滑动摩擦力、静摩擦力的概念和影响因素
- 力的合成：同一直线上力的合成
- 牛顿第一定律：惯性的概念和现象
- 二力平衡：平衡力的条件和应用
- 压力和压强：压强公式 p=F/S，液体压强公式 p=ρgh`,
                        
                        'energy': `
**初中能量教学内容：**
- 功的概念：功的定义 W=Fs，功的单位焦耳
- 功率：功率的定义 P=W/t，功率单位瓦特
- 机械能：动能和势能的概念，影响因素
- 动能：与质量和速度的关系 Ek=½mv²（定性）
- 重力势能：与质量和高度的关系 Ep=mgh（定性）
- 机械能守恒的简单实例：单摆、过山车等
- 能量转化：机械能与其他形式能量的相互转化`,
                        
                        'oscillation': `
**初中振动波动教学内容：**
- 声音的产生：振动产生声音，声音传播需要介质
- 声音的传播：声速在不同介质中的传播，回声现象
- 声音的特性：音调、响度、音色的概念
- 超声波和次声波：频率范围和应用
- 简单的振动现象：摆动、弹簧振动等生活实例`
                    },
                    
                    'electromagnetism': {
                        'electrostatics': `
**初中静电学教学内容：**
- 摩擦起电现象：两种电荷，电荷间的相互作用
- 导体和绝缘体：常见材料的导电性
- 验电器的原理和使用
- 电荷量的概念，元电荷
- 简单的静电现象：雷电、静电吸附等`,
                        
                        'current': `
**初中电流电路教学内容：**
- 电流：电流的形成，电流方向的规定
- 电路：电路的组成，电路图的画法
- 串联和并联电路：电路连接方式，电路分析
- 电流的测量：电流表的使用，电流的单位安培
- 欧姆定律：I=U/R，电阻的概念和单位
- 电压：电压的概念，电压表的使用，电压单位伏特
- 电阻：影响电阻大小的因素，变阻器的使用
- 电功和电功率：W=UIt，P=UI，电能的计算`,
                        
                        'magnetism': `
**初中磁学教学内容：**
- 磁现象：磁铁的性质，磁极间的相互作用
- 磁场：磁场的概念，磁感线的特点
- 地磁场：地球的磁场，指南针的原理
- 电流的磁效应：通电导线周围的磁场
- 电磁铁：电磁铁的制作和应用`,
                        
                        'induction': `
**初中电磁感应教学内容：**
- 电磁感应现象：导体在磁场中运动产生电流
- 发电机的原理：交流发电机的简单工作原理
- 电动机的原理：通电导体在磁场中受力
- 电磁感应在生活中的应用`
                    },
                    
                    'thermodynamics': {
                        'kinetic-theory': `
**初中分子动理论教学内容：**
- 物质的构成：分子、原子的概念
- 分子运动论：分子的无规则运动，扩散现象
- 分子间相互作用：分子间引力和斥力
- 物质的三态：固体、液体、气体的分子模型
- 熔化和凝固：熔点，熔化吸热，凝固放热
- 汽化和液化：沸点，汽化吸热，液化放热
- 升华和凝华：物态变化的六种形式`,
                        
                        'heat-transfer': `
**初中热传递教学内容：**
- 温度：温度的概念，温度计的使用
- 内能：内能的概念，内能与温度、质量的关系
- 热传递：传导、对流、辐射三种方式
- 比热容：c=Q/(mΔt)，水的比热容大的应用
- 热量计算：Q=cmΔt，热平衡方程
- 燃料的热值：q=Q/m，完全燃烧放热计算
- 热机：内燃机的工作原理，热机效率`,
                        
                        'thermodynamic-laws': `
**初中热力学定律教学内容：**
- 能量守恒定律：能量的转化和守恒
- 热机效率：η=W有用/Q总×100%
- 永动机不可能：第一类永动机和第二类永动机
- 节约能源：提高能源利用率的方法`,
                        
                        'phase-changes': `
**初中相变教学内容：**
- 熔化和凝固：熔化曲线，晶体和非晶体
- 汽化和液化：蒸发和沸腾的区别
- 升华和凝华：干冰升华，霜的形成
- 生活中的物态变化：冰箱制冷、蒸汽机等`
                    },
                    
                    'optics': {
                        'geometric-optics': `
**初中几何光学教学内容：**
- 光的传播：光在均匀介质中沿直线传播
- 光速：光在真空中的传播速度 c=3×10⁸m/s
- 光的反射：反射定律，镜面反射和漫反射
- 平面镜成像：像与物的关系，虚像的特点
- 光的折射：折射定律，折射现象的解释
- 凸透镜成像：物距、像距、焦距的关系
- 凸透镜成像规律：实像和虚像的判断
- 眼睛和眼镜：近视眼和远视眼的矫正`,
                        
                        'wave-optics': `
**初中波动光学教学内容：**
- 光的色散：白光通过三棱镜的色散现象
- 光的颜色：红、橙、黄、绿、蓝、靛、紫
- 物体的颜色：透明体和不透明体的颜色
- 彩虹的形成：自然界中的色散现象`,
                        
                        'optical-instruments': `
**初中光学仪器教学内容：**
- 照相机：成像原理，实像的应用
- 投影仪：成像原理，实像的放大应用
- 放大镜：成像原理，虚像的应用
- 显微镜和望远镜：复合光学系统的简单介绍`,
                        
                        'laser': `
**初中激光光学教学内容：**
- 激光的特点：单色性好、方向性好、亮度高
- 激光的应用：激光切割、激光医疗、光纤通信
- 光纤通信：光在光纤中的全反射传播`
                    },
                    
                    'modern': {
                        'quantum': `
**初中量子物理教学内容：**
- 原子的基本构成：原子核和电子
- 电子的发现：阴极射线实验
- 原子核的发现：α粒子散射实验
- 原子核的组成：质子和中子
- 同位素：原子序数相同，质量数不同的原子`,
                        
                        'relativity': `
**初中相对论教学内容：**
- 爱因斯坦简介：20世纪伟大的物理学家
- 相对论的基本观点：时间和空间的相对性
- 质能方程：E=mc²的简单介绍
- 相对论在现代科技中的应用：GPS定位系统`,
                        
                        'atomic': `
**初中原子物理教学内容：**
- 原子的大小：10⁻¹⁰米的量级概念
- 原子核的大小：比原子小得多
- 放射性现象：某些原子核不稳定
- 核能的利用：核电站的工作原理
- 核能的安全性：核废料处理，核泄漏防护`,
                        
                        'particle': `
**初中粒子物理教学内容：**
- 基本粒子的概念：构成物质的最小单位
- 宇宙射线：来自外太空的高能粒子
- 粒子加速器：科学研究的重要工具
- 粒子物理与日常生活：医学影像、材料分析`
                    }
                },
                
                'high': {
                    'mechanics': {
                        'kinematics': `
**高中运动学教学内容：**
- 质点、参考系、坐标系的概念
- 位移和路程：矢量和标量的区别
- 速度和速率：平均速度、瞬时速度
- 加速度：a=Δv/Δt，加速度的矢量性
- 匀速直线运动：位移公式 x=vt
- 匀变速直线运动：v=v₀+at，x=v₀t+½at²，v²=v₀²+2ax
- 自由落体运动：g=9.8m/s²，公式应用
- 竖直上抛运动：上升、下降过程分析
- 运动图像：x-t图像、v-t图像的分析`,
                        
                        'dynamics': `
**高中动力学教学内容：**
- 牛顿第一定律：惯性定律，惯性的概念
- 牛顿第二定律：F=ma，力和运动的关系
- 牛顿第三定律：作用力与反作用力
- 重力：万有引力在地面附近的表现
- 弹力：胡克定律 F=kx，弹力的方向
- 摩擦力：静摩擦力、滑动摩擦力 f=μN
- 力的合成与分解：平行四边形定则
- 共点力平衡：ΣF=0的条件和应用
- 牛顿运动定律的应用：连接体问题、斜面问题`,
                        
                        'energy': `
**高中功和能教学内容：**
- 功的定义：W=Fscosθ，功是标量
- 重力做功：Wg=mgh，与路径无关
- 弹力做功：W=½kx²，弹性势能
- 动能定理：Wnet=ΔEk，动能 Ek=½mv²
- 重力势能：Ep=mgh，势能的相对性
- 机械能守恒定律：条件和应用
- 功率：P=W/t=Fv，额定功率和实际功率
- 机车启动问题：恒定功率和恒定牵引力`,
                        
                        'oscillation': `
**高中振动波动教学内容：**
- 简谐运动：回复力 F=-kx，周期性运动
- 单摆：周期公式 T=2π√(l/g)
- 弹簧振子：周期公式 T=2π√(m/k)
- 受迫振动：驱动力、固有频率、共振现象
- 机械波：横波和纵波，波的传播
- 波长、频率、波速：v=λf关系
- 波的干涉：相干条件，干涉图样
- 波的衍射：单缝衍射，衍射条件
- 多普勒效应：波源和观察者相对运动`
                    },
                    
                    'electromagnetism': {
                        'electrostatics': `
**高中静电学教学内容：**
- 库仑定律：F=kq₁q₂/r²，电荷间相互作用
- 电场强度：E=F/q，点电荷电场 E=kQ/r²
- 电场线：电场的图像表示，电场线性质
- 电势：电势差U=WAB/q，电势能EPA=qφA
- 匀强电场：E=U/d，电场力做功 W=qEd
- 电容器：C=Q/U，平行板电容器 C=εS/d
- 带电粒子在电场中的运动：加速和偏转`,
                        
                        'current': `
**高中恒定电流教学内容：**
- 电流强度：I=Q/t，电流的微观本质
- 欧姆定律：I=U/R，适用条件
- 电阻定律：R=ρl/S，电阻率的概念
- 串并联电路：电压、电流、电阻的分配
- 电动势：ε=W/q，闭合电路欧姆定律
- 路端电压：U=ε-Ir，内外电路分析
- 电功和电功率：W=UIt，P=UI=I²R=U²/R
- 焦耳定律：Q=I²Rt，电热功率`,
                        
                        'magnetism': `
**高中磁场教学内容：**
- 磁感应强度：B=F/(Il)，磁场的量度
- 安培力：F=BIl，左右手定则
- 洛伦兹力：f=qvB，带电粒子在磁场中运动
- 质谱仪：带电粒子的偏转和分离
- 回旋加速器：粒子加速原理
- 霍尔效应：载流导体在磁场中的现象`,
                        
                        'induction': `
**高中电磁感应教学内容：**
- 法拉第电磁感应定律：ε=nΔΦ/Δt
- 楞次定律：感应电流方向的判断
- 导体切割磁感线：ε=Blv
- 自感现象：L=Φ/I，自感系数
- 日光灯原理：启动器和镇流器的作用
- 涡流现象：金属在变化磁场中的感应电流
- 交变电流：正弦交流电，有效值I=Im/√2`
                    },
                    
                    'thermodynamics': {
                        'kinetic-theory': `
**高中分子动理论教学内容：**
- 物质的微观结构：阿伏伽德罗常数，油膜法测分子直径
- 分子热运动：布朗运动，分子平均动能与温度关系
- 分子间作用力：分子力与分子间距离的关系
- 物体的内能：分子动能和势能的总和
- 理想气体：理想气体分子模型，微观量统计意义`,
                        
                        'heat-transfer': `
**高中热传递教学内容：**
- 热传导：傅里叶定律，导热系数
- 热对流：自然对流和强制对流
- 热辐射：黑体辐射，斯特藩-玻尔兹曼定律
- 热容量：定压热容和定容热容
- 相变潜热：汽化潜热，熔化潜热的计算`,
                        
                        'thermodynamic-laws': `
**高中热力学定律教学内容：**
- 热力学第一定律：ΔU=Q-W，内能变化
- 等容过程：W=0，Q=ΔU
- 等压过程：W=pΔV，摩尔定压热容
- 等温过程：ΔU=0，Q=W
- 绝热过程：Q=0，W=-ΔU
- 热力学第二定律：熵增原理，热机效率极限
- 卡诺循环：理想热机，卡诺效率η=1-T₂/T₁`,
                        
                        'phase-changes': `
**高中相变教学内容：**
- 固液相变：熔化潜热，克拉佩龙方程
- 液气相变：汽化潜热，饱和蒸气压
- 相图：p-T图，三相点和临界点
- 表面张力：表面能，毛细现象
- 固体的晶体结构：单晶体和多晶体，非晶体`
                    },
                    
                    'optics': {
                        'geometric-optics': `
**高中几何光学教学内容：**
- 光的反射：反射定律，球面镜成像公式
- 光的折射：折射定律，折射率n=c/v
- 全反射：临界角，光纤传输原理
- 薄透镜成像：透镜公式1/f=1/u+1/v
- 透镜组合：复合光学系统
- 光学仪器：显微镜和望远镜的放大倍数`,
                        
                        'wave-optics': `
**高中波动光学教学内容：**
- 光的干涉：双缝干涉，干涉条纹间距Δx=λD/d
- 薄膜干涉：等厚干涉，牛顿环
- 光的衍射：单缝衍射，衍射光栅
- 光的偏振：马吕斯定律，偏振片的应用
- 光的色散：棱镜色散，光谱分析`,
                        
                        'optical-instruments': `
**高中光学仪器教学内容：**
- 干涉仪：迈克尔逊干涉仪，测量光波波长
- 光谱仪：光栅光谱仪，分辨率和色散
- 激光器：受激辐射，光学谐振腔
- 光学显微镜：数值孔径，分辨极限
- 望远镜：反射式和折射式望远镜`,
                        
                        'laser': `
**高中激光光学教学内容：**
- 受激辐射：爱因斯坦系数，粒子数反转
- 激光器构成：工作物质、泵浦源、谐振腔
- 激光特性：单色性、相干性、方向性、高亮度
- 激光应用：全息照相、激光雷达、医疗应用
- 非线性光学：倍频、光学双稳态`
                    },
                    
                    'modern': {
                        'quantum': `
**现代物理-量子力学教学内容：**
- 黑体辐射：普朗克量子假设，h=6.63×10⁻³⁴J·s
- 光电效应：爱因斯坦光子说，Ek=hν-W₀
- 康普顿散射：光子的动量，E=pc
- 原子结构：卢瑟福模型，玻尔模型
- 氢原子光谱：巴尔末系，里德伯常数
- 德布罗意波：λ=h/p，波粒二象性
- 不确定性原理：ΔxΔp≥ℏ/2，ΔEΔt≥ℏ/2`,
                        
                        'relativity': `
**现代物理-相对论教学内容：**
- 狭义相对论：光速不变原理，相对性原理
- 洛伦兹变换：时间膨胀，长度收缩
- 质能关系：E=mc²，质量缺陷
- 相对论动量：p=γmv，γ=1/√(1-v²/c²)
- 广义相对论：等效原理，时空弯曲`,
                        
                        'atomic': `
**现代物理-原子物理教学内容：**
- 原子核结构：质子数、中子数、质量数
- 放射性衰变：α衰变、β衰变、γ衰变
- 半衰期：指数衰变规律，N=N₀e^(-λt)
- 核反应：核反应方程，核反应能
- 核裂变：铀235裂变，链式反应
- 核聚变：氢核聚变，太阳能源`,
                        
                        'particle': `
**现代物理-粒子物理教学内容：**
- 基本粒子：夸克、轻子、规范玻色子
- 粒子加速器：直线加速器、回旋加速器
- 粒子探测器：云室、泡室、正电子发射断层扫描
- 标准模型：强相互作用、弱相互作用、电磁相互作用
- 宇宙射线：高能粒子，μ介子`
                    }
                }
            };
            
            // 处理综合测试
            if (type === 'comprehensive') {
                const subjectScope = curriculum[level]?.[subject];
                if (subjectScope) {
                    const allTopics = Object.values(subjectScope).join('\n\n');
                    const subjectNames = {
                        'mechanics': '力学',
                        'electromagnetism': '电磁学',
                        'thermodynamics': '热学',
                        'optics': '光学',
                        'modern': '现代物理'
                    };
                    return `**${subjectNames[subject]}综合测试教学内容：**\n\n${allTopics}\n\n**综合应用要求：**\n- 跨主题知识整合和应用\n- 多个概念的综合分析\n- 实际问题的物理建模\n- 不同知识点的相互关联\n- 解题策略和方法的灵活运用`;
                }
            }
            
            return curriculum[level]?.[subject]?.[type] || `请生成符合${level}物理${subject}中${type}内容的题目`;
        }

        function initializeTestButtons() {
            // 力学测试
            document.getElementById('start-mechanics-test').addEventListener('click', function() {
                const level = document.getElementById('mechanics-level').value;
                const difficulty = document.getElementById('mechanics-difficulty').value;
                const questionCount = document.getElementById('mechanics-question-count').value;
                const container = document.getElementById('mechanics-test-container');
                
                if (!currentTestType) {
                    alert('请先选择一个测试类型');
                    return;
                }
                
                startPhysicsTest('mechanics', currentTestType, level, difficulty, container, questionCount);
            });

            // 电磁学测试
            document.getElementById('start-em-test').addEventListener('click', function() {
                const level = document.getElementById('em-level').value;
                const difficulty = document.getElementById('em-difficulty').value;
                const questionCount = document.getElementById('em-question-count').value;
                const container = document.getElementById('em-test-container');
                
                if (!currentTestType) {
                    alert('请先选择一个测试类型');
                    return;
                }
                
                startPhysicsTest('electromagnetism', currentTestType, level, difficulty, container, questionCount);
            });

            // 热学测试
            document.getElementById('start-thermo-test').addEventListener('click', function() {
                const level = document.getElementById('thermo-level').value;
                const difficulty = document.getElementById('thermo-difficulty').value;
                const questionCount = document.getElementById('thermo-question-count').value;
                const container = document.getElementById('thermo-test-container');
                
                if (!currentTestType) {
                    alert('请先选择一个测试类型');
                    return;
                }
                
                startPhysicsTest('thermodynamics', currentTestType, level, difficulty, container, questionCount);
            });

            // 光学测试
            document.getElementById('start-optics-test').addEventListener('click', function() {
                const level = document.getElementById('optics-level').value;
                const difficulty = document.getElementById('optics-difficulty').value;
                const questionCount = document.getElementById('optics-question-count').value;
                const container = document.getElementById('optics-test-container');
                
                if (!currentTestType) {
                    alert('请先选择一个测试类型');
                    return;
                }
                
                startPhysicsTest('optics', currentTestType, level, difficulty, container, questionCount);
            });

            // 现代物理测试
            document.getElementById('start-modern-test').addEventListener('click', function() {
                const level = document.getElementById('modern-level').value;
                const difficulty = document.getElementById('modern-difficulty').value;
                const questionCount = document.getElementById('modern-question-count').value;
                const container = document.getElementById('modern-test-container');
                
                if (!currentTestType) {
                    alert('请先选择一个测试类型');
                    return;
                }
                
                startPhysicsTest('modern', currentTestType, level, difficulty, container, questionCount);
            });
        }

        async function startPhysicsTest(subject, type, level, difficulty, container, questionCount = 10) {
            container.style.display = 'block';
            container.innerHTML = '<div class="text-center"><i class="fas fa-spinner fa-spin"></i> 正在生成物理测试，请稍候...</div>';
            
            const subjectNames = {
                'mechanics': '力学',
                'electromagnetism': '电磁学',
                'thermodynamics': '热学',
                'optics': '光学',
                'modern': '现代物理'
            };

            const typeNames = {
                // 力学
                'kinematics': '运动学',
                'dynamics': '动力学',
                'energy': '能量守恒',
                'oscillation': '振动波动',
                'comprehensive': '综合测试',
                // 电磁学
                'electrostatics': '静电学',
                'current': '电流电路',
                'magnetism': '磁学',
                'induction': '电磁感应',
                // 热学
                'kinetic-theory': '分子运动论',
                'heat-transfer': '热传递',
                'thermodynamic-laws': '热力学定律',
                'phase-changes': '相变',
                // 光学
                'geometric-optics': '几何光学',
                'wave-optics': '波动光学',
                'optical-instruments': '光学仪器',
                'laser': '激光光学',
                // 现代物理
                'quantum': '量子力学',
                'relativity': '相对论',
                'atomic': '原子物理',
                'particle': '粒子物理'
            };

            const difficultyNames = {
                'easy': '基础',
                'medium': '中等',
                'hard': '困难'
            };

            const levelNames = {
                'middle': '初中',
                'high': '高中',
                'university': '大学'
            };

            try {
                // 构建基于中国教学大纲的详细课程范围
                const curriculumScope = getCurriculumScope(level, subject, type);
                
                const prompt = `请严格按照中国${levelNames[level]}物理教学大纲，生成${questionCount}道${subjectNames[subject]}中${typeNames[type]}的${difficultyNames[difficulty]}测试题目。

## 教学大纲范围：
${curriculumScope}

## 题目要求：
1. **教育水平**：${levelNames[level]} - 严格遵循人教版物理教材内容
2. **难度等级**：${difficultyNames[difficulty]} - 符合实际考试标准
3. **知识范围**：仅限于上述教学大纲范围内的内容
4. **计算要求**：包含适量的物理计算和概念理解

## 题目规范：
1. 每道题必须是单选题，有4个选项(A、B、C、D)
2. 题目情境要贴近中国学生生活实际
3. 物理公式和数学表达式使用LaTeX格式，用$符号包围
4. 正确答案随机分布在A、B、C、D选项中
5. 设置有迷惑性的干扰项，体现常见错误理解
6. 数值计算要合理，避免复杂运算

## 解答要求：
每道题的explanation必须包含：
- 物理概念或定律的阐述
- 公式的选择和应用
- 计算过程（如有）
- 结果的物理意义

请按以下JSON格式返回：

{
  "questions": [
    {
      "question": "题目内容",
      "options": ["选项A", "选项B", "选项C", "选项D"],
      "correct": 正确答案的索引(0-3),
      "explanation": "详细解题步骤：1. 物理原理... 2. 公式应用... 3. 计算过程... 4. 答案分析..."
    }
  ]
}`;

                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ prompt: prompt })
                });

                if (!response.ok) {
                    throw new Error(`HTTP错误: ${response.status}`);
                }

                const result = await response.json();
                
                if (result.error) {
                    throw new Error(result.message || 'AI生成失败');
                }

                const test = parseAIQuizResponse(result.output);
                currentQuestions = test.questions;
                displayPhysicsTest(test, container, subjectNames[subject], typeNames[type]);
                
            } catch (error) {
                console.error('生成物理测试失败:', error);
                // Fallback content
                const fallbackTest = {
                    questions: [
                        {
                            question: "一个物体从静止开始做匀加速直线运动，在前2秒内的位移为8米，则物体的加速度为：",
                            options: ["2 m/s²", "4 m/s²", "6 m/s²", "8 m/s²"],
                            correct: 1,
                            explanation: "根据运动学公式：$s = \\frac{1}{2}at^2$，代入s=8m，t=2s，解得a=4m/s²"
                        }
                    ]
                };
                currentQuestions = fallbackTest.questions;
                displayPhysicsTest(fallbackTest, container, subjectNames[subject], typeNames[type]);
            }
        }

        function parseAIQuizResponse(response) {
            try {
                // Try to parse as JSON first
                if (response.startsWith('{')) {
                    return JSON.parse(response);
                }
                
                // Extract JSON from markdown code block
                const jsonMatch = response.match(/```(?:json)?\s*(\{[\s\S]*?\})\s*```/);
                if (jsonMatch) {
                    return JSON.parse(jsonMatch[1]);
                }
                
                // Extract JSON from text
                const jsonStart = response.indexOf('{');
                const jsonEnd = response.lastIndexOf('}') + 1;
                if (jsonStart !== -1 && jsonEnd > jsonStart) {
                    const jsonString = response.substring(jsonStart, jsonEnd);
                    return JSON.parse(jsonString);
                }
                
                throw new Error('无法解析AI响应');
            } catch (error) {
                console.error('解析AI响应失败:', error);
                return {
                    questions: [
                        {
                            question: "示例物理题目",
                            options: ["选项A", "选项B", "选项C", "选项D"],
                            correct: 0,
                            explanation: "这是一个示例解释"
                        }
                    ]
                };
            }
        }

        function displayPhysicsTest(test, container, subjectName, typeName) {
            let html = `<h3>${subjectName} - ${typeName}测试</h3>`;
            
            if (test.questions && Array.isArray(test.questions)) {
                test.questions.forEach((question, index) => {
                    html += `
                        <div class="test-question">
                            <div class="question-text">${index + 1}. ${question.question}</div>
                            <ul class="options-list">
                    `;
                    
                    question.options.forEach((option, optionIndex) => {
                        html += `
                            <li class="option-item" data-question="${index}" data-option="${optionIndex}" data-correct="${question.correct}">
                                ${String.fromCharCode(65 + optionIndex)}. ${option}
                            </li>
                        `;
                    });
                    
                    html += '</ul></div>';
                });
            }
            
            html += `
                <div class="form-group">
                    <button id="submit-physics-test" class="btn btn-primary">
                        <i class="fas fa-check"></i> 提交答案
                    </button>
                </div>
            `;
            
            container.innerHTML = html;
            
            // Render MathJax
            renderMathJaxSafely(container);
            
            // Add click handlers for options
            const options = container.querySelectorAll('.option-item');
            options.forEach(option => {
                option.addEventListener('click', function() {
                    const questionId = this.getAttribute('data-question');
                    const questionOptions = document.querySelectorAll(`.option-item[data-question="${questionId}"]`);
                    questionOptions.forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
            
            // Add submit handler
            const submitBtn = container.querySelector('#submit-physics-test');
            submitBtn.addEventListener('click', function() {
                const selectedOptions = container.querySelectorAll('.option-item.selected');
                if (selectedOptions.length < (test.questions?.length || 1)) {
                    alert('请回答所有问题');
                    return;
                }
                
                showPhysicsTestResults(test, selectedOptions, container);
            });
        }

        function showPhysicsTestResults(test, selectedOptions, container) {
            let score = 0;
            let userAnswers = [];
            
            // 收集用户答案
            selectedOptions.forEach(selectedOption => {
                const questionIndex = parseInt(selectedOption.getAttribute('data-question'));
                const selectedIndex = parseInt(selectedOption.getAttribute('data-option'));
                const correctIndex = parseInt(selectedOption.getAttribute('data-correct'));
                
                userAnswers[questionIndex] = {
                    selected: selectedIndex,
                    correct: correctIndex,
                    isCorrect: selectedIndex === correctIndex
                };
                
                if (selectedIndex === correctIndex) {
                    score++;
                }
            });

            const percentage = Math.round((score / test.questions.length) * 100);
            
            // 保存测试结果到进度跟踪
            const subject = getCurrentSubject();
            const type = currentTestType || 'general';
            const level = document.getElementById(`${subject}-level`)?.value || 'high';
            const difficulty = document.getElementById(`${subject}-difficulty`)?.value || 'medium';
            saveTestResult(subject, type, percentage, level, difficulty);
            
            // 显示结果
            let resultsHtml = `
                <div class="result-summary">
                    <div class="score-display">${percentage}%</div>
                    <div class="level-badge">${getPhysicsLevel(percentage)}</div>
                    <p>您答对了 ${score} 道题，共 ${test.questions.length} 道题</p>
                    
                    <!-- 新增：学习建议 -->
                    <div class="learning-suggestion">
                        <h4><i class="fas fa-lightbulb"></i> 学习建议</h4>
                        <p>${getLearningAdvice(percentage, subject, type)}</p>
                    </div>
                </div>
                
                <h4><i class="fas fa-clipboard-list"></i> 详细结果分析</h4>
            `;
            
            // 详细题目分析
            test.questions.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                const isCorrect = userAnswer.isCorrect;
                
                resultsHtml += `
                    <div class="question-result ${isCorrect ? 'correct' : 'incorrect'}">
                        <div class="question-header">
                            <div class="question-number">题目 ${index + 1}</div>
                            <div class="question-status">
                                <i class="fas ${isCorrect ? 'fa-check-circle' : 'fa-times-circle'}"></i>
                                ${isCorrect ? '正确' : '错误'}
                            </div>
                        </div>
                        
                        <div class="original-question">${question.question}</div>
                        
                        <div class="answer-analysis">
                            <div class="user-answer ${isCorrect ? 'correct' : 'incorrect'}">
                                <strong>您的答案：</strong>
                                <span class="answer-option">${String.fromCharCode(65 + userAnswer.selected)}. ${question.options[userAnswer.selected]}</span>
                            </div>
                            <div class="correct-answer">
                                <strong>正确答案：</strong>
                                <span class="answer-option correct-answer">${String.fromCharCode(65 + question.correct)}. ${question.options[question.correct]}</span>
                            </div>
                        </div>
                        
                        <div class="explanation-content">
                            <strong><i class="fas fa-lightbulb"></i> 解题思路：</strong>
                            <div class="explanation-text">${question.explanation}</div>
                        </div>
                    </div>
                `;
            });
            
            resultsHtml += `
                <div class="result-actions">
                    <button class="btn btn-primary" onclick="location.reload()">
                        <i class="fas fa-redo"></i> 重新测试
                    </button>
                    <button class="btn btn-secondary" onclick="window.location.href='main.html'">
                        <i class="fas fa-home"></i> 返回首页
                    </button>
                </div>
            `;
            
            container.innerHTML = resultsHtml;
            renderMathJaxSafely(container);
        }

        function getPhysicsLevel(percentage) {
            if (percentage >= 90) return '物理学霸';
            if (percentage >= 80) return '物理高手';
            if (percentage >= 70) return '物理能手';
            if (percentage >= 60) return '物理学徒';
            return '需要加强';
        }

        function renderMathJaxSafely(element) {
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise([element]).catch(function(err) {
                    console.error('MathJax渲染错误:', err);
                });
            }
        }
    </script>
</body>
</html> 