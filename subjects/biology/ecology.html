<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿæ€å­¦ - ç”Ÿç‰©å­¦ä¹ åŠ©æ‰‹</title>
    <link rel="icon" href="../../assets/icons/logo_btrfly.ico" type="image/x-icon">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/components.css">
    <link rel="stylesheet" href="../../css/utilities.css">
    <link rel="stylesheet" href="../../css/responsive.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .ecology-page {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem 0;
        }

        .ecology-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            margin: 2rem auto;
            max-width: 1600px;
        }

        .ecology-header {
            background: linear-gradient(135deg, #4caf50, #8bc34a);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .ecology-header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 700;
        }

        .ecology-header p {
            margin: 1rem 0 0 0;
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .ecology-tabs {
            background: #f8f9fa;
            padding: 0;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            overflow-x: auto;
        }

        .ecology-tab {
            padding: 1rem 2rem;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #666;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .ecology-tab.active {
            color: #4caf50;
            border-bottom-color: #4caf50;
            background: white;
        }

        .ecology-tab:hover {
            color: #4caf50;
            background: #f0f8ff;
        }

        .ecology-content {
            padding: 2rem;
            min-height: 600px;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        .ecosystem-explorer {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 2rem;
            height: 600px;
        }

        .ecosystem-display {
            background: #f8f9fa;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            border: 2px solid #e9ecef;
        }

        .ecosystem-canvas {
            width: 100%;
            height: 100%;
            display: block;
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%);
        }

        .ecosystem-controls {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            height: fit-content;
            border: 1px solid #e9ecef;
        }

        .ecosystem-controls h3 {
            margin: 0 0 1rem 0;
            color: #4caf50;
            font-size: 1.2rem;
        }

        .ecosystem-selector {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .ecosystem-btn {
            padding: 0.75rem;
            border: 1px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .ecosystem-btn:hover {
            border-color: #4caf50;
            background: #f0f8ff;
        }

        .ecosystem-btn.selected {
            border-color: #4caf50;
            background: #e8f5e8;
            color: #2e7d32;
        }

        .ecosystem-info {
            background: #f0f8ff;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #4caf50;
            margin-bottom: 1rem;
        }

        .ecosystem-info h4 {
            margin: 0 0 0.5rem 0;
            color: #4caf50;
        }

        .ecosystem-info p {
            margin: 0;
            font-size: 0.9rem;
            line-height: 1.5;
            color: #333;
        }

        .food-web-builder {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
        }

        .food-web-canvas {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #e9ecef;
            height: 400px;
            position: relative;
        }

        .organism-palette {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .organism-card {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            border: 1px solid #e9ecef;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .organism-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.15);
        }

        .organism-card.selected {
            border-color: #4caf50;
            background: #e8f5e8;
        }

        .organism-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .organism-name {
            font-size: 0.8rem;
            color: #666;
        }

        .biodiversity-analyzer {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
        }

        .biodiversity-chart {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #e9ecef;
            height: 400px;
            position: relative;
        }

        .chart-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .biodiversity-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            border: 1px solid #e9ecef;
            text-align: center;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4caf50;
            margin-bottom: 0.5rem;
        }

        .metric-label {
            font-size: 0.9rem;
            color: #666;
        }

        .conservation-simulator {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
        }

        .conservation-scenario {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #e9ecef;
        }

        .scenario-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .control-group label {
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }

        .control-slider {
            width: 100%;
            margin: 0.5rem 0;
        }

        .control-value {
            text-align: center;
            font-weight: bold;
            color: #4caf50;
        }

        .conservation-results {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            border: 1px solid #e9ecef;
        }

        .action-btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #4caf50, #8bc34a);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .action-btn.secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
        }

        @media (max-width: 768px) {
            .ecosystem-explorer {
                grid-template-columns: 1fr;
            }
            
            .ecology-tabs {
                flex-direction: column;
            }
            
            .ecology-tab {
                text-align: center;
            }
            
            .biodiversity-metrics {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="../../index.html">
                        <i class="fas fa-graduation-cap" style="background: linear-gradient(90deg, #4361ee, #7209b7); -webkit-background-clip: text; background-clip: text; color: transparent;"></i>
                        <span>Alexçš„å­¦ä¹ åŠ©æ‰‹</span>
                    </a>
                </div>
                <nav class="main-nav">
                    <ul>
                        <li><a href="../../index.html">é¦–é¡µ</a></li>
                        <li><a href="main.html">ç”Ÿç‰©</a></li>
                        <li><a href="../../index.html#subjects">ç§‘ç›®</a></li>
                        <li><a href="../../tts.html">è¯­éŸ³</a></li>
                        <li><a href="../../draw.html">ç»˜å›¾</a></li>
                    </ul>
                </nav>
                <button class="mobile-menu-toggle" aria-label="åˆ‡æ¢èœå•">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <main class="ecology-page">
        <div class="container">
            <div class="ecology-container">
                <div class="ecology-header">
                    <h1><i class="fas fa-leaf"></i> ç”Ÿæ€å­¦</h1>
                    <p>ç ”ç©¶ç”Ÿæ€ç³»ç»Ÿã€ç‰©ç§ç›¸äº’ä½œç”¨å’Œç”Ÿç‰©å¤šæ ·æ€§</p>
                </div>

                <div class="ecology-tabs">
                    <button class="ecology-tab active" data-tab="ecosystems">ç”Ÿæ€ç³»ç»Ÿ</button>
                    <button class="ecology-tab" data-tab="foodweb">é£Ÿç‰©ç½‘</button>
                    <button class="ecology-tab" data-tab="biodiversity">ç”Ÿç‰©å¤šæ ·æ€§</button>
                    <button class="ecology-tab" data-tab="conservation">ä¿æŠ¤ç­–ç•¥</button>
                </div>

                <div class="ecology-content">
                    <!-- ç”Ÿæ€ç³»ç»Ÿæ ‡ç­¾é¡µ -->
                    <div class="tab-panel active" id="ecosystems-panel">
                        <div class="ecosystem-explorer">
                            <div class="ecosystem-display">
                                <canvas class="ecosystem-canvas" id="ecosystem-canvas" width="800" height="600"></canvas>
                            </div>
                            
                            <div class="ecosystem-controls">
                                <h3><i class="fas fa-globe"></i> ç”Ÿæ€ç³»ç»Ÿç±»å‹</h3>
                                
                                <div class="ecosystem-selector">
                                    <button class="ecosystem-btn selected" data-ecosystem="forest">
                                        <i class="fas fa-tree" style="color: #27ae60;"></i>
                                        æ£®æ—ç”Ÿæ€ç³»ç»Ÿ
                                    </button>
                                    <button class="ecosystem-btn" data-ecosystem="grassland">
                                        <i class="fas fa-seedling" style="color: #8bc34a;"></i>
                                        è‰åŸç”Ÿæ€ç³»ç»Ÿ
                                    </button>
                                    <button class="ecosystem-btn" data-ecosystem="aquatic">
                                        <i class="fas fa-water" style="color: #3498db;"></i>
                                        æ°´ç”Ÿç”Ÿæ€ç³»ç»Ÿ
                                    </button>
                                    <button class="ecosystem-btn" data-ecosystem="desert">
                                        <i class="fas fa-sun" style="color: #f39c12;"></i>
                                        æ²™æ¼ ç”Ÿæ€ç³»ç»Ÿ
                                    </button>
                                    <button class="ecosystem-btn" data-ecosystem="tundra">
                                        <i class="fas fa-snowflake" style="color: #74b9ff;"></i>
                                        è‹”åŸç”Ÿæ€ç³»ç»Ÿ
                                    </button>
                                    <button class="ecosystem-btn" data-ecosystem="urban">
                                        <i class="fas fa-city" style="color: #95a5a6;"></i>
                                        åŸå¸‚ç”Ÿæ€ç³»ç»Ÿ
                                    </button>
                                </div>

                                <div class="ecosystem-info" id="ecosystem-info">
                                    <h4>æ£®æ—ç”Ÿæ€ç³»ç»Ÿ</h4>
                                    <p>ä»¥æ ‘æœ¨ä¸ºä¸»ä½“çš„ç”Ÿæ€ç³»ç»Ÿï¼Œå…·æœ‰å¤æ‚çš„å‚ç›´ç»“æ„å’Œä¸°å¯Œçš„ç”Ÿç‰©å¤šæ ·æ€§ã€‚åŒ…æ‹¬ç”Ÿäº§è€…ã€åˆçº§æ¶ˆè´¹è€…ã€æ¬¡çº§æ¶ˆè´¹è€…å’Œåˆ†è§£è€…ã€‚</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- é£Ÿç‰©ç½‘æ ‡ç­¾é¡µ -->
                    <div class="tab-panel" id="foodweb-panel">
                        <h2>é£Ÿç‰©ç½‘æ„å»ºå™¨</h2>
                        <div class="food-web-builder">
                            <div class="food-web-canvas" id="food-web-canvas">
                                <canvas id="food-web-chart" width="600" height="350"></canvas>
                            </div>
                            
                            <div class="organism-palette">
                                <div class="organism-card" data-organism="grass" data-level="producer">
                                    <div class="organism-icon">ğŸŒ±</div>
                                    <div class="organism-name">è‰</div>
                                </div>
                                <div class="organism-card" data-organism="rabbit" data-level="primary">
                                    <div class="organism-icon">ğŸ°</div>
                                    <div class="organism-name">å…”å­</div>
                                </div>
                                <div class="organism-card" data-organism="fox" data-level="secondary">
                                    <div class="organism-icon">ğŸ¦Š</div>
                                    <div class="organism-name">ç‹ç‹¸</div>
                                </div>
                                <div class="organism-card" data-organism="hawk" data-level="tertiary">
                                    <div class="organism-icon">ğŸ¦…</div>
                                    <div class="organism-name">é¹°</div>
                                </div>
                                <div class="organism-card" data-organism="deer" data-level="primary">
                                    <div class="organism-icon">ğŸ¦Œ</div>
                                    <div class="organism-name">é¹¿</div>
                                </div>
                                <div class="organism-card" data-organism="wolf" data-level="secondary">
                                    <div class="organism-icon">ğŸº</div>
                                    <div class="organism-name">ç‹¼</div>
                                </div>
                                <div class="organism-card" data-organism="mushroom" data-level="decomposer">
                                    <div class="organism-icon">ğŸ„</div>
                                    <div class="organism-name">è˜‘è‡</div>
                                </div>
                                <div class="organism-card" data-organism="bacteria" data-level="decomposer">
                                    <div class="organism-icon">ğŸ¦ </div>
                                    <div class="organism-name">ç»†èŒ</div>
                                </div>
                            </div>

                            <div style="text-align: center;">
                                <button class="action-btn" id="build-food-web">æ„å»ºé£Ÿç‰©ç½‘</button>
                                <button class="action-btn secondary" id="clear-food-web">æ¸…ç©º</button>
                            </div>
                        </div>
                    </div>

                    <!-- ç”Ÿç‰©å¤šæ ·æ€§æ ‡ç­¾é¡µ -->
                    <div class="tab-panel" id="biodiversity-panel">
                        <h2>ç”Ÿç‰©å¤šæ ·æ€§åˆ†æ</h2>
                        <div class="biodiversity-analyzer">
                            <div class="biodiversity-chart">
                                <canvas class="chart-canvas" id="biodiversity-chart" width="600" height="300"></canvas>
                            </div>
                            
                            <div class="biodiversity-metrics">
                                <div class="metric-card">
                                    <div class="metric-value" id="species-richness">25</div>
                                    <div class="metric-label">ç‰©ç§ä¸°å¯Œåº¦</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value" id="shannon-index">2.85</div>
                                    <div class="metric-label">é¦™å†œå¤šæ ·æ€§æŒ‡æ•°</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value" id="evenness">0.78</div>
                                    <div class="metric-label">å‡åŒ€åº¦æŒ‡æ•°</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value" id="dominance">0.15</div>
                                    <div class="metric-label">ä¼˜åŠ¿åº¦æŒ‡æ•°</div>
                                </div>
                            </div>

                            <div style="text-align: center;">
                                <button class="action-btn" id="analyze-biodiversity">åˆ†æç”Ÿç‰©å¤šæ ·æ€§</button>
                                <button class="action-btn secondary" id="generate-sample">ç”Ÿæˆæ ·æœ¬æ•°æ®</button>
                            </div>
                        </div>
                    </div>

                    <!-- ä¿æŠ¤ç­–ç•¥æ ‡ç­¾é¡µ -->
                    <div class="tab-panel" id="conservation-panel">
                        <h2>ç”Ÿæ€ä¿æŠ¤æ¨¡æ‹Ÿå™¨</h2>
                        <div class="conservation-simulator">
                            <div class="conservation-scenario">
                                <h4>ä¿æŠ¤ç­–ç•¥å‚æ•°</h4>
                                <div class="scenario-controls">
                                    <div class="control-group">
                                        <label>æ –æ¯åœ°ä¿æŠ¤</label>
                                        <input type="range" class="control-slider" id="habitat-protection" min="0" max="100" value="50">
                                        <div class="control-value" id="habitat-value">50%</div>
                                    </div>
                                    <div class="control-group">
                                        <label>æ±¡æŸ“æ§åˆ¶</label>
                                        <input type="range" class="control-slider" id="pollution-control" min="0" max="100" value="60">
                                        <div class="control-value" id="pollution-value">60%</div>
                                    </div>
                                    <div class="control-group">
                                        <label>ç‰©ç§ä¿æŠ¤</label>
                                        <input type="range" class="control-slider" id="species-protection" min="0" max="100" value="70">
                                        <div class="control-value" id="species-value">70%</div>
                                    </div>
                                    <div class="control-group">
                                        <label>æ•™è‚²å®£ä¼ </label>
                                        <input type="range" class="control-slider" id="education-level" min="0" max="100" value="40">
                                        <div class="control-value" id="education-value">40%</div>
                                    </div>
                                </div>
                                <button class="action-btn" id="run-simulation">è¿è¡Œä¿æŠ¤æ¨¡æ‹Ÿ</button>
                            </div>

                            <div class="conservation-results" id="conservation-results">
                                <h4>ä¿æŠ¤æ•ˆæœé¢„æµ‹</h4>
                                <p>è°ƒæ•´ä¸Šæ–¹å‚æ•°å¹¶ç‚¹å‡»"è¿è¡Œä¿æŠ¤æ¨¡æ‹Ÿ"æŸ¥çœ‹é¢„æµ‹ç»“æœ</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <p class="copyright-text">study-llm.meåŸŸåä¸ºAlexæ‰€æœ‰ã€‚ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚</p>
            </div>
        </div>
    </footer>

    <script src="../../js/common.js"></script>
    <script src="../../js/navigation.js"></script>
    <script>
        // ç”Ÿæ€å­¦åŠŸèƒ½
        class Ecology {
            constructor() {
                this.canvas = document.getElementById('ecosystem-canvas');
                this.ctx = this.canvas.getContext('2d');
                this.foodWebCanvas = document.getElementById('food-web-chart');
                this.foodWebCtx = this.foodWebCanvas.getContext('2d');
                this.biodiversityChart = document.getElementById('biodiversity-chart');
                this.biodiversityCtx = this.biodiversityChart.getContext('2d');
                
                this.currentEcosystem = 'forest';
                this.selectedOrganisms = [];
                this.foodWebConnections = [];
                
                this.ecosystemData = this.initializeEcosystemData();
                this.organismData = this.initializeOrganismData();
                this.initializeEventListeners();
                this.drawEcosystem();
                this.drawBiodiversityChart();
            }

            initializeEcosystemData() {
                return {
                    'forest': {
                        name: 'æ£®æ—ç”Ÿæ€ç³»ç»Ÿ',
                        description: 'ä»¥æ ‘æœ¨ä¸ºä¸»ä½“çš„ç”Ÿæ€ç³»ç»Ÿï¼Œå…·æœ‰å¤æ‚çš„å‚ç›´ç»“æ„å’Œä¸°å¯Œçš„ç”Ÿç‰©å¤šæ ·æ€§ã€‚åŒ…æ‹¬ç”Ÿäº§è€…ã€åˆçº§æ¶ˆè´¹è€…ã€æ¬¡çº§æ¶ˆè´¹è€…å’Œåˆ†è§£è€…ã€‚',
                        layers: ['æ—å† å±‚', 'æ—ä¸‹å±‚', 'çŒæœ¨å±‚', 'è‰æœ¬å±‚', 'åœŸå£¤å±‚'],
                        species: ['æ ‘æœ¨', 'é¸Ÿç±»', 'å“ºä¹³åŠ¨ç‰©', 'æ˜†è™«', 'çœŸèŒ'],
                        color: '#27ae60'
                    },
                    'grassland': {
                        name: 'è‰åŸç”Ÿæ€ç³»ç»Ÿ',
                        description: 'ä»¥è‰æœ¬æ¤ç‰©ä¸ºä¸»çš„ç”Ÿæ€ç³»ç»Ÿï¼Œå…·æœ‰å¼€é˜”çš„åœ°å½¢å’Œå­£èŠ‚æ€§å˜åŒ–æ˜æ˜¾çš„ç‰¹ç‚¹ã€‚',
                        layers: ['è‰æœ¬å±‚', 'æ ¹ç³»å±‚', 'åœŸå£¤å±‚'],
                        species: ['ç¦¾æœ¬ç§‘æ¤ç‰©', 'é£Ÿè‰åŠ¨ç‰©', 'è‚‰é£ŸåŠ¨ç‰©', 'åœŸå£¤å¾®ç”Ÿç‰©'],
                        color: '#8bc34a'
                    },
                    'aquatic': {
                        name: 'æ°´ç”Ÿç”Ÿæ€ç³»ç»Ÿ',
                        description: 'ä»¥æ°´ä¸ºä»‹è´¨çš„ç”Ÿæ€ç³»ç»Ÿï¼ŒåŒ…æ‹¬æ·¡æ°´å’Œæµ·æ°´ç¯å¢ƒï¼Œå…·æœ‰ç‹¬ç‰¹çš„ç‰©ç†åŒ–å­¦ç‰¹æ€§ã€‚',
                        layers: ['è¡¨å±‚', 'ä¸­å±‚', 'æ·±å±‚', 'åº•å±‚'],
                        species: ['æµ®æ¸¸æ¤ç‰©', 'æµ®æ¸¸åŠ¨ç‰©', 'é±¼ç±»', 'æ°´ç”Ÿæ¤ç‰©'],
                        color: '#3498db'
                    },
                    'desert': {
                        name: 'æ²™æ¼ ç”Ÿæ€ç³»ç»Ÿ',
                        description: 'å¹²æ—±å°‘é›¨çš„ç”Ÿæ€ç³»ç»Ÿï¼Œç”Ÿç‰©é€‚åº”æ€§å¼ºï¼Œå…·æœ‰ç‰¹æ®Šçš„æ°´åˆ†ä¿å­˜æœºåˆ¶ã€‚',
                        layers: ['åœ°è¡¨å±‚', 'æµ…åœŸå±‚', 'æ·±åœŸå±‚'],
                        species: ['ä»™äººæŒ', 'æ²™æ¼ åŠ¨ç‰©', 'è€æ—±æ¤ç‰©', 'å¾®ç”Ÿç‰©'],
                        color: '#f39c12'
                    },
                    'tundra': {
                        name: 'è‹”åŸç”Ÿæ€ç³»ç»Ÿ',
                        description: 'å¯’å†·åœ°åŒºçš„ç”Ÿæ€ç³»ç»Ÿï¼Œç”Ÿé•¿å­£çŸ­ï¼Œæ°¸ä¹…å†»åœŸå±‚å­˜åœ¨ï¼Œç”Ÿç‰©å¤šæ ·æ€§ç›¸å¯¹è¾ƒä½ã€‚',
                        layers: ['è‹”è—“å±‚', 'æ´»åŠ¨åœŸå±‚', 'æ°¸ä¹…å†»åœŸå±‚'],
                        species: ['è‹”è—“', 'åœ°è¡£', 'åŒ—æåŠ¨ç‰©', 'å€™é¸Ÿ'],
                        color: '#74b9ff'
                    },
                    'urban': {
                        name: 'åŸå¸‚ç”Ÿæ€ç³»ç»Ÿ',
                        description: 'äººå·¥æ”¹é€ çš„ç”Ÿæ€ç³»ç»Ÿï¼Œå…·æœ‰é«˜åº¦çš„äººç±»æ´»åŠ¨å½±å“å’Œç‹¬ç‰¹çš„ç¯å¢ƒç‰¹å¾ã€‚',
                        layers: ['å»ºç­‘å±‚', 'ç»¿åŒ–å±‚', 'åœ°ä¸‹å±‚'],
                        species: ['åŸå¸‚æ¤ç‰©', 'åŸå¸‚åŠ¨ç‰©', 'äººç±»', 'å¾®ç”Ÿç‰©'],
                        color: '#95a5a6'
                    }
                };
            }

            initializeOrganismData() {
                return {
                    'grass': { name: 'è‰', level: 'producer', energy: 100, icon: 'ğŸŒ±' },
                    'rabbit': { name: 'å…”å­', level: 'primary', energy: 80, icon: 'ğŸ°' },
                    'fox': { name: 'ç‹ç‹¸', level: 'secondary', energy: 60, icon: 'ğŸ¦Š' },
                    'hawk': { name: 'é¹°', level: 'tertiary', energy: 40, icon: 'ğŸ¦…' },
                    'deer': { name: 'é¹¿', level: 'primary', energy: 75, icon: 'ğŸ¦Œ' },
                    'wolf': { name: 'ç‹¼', level: 'secondary', energy: 55, icon: 'ğŸº' },
                    'mushroom': { name: 'è˜‘è‡', level: 'decomposer', energy: 20, icon: 'ğŸ„' },
                    'bacteria': { name: 'ç»†èŒ', level: 'decomposer', energy: 10, icon: 'ğŸ¦ ' }
                };
            }

            initializeEventListeners() {
                // æ ‡ç­¾é¡µåˆ‡æ¢
                document.querySelectorAll('.ecology-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        this.switchTab(e.target.dataset.tab);
                    });
                });

                // ç”Ÿæ€ç³»ç»Ÿé€‰æ‹©
                document.querySelectorAll('.ecosystem-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.selectEcosystem(e.target.dataset.ecosystem);
                    });
                });

                // ç”Ÿç‰©é€‰æ‹©
                document.querySelectorAll('.organism-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        this.selectOrganism(e.target.closest('.organism-card'));
                    });
                });

                // é£Ÿç‰©ç½‘æ§åˆ¶
                document.getElementById('build-food-web').addEventListener('click', () => {
                    this.buildFoodWeb();
                });

                document.getElementById('clear-food-web').addEventListener('click', () => {
                    this.clearFoodWeb();
                });

                // ç”Ÿç‰©å¤šæ ·æ€§åˆ†æ
                document.getElementById('analyze-biodiversity').addEventListener('click', () => {
                    this.analyzeBiodiversity();
                });

                document.getElementById('generate-sample').addEventListener('click', () => {
                    this.generateSampleData();
                });

                // ä¿æŠ¤æ¨¡æ‹Ÿæ§åˆ¶
                document.getElementById('run-simulation').addEventListener('click', () => {
                    this.runConservationSimulation();
                });

                // æ»‘å—æ§åˆ¶
                ['habitat-protection', 'pollution-control', 'species-protection', 'education-level'].forEach(id => {
                    document.getElementById(id).addEventListener('input', (e) => {
                        this.updateSliderValue(id, e.target.value);
                    });
                });
            }

            switchTab(tabName) {
                // æ›´æ–°æ ‡ç­¾é¡µçŠ¶æ€
                document.querySelectorAll('.ecology-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

                // æ˜¾ç¤ºå¯¹åº”é¢æ¿
                document.querySelectorAll('.tab-panel').forEach(panel => {
                    panel.classList.remove('active');
                });
                document.getElementById(`${tabName}-panel`).classList.add('active');
            }

            selectEcosystem(ecosystemKey) {
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                document.querySelectorAll('.ecosystem-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                document.querySelector(`[data-ecosystem="${ecosystemKey}"]`).classList.add('selected');

                this.currentEcosystem = ecosystemKey;
                this.updateEcosystemInfo();
                this.drawEcosystem();
            }

            updateEcosystemInfo() {
                const ecosystem = this.ecosystemData[this.currentEcosystem];
                const infoDiv = document.getElementById('ecosystem-info');
                
                infoDiv.innerHTML = `
                    <h4>${ecosystem.name}</h4>
                    <p>${ecosystem.description}</p>
                    <p><strong>ä¸»è¦å±‚æ¬¡:</strong> ${ecosystem.layers.join('ã€')}</p>
                    <p><strong>å…¸å‹ç‰©ç§:</strong> ${ecosystem.species.join('ã€')}</p>
                `;
            }

            drawEcosystem() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

                const ecosystem = this.ecosystemData[this.currentEcosystem];
                
                // ç»˜åˆ¶èƒŒæ™¯
                const gradient = this.ctx.createLinearGradient(0, 0, 0, this.canvas.height);
                gradient.addColorStop(0, '#87CEEB');
                gradient.addColorStop(1, ecosystem.color);
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                // æ ¹æ®ç”Ÿæ€ç³»ç»Ÿç±»å‹ç»˜åˆ¶ç‰¹å¾
                switch(this.currentEcosystem) {
                    case 'forest':
                        this.drawForest();
                        break;
                    case 'grassland':
                        this.drawGrassland();
                        break;
                    case 'aquatic':
                        this.drawAquatic();
                        break;
                    case 'desert':
                        this.drawDesert();
                        break;
                    case 'tundra':
                        this.drawTundra();
                        break;
                    case 'urban':
                        this.drawUrban();
                        break;
                }

                // æ·»åŠ æ ‡é¢˜
                this.ctx.fillStyle = '#333';
                this.ctx.font = '20px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText(ecosystem.name, this.canvas.width / 2, 30);
            }

            drawForest() {
                // ç»˜åˆ¶æ ‘æœ¨
                for (let i = 0; i < 8; i++) {
                    const x = 100 + i * 80;
                    const height = 150 + Math.random() * 100;
                    
                    // æ ‘å¹²
                    this.ctx.fillStyle = '#8B4513';
                    this.ctx.fillRect(x - 10, this.canvas.height - height, 20, height);
                    
                    // æ ‘å† 
                    this.ctx.fillStyle = '#228B22';
                    this.ctx.beginPath();
                    this.ctx.arc(x, this.canvas.height - height, 40, 0, 2 * Math.PI);
                    this.ctx.fill();
                }
                
                // åœ°é¢æ¤è¢«
                this.ctx.fillStyle = '#90EE90';
                this.ctx.fillRect(0, this.canvas.height - 50, this.canvas.width, 50);
            }

            drawGrassland() {
                // ç»˜åˆ¶è‰åœ°
                this.ctx.fillStyle = '#9ACD32';
                for (let i = 0; i < 50; i++) {
                    const x = Math.random() * this.canvas.width;
                    const height = 20 + Math.random() * 30;
                    this.ctx.fillRect(x, this.canvas.height - height, 3, height);
                }
                
                // è¿œå±±
                this.ctx.fillStyle = '#8FBC8F';
                this.ctx.beginPath();
                this.ctx.moveTo(0, this.canvas.height - 100);
                for (let i = 0; i <= this.canvas.width; i += 50) {
                    this.ctx.lineTo(i, this.canvas.height - 100 - Math.random() * 50);
                }
                this.ctx.lineTo(this.canvas.width, this.canvas.height);
                this.ctx.lineTo(0, this.canvas.height);
                this.ctx.fill();
            }

            drawAquatic() {
                // ç»˜åˆ¶æ°´æ³¢
                this.ctx.strokeStyle = '#4682B4';
                this.ctx.lineWidth = 2;
                for (let y = 100; y < this.canvas.height; y += 30) {
                    this.ctx.beginPath();
                    for (let x = 0; x <= this.canvas.width; x += 20) {
                        const waveY = y + Math.sin(x * 0.02) * 5;
                        if (x === 0) {
                            this.ctx.moveTo(x, waveY);
                        } else {
                            this.ctx.lineTo(x, waveY);
                        }
                    }
                    this.ctx.stroke();
                }
                
                // æ°´ç”Ÿæ¤ç‰©
                this.ctx.fillStyle = '#006400';
                for (let i = 0; i < 10; i++) {
                    const x = Math.random() * this.canvas.width;
                    this.ctx.fillRect(x, this.canvas.height - 80, 5, 60);
                }
            }

            drawDesert() {
                // ç»˜åˆ¶æ²™ä¸˜
                this.ctx.fillStyle = '#F4A460';
                this.ctx.beginPath();
                this.ctx.moveTo(0, this.canvas.height);
                for (let i = 0; i <= this.canvas.width; i += 100) {
                    this.ctx.lineTo(i, this.canvas.height - 50 - Math.random() * 100);
                }
                this.ctx.lineTo(this.canvas.width, this.canvas.height);
                this.ctx.fill();
                
                // ä»™äººæŒ
                for (let i = 0; i < 5; i++) {
                    const x = 100 + i * 150;
                    this.ctx.fillStyle = '#228B22';
                    this.ctx.fillRect(x, this.canvas.height - 120, 15, 100);
                    this.ctx.fillRect(x - 10, this.canvas.height - 80, 35, 15);
                }
            }

            drawTundra() {
                // ç»˜åˆ¶é›ªåœ°
                this.ctx.fillStyle = '#F0F8FF';
                this.ctx.fillRect(0, this.canvas.height - 100, this.canvas.width, 100);
                
                // è‹”è—“
                this.ctx.fillStyle = '#8FBC8F';
                for (let i = 0; i < 20; i++) {
                    const x = Math.random() * this.canvas.width;
                    const y = this.canvas.height - 100 + Math.random() * 50;
                    this.ctx.beginPath();
                    this.ctx.arc(x, y, 5, 0, 2 * Math.PI);
                    this.ctx.fill();
                }
            }

            drawUrban() {
                // ç»˜åˆ¶å»ºç­‘ç‰©
                for (let i = 0; i < 6; i++) {
                    const x = 50 + i * 120;
                    const height = 100 + Math.random() * 200;
                    this.ctx.fillStyle = '#696969';
                    this.ctx.fillRect(x, this.canvas.height - height, 80, height);
                    
                    // çª—æˆ·
                    this.ctx.fillStyle = '#FFD700';
                    for (let j = 0; j < Math.floor(height / 30); j++) {
                        for (let k = 0; k < 3; k++) {
                            this.ctx.fillRect(x + 10 + k * 20, this.canvas.height - height + 10 + j * 30, 15, 20);
                        }
                    }
                }
                
                // ç»¿åŒ–å¸¦
                this.ctx.fillStyle = '#32CD32';
                this.ctx.fillRect(0, this.canvas.height - 30, this.canvas.width, 30);
            }

            selectOrganism(card) {
                card.classList.toggle('selected');
                const organism = card.dataset.organism;
                
                if (card.classList.contains('selected')) {
                    this.selectedOrganisms.push(organism);
                } else {
                    this.selectedOrganisms = this.selectedOrganisms.filter(o => o !== organism);
                }
            }

            buildFoodWeb() {
                if (this.selectedOrganisms.length < 2) {
                    alert('è¯·è‡³å°‘é€‰æ‹©ä¸¤ä¸ªç”Ÿç‰©æ¥æ„å»ºé£Ÿç‰©ç½‘');
                    return;
                }
                
                this.foodWebConnections = [];
                
                // æ ¹æ®è¥å…»çº§å»ºç«‹è¿æ¥
                const levels = {
                    'producer': 0,
                    'primary': 1,
                    'secondary': 2,
                    'tertiary': 3,
                    'decomposer': 4
                };
                
                this.selectedOrganisms.forEach(org1 => {
                    this.selectedOrganisms.forEach(org2 => {
                        const level1 = levels[this.organismData[org1].level];
                        const level2 = levels[this.organismData[org2].level];
                        
                        if (level2 === level1 + 1 || (level1 < 4 && level2 === 4)) {
                            this.foodWebConnections.push({ from: org1, to: org2 });
                        }
                    });
                });
                
                this.drawFoodWeb();
            }

            drawFoodWeb() {
                this.foodWebCtx.clearRect(0, 0, this.foodWebCanvas.width, this.foodWebCanvas.height);
                
                if (this.selectedOrganisms.length === 0) return;
                
                // è®¡ç®—ä½ç½®
                const positions = {};
                const levels = {
                    'producer': 0,
                    'primary': 1,
                    'secondary': 2,
                    'tertiary': 3,
                    'decomposer': 4
                };
                
                const levelGroups = {};
                this.selectedOrganisms.forEach(org => {
                    const level = this.organismData[org].level;
                    if (!levelGroups[level]) levelGroups[level] = [];
                    levelGroups[level].push(org);
                });
                
                Object.keys(levelGroups).forEach(level => {
                    const y = 50 + levels[level] * 60;
                    levelGroups[level].forEach((org, index) => {
                        const x = 100 + index * 100;
                        positions[org] = { x, y };
                    });
                });
                
                // ç»˜åˆ¶è¿æ¥çº¿
                this.foodWebCtx.strokeStyle = '#4caf50';
                this.foodWebCtx.lineWidth = 2;
                this.foodWebConnections.forEach(conn => {
                    const from = positions[conn.from];
                    const to = positions[conn.to];
                    if (from && to) {
                        this.foodWebCtx.beginPath();
                        this.foodWebCtx.moveTo(from.x, from.y);
                        this.foodWebCtx.lineTo(to.x, to.y);
                        this.foodWebCtx.stroke();
                        
                        // ç®­å¤´
                        const angle = Math.atan2(to.y - from.y, to.x - from.x);
                        this.foodWebCtx.beginPath();
                        this.foodWebCtx.moveTo(to.x - 10 * Math.cos(angle - 0.3), to.y - 10 * Math.sin(angle - 0.3));
                        this.foodWebCtx.lineTo(to.x, to.y);
                        this.foodWebCtx.lineTo(to.x - 10 * Math.cos(angle + 0.3), to.y - 10 * Math.sin(angle + 0.3));
                        this.foodWebCtx.stroke();
                    }
                });
                
                // ç»˜åˆ¶ç”Ÿç‰©
                this.selectedOrganisms.forEach(org => {
                    const pos = positions[org];
                    if (pos) {
                        this.foodWebCtx.fillStyle = '#fff';
                        this.foodWebCtx.beginPath();
                        this.foodWebCtx.arc(pos.x, pos.y, 20, 0, 2 * Math.PI);
                        this.foodWebCtx.fill();
                        this.foodWebCtx.stroke();
                        
                        this.foodWebCtx.font = '16px Arial';
                        this.foodWebCtx.textAlign = 'center';
                        this.foodWebCtx.fillStyle = '#333';
                        this.foodWebCtx.fillText(this.organismData[org].icon, pos.x, pos.y + 5);
                    }
                });
            }

            clearFoodWeb() {
                this.selectedOrganisms = [];
                this.foodWebConnections = [];
                document.querySelectorAll('.organism-card').forEach(card => {
                    card.classList.remove('selected');
                });
                this.foodWebCtx.clearRect(0, 0, this.foodWebCanvas.width, this.foodWebCanvas.height);
            }

            drawBiodiversityChart() {
                this.biodiversityCtx.clearRect(0, 0, this.biodiversityChart.width, this.biodiversityChart.height);
                
                // ç»˜åˆ¶ç‰©ç§ä¸°å¯Œåº¦æŸ±çŠ¶å›¾
                const species = ['æ¤ç‰©', 'æ˜†è™«', 'é¸Ÿç±»', 'å“ºä¹³åŠ¨ç‰©', 'é±¼ç±»', 'ä¸¤æ –åŠ¨ç‰©'];
                const counts = [45, 120, 25, 15, 30, 8];
                const colors = ['#4caf50', '#ff9800', '#2196f3', '#9c27b0', '#00bcd4', '#8bc34a'];
                
                const barWidth = 80;
                const maxCount = Math.max(...counts);
                
                species.forEach((species, index) => {
                    const x = 50 + index * 90;
                    const height = (counts[index] / maxCount) * 200;
                    const y = 250 - height;
                    
                    this.biodiversityCtx.fillStyle = colors[index];
                    this.biodiversityCtx.fillRect(x, y, barWidth, height);
                    
                    this.biodiversityCtx.fillStyle = '#333';
                    this.biodiversityCtx.font = '12px Arial';
                    this.biodiversityCtx.textAlign = 'center';
                    this.biodiversityCtx.fillText(species, x + barWidth/2, 270);
                    this.biodiversityCtx.fillText(counts[index], x + barWidth/2, y - 5);
                });
                
                // æ ‡é¢˜
                this.biodiversityCtx.font = '16px Arial';
                this.biodiversityCtx.fillText('ç‰©ç§æ•°é‡åˆ†å¸ƒ', 300, 30);
            }

            analyzeBiodiversity() {
                // æ¨¡æ‹Ÿç”Ÿç‰©å¤šæ ·æ€§åˆ†æ
                const richness = 20 + Math.floor(Math.random() * 30);
                const shannon = 2.0 + Math.random() * 1.5;
                const evenness = 0.5 + Math.random() * 0.4;
                const dominance = 0.1 + Math.random() * 0.3;
                
                document.getElementById('species-richness').textContent = richness;
                document.getElementById('shannon-index').textContent = shannon.toFixed(2);
                document.getElementById('evenness').textContent = evenness.toFixed(2);
                document.getElementById('dominance').textContent = dominance.toFixed(2);
                
                this.drawBiodiversityChart();
            }

            generateSampleData() {
                // ç”Ÿæˆéšæœºæ ·æœ¬æ•°æ®
                this.analyzeBiodiversity();
                alert('å·²ç”Ÿæˆæ–°çš„æ ·æœ¬æ•°æ®ï¼Œç”Ÿç‰©å¤šæ ·æ€§æŒ‡æ ‡å·²æ›´æ–°');
            }

            updateSliderValue(sliderId, value) {
                const valueId = sliderId.replace('-', '-').replace('protection', 'value').replace('control', 'value').replace('level', 'value');
                document.getElementById(valueId).textContent = value + '%';
            }

            runConservationSimulation() {
                const habitat = parseInt(document.getElementById('habitat-protection').value);
                const pollution = parseInt(document.getElementById('pollution-control').value);
                const species = parseInt(document.getElementById('species-protection').value);
                const education = parseInt(document.getElementById('education-level').value);
                
                // è®¡ç®—ä¿æŠ¤æ•ˆæœ
                const overallScore = (habitat + pollution + species + education) / 4;
                const biodiversityChange = (overallScore - 50) * 0.5;
                const populationChange = (overallScore - 50) * 0.3;
                const habitatQuality = Math.min(100, 50 + (overallScore - 50) * 0.8);
                
                let assessment = '';
                if (overallScore >= 80) {
                    assessment = 'ä¼˜ç§€ - ç”Ÿæ€ç³»ç»Ÿå°†å¾—åˆ°æ˜¾è‘—æ”¹å–„';
                } else if (overallScore >= 60) {
                    assessment = 'è‰¯å¥½ - ç”Ÿæ€ç³»ç»Ÿå°†ç¨³æ­¥æ¢å¤';
                } else if (overallScore >= 40) {
                    assessment = 'ä¸€èˆ¬ - ç”Ÿæ€ç³»ç»Ÿç»´æŒç°çŠ¶';
                } else {
                    assessment = 'è¾ƒå·® - ç”Ÿæ€ç³»ç»Ÿå¯èƒ½ç»§ç»­æ¶åŒ–';
                }
                
                const resultsDiv = document.getElementById('conservation-results');
                resultsDiv.innerHTML = `
                    <h4>ä¿æŠ¤æ•ˆæœé¢„æµ‹</h4>
                    <p><strong>ç»¼åˆè¯„åˆ†:</strong> ${overallScore.toFixed(1)}/100</p>
                    <p><strong>ç”Ÿç‰©å¤šæ ·æ€§å˜åŒ–:</strong> ${biodiversityChange > 0 ? '+' : ''}${biodiversityChange.toFixed(1)}%</p>
                    <p><strong>ç§ç¾¤æ•°é‡å˜åŒ–:</strong> ${populationChange > 0 ? '+' : ''}${populationChange.toFixed(1)}%</p>
                    <p><strong>æ –æ¯åœ°è´¨é‡:</strong> ${habitatQuality.toFixed(1)}%</p>
                    <p><strong>æ€»ä½“è¯„ä¼°:</strong> ${assessment}</p>
                    <h5>å»ºè®®æªæ–½:</h5>
                    <ul>
                        ${habitat < 70 ? '<li>åŠ å¼ºæ –æ¯åœ°ä¿æŠ¤ï¼Œå»ºç«‹æ›´å¤šè‡ªç„¶ä¿æŠ¤åŒº</li>' : ''}
                        ${pollution < 70 ? '<li>åŠ å¤§æ±¡æŸ“æ²»ç†åŠ›åº¦ï¼Œæ”¹å–„ç¯å¢ƒè´¨é‡</li>' : ''}
                        ${species < 70 ? '<li>å®æ–½æ¿’å±ç‰©ç§ä¿æŠ¤è®¡åˆ’</li>' : ''}
                        ${education < 70 ? '<li>åŠ å¼ºç¯ä¿æ•™è‚²å’Œå…¬ä¼—å‚ä¸</li>' : ''}
                    </ul>
                `;
            }
        }

        // åˆå§‹åŒ–ç”Ÿæ€å­¦
        let ecology;
        document.addEventListener('DOMContentLoaded', () => {
            ecology = new Ecology();
        });
    </script>
</body>
</html> 