<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>遗传学 - 生物学习助手</title>
    <link rel="icon" href="../../assets/icons/logo_btrfly.ico" type="image/x-icon">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/components.css">
    <link rel="stylesheet" href="../../css/utilities.css">
    <link rel="stylesheet" href="../../css/responsive.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .genetics-page {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem 0;
        }

        .genetics-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            margin: 2rem auto;
            max-width: 1600px;
        }

        .genetics-header {
            background: linear-gradient(135deg, #4caf50, #8bc34a);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .genetics-header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 700;
        }

        .genetics-header p {
            margin: 1rem 0 0 0;
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .genetics-tabs {
            background: #f8f9fa;
            padding: 0;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            overflow-x: auto;
        }

        .genetics-tab {
            padding: 1rem 2rem;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #666;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .genetics-tab.active {
            color: #4caf50;
            border-bottom-color: #4caf50;
            background: white;
        }

        .genetics-tab:hover {
            color: #4caf50;
            background: #f0f8ff;
        }

        .genetics-content {
            padding: 2rem;
            min-height: 600px;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        .dna-explorer {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 2rem;
            height: 600px;
        }

        .dna-display {
            background: #f8f9fa;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            border: 2px solid #e9ecef;
        }

        .dna-canvas {
            width: 100%;
            height: 100%;
            display: block;
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%);
        }

        .dna-info {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            height: fit-content;
            border: 1px solid #e9ecef;
        }

        .dna-info h3 {
            margin: 0 0 1rem 0;
            color: #4caf50;
            font-size: 1.2rem;
        }

        .base-sequence {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .base-a { color: #ff6b6b; }
        .base-t { color: #4ecdc4; }
        .base-g { color: #45b7d1; }
        .base-c { color: #f9ca24; }

        .inheritance-simulator {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
        }

        .parent-setup {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .parent-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            border: 1px solid #e9ecef;
        }

        .parent-card h4 {
            margin: 0 0 1rem 0;
            color: #4caf50;
        }

        .genotype-input {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .allele-input {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 50px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .punnett-square {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            border: 1px solid #e9ecef;
            margin-bottom: 2rem;
        }

        .punnett-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1px;
            background: #ddd;
            border: 1px solid #ddd;
            max-width: 300px;
            margin: 0 auto;
        }

        .punnett-cell {
            background: white;
            padding: 1rem;
            text-align: center;
            font-weight: bold;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .punnett-header {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .punnett-result {
            font-size: 0.9rem;
        }

        .trait-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .trait-btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #4caf50, #8bc34a);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .trait-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .trait-btn.secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
        }

        .results-summary {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            border: 1px solid #e9ecef;
        }

        .results-summary h4 {
            margin: 0 0 1rem 0;
            color: #4caf50;
        }

        .ratio-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .ratio-item {
            text-align: center;
            padding: 1rem;
            background: #e8f5e8;
            border-radius: 8px;
        }

        .ratio-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2e7d32;
        }

        .ratio-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.5rem;
        }

        .gene-expression {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
        }

        .expression-steps {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .expression-step {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            border-left: 4px solid #4caf50;
            transition: all 0.3s ease;
        }

        .expression-step:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.15);
        }

        .expression-step h4 {
            margin: 0 0 0.5rem 0;
            color: #4caf50;
        }

        .expression-step p {
            margin: 0;
            color: #666;
            line-height: 1.5;
        }

        .sequence-analyzer {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            border: 1px solid #e9ecef;
        }

        .sequence-input {
            width: 100%;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            min-height: 100px;
            resize: vertical;
        }

        .analysis-results {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
        }

        @media (max-width: 768px) {
            .dna-explorer {
                grid-template-columns: 1fr;
            }
            
            .parent-setup {
                grid-template-columns: 1fr;
            }
            
            .genetics-tabs {
                flex-direction: column;
            }
            
            .genetics-tab {
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="../../index.html">
                        <i class="fas fa-graduation-cap" style="background: linear-gradient(90deg, #4361ee, #7209b7); -webkit-background-clip: text; background-clip: text; color: transparent;"></i>
                        <span>Alex的学习助手</span>
                    </a>
                </div>
                <nav class="main-nav">
                    <ul>
                        <li><a href="../../index.html">首页</a></li>
                        <li><a href="main.html">生物</a></li>
                        <li><a href="../../index.html#subjects">科目</a></li>
                        <li><a href="../../tts.html">语音</a></li>
                        <li><a href="../../draw.html">绘图</a></li>
                    </ul>
                </nav>
                <button class="mobile-menu-toggle" aria-label="切换菜单">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <main class="genetics-page">
        <div class="container">
            <div class="genetics-container">
                <div class="genetics-header">
                    <h1><i class="fas fa-dna"></i> 遗传学</h1>
                    <p>学习DNA、基因表达和遗传规律的基本原理</p>
                </div>

                <div class="genetics-tabs">
                    <button class="genetics-tab active" data-tab="dna">DNA结构</button>
                    <button class="genetics-tab" data-tab="inheritance">遗传规律</button>
                    <button class="genetics-tab" data-tab="expression">基因表达</button>
                    <button class="genetics-tab" data-tab="analysis">序列分析</button>
                </div>

                <div class="genetics-content">
                    <!-- DNA结构标签页 -->
                    <div class="tab-panel active" id="dna-panel">
                        <div class="dna-explorer">
                            <div class="dna-display">
                                <canvas class="dna-canvas" id="dna-canvas" width="800" height="600"></canvas>
                            </div>
                            
                            <div class="dna-info">
                                <h3><i class="fas fa-search"></i> DNA结构探索</h3>
                                
                                <div class="base-sequence" id="sequence-display">
                                    <div>5' - <span class="base-a">A</span><span class="base-t">T</span><span class="base-g">G</span><span class="base-c">C</span><span class="base-a">A</span><span class="base-t">T</span><span class="base-g">G</span><span class="base-c">C</span> - 3'</div>
                                    <div>3' - <span class="base-t">T</span><span class="base-a">A</span><span class="base-c">C</span><span class="base-g">G</span><span class="base-t">T</span><span class="base-a">A</span><span class="base-c">C</span><span class="base-g">G</span> - 5'</div>
                                </div>

                                <div class="trait-controls">
                                    <button class="trait-btn" id="rotate-dna">旋转DNA</button>
                                    <button class="trait-btn secondary" id="generate-sequence">生成序列</button>
                                </div>

                                <div style="background: #f0f8ff; padding: 1rem; border-radius: 8px; border-left: 4px solid #4caf50;">
                                    <h4>DNA双螺旋结构</h4>
                                    <p>DNA由两条反向平行的多核苷酸链组成，通过氢键连接的碱基对维持双螺旋结构。A与T配对，G与C配对。</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 遗传规律标签页 -->
                    <div class="tab-panel" id="inheritance-panel">
                        <h2>遗传规律模拟</h2>
                        <div class="inheritance-simulator">
                            <div class="parent-setup">
                                <div class="parent-card">
                                    <h4>亲本1 (♀)</h4>
                                    <div class="genotype-input">
                                        <input type="text" class="allele-input" id="p1-allele1" value="A" maxlength="1">
                                        <input type="text" class="allele-input" id="p1-allele2" value="a" maxlength="1">
                                    </div>
                                    <p>基因型: <span id="p1-genotype">Aa</span></p>
                                    <p>表现型: <span id="p1-phenotype">显性</span></p>
                                </div>
                                <div class="parent-card">
                                    <h4>亲本2 (♂)</h4>
                                    <div class="genotype-input">
                                        <input type="text" class="allele-input" id="p2-allele1" value="A" maxlength="1">
                                        <input type="text" class="allele-input" id="p2-allele2" value="a" maxlength="1">
                                    </div>
                                    <p>基因型: <span id="p2-genotype">Aa</span></p>
                                    <p>表现型: <span id="p2-phenotype">显性</span></p>
                                </div>
                            </div>

                            <div class="trait-controls">
                                <button class="trait-btn" id="calculate-cross">计算杂交</button>
                                <button class="trait-btn secondary" id="reset-cross">重置</button>
                            </div>

                            <div class="punnett-square">
                                <h4>棋盘法分析</h4>
                                <div class="punnett-grid" id="punnett-grid">
                                    <div class="punnett-cell punnett-header"></div>
                                    <div class="punnett-cell punnett-header">A</div>
                                    <div class="punnett-cell punnett-header">a</div>
                                    <div class="punnett-cell punnett-header">A</div>
                                    <div class="punnett-cell punnett-result">AA</div>
                                    <div class="punnett-cell punnett-result">Aa</div>
                                    <div class="punnett-cell punnett-header">a</div>
                                    <div class="punnett-cell punnett-result">Aa</div>
                                    <div class="punnett-cell punnett-result">aa</div>
                                </div>
                            </div>

                            <div class="results-summary">
                                <h4>后代分析结果</h4>
                                <div class="ratio-display" id="ratio-display">
                                    <div class="ratio-item">
                                        <div class="ratio-value">1:2:1</div>
                                        <div class="ratio-label">基因型比例</div>
                                    </div>
                                    <div class="ratio-item">
                                        <div class="ratio-value">3:1</div>
                                        <div class="ratio-label">表现型比例</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 基因表达标签页 -->
                    <div class="tab-panel" id="expression-panel">
                        <h2>基因表达过程</h2>
                        <div class="gene-expression">
                            <div class="expression-steps">
                                <div class="expression-step">
                                    <h4>1. 转录 (Transcription)</h4>
                                    <p>DNA双链解开，RNA聚合酶以DNA为模板合成mRNA。过程包括起始、延伸和终止三个阶段。</p>
                                </div>
                                <div class="expression-step">
                                    <h4>2. RNA加工 (RNA Processing)</h4>
                                    <p>在真核细胞中，初级转录产物经过5'加帽、3'加尾和剪接等修饰形成成熟mRNA。</p>
                                </div>
                                <div class="expression-step">
                                    <h4>3. 翻译 (Translation)</h4>
                                    <p>mRNA与核糖体结合，tRNA携带氨基酸按照遗传密码子顺序合成蛋白质。</p>
                                </div>
                                <div class="expression-step">
                                    <h4>4. 蛋白质折叠 (Protein Folding)</h4>
                                    <p>新合成的多肽链折叠成具有生物活性的三维结构，可能需要分子伴侣的协助。</p>
                                </div>
                            </div>

                            <div class="trait-controls">
                                <button class="trait-btn" id="start-transcription">开始转录</button>
                                <button class="trait-btn" id="start-translation">开始翻译</button>
                                <button class="trait-btn secondary" id="reset-expression">重置过程</button>
                            </div>

                            <div class="sequence-analyzer">
                                <h4>密码子分析</h4>
                                <p>输入DNA序列，查看对应的mRNA和蛋白质序列：</p>
                                <textarea class="sequence-input" id="dna-sequence" placeholder="输入DNA序列 (例如: ATGGCATAA)">ATGGCATAA</textarea>
                                <button class="trait-btn" id="analyze-sequence">分析序列</button>
                                <div class="analysis-results" id="analysis-results">
                                    <p><strong>DNA:</strong> <span id="dna-result">ATGGCATAA</span></p>
                                    <p><strong>mRNA:</strong> <span id="mrna-result">AUCCGUAUU</span></p>
                                    <p><strong>蛋白质:</strong> <span id="protein-result">Met-Ala-*</span></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 序列分析标签页 -->
                    <div class="tab-panel" id="analysis-panel">
                        <h2>基因序列分析工具</h2>
                        <div class="gene-expression">
                            <div class="sequence-analyzer">
                                <h4>序列比较分析</h4>
                                <p>输入两个DNA序列进行比较分析：</p>
                                
                                <label>序列1:</label>
                                <textarea class="sequence-input" id="sequence1" placeholder="输入第一个DNA序列">ATGGCATAAGGC</textarea>
                                
                                <label>序列2:</label>
                                <textarea class="sequence-input" id="sequence2" placeholder="输入第二个DNA序列">ATGGCCTAAGGC</textarea>
                                
                                <div class="trait-controls">
                                    <button class="trait-btn" id="compare-sequences">比较序列</button>
                                    <button class="trait-btn" id="find-mutations">查找突变</button>
                                    <button class="trait-btn secondary" id="clear-analysis">清空</button>
                                </div>
                                
                                <div class="analysis-results" id="comparison-results">
                                    <h4>分析结果</h4>
                                    <p>点击上方按钮开始序列分析</p>
                                </div>
                            </div>

                            <div class="results-summary">
                                <h4>遗传学工具箱</h4>
                                <div class="expression-steps">
                                    <div class="expression-step">
                                        <h4>序列比较</h4>
                                        <p>比较两个DNA序列的相似性和差异，识别突变位点。</p>
                                    </div>
                                    <div class="expression-step">
                                        <h4>密码子使用</h4>
                                        <p>分析基因序列中密码子的使用频率和偏好性。</p>
                                    </div>
                                    <div class="expression-step">
                                        <h4>开放阅读框</h4>
                                        <p>识别DNA序列中可能编码蛋白质的开放阅读框(ORF)。</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <p class="copyright-text">study-llm.me域名为Alex所有。保留所有权利。</p>
            </div>
        </div>
    </footer>

    <script src="../../js/common.js"></script>
    <script src="../../js/navigation.js"></script>
    <script>
        // 遗传学功能
        class Genetics {
            constructor() {
                this.canvas = document.getElementById('dna-canvas');
                this.ctx = this.canvas.getContext('2d');
                this.rotationAngle = 0;
                this.isRotating = false;
                
                this.geneticCode = this.initializeGeneticCode();
                this.initializeEventListeners();
                this.drawDNA();
                this.updateGenotypeDisplays();
            }

            initializeGeneticCode() {
                return {
                    'TTT': 'Phe', 'TTC': 'Phe', 'TTA': 'Leu', 'TTG': 'Leu',
                    'TCT': 'Ser', 'TCC': 'Ser', 'TCA': 'Ser', 'TCG': 'Ser',
                    'TAT': 'Tyr', 'TAC': 'Tyr', 'TAA': '*', 'TAG': '*',
                    'TGT': 'Cys', 'TGC': 'Cys', 'TGA': '*', 'TGG': 'Trp',
                    'CTT': 'Leu', 'CTC': 'Leu', 'CTA': 'Leu', 'CTG': 'Leu',
                    'CCT': 'Pro', 'CCC': 'Pro', 'CCA': 'Pro', 'CCG': 'Pro',
                    'CAT': 'His', 'CAC': 'His', 'CAA': 'Gln', 'CAG': 'Gln',
                    'CGT': 'Arg', 'CGC': 'Arg', 'CGA': 'Arg', 'CGG': 'Arg',
                    'ATT': 'Ile', 'ATC': 'Ile', 'ATA': 'Ile', 'ATG': 'Met',
                    'ACT': 'Thr', 'ACC': 'Thr', 'ACA': 'Thr', 'ACG': 'Thr',
                    'AAT': 'Asn', 'AAC': 'Asn', 'AAA': 'Lys', 'AAG': 'Lys',
                    'AGT': 'Ser', 'AGC': 'Ser', 'AGA': 'Arg', 'AGG': 'Arg',
                    'GTT': 'Val', 'GTC': 'Val', 'GTA': 'Val', 'GTG': 'Val',
                    'GCT': 'Ala', 'GCC': 'Ala', 'GCA': 'Ala', 'GCG': 'Ala',
                    'GAT': 'Asp', 'GAC': 'Asp', 'GAA': 'Glu', 'GAG': 'Glu',
                    'GGT': 'Gly', 'GGC': 'Gly', 'GGA': 'Gly', 'GGG': 'Gly'
                };
            }

            initializeEventListeners() {
                // 标签页切换
                document.querySelectorAll('.genetics-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        this.switchTab(e.target.dataset.tab);
                    });
                });

                // DNA控制
                document.getElementById('rotate-dna').addEventListener('click', () => {
                    this.toggleRotation();
                });

                document.getElementById('generate-sequence').addEventListener('click', () => {
                    this.generateRandomSequence();
                });

                // 遗传规律控制
                document.getElementById('calculate-cross').addEventListener('click', () => {
                    this.calculateCross();
                });

                document.getElementById('reset-cross').addEventListener('click', () => {
                    this.resetCross();
                });

                // 基因表达控制
                document.getElementById('start-transcription').addEventListener('click', () => {
                    this.startTranscription();
                });

                document.getElementById('start-translation').addEventListener('click', () => {
                    this.startTranslation();
                });

                document.getElementById('reset-expression').addEventListener('click', () => {
                    this.resetExpression();
                });

                document.getElementById('analyze-sequence').addEventListener('click', () => {
                    this.analyzeSequence();
                });

                // 序列分析控制
                document.getElementById('compare-sequences').addEventListener('click', () => {
                    this.compareSequences();
                });

                document.getElementById('find-mutations').addEventListener('click', () => {
                    this.findMutations();
                });

                document.getElementById('clear-analysis').addEventListener('click', () => {
                    this.clearAnalysis();
                });

                // 基因型输入监听
                ['p1-allele1', 'p1-allele2', 'p2-allele1', 'p2-allele2'].forEach(id => {
                    document.getElementById(id).addEventListener('input', () => {
                        this.updateGenotypeDisplays();
                    });
                });
            }

            switchTab(tabName) {
                // 更新标签页状态
                document.querySelectorAll('.genetics-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

                // 显示对应面板
                document.querySelectorAll('.tab-panel').forEach(panel => {
                    panel.classList.remove('active');
                });
                document.getElementById(`${tabName}-panel`).classList.add('active');
            }

            drawDNA() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                const radius = 150;
                const height = 400;

                // 绘制DNA双螺旋
                for (let i = 0; i < height; i += 5) {
                    const angle1 = (i / 20 + this.rotationAngle) % (2 * Math.PI);
                    const angle2 = angle1 + Math.PI;

                    const x1 = centerX + radius * Math.cos(angle1);
                    const y1 = centerY - height/2 + i;
                    const x2 = centerX + radius * Math.cos(angle2);
                    const y2 = centerY - height/2 + i;

                    // 绘制骨架
                    this.ctx.strokeStyle = '#4caf50';
                    this.ctx.lineWidth = 3;
                    this.ctx.beginPath();
                    this.ctx.arc(x1, y1, 3, 0, 2 * Math.PI);
                    this.ctx.stroke();

                    this.ctx.beginPath();
                    this.ctx.arc(x2, y2, 3, 0, 2 * Math.PI);
                    this.ctx.stroke();

                    // 绘制氢键
                    if (i % 20 === 0) {
                        this.ctx.strokeStyle = '#ff6b6b';
                        this.ctx.lineWidth = 1;
                        this.ctx.setLineDash([5, 5]);
                        this.ctx.beginPath();
                        this.ctx.moveTo(x1, y1);
                        this.ctx.lineTo(x2, y2);
                        this.ctx.stroke();
                        this.ctx.setLineDash([]);
                    }
                }

                // 绘制碱基对标签
                this.ctx.fillStyle = '#333';
                this.ctx.font = '14px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText('DNA双螺旋结构', centerX, 50);
                this.ctx.fillText('5\' → 3\'', centerX - 100, 100);
                this.ctx.fillText('3\' ← 5\'', centerX + 100, 100);
            }

            toggleRotation() {
                this.isRotating = !this.isRotating;
                if (this.isRotating) {
                    this.startRotation();
                }
            }

            startRotation() {
                if (!this.isRotating) return;
                
                this.rotationAngle += 0.05;
                this.drawDNA();
                requestAnimationFrame(() => this.startRotation());
            }

            generateRandomSequence() {
                const bases = ['A', 'T', 'G', 'C'];
                let sequence1 = '';
                let sequence2 = '';
                
                for (let i = 0; i < 8; i++) {
                    const base = bases[Math.floor(Math.random() * bases.length)];
                    sequence1 += base;
                    
                    // 生成互补碱基
                    const complement = {'A': 'T', 'T': 'A', 'G': 'C', 'C': 'G'}[base];
                    sequence2 += complement;
                }

                const display = document.getElementById('sequence-display');
                display.innerHTML = `
                    <div>5' - ${sequence1.split('').map(base => `<span class="base-${base.toLowerCase()}">${base}</span>`).join('')} - 3'</div>
                    <div>3' - ${sequence2.split('').map(base => `<span class="base-${base.toLowerCase()}">${base}</span>`).join('')} - 5'</div>
                `;
            }

            updateGenotypeDisplays() {
                const p1a1 = document.getElementById('p1-allele1').value || 'A';
                const p1a2 = document.getElementById('p1-allele2').value || 'a';
                const p2a1 = document.getElementById('p2-allele1').value || 'A';
                const p2a2 = document.getElementById('p2-allele2').value || 'a';

                document.getElementById('p1-genotype').textContent = p1a1 + p1a2;
                document.getElementById('p2-genotype').textContent = p2a1 + p2a2;

                document.getElementById('p1-phenotype').textContent = this.getPhenotype(p1a1, p1a2);
                document.getElementById('p2-phenotype').textContent = this.getPhenotype(p2a1, p2a2);
            }

            getPhenotype(allele1, allele2) {
                const dominant = allele1.toUpperCase();
                const recessive = allele1.toLowerCase();
                
                if (allele1 === dominant || allele2 === dominant) {
                    return '显性';
                } else {
                    return '隐性';
                }
            }

            calculateCross() {
                const p1a1 = document.getElementById('p1-allele1').value || 'A';
                const p1a2 = document.getElementById('p1-allele2').value || 'a';
                const p2a1 = document.getElementById('p2-allele1').value || 'A';
                const p2a2 = document.getElementById('p2-allele2').value || 'a';

                // 生成棋盘法
                const gametes1 = [p1a1, p1a2];
                const gametes2 = [p2a1, p2a2];
                
                const grid = document.getElementById('punnett-grid');
                grid.innerHTML = `
                    <div class="punnett-cell punnett-header"></div>
                    <div class="punnett-cell punnett-header">${gametes2[0]}</div>
                    <div class="punnett-cell punnett-header">${gametes2[1]}</div>
                    <div class="punnett-cell punnett-header">${gametes1[0]}</div>
                    <div class="punnett-cell punnett-result">${gametes1[0]}${gametes2[0]}</div>
                    <div class="punnett-cell punnett-result">${gametes1[0]}${gametes2[1]}</div>
                    <div class="punnett-cell punnett-header">${gametes1[1]}</div>
                    <div class="punnett-cell punnett-result">${gametes1[1]}${gametes2[0]}</div>
                    <div class="punnett-cell punnett-result">${gametes1[1]}${gametes2[1]}</div>
                `;

                // 计算比例
                const offspring = [
                    gametes1[0] + gametes2[0],
                    gametes1[0] + gametes2[1],
                    gametes1[1] + gametes2[0],
                    gametes1[1] + gametes2[1]
                ];

                this.calculateRatios(offspring);
            }

            calculateRatios(offspring) {
                const genotypeCounts = {};
                const phenotypeCounts = { '显性': 0, '隐性': 0 };

                offspring.forEach(genotype => {
                    // 统计基因型
                    const sorted = genotype.split('').sort().join('');
                    genotypeCounts[sorted] = (genotypeCounts[sorted] || 0) + 1;

                    // 统计表现型
                    const phenotype = this.getPhenotype(genotype[0], genotype[1]);
                    phenotypeCounts[phenotype]++;
                });

                // 显示结果
                const genotypeRatio = Object.values(genotypeCounts).join(':');
                const phenotypeRatio = `${phenotypeCounts['显性']}:${phenotypeCounts['隐性']}`;

                document.getElementById('ratio-display').innerHTML = `
                    <div class="ratio-item">
                        <div class="ratio-value">${genotypeRatio}</div>
                        <div class="ratio-label">基因型比例</div>
                    </div>
                    <div class="ratio-item">
                        <div class="ratio-value">${phenotypeRatio}</div>
                        <div class="ratio-label">表现型比例</div>
                    </div>
                `;
            }

            resetCross() {
                document.getElementById('p1-allele1').value = 'A';
                document.getElementById('p1-allele2').value = 'a';
                document.getElementById('p2-allele1').value = 'A';
                document.getElementById('p2-allele2').value = 'a';
                this.updateGenotypeDisplays();
                this.calculateCross();
            }

            startTranscription() {
                alert('转录过程开始：DNA → mRNA\n\n1. RNA聚合酶结合到启动子\n2. DNA双链解开\n3. 以DNA为模板合成mRNA\n4. mRNA从DNA上释放');
            }

            startTranslation() {
                alert('翻译过程开始：mRNA → 蛋白质\n\n1. mRNA与核糖体结合\n2. tRNA携带氨基酸\n3. 按密码子顺序合成多肽\n4. 多肽折叠成蛋白质');
            }

            resetExpression() {
                document.getElementById('dna-sequence').value = 'ATGGCATAA';
                this.analyzeSequence();
            }

            analyzeSequence() {
                const dnaSeq = document.getElementById('dna-sequence').value.toUpperCase().replace(/[^ATGC]/g, '');
                
                // 转录：DNA → mRNA
                const mrnaSeq = dnaSeq.replace(/T/g, 'U');
                
                // 翻译：mRNA → 蛋白质
                let proteinSeq = '';
                for (let i = 0; i < mrnaSeq.length - 2; i += 3) {
                    const codon = mrnaSeq.substr(i, 3);
                    if (codon.length === 3) {
                        const aminoAcid = this.geneticCode[codon.replace(/U/g, 'T')] || 'X';
                        proteinSeq += aminoAcid + '-';
                    }
                }
                proteinSeq = proteinSeq.slice(0, -1); // 移除最后的连字符

                document.getElementById('dna-result').textContent = dnaSeq;
                document.getElementById('mrna-result').textContent = mrnaSeq;
                document.getElementById('protein-result').textContent = proteinSeq;
            }

            compareSequences() {
                const seq1 = document.getElementById('sequence1').value.toUpperCase().replace(/[^ATGC]/g, '');
                const seq2 = document.getElementById('sequence2').value.toUpperCase().replace(/[^ATGC]/g, '');
                
                if (seq1.length === 0 || seq2.length === 0) {
                    alert('请输入有效的DNA序列');
                    return;
                }

                const maxLength = Math.max(seq1.length, seq2.length);
                let matches = 0;
                let differences = [];

                for (let i = 0; i < maxLength; i++) {
                    const base1 = seq1[i] || '-';
                    const base2 = seq2[i] || '-';
                    
                    if (base1 === base2) {
                        matches++;
                    } else {
                        differences.push(`位置${i + 1}: ${base1} → ${base2}`);
                    }
                }

                const similarity = ((matches / maxLength) * 100).toFixed(1);
                
                document.getElementById('comparison-results').innerHTML = `
                    <h4>序列比较结果</h4>
                    <p><strong>相似度:</strong> ${similarity}%</p>
                    <p><strong>匹配位点:</strong> ${matches}/${maxLength}</p>
                    <p><strong>差异位点:</strong> ${differences.length}</p>
                    ${differences.length > 0 ? `<p><strong>差异详情:</strong><br>${differences.slice(0, 5).join('<br>')}</p>` : ''}
                `;
            }

            findMutations() {
                const seq1 = document.getElementById('sequence1').value.toUpperCase().replace(/[^ATGC]/g, '');
                const seq2 = document.getElementById('sequence2').value.toUpperCase().replace(/[^ATGC]/g, '');
                
                if (seq1.length === 0 || seq2.length === 0) {
                    alert('请输入有效的DNA序列');
                    return;
                }

                const mutations = [];
                const minLength = Math.min(seq1.length, seq2.length);

                for (let i = 0; i < minLength; i++) {
                    if (seq1[i] !== seq2[i]) {
                        let mutationType = '点突变';
                        if (seq1[i] === 'A' && seq2[i] === 'G' || seq1[i] === 'G' && seq2[i] === 'A' ||
                            seq1[i] === 'C' && seq2[i] === 'T' || seq1[i] === 'T' && seq2[i] === 'C') {
                            mutationType = '转换';
                        } else {
                            mutationType = '颠换';
                        }
                        mutations.push(`位置${i + 1}: ${seq1[i]}→${seq2[i]} (${mutationType})`);
                    }
                }

                document.getElementById('comparison-results').innerHTML = `
                    <h4>突变分析结果</h4>
                    <p><strong>检测到突变:</strong> ${mutations.length}个</p>
                    ${mutations.length > 0 ? `<p><strong>突变详情:</strong><br>${mutations.slice(0, 10).join('<br>')}</p>` : '<p>未检测到突变</p>'}
                `;
            }

            clearAnalysis() {
                document.getElementById('sequence1').value = '';
                document.getElementById('sequence2').value = '';
                document.getElementById('comparison-results').innerHTML = `
                    <h4>分析结果</h4>
                    <p>点击上方按钮开始序列分析</p>
                `;
            }
        }

        // 初始化遗传学
        let genetics;
        document.addEventListener('DOMContentLoaded', () => {
            genetics = new Genetics();
        });
    </script>
</body>
</html> 