<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿›åŒ–è®º - ç”Ÿç‰©å­¦ä¹ åŠ©æ‰‹</title>
    <link rel="icon" href="../../assets/icons/logo_btrfly.ico" type="image/x-icon">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/components.css">
    <link rel="stylesheet" href="../../css/utilities.css">
    <link rel="stylesheet" href="../../css/responsive.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .evolution-page {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem 0;
        }

        .evolution-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            margin: 2rem auto;
            max-width: 1600px;
        }

        .evolution-header {
            background: linear-gradient(135deg, #4caf50, #8bc34a);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .evolution-header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 700;
        }

        .evolution-header p {
            margin: 1rem 0 0 0;
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .evolution-tabs {
            background: #f8f9fa;
            padding: 0;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            overflow-x: auto;
        }

        .evolution-tab {
            padding: 1rem 2rem;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #666;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .evolution-tab.active {
            color: #4caf50;
            border-bottom-color: #4caf50;
            background: white;
        }

        .evolution-tab:hover {
            color: #4caf50;
            background: #f0f8ff;
        }

        .evolution-content {
            padding: 2rem;
            min-height: 600px;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        .timeline-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
            position: relative;
            overflow-x: auto;
        }

        .timeline {
            position: relative;
            height: 400px;
            background: linear-gradient(to right, #e8f5e8, #f0f8f0);
            border-radius: 10px;
            padding: 2rem;
        }

        .timeline-line {
            position: absolute;
            top: 50%;
            left: 50px;
            right: 50px;
            height: 4px;
            background: #4caf50;
            transform: translateY(-50%);
        }

        .timeline-event {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: white;
            border: 3px solid #4caf50;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .timeline-label {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: #4caf50;
            color: white;
            padding: 0.5rem;
            border-radius: 5px;
            font-size: 0.8rem;
            white-space: nowrap;
        }

        .timeline-description {
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 200px;
            font-size: 0.9rem;
            display: none;
        }

        .timeline-event:hover .timeline-description {
            display: block;
        }

        .selection-simulator {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
        }

        .simulation-canvas {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #e9ecef;
            height: 400px;
            position: relative;
        }

        .simulation-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .control-group {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            border: 1px solid #e9ecef;
        }

        .control-group h4 {
            margin: 0 0 1rem 0;
            color: #4caf50;
        }

        .control-slider {
            width: 100%;
            margin: 0.5rem 0;
        }

        .control-value {
            text-align: center;
            font-weight: bold;
            color: #4caf50;
        }

        .phylogenetic-tree {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
        }

        .tree-canvas {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #e9ecef;
            height: 500px;
            position: relative;
        }

        .species-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .species-card {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            border: 1px solid #e9ecef;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .species-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.15);
        }

        .species-card.selected {
            border-color: #4caf50;
            background: #e8f5e8;
        }

        .species-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .species-name {
            font-size: 0.9rem;
            color: #666;
        }

        .adaptation-examples {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
        }

        .adaptation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .adaptation-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .adaptation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(76, 175, 80, 0.15);
        }

        .adaptation-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .adaptation-icon {
            font-size: 2rem;
            color: #4caf50;
        }

        .adaptation-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
        }

        .adaptation-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .adaptation-example {
            background: #f0f8ff;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #4caf50;
        }

        .action-btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #4caf50, #8bc34a);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .action-btn.secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
        }

        @media (max-width: 768px) {
            .evolution-tabs {
                flex-direction: column;
            }
            
            .evolution-tab {
                text-align: center;
            }
            
            .simulation-controls {
                grid-template-columns: 1fr;
            }
            
            .adaptation-grid {
                grid-template-columns: 1fr;
            }
        }

        /* è¾¾å°”æ–‡ç†è®ºæ ‡ç­¾é¡µæ ·å¼ */
        .darwin-theory {
            padding: 1rem;
        }

        .darwin-intro {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .darwin-portrait {
            text-align: center;
        }

        .darwin-img {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #4caf50;
            margin-bottom: 1rem;
        }

        .caption {
            font-size: 0.9rem;
            color: #666;
            font-style: italic;
        }

        .darwin-summary h3 {
            color: #4caf50;
            margin: 0 0 1rem 0;
        }

        .darwin-summary p {
            color: #333;
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        .key-concepts {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            border-left: 4px solid #4caf50;
        }

        .key-concepts h4 {
            color: #4caf50;
            margin: 0 0 1rem 0;
        }

        .key-concepts ul {
            margin: 0;
            padding-left: 1.5rem;
        }

        .key-concepts li {
            margin-bottom: 0.5rem;
            color: #333;
        }

        .darwin-voyage {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .darwin-voyage h3 {
            color: #4caf50;
            margin: 0 0 1.5rem 0;
            text-align: center;
        }

        .voyage-map {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .voyage-img {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .voyage-observations h4 {
            color: #4caf50;
            margin: 0 0 1rem 0;
            text-align: center;
        }

        .observation-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .observation-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            border-top: 4px solid #4caf50;
        }

        .observation-card h5 {
            color: #333;
            margin: 0 0 0.5rem 0;
        }

        .observation-card p {
            color: #666;
            margin: 0;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .darwin-impact {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .darwin-impact h3 {
            color: #4caf50;
            margin: 0 0 1.5rem 0;
            text-align: center;
        }

        .impact-timeline {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            position: relative;
            padding-left: 2rem;
        }

        .impact-timeline::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 8px;
            width: 4px;
            background: #4caf50;
            border-radius: 2px;
        }

        .impact-event {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            position: relative;
        }

        .impact-event::before {
            content: '';
            position: absolute;
            left: -2rem;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            border: 4px solid #4caf50;
        }

        .impact-year {
            font-weight: 600;
            color: #4caf50;
            min-width: 120px;
        }

        .impact-description {
            color: #333;
        }

        /* è¿›åŒ–è¯æ®æ ‡ç­¾é¡µæ ·å¼ */
        .evidence-container {
            padding: 1rem;
        }

        .evidence-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .evidence-category {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .evidence-category:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        .evidence-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(139, 195, 74, 0.1));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            color: #4caf50;
            font-size: 1.8rem;
        }

        .evidence-category h3 {
            color: #333;
            margin: 0 0 1rem 0;
            text-align: center;
        }

        .evidence-content {
            max-height: 100px;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .evidence-category.expanded .evidence-content {
            max-height: 1000px;
        }

        .evidence-content p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 1rem;
            text-align: center;
        }

        .evidence-examples {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .evidence-example {
            margin-bottom: 1rem;
        }

        .evidence-example:last-child {
            margin-bottom: 0;
        }

        .evidence-example h4 {
            color: #4caf50;
            margin: 0 0 0.5rem 0;
            font-size: 1rem;
        }

        .evidence-example p {
            color: #666;
            margin: 0 0 0.5rem 0;
            font-size: 0.9rem;
            text-align: left;
        }

        .evidence-img {
            max-width: 100%;
            border-radius: 8px;
            display: block;
            margin: 0.5rem auto;
        }

        .evidence-quiz {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        .evidence-quiz h3 {
            color: #4caf50;
            margin: 0 0 1.5rem 0;
        }

        .quiz-container {
            max-width: 600px;
            margin: 0 auto;
        }

        @media (max-width: 768px) {
            .darwin-intro {
                grid-template-columns: 1fr;
            }
            
            .darwin-portrait {
                margin-bottom: 1.5rem;
            }
            
            .observation-cards {
                grid-template-columns: 1fr;
            }
            
            .evidence-categories {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="../../index.html">
                        <i class="fas fa-graduation-cap" style="background: linear-gradient(90deg, #4361ee, #7209b7); -webkit-background-clip: text; background-clip: text; color: transparent;"></i>
                        <span>Alexçš„å­¦ä¹ åŠ©æ‰‹</span>
                    </a>
                </div>
                <nav class="main-nav">
                    <ul>
                        <li><a href="../../index.html">é¦–é¡µ</a></li>
                        <li><a href="main.html">ç”Ÿç‰©</a></li>
                        <li><a href="../../index.html#subjects">ç§‘ç›®</a></li>
                        <li><a href="../../tts.html">è¯­éŸ³</a></li>
                        <li><a href="../../draw.html">ç»˜å›¾</a></li>
                    </ul>
                </nav>
                <button class="mobile-menu-toggle" aria-label="åˆ‡æ¢èœå•">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <main class="evolution-page">
        <div class="container">
            <div class="evolution-container">
                <div class="evolution-header">
                    <h1><i class="fas fa-tree"></i> è¿›åŒ–è®º</h1>
                    <p>æ¢ç´¢è¾¾å°”æ–‡è‡ªç„¶é€‰æ‹©ç†è®ºã€ç‰©ç§å¤šæ ·æ€§èµ·æºåŠç”Ÿç‰©é€‚åº”æ€§çš„ç§‘å­¦åŸºç¡€</p>
                </div>

                <div class="evolution-tabs">
                    <button class="evolution-tab active" data-tab="timeline">è¿›åŒ–æ—¶é—´è½´</button>
                    <button class="evolution-tab" data-tab="selection">è‡ªç„¶é€‰æ‹©</button>
                    <button class="evolution-tab" data-tab="phylogeny">ç³»ç»Ÿå‘è‚²</button>
                    <button class="evolution-tab" data-tab="darwin">è¾¾å°”æ–‡ç†è®º</button>
                    <button class="evolution-tab" data-tab="evidence">è¿›åŒ–è¯æ®</button>
                </div>

                <div class="evolution-content">
                    <!-- è¿›åŒ–æ—¶é—´è½´æ ‡ç­¾é¡µ -->
                    <div class="tab-panel active" id="timeline-panel">
                        <h2>ç”Ÿå‘½æ¼”åŒ–çš„å…³é”®æ—¶åˆ»</h2>
                        <div class="timeline-container">
                            <div class="timeline">
                                <div class="timeline-line"></div>
                                
                                <div class="timeline-event" style="left: 10%;">
                                    <div class="timeline-label">38äº¿å¹´å‰</div>
                                    <div class="timeline-description">
                                        <strong>ç”Ÿå‘½èµ·æº</strong><br>
                                        æœ€æ—©çš„åŸæ ¸ç”Ÿç‰©å‡ºç°ï¼Œæ ‡å¿—ç€åœ°çƒç”Ÿå‘½çš„å¼€å§‹
                                    </div>
                                </div>
                                
                                <div class="timeline-event" style="left: 25%;">
                                    <div class="timeline-label">20äº¿å¹´å‰</div>
                                    <div class="timeline-description">
                                        <strong>çœŸæ ¸ç»†èƒ</strong><br>
                                        å…·æœ‰ç»†èƒæ ¸çš„çœŸæ ¸ç»†èƒå‡ºç°ï¼Œç”Ÿå‘½å¤æ‚æ€§å¤§å¹…æå‡
                                    </div>
                                </div>
                                
                                <div class="timeline-event" style="left: 40%;">
                                    <div class="timeline-label">5.4äº¿å¹´å‰</div>
                                    <div class="timeline-description">
                                        <strong>å¯’æ­¦çºªå¤§çˆ†å‘</strong><br>
                                        å¤šç»†èƒç”Ÿç‰©å¤§é‡å‡ºç°ï¼Œç”Ÿç‰©å¤šæ ·æ€§æ€¥å‰§å¢åŠ 
                                    </div>
                                </div>
                                
                                <div class="timeline-event" style="left: 55%;">
                                    <div class="timeline-label">4äº¿å¹´å‰</div>
                                    <div class="timeline-description">
                                        <strong>æ¤ç‰©ç™»é™†</strong><br>
                                        æ¤ç‰©å¼€å§‹åœ¨é™†åœ°ä¸Šç”Ÿé•¿ï¼Œæ”¹å˜äº†åœ°çƒç¯å¢ƒ
                                    </div>
                                </div>
                                
                                <div class="timeline-event" style="left: 70%;">
                                    <div class="timeline-label">2.3äº¿å¹´å‰</div>
                                    <div class="timeline-description">
                                        <strong>æé¾™æ—¶ä»£</strong><br>
                                        æé¾™æˆä¸ºåœ°çƒä¸Šçš„ä¸»å¯¼ç”Ÿç‰©ç¾¤ä½“
                                    </div>
                                </div>
                                
                                <div class="timeline-event" style="left: 85%;">
                                    <div class="timeline-label">700ä¸‡å¹´å‰</div>
                                    <div class="timeline-description">
                                        <strong>äººç±»ç¥–å…ˆ</strong><br>
                                        äººç±»å’Œé»‘çŒ©çŒ©çš„å…±åŒç¥–å…ˆåˆ†åŒ–
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- è‡ªç„¶é€‰æ‹©æ ‡ç­¾é¡µ -->
                    <div class="tab-panel" id="selection-panel">
                        <h2>è‡ªç„¶é€‰æ‹©æ¨¡æ‹Ÿå™¨</h2>
                        <div class="selection-simulator">
                            <div class="simulation-canvas">
                                <canvas id="selection-canvas" width="600" height="350"></canvas>
                            </div>
                            
                            <div class="simulation-controls">
                                <div class="control-group">
                                    <h4>ç¯å¢ƒå‹åŠ›</h4>
                                    <label>æ•é£Ÿå‹åŠ›</label>
                                    <input type="range" class="control-slider" id="predation-pressure" min="0" max="100" value="50">
                                    <div class="control-value" id="predation-value">50%</div>
                                </div>
                                
                                <div class="control-group">
                                    <h4>çªå˜ç‡</h4>
                                    <label>åŸºå› çªå˜</label>
                                    <input type="range" class="control-slider" id="mutation-rate" min="0" max="10" value="2">
                                    <div class="control-value" id="mutation-value">2%</div>
                                </div>
                                
                                <div class="control-group">
                                    <h4>ç§ç¾¤å¤§å°</h4>
                                    <label>ä¸ªä½“æ•°é‡</label>
                                    <input type="range" class="control-slider" id="population-size" min="50" max="500" value="200">
                                    <div class="control-value" id="population-value">200</div>
                                </div>
                                
                                <div class="control-group">
                                    <h4>é€‰æ‹©å¼ºåº¦</h4>
                                    <label>é€‚åº”æ€§å·®å¼‚</label>
                                    <input type="range" class="control-slider" id="selection-strength" min="0" max="100" value="30">
                                    <div class="control-value" id="selection-value">30%</div>
                                </div>
                            </div>

                            <div style="text-align: center;">
                                <button class="action-btn" id="start-evolution">å¼€å§‹è¿›åŒ–æ¨¡æ‹Ÿ</button>
                                <button class="action-btn secondary" id="reset-evolution">é‡ç½®æ¨¡æ‹Ÿ</button>
                            </div>
                        </div>
                    </div>

                    <!-- ç³»ç»Ÿå‘è‚²æ ‡ç­¾é¡µ -->
                    <div class="tab-panel" id="phylogeny-panel">
                        <h2>ç³»ç»Ÿå‘è‚²æ ‘</h2>
                        <div class="phylogenetic-tree">
                            <div class="tree-canvas">
                                <canvas id="phylogeny-canvas" width="600" height="450"></canvas>
                            </div>
                            
                            <div class="species-selector">
                                <div class="species-card selected" data-species="human">
                                    <div class="species-icon">ğŸ§‘</div>
                                    <div class="species-name">äººç±»</div>
                                </div>
                                <div class="species-card selected" data-species="chimp">
                                    <div class="species-icon">ğŸµ</div>
                                    <div class="species-name">é»‘çŒ©çŒ©</div>
                                </div>
                                <div class="species-card selected" data-species="dog">
                                    <div class="species-icon">ğŸ•</div>
                                    <div class="species-name">ç‹—</div>
                                </div>
                                <div class="species-card selected" data-species="cat">
                                    <div class="species-icon">ğŸ±</div>
                                    <div class="species-name">çŒ«</div>
                                </div>
                                <div class="species-card selected" data-species="mouse">
                                    <div class="species-icon">ğŸ­</div>
                                    <div class="species-name">å°é¼ </div>
                                </div>
                                <div class="species-card selected" data-species="bird">
                                    <div class="species-icon">ğŸ¦</div>
                                    <div class="species-name">é¸Ÿç±»</div>
                                </div>
                            </div>

                            <div style="text-align: center;">
                                <button class="action-btn" id="build-tree">æ„å»ºç³»ç»Ÿå‘è‚²æ ‘</button>
                                <button class="action-btn secondary" id="clear-tree">æ¸…ç©ºé€‰æ‹©</button>
                            </div>
                        </div>
                    </div>

                    <!-- é€‚åº”æ€§è¿›åŒ–æ ‡ç­¾é¡µ -->
                    <div class="tab-panel" id="adaptations-panel">
                        <h2>é€‚åº”æ€§è¿›åŒ–å®ä¾‹</h2>
                        <div class="adaptation-examples">
                            <div class="adaptation-grid">
                                <div class="adaptation-card">
                                    <div class="adaptation-header">
                                        <div class="adaptation-icon">ğŸ¦’</div>
                                        <div class="adaptation-title">é•¿é¢ˆé¹¿çš„é•¿è„–å­</div>
                                    </div>
                                    <div class="adaptation-description">
                                        é•¿é¢ˆé¹¿çš„é•¿è„–å­æ˜¯ä¸ºäº†é€‚åº”é«˜å¤„å–é£Ÿçš„ç¯å¢ƒå‹åŠ›è€Œè¿›åŒ–å‡ºçš„ç‰¹å¾ã€‚
                                    </div>
                                    <div class="adaptation-example">
                                        <strong>é€‚åº”æœºåˆ¶:</strong> é¢ˆæ¤å»¶é•¿ï¼Œè¡€ç®¡ç³»ç»Ÿç‰¹åŒ–ï¼Œèƒ½å¤Ÿå–é£Ÿé«˜å¤„çš„æ ‘å¶ï¼Œå‡å°‘ç«äº‰ã€‚
                                    </div>
                                </div>
                                
                                <div class="adaptation-card">
                                    <div class="adaptation-header">
                                        <div class="adaptation-icon">ğŸ§</div>
                                        <div class="adaptation-title">ä¼é¹…çš„æ¸¸æ³³é€‚åº”</div>
                                    </div>
                                    <div class="adaptation-description">
                                        ä¼é¹…å¤±å»é£è¡Œèƒ½åŠ›ï¼Œä½†è·å¾—äº†å“è¶Šçš„æ¸¸æ³³å’Œæ½œæ°´èƒ½åŠ›ã€‚
                                    </div>
                                    <div class="adaptation-example">
                                        <strong>é€‚åº”æœºåˆ¶:</strong> ç¿…è†€å˜æˆé³çŠ¶ï¼Œéª¨éª¼å¯†åº¦å¢åŠ ï¼Œç¾½æ¯›é˜²æ°´ï¼Œé€‚åº”æµ·æ´‹ç”Ÿæ´»ã€‚
                                    </div>
                                </div>
                                
                                <div class="adaptation-card">
                                    <div class="adaptation-header">
                                        <div class="adaptation-icon">ğŸŒµ</div>
                                        <div class="adaptation-title">ä»™äººæŒçš„æŠ—æ—±æ€§</div>
                                    </div>
                                    <div class="adaptation-description">
                                        ä»™äººæŒè¿›åŒ–å‡ºå¤šç§æŠ—æ—±ç‰¹å¾ï¼Œé€‚åº”å¹²æ—±çš„æ²™æ¼ ç¯å¢ƒã€‚
                                    </div>
                                    <div class="adaptation-example">
                                        <strong>é€‚åº”æœºåˆ¶:</strong> å¶ç‰‡å˜æˆåˆºï¼ŒèŒéƒ¨å‚¨æ°´ï¼Œè¡¨é¢èœ¡è´¨å±‚å‡å°‘æ°´åˆ†è’¸å‘ã€‚
                                    </div>
                                </div>
                                
                                <div class="adaptation-card">
                                    <div class="adaptation-header">
                                        <div class="adaptation-icon">ğŸ¦‡</div>
                                        <div class="adaptation-title">è™è çš„å›å£°å®šä½</div>
                                    </div>
                                    <div class="adaptation-description">
                                        è™è è¿›åŒ–å‡ºå›å£°å®šä½ç³»ç»Ÿï¼Œåœ¨é»‘æš—ä¸­ç²¾ç¡®å¯¼èˆªå’Œæ•é£Ÿã€‚
                                    </div>
                                    <div class="adaptation-example">
                                        <strong>é€‚åº”æœºåˆ¶:</strong> å‘å£°å™¨å®˜ç‰¹åŒ–ï¼Œå¬è§‰ç³»ç»Ÿæ•æ„Ÿï¼Œå¤§è„‘å¤„ç†å£°æ³¢ä¿¡æ¯ã€‚
                                    </div>
                                </div>
                                
                                <div class="adaptation-card">
                                    <div class="adaptation-header">
                                        <div class="adaptation-icon">ğŸŸ</div>
                                        <div class="adaptation-title">æ·±æµ·é±¼çš„å‘å…‰å™¨å®˜</div>
                                    </div>
                                    <div class="adaptation-description">
                                        æ·±æµ·é±¼ç±»è¿›åŒ–å‡ºç”Ÿç‰©å‘å…‰å™¨å®˜ï¼Œé€‚åº”é»‘æš—çš„æ·±æµ·ç¯å¢ƒã€‚
                                    </div>
                                    <div class="adaptation-example">
                                        <strong>é€‚åº”æœºåˆ¶:</strong> å‘å…‰ç»†èŒå…±ç”Ÿï¼ŒåŒ–å­¦å‘å…‰ååº”ï¼Œç”¨äºé€šè®¯å’Œæ•é£Ÿã€‚
                                    </div>
                                </div>
                                
                                <div class="adaptation-card">
                                    <div class="adaptation-header">
                                        <div class="adaptation-icon">ğŸ¦‹</div>
                                        <div class="adaptation-title">è´è¶çš„æ‹Ÿæ€</div>
                                    </div>
                                    <div class="adaptation-description">
                                        æŸäº›è´è¶è¿›åŒ–å‡ºæ‹Ÿæ€ç‰¹å¾ï¼Œæ¨¡ä»¿æœ‰æ¯’ç‰©ç§ä»¥é¿å…è¢«æ•é£Ÿã€‚
                                    </div>
                                    <div class="adaptation-example">
                                        <strong>é€‚åº”æœºåˆ¶:</strong> ç¿…è†€é¢œè‰²å’Œå›¾æ¡ˆæ¨¡ä»¿ï¼Œè¡Œä¸ºæ¨¡ä»¿ï¼Œè´æ°æ‹Ÿæ€å’Œç¼ªæ°æ‹Ÿæ€ã€‚
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- è¾¾å°”æ–‡ç†è®ºæ ‡ç­¾é¡µ -->
                    <div class="tab-panel" id="darwin-panel">
                        <h2>è¾¾å°”æ–‡çš„è¿›åŒ–ç†è®º</h2>
                        <div class="darwin-theory">
                            <div class="darwin-intro">
                                <div class="darwin-portrait">
                                    <img src="../../assets/images/darwin_portrait.jpg" alt="æŸ¥å°”æ–¯Â·è¾¾å°”æ–‡" class="darwin-img">
                                    <p class="caption">æŸ¥å°”æ–¯Â·ç½—ä¼¯ç‰¹Â·è¾¾å°”æ–‡ (1809-1882)</p>
                                </div>
                                <div class="darwin-summary">
                                    <h3>ã€Šç‰©ç§èµ·æºã€‹</h3>
                                    <p>è¾¾å°”æ–‡äº1859å¹´å‡ºç‰ˆçš„ã€Šç‰©ç§èµ·æºã€‹å½»åº•æ”¹å˜äº†æˆ‘ä»¬å¯¹ç”Ÿå‘½æ¼”åŒ–çš„ç†è§£ã€‚ä»–åœ¨å°çŒçŠ¬å·ä¸Šçš„äº”å¹´ç¯çƒèˆªè¡Œä¸­æ”¶é›†çš„è¯æ®ä¸ºä»–çš„é©å‘½æ€§ç†è®ºå¥ å®šäº†åŸºç¡€ã€‚</p>
                                    <div class="key-concepts">
                                        <h4>è¾¾å°”æ–‡è¿›åŒ–è®ºçš„å…³é”®æ¦‚å¿µï¼š</h4>
                                        <ul>
                                            <li><strong>å˜å¼‚å­˜åœ¨</strong>ï¼šç”Ÿç‰©ä½“å†…å­˜åœ¨è‡ªç„¶å˜å¼‚</li>
                                            <li><strong>é—ä¼ æ€§</strong>ï¼šç‰¹å¾å¯ä»¥é—ä¼ ç»™åä»£</li>
                                            <li><strong>è¿‡åº¦ç¹æ®–</strong>ï¼šç”Ÿç‰©äº§ç”Ÿçš„åä»£å¤šäºèƒ½å¤Ÿå­˜æ´»çš„æ•°é‡</li>
                                            <li><strong>èµ„æºæœ‰é™</strong>ï¼šç¯å¢ƒä¸­çš„èµ„æºæœ‰é™ï¼Œå¯¼è‡´ç”Ÿå­˜ç«äº‰</li>
                                            <li><strong>é€‚è€…ç”Ÿå­˜</strong>ï¼šæœ€é€‚åº”ç¯å¢ƒçš„ä¸ªä½“æ›´å¯èƒ½å­˜æ´»å¹¶ç¹æ®–</li>
                                            <li><strong>è‡ªç„¶é€‰æ‹©</strong>ï¼šç¯å¢ƒé€‰æ‹©æœ‰åˆ©ç‰¹å¾ï¼Œå¯¼è‡´ç‰©ç§é€æ¸å˜åŒ–</li>
                                            <li><strong>ç‰©ç§å½¢æˆ</strong>ï¼šéšç€æ—¶é—´æ¨ç§»ï¼Œç§ç¾¤å¯èƒ½åˆ†åŒ–æˆä¸åŒç‰©ç§</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="darwin-voyage">
                                <h3>å°çŒçŠ¬å·èˆªè¡Œ</h3>
                                <div class="voyage-map">
                                    <img src="../../assets/images/beagle_voyage.jpg" alt="å°çŒçŠ¬å·èˆªè¡Œè·¯çº¿" class="voyage-img">
                                </div>
                                <div class="voyage-observations">
                                    <h4>å…³é”®è§‚å¯Ÿï¼š</h4>
                                    <div class="observation-cards">
                                        <div class="observation-card">
                                            <h5>åŠ æ‹‰å¸•æˆˆæ–¯é›€</h5>
                                            <p>è¾¾å°”æ–‡åœ¨åŠ æ‹‰å¸•æˆˆæ–¯ç¾¤å²›è§‚å¯Ÿåˆ°13ç§é›€é¸Ÿï¼Œå®ƒä»¬çš„å–™éƒ¨å½¢çŠ¶é€‚åº”å„è‡ªçš„é£Ÿç‰©æ¥æºï¼Œè¿™æˆä¸ºé€‚åº”æ€§è¾å°„çš„ç»å…¸ä¾‹å­ã€‚</p>
                                        </div>
                                        <div class="observation-card">
                                            <h5>åŒ–çŸ³è®°å½•</h5>
                                            <p>è¾¾å°”æ–‡åœ¨å—ç¾å‘ç°çš„åŒ–çŸ³ä¸ç°å­˜ç‰©ç§æ—¢æœ‰ç›¸ä¼¼ä¹‹å¤„åˆæœ‰å·®å¼‚ï¼Œè¡¨æ˜ç‰©ç§éšæ—¶é—´å˜åŒ–ã€‚</p>
                                        </div>
                                        <div class="observation-card">
                                            <h5>åœ°ç†åˆ†å¸ƒ</h5>
                                            <p>è¾¾å°”æ–‡æ³¨æ„åˆ°ç›¸ä¼¼ä½†ä¸åŒçš„ç‰©ç§å¾€å¾€å‡ºç°åœ¨åœ°ç†ä¸Šéš”ç¦»çš„åŒºåŸŸï¼Œæš—ç¤ºå…±åŒç¥–å…ˆã€‚</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="darwin-impact">
                                <h3>è¾¾å°”æ–‡ç†è®ºçš„å½±å“</h3>
                                <div class="impact-timeline">
                                    <div class="impact-event">
                                        <div class="impact-year">1859</div>
                                        <div class="impact-description">ã€Šç‰©ç§èµ·æºã€‹å‡ºç‰ˆ</div>
                                    </div>
                                    <div class="impact-event">
                                        <div class="impact-year">1900å¹´ä»£åˆ</div>
                                        <div class="impact-description">å­Ÿå¾·å°”é—ä¼ å­¦çš„é‡æ–°å‘ç°ï¼Œä¸ºè‡ªç„¶é€‰æ‹©æä¾›é—ä¼ æœºåˆ¶</div>
                                    </div>
                                    <div class="impact-event">
                                        <div class="impact-year">1930-1940å¹´ä»£</div>
                                        <div class="impact-description">ç°ä»£ç»¼åˆç†è®ºç»“åˆè¾¾å°”æ–‡è¿›åŒ–è®ºä¸å­Ÿå¾·å°”é—ä¼ å­¦</div>
                                    </div>
                                    <div class="impact-event">
                                        <div class="impact-year">1950å¹´ä»£</div>
                                        <div class="impact-description">DNAç»“æ„å‘ç°ï¼Œæ­ç¤ºåˆ†å­æ°´å¹³çš„è¿›åŒ–æœºåˆ¶</div>
                                    </div>
                                    <div class="impact-event">
                                        <div class="impact-year">å½“ä»£</div>
                                        <div class="impact-description">åŸºå› ç»„å­¦å’Œç”Ÿç‰©ä¿¡æ¯å­¦ä¸ºè¿›åŒ–ç†è®ºæä¾›æ–°è§è§£</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- è¿›åŒ–è¯æ®æ ‡ç­¾é¡µ -->
                    <div class="tab-panel" id="evidence-panel">
                        <h2>è¿›åŒ–çš„å¤šé‡è¯æ®</h2>
                        <div class="evidence-container">
                            <div class="evidence-categories">
                                <div class="evidence-category" id="fossil-evidence">
                                    <div class="evidence-icon">
                                        <i class="fas fa-bone"></i>
                                    </div>
                                    <h3>åŒ–çŸ³è¯æ®</h3>
                                    <div class="evidence-content">
                                        <p>åŒ–çŸ³è®°å½•æä¾›äº†ç‰©ç§éšæ—¶é—´å˜åŒ–çš„ç›´æ¥è¯æ®ï¼Œå±•ç¤ºäº†è¿‡æ¸¡å½¢å¼å’Œç­ç»ç‰©ç§ã€‚</p>
                                        <div class="evidence-examples">
                                            <div class="evidence-example">
                                                <h4>é²¸ç±»è¿›åŒ–</h4>
                                                <p>åŒ–çŸ³æ˜¾ç¤ºé²¸ç±»ä»é™†ç”Ÿå“ºä¹³åŠ¨ç‰©è¿›åŒ–è€Œæ¥ï¼Œä¿ç•™äº†é€€åŒ–çš„åè‚¢éª¨éª¼ã€‚</p>
                                                <img src="../../assets/images/whale_evolution.jpg" alt="é²¸ç±»è¿›åŒ–" class="evidence-img">
                                            </div>
                                            <div class="evidence-example">
                                                <h4>å§‹ç¥–é¸Ÿ</h4>
                                                <p>å§‹ç¥–é¸Ÿæ˜¯çˆ¬è¡ŒåŠ¨ç‰©å’Œé¸Ÿç±»ä¹‹é—´çš„è¿‡æ¸¡å½¢å¼ï¼ŒåŒæ—¶å…·æœ‰çˆ¬è¡ŒåŠ¨ç‰©å’Œé¸Ÿç±»çš„ç‰¹å¾ã€‚</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="evidence-category" id="comparative-anatomy">
                                    <div class="evidence-icon">
                                        <i class="fas fa-hand-sparkles"></i>
                                    </div>
                                    <h3>æ¯”è¾ƒè§£å‰–å­¦</h3>
                                    <div class="evidence-content">
                                        <p>ä¸åŒç‰©ç§ä¹‹é—´çš„ç»“æ„ç›¸ä¼¼æ€§è¡¨æ˜å®ƒä»¬æœ‰å…±åŒçš„ç¥–å…ˆã€‚</p>
                                        <div class="evidence-examples">
                                            <div class="evidence-example">
                                                <h4>åŒæºç»“æ„</h4>
                                                <p>äººç±»æ‰‹è‡‚ã€é²¸é³ã€è™è ç¿¼å’ŒçŒ«è…¿éƒ½æœ‰ç›¸åŒçš„åŸºæœ¬éª¨éª¼ç»“æ„ï¼Œè¡¨æ˜å®ƒä»¬ä»å…±åŒç¥–å…ˆè¿›åŒ–è€Œæ¥ã€‚</p>
                                                <img src="../../assets/images/homologous_structures.jpg" alt="åŒæºç»“æ„" class="evidence-img">
                                            </div>
                                            <div class="evidence-example">
                                                <h4>ç—•è¿¹å™¨å®˜</h4>
                                                <p>å¦‚äººç±»çš„ç›²è‚ å’Œå°¾éª¨ç­‰ç»“æ„åœ¨å…¶ä»–åŠ¨ç‰©ä¸­æœ‰åŠŸèƒ½ï¼Œä½†åœ¨äººç±»ä¸­å·²é€€åŒ–ã€‚</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="evidence-category" id="molecular-evidence">
                                    <div class="evidence-icon">
                                        <i class="fas fa-dna"></i>
                                    </div>
                                    <h3>åˆ†å­è¯æ®</h3>
                                    <div class="evidence-content">
                                        <p>DNAå’Œè›‹ç™½è´¨åºåˆ—æ¯”è¾ƒä¸ºè¿›åŒ–å…³ç³»æä¾›äº†æœ€ç›´æ¥çš„è¯æ®ã€‚</p>
                                        <div class="evidence-examples">
                                            <div class="evidence-example">
                                                <h4>DNAåºåˆ—ç›¸ä¼¼æ€§</h4>
                                                <p>äººç±»å’Œé»‘çŒ©çŒ©çš„DNAåºåˆ—ç›¸ä¼¼åº¦çº¦ä¸º98.8%ï¼Œè¡¨æ˜å®ƒä»¬æœ‰å…±åŒçš„ç¥–å…ˆã€‚</p>
                                            </div>
                                            <div class="evidence-example">
                                                <h4>åˆ†å­é’Ÿ</h4>
                                                <p>åŸºäºDNAçªå˜ç‡çš„è®¡ç®—å¯ä»¥ä¼°è®¡ç‰©ç§åˆ†åŒ–çš„æ—¶é—´ã€‚</p>
                                                <img src="../../assets/images/molecular_clock.jpg" alt="åˆ†å­é’Ÿ" class="evidence-img">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="evidence-category" id="biogeographical-evidence">
                                    <div class="evidence-icon">
                                        <i class="fas fa-globe-americas"></i>
                                    </div>
                                    <h3>ç”Ÿç‰©åœ°ç†å­¦è¯æ®</h3>
                                    <div class="evidence-content">
                                        <p>ç‰©ç§çš„åœ°ç†åˆ†å¸ƒæ¨¡å¼æ”¯æŒè¿›åŒ–è®ºå’Œå¤§é™†æ¼‚ç§»ç†è®ºã€‚</p>
                                        <div class="evidence-examples">
                                            <div class="evidence-example">
                                                <h4>å²›å±¿ç”Ÿç‰©åœ°ç†å­¦</h4>
                                                <p>éš”ç¦»çš„å²›å±¿ä¸Šçš„ç‰©ç§å¾€å¾€ä¸æœ€è¿‘å¤§é™†çš„ç‰©ç§ç›¸ä¼¼ï¼Œä½†å…·æœ‰ç‰¹æ®Šé€‚åº”æ€§ã€‚</p>
                                            </div>
                                            <div class="evidence-example">
                                                <h4>å¤§é™†æ¼‚ç§»</h4>
                                                <p>ä¸åŒå¤§é™†ä¸Šçš„åŒ–çŸ³åˆ†å¸ƒæ”¯æŒå¤§é™†æ›¾ç»ç›¸è¿çš„ç†è®ºã€‚</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="evidence-quiz">
                                <h3>è¿›åŒ–è¯æ®æµ‹éªŒ</h3>
                                <div class="quiz-container" id="evidence-quiz-container">
                                    <button class="action-btn" id="start-evidence-quiz">å¼€å§‹æµ‹éªŒ</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <p class="copyright-text">study-llm.meåŸŸåä¸ºAlexæ‰€æœ‰ã€‚ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚</p>
            </div>
        </div>
    </footer>

    <script src="../../js/common.js"></script>
    <script src="../../js/navigation.js"></script>
    <script>
        // è¿›åŒ–è®ºåŠŸèƒ½
        class Evolution {
            constructor() {
                this.selectionCanvas = document.getElementById('selection-canvas');
                this.selectionCtx = this.selectionCanvas.getContext('2d');
                this.phylogenyCanvas = document.getElementById('phylogeny-canvas');
                this.phylogenyCtx = this.phylogenyCanvas.getContext('2d');
                
                this.isSimulating = false;
                this.generation = 0;
                this.population = [];
                this.selectedSpecies = ['human', 'chimp', 'dog', 'cat', 'mouse', 'bird'];
                
                this.initializeEventListeners();
                this.initializePopulation();
                this.drawPhylogeneticTree();
            }

            initializeEventListeners() {
                // æ ‡ç­¾é¡µåˆ‡æ¢
                document.querySelectorAll('.evolution-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        this.switchTab(e.target.dataset.tab);
                    });
                });

                // æ»‘å—æ§åˆ¶
                ['predation-pressure', 'mutation-rate', 'population-size', 'selection-strength'].forEach(id => {
                    document.getElementById(id).addEventListener('input', (e) => {
                        this.updateSliderValue(id, e.target.value);
                    });
                });

                // è¿›åŒ–æ¨¡æ‹Ÿæ§åˆ¶
                document.getElementById('start-evolution').addEventListener('click', () => {
                    this.startEvolutionSimulation();
                });

                document.getElementById('reset-evolution').addEventListener('click', () => {
                    this.resetEvolution();
                });

                // ç‰©ç§é€‰æ‹©
                document.querySelectorAll('.species-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        this.toggleSpecies(e.target.closest('.species-card'));
                    });
                });

                // ç³»ç»Ÿå‘è‚²æ ‘æ§åˆ¶
                document.getElementById('build-tree').addEventListener('click', () => {
                    this.buildPhylogeneticTree();
                });

                document.getElementById('clear-tree').addEventListener('click', () => {
                    this.clearSpeciesSelection();
                });
            }

            switchTab(tabName) {
                // æ›´æ–°æ ‡ç­¾é¡µçŠ¶æ€
                document.querySelectorAll('.evolution-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

                // æ˜¾ç¤ºå¯¹åº”é¢æ¿
                document.querySelectorAll('.tab-panel').forEach(panel => {
                    panel.classList.remove('active');
                });
                document.getElementById(`${tabName}-panel`).classList.add('active');
            }

            updateSliderValue(sliderId, value) {
                const valueId = sliderId.replace('-', '-') + '-value';
                const suffix = sliderId.includes('size') ? '' : '%';
                document.getElementById(valueId).textContent = value + suffix;
            }

            initializePopulation() {
                this.population = [];
                const size = parseInt(document.getElementById('population-size').value);
                
                for (let i = 0; i < size; i++) {
                    this.population.push({
                        x: Math.random() * 500,
                        y: Math.random() * 300,
                        color: this.randomColor(),
                        size: 3 + Math.random() * 4,
                        fitness: Math.random(),
                        speed: 1 + Math.random() * 2
                    });
                }
                
                this.generation = 0;
                this.drawPopulation();
            }

            randomColor() {
                const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3'];
                return colors[Math.floor(Math.random() * colors.length)];
            }

            drawPopulation() {
                this.selectionCtx.clearRect(0, 0, this.selectionCanvas.width, this.selectionCanvas.height);
                
                // ç»˜åˆ¶èƒŒæ™¯
                this.selectionCtx.fillStyle = '#f0f8f0';
                this.selectionCtx.fillRect(0, 0, this.selectionCanvas.width, this.selectionCanvas.height);
                
                // ç»˜åˆ¶ä¸ªä½“
                this.population.forEach(individual => {
                    this.selectionCtx.fillStyle = individual.color;
                    this.selectionCtx.beginPath();
                    this.selectionCtx.arc(individual.x, individual.y, individual.size, 0, 2 * Math.PI);
                    this.selectionCtx.fill();
                });
                
                // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
                this.selectionCtx.fillStyle = '#333';
                this.selectionCtx.font = '16px Arial';
                this.selectionCtx.fillText(`ç¬¬ ${this.generation} ä»£`, 10, 25);
                this.selectionCtx.fillText(`ç§ç¾¤å¤§å°: ${this.population.length}`, 10, 45);
                
                const avgFitness = this.population.reduce((sum, ind) => sum + ind.fitness, 0) / this.population.length;
                this.selectionCtx.fillText(`å¹³å‡é€‚åº”åº¦: ${avgFitness.toFixed(2)}`, 10, 65);
            }

            startEvolutionSimulation() {
                if (this.isSimulating) return;
                
                this.isSimulating = true;
                
                const evolve = () => {
                    if (!this.isSimulating) return;
                    
                    this.runSelection();
                    this.reproduce();
                    this.mutate();
                    this.generation++;
                    this.drawPopulation();
                    
                    setTimeout(evolve, 500);
                };
                
                evolve();
            }

            runSelection() {
                const predationPressure = parseInt(document.getElementById('predation-pressure').value) / 100;
                const selectionStrength = parseInt(document.getElementById('selection-strength').value) / 100;
                
                // è®¡ç®—é€‚åº”åº¦
                this.population.forEach(individual => {
                    // åŸºäºé¢œè‰²ã€å¤§å°ç­‰ç‰¹å¾è®¡ç®—é€‚åº”åº¦
                    let fitness = individual.fitness;
                    
                    // ç¯å¢ƒå‹åŠ›å½±å“
                    if (predationPressure > 0.5) {
                        // é«˜æ•é£Ÿå‹åŠ›ä¸‹ï¼Œè¾ƒå°çš„ä¸ªä½“æ›´å®¹æ˜“ç”Ÿå­˜
                        fitness *= (1 - (individual.size - 3) / 4 * selectionStrength);
                    } else {
                        // ä½æ•é£Ÿå‹åŠ›ä¸‹ï¼Œè¾ƒå¤§çš„ä¸ªä½“ç«äº‰ä¼˜åŠ¿æ›´å¤§
                        fitness *= (1 + (individual.size - 3) / 4 * selectionStrength);
                    }
                    
                    individual.fitness = Math.max(0.1, fitness);
                });
                
                // é€‰æ‹©ç”Ÿå­˜è€…
                this.population.sort((a, b) => b.fitness - a.fitness);
                const survivors = Math.floor(this.population.length * 0.7);
                this.population = this.population.slice(0, survivors);
            }

            reproduce() {
                const targetSize = parseInt(document.getElementById('population-size').value);
                const offspring = [];
                
                while (this.population.length + offspring.length < targetSize) {
                    // é€‰æ‹©çˆ¶æ¯ï¼ˆé€‚åº”åº¦è¶Šé«˜ï¼Œè¢«é€‰ä¸­æ¦‚ç‡è¶Šå¤§ï¼‰
                    const parent1 = this.selectParent();
                    const parent2 = this.selectParent();
                    
                    // äº§ç”Ÿåä»£
                    const child = {
                        x: Math.random() * 500,
                        y: Math.random() * 300,
                        color: Math.random() < 0.5 ? parent1.color : parent2.color,
                        size: (parent1.size + parent2.size) / 2 + (Math.random() - 0.5) * 0.5,
                        fitness: (parent1.fitness + parent2.fitness) / 2,
                        speed: (parent1.speed + parent2.speed) / 2
                    };
                    
                    offspring.push(child);
                }
                
                this.population = this.population.concat(offspring);
            }

            selectParent() {
                const totalFitness = this.population.reduce((sum, ind) => sum + ind.fitness, 0);
                let random = Math.random() * totalFitness;
                
                for (let individual of this.population) {
                    random -= individual.fitness;
                    if (random <= 0) {
                        return individual;
                    }
                }
                
                return this.population[this.population.length - 1];
            }

            mutate() {
                const mutationRate = parseInt(document.getElementById('mutation-rate').value) / 100;
                
                this.population.forEach(individual => {
                    if (Math.random() < mutationRate) {
                        // éšæœºçªå˜
                        if (Math.random() < 0.3) {
                            individual.color = this.randomColor();
                        }
                        if (Math.random() < 0.3) {
                            individual.size += (Math.random() - 0.5) * 1;
                            individual.size = Math.max(1, Math.min(8, individual.size));
                        }
                        if (Math.random() < 0.3) {
                            individual.fitness += (Math.random() - 0.5) * 0.2;
                            individual.fitness = Math.max(0.1, Math.min(1, individual.fitness));
                        }
                    }
                });
            }

            resetEvolution() {
                this.isSimulating = false;
                this.initializePopulation();
            }

            toggleSpecies(card) {
                const species = card.dataset.species;
                
                if (card.classList.contains('selected')) {
                    card.classList.remove('selected');
                    this.selectedSpecies = this.selectedSpecies.filter(s => s !== species);
                } else {
                    card.classList.add('selected');
                    this.selectedSpecies.push(species);
                }
            }

            buildPhylogeneticTree() {
                this.drawPhylogeneticTree();
            }

            drawPhylogeneticTree() {
                this.phylogenyCtx.clearRect(0, 0, this.phylogenyCanvas.width, this.phylogenyCanvas.height);
                
                if (this.selectedSpecies.length === 0) return;
                
                // ç‰©ç§æ•°æ®
                const speciesData = {
                    'human': { name: 'äººç±»', icon: 'ğŸ§‘', divergence: 7 },
                    'chimp': { name: 'é»‘çŒ©çŒ©', icon: 'ğŸµ', divergence: 7 },
                    'dog': { name: 'ç‹—', icon: 'ğŸ•', divergence: 95 },
                    'cat': { name: 'çŒ«', icon: 'ğŸ±', divergence: 95 },
                    'mouse': { name: 'å°é¼ ', icon: 'ğŸ­', divergence: 95 },
                    'bird': { name: 'é¸Ÿç±»', icon: 'ğŸ¦', divergence: 310 }
                };
                
                // ç»˜åˆ¶æ ‘ç»“æ„
                const treeHeight = 400;
                const treeWidth = 500;
                const startX = 50;
                const startY = treeHeight - 50;
                
                // ä¸»å¹²
                this.phylogenyCtx.strokeStyle = '#4caf50';
                this.phylogenyCtx.lineWidth = 3;
                this.phylogenyCtx.beginPath();
                this.phylogenyCtx.moveTo(startX, startY);
                this.phylogenyCtx.lineTo(startX, 50);
                this.phylogenyCtx.stroke();
                
                // ç»˜åˆ¶åˆ†æ”¯
                const selectedData = this.selectedSpecies.map(s => ({ species: s, ...speciesData[s] }));
                selectedData.sort((a, b) => a.divergence - b.divergence);
                
                let currentY = startY;
                const branchSpacing = (treeHeight - 100) / selectedData.length;
                
                selectedData.forEach((data, index) => {
                    const branchY = startY - (index + 1) * branchSpacing;
                    const branchX = startX + data.divergence * 1.5;
                    
                    // æ°´å¹³åˆ†æ”¯
                    this.phylogenyCtx.beginPath();
                    this.phylogenyCtx.moveTo(startX, branchY);
                    this.phylogenyCtx.lineTo(branchX, branchY);
                    this.phylogenyCtx.stroke();
                    
                    // ç‰©ç§æ ‡ç­¾
                    this.phylogenyCtx.fillStyle = '#333';
                    this.phylogenyCtx.font = '16px Arial';
                    this.phylogenyCtx.fillText(data.icon + ' ' + data.name, branchX + 10, branchY + 5);
                    
                    // æ—¶é—´æ ‡ç­¾
                    this.phylogenyCtx.fillStyle = '#666';
                    this.phylogenyCtx.font = '12px Arial';
                    this.phylogenyCtx.fillText(data.divergence + 'ç™¾ä¸‡å¹´å‰', branchX + 10, branchY + 20);
                });
                
                // æ ‡é¢˜
                this.phylogenyCtx.fillStyle = '#333';
                this.phylogenyCtx.font = '18px Arial';
                this.phylogenyCtx.fillText('ç³»ç»Ÿå‘è‚²æ ‘', 250, 30);
                
                // æ—¶é—´è½´
                this.phylogenyCtx.fillStyle = '#666';
                this.phylogenyCtx.font = '12px Arial';
                this.phylogenyCtx.fillText('æ—¶é—´ (ç™¾ä¸‡å¹´å‰)', 10, treeHeight - 10);
            }

            clearSpeciesSelection() {
                this.selectedSpecies = [];
                document.querySelectorAll('.species-card').forEach(card => {
                    card.classList.remove('selected');
                });
                this.phylogenyCtx.clearRect(0, 0, this.phylogenyCanvas.width, this.phylogenyCanvas.height);
            }

            addSpeciesToTree() {
                // æ·»åŠ ç‰©ç§åˆ°ç³»ç»Ÿå‘è‚²æ ‘...
            }

            clearTree() {
                // æ¸…ç©ºç³»ç»Ÿå‘è‚²æ ‘...
            }

            // è¾¾å°”æ–‡ç†è®ºå’Œè¿›åŒ–è¯æ®ç›¸å…³æ–¹æ³•
            setupDarwinTab() {
                // æ£€æŸ¥å›¾ç‰‡æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æ˜¾ç¤ºæ›¿ä»£å†…å®¹
                const darwinImg = document.querySelector('.darwin-img');
                const voyageImg = document.querySelector('.voyage-img');
                
                darwinImg.onerror = function() {
                    this.src = '../../assets/images/placeholder.jpg';
                    document.querySelector('.caption').textContent = "æŸ¥å°”æ–¯Â·è¾¾å°”æ–‡è‚–åƒ";
                };
                
                voyageImg.onerror = function() {
                    this.src = '../../assets/images/placeholder.jpg';
                    const mapContainer = this.parentElement;
                    mapContainer.innerHTML += '<p class="map-caption">å°çŒçŠ¬å·ç¯çƒèˆªè¡Œè·¯çº¿ (1831-1836)</p>';
                };
            }
            
            setupEvidenceTab() {
                // åˆå§‹åŒ–è¯æ®å¡ç‰‡äº¤äº’
                const evidenceCategories = document.querySelectorAll('.evidence-category');
                evidenceCategories.forEach(category => {
                    category.addEventListener('click', () => {
                        this.expandEvidenceCategory(category);
                    });
                });
                
                // æ£€æŸ¥å›¾ç‰‡æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æ˜¾ç¤ºæ›¿ä»£å†…å®¹
                const evidenceImages = document.querySelectorAll('.evidence-img');
                evidenceImages.forEach(img => {
                    img.onerror = function() {
                        this.src = '../../assets/images/placeholder.jpg';
                    };
                });
                
                // åˆå§‹åŒ–è¿›åŒ–è¯æ®æµ‹éªŒ
                document.getElementById('start-evidence-quiz').addEventListener('click', () => {
                    this.startEvidenceQuiz();
                });
            }
            
            expandEvidenceCategory(category) {
                // å±•å¼€/æ”¶èµ·è¯æ®å¡ç‰‡
                const isExpanded = category.classList.contains('expanded');
                
                // å…ˆé‡ç½®æ‰€æœ‰å¡ç‰‡
                document.querySelectorAll('.evidence-category').forEach(c => {
                    c.classList.remove('expanded');
                });
                
                // åˆ‡æ¢å½“å‰å¡ç‰‡çŠ¶æ€
                if (!isExpanded) {
                    category.classList.add('expanded');
                }
            }
            
            startEvidenceQuiz() {
                // åˆ›å»ºè¿›åŒ–è¯æ®æµ‹éªŒé—®é¢˜
                const quizQuestions = [
                    {
                        question: "åŒ–çŸ³è®°å½•æä¾›äº†ä»€ä¹ˆç±»å‹çš„è¿›åŒ–è¯æ®ï¼Ÿ",
                        options: [
                            "ç‰©ç§éšæ—¶é—´å˜åŒ–çš„ç›´æ¥è¯æ®",
                            "ä¸åŒç‰©ç§ä¹‹é—´çš„DNAç›¸ä¼¼æ€§",
                            "ç”Ÿç‰©çš„åœ°ç†åˆ†å¸ƒæ¨¡å¼",
                            "ç”Ÿç‰©ä½“ç»“æ„çš„ç›¸ä¼¼æ€§"
                        ],
                        correct: 0
                    },
                    {
                        question: "äººç±»æ‰‹è‡‚ã€é²¸é³å’Œè™è ç¿¼çš„éª¨éª¼ç»“æ„ç›¸ä¼¼æ€§è¢«ç§°ä¸ºä»€ä¹ˆï¼Ÿ",
                        options: [
                            "è¶‹åŒè¿›åŒ–",
                            "åŒæºç»“æ„",
                            "ç›¸ä¼¼å™¨å®˜",
                            "ç—•è¿¹å™¨å®˜"
                        ],
                        correct: 1
                    },
                    {
                        question: "äººç±»ä¸é»‘çŒ©çŒ©çš„DNAåºåˆ—ç›¸ä¼¼åº¦çº¦ä¸ºå¤šå°‘ï¼Ÿ",
                        options: [
                            "70%",
                            "85%",
                            "98.8%",
                            "50%"
                        ],
                        correct: 2
                    },
                    {
                        question: "è¾¾å°”æ–‡åœ¨å“ªä¸ªç¾¤å²›è§‚å¯Ÿåˆ°çš„é›€é¸Ÿä¸ºä»–çš„è¿›åŒ–ç†è®ºæä¾›äº†é‡è¦è¯æ®ï¼Ÿ",
                        options: [
                            "å¤å¨å¤·ç¾¤å²›",
                            "åŠ æ‹‰å¸•æˆˆæ–¯ç¾¤å²›",
                            "é©¬å°”ä»£å¤«ç¾¤å²›",
                            "å¤§æºªåœ°ç¾¤å²›"
                        ],
                        correct: 1
                    },
                    {
                        question: "ä»¥ä¸‹å“ªä¸€é¡¹ä¸æ˜¯è¾¾å°”æ–‡è‡ªç„¶é€‰æ‹©ç†è®ºçš„å…³é”®æ¦‚å¿µï¼Ÿ",
                        options: [
                            "ä¸ªä½“é—´å­˜åœ¨å˜å¼‚",
                            "é€‚åº”ç¯å¢ƒçš„ç‰¹å¾ç”±æ‹‰é©¬å…‹è·å¾—æ€§é—ä¼ ",
                            "èµ„æºæœ‰é™å¯¼è‡´ç”Ÿå­˜ç«äº‰",
                            "æœ‰åˆ©ç‰¹å¾çš„ä¸ªä½“æ›´å¯èƒ½å­˜æ´»å¹¶ç¹æ®–"
                        ],
                        correct: 1
                    }
                ];
                
                let currentQuestion = 0;
                let score = 0;
                
                const showQuestion = () => {
                    if (currentQuestion >= quizQuestions.length) {
                        // æ˜¾ç¤ºæµ‹éªŒç»“æœ
                        const resultPercentage = Math.round((score / quizQuestions.length) * 100);
                        const quizContainer = document.getElementById('evidence-quiz-container');
                        
                        quizContainer.innerHTML = `
                            <h3>æµ‹éªŒå®Œæˆ!</h3>
                            <p>æ‚¨çš„å¾—åˆ†: ${score}/${quizQuestions.length} (${resultPercentage}%)</p>
                            <button class="action-btn" onclick="window.evolution.startEvidenceQuiz()">é‡æ–°æµ‹éªŒ</button>
                        `;
                        return;
                    }
                    
                    const question = quizQuestions[currentQuestion];
                    const quizContainer = document.getElementById('evidence-quiz-container');
                    
                    quizContainer.innerHTML = `
                        <div class="quiz-question">
                            <h4>é—®é¢˜ ${currentQuestion + 1}/${quizQuestions.length}</h4>
                            <p>${question.question}</p>
                            <div class="quiz-options">
                                ${question.options.map((option, index) => `
                                    <div class="quiz-option" onclick="window.evolution.answerEvidenceQuestion(${index})">
                                        ${option}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                };
                
                // å¼€å§‹æµ‹éªŒ
                showQuestion();
                
                // å°†å‡½æ•°æš´éœ²ç»™å…¨å±€ï¼Œä»¥ä¾¿é€‰é¡¹ç‚¹å‡»å¤„ç†
                window.evolution = window.evolution || {};
                window.evolution.answerEvidenceQuestion = (selectedIndex) => {
                    const question = quizQuestions[currentQuestion];
                    const options = document.querySelectorAll('.quiz-option');
                    
                    // æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
                    options.forEach((option, index) => {
                        if (index === question.correct) {
                            option.classList.add('correct');
                        } else if (index === selectedIndex && index !== question.correct) {
                            option.classList.add('incorrect');
                        }
                    });
                    
                    // æ›´æ–°å¾—åˆ†
                    if (selectedIndex === question.correct) {
                        score++;
                    }
                    
                    // å»¶è¿Ÿè¿›å…¥ä¸‹ä¸€é¢˜
                    setTimeout(() => {
                        currentQuestion++;
                        showQuestion();
                    }, 1500);
                };
                
                window.evolution.startEvidenceQuiz = this.startEvidenceQuiz.bind(this);
            }
        }

        // é¡µé¢åŠ è½½ååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            const evolution = new Evolution();
            window.evolution = evolution;
            
            // åˆå§‹åŒ–è¾¾å°”æ–‡ç†è®ºå’Œè¿›åŒ–è¯æ®æ ‡ç­¾é¡µ
            evolution.setupDarwinTab();
            evolution.setupEvidenceTab();
        });
    </script>
</body>
</html> 