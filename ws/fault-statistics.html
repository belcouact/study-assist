<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•…éšœç»Ÿè®¡</title>
    <link rel="icon" href="../assets/icons/alex.ico" type="image/x-icon">
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/responsive.css">
    <script src="language.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background-color: #f5f5f5;
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* å¯¼èˆªæ æ ·å¼ */
        header {
            background-color: #2c3e50;
            color: white;
            padding: 1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
        }
        
        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .page-title {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .nav-menu {
            display: flex;
            gap: 1.5rem;
        }
        
        .nav-menu a {
            color: white;
            text-decoration: none;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .nav-menu a:hover {
            background-color: #34495e;
        }
        
        /* ä¸»å†…å®¹åŒºåŸŸ */
        main {
            flex: 1;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            margin-top: 60px; /* ä¸ºå›ºå®šå¯¼èˆªæ ç•™å‡ºç©ºé—´ */
        }
        
        .content-header {
            margin-bottom: 2rem;
        }
        
        .content-title {
            font-size: 1.8rem;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }
        
        .content-description {
            color: #7f8c8d;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .chart-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .chart-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .chart-filter {
            display: flex;
            gap: 0.5rem;
        }
        
        .filter-select {
            padding: 0.5rem 1rem;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: border-color 0.3s;
            min-width: 120px;
        }
        
        .filter-select:hover {
            border-color: #3498db;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .filter-button {
            padding: 0.5rem 1rem;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .filter-button:hover {
            background-color: #e9ecef;
        }
        
        .filter-button.active {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .chart-placeholder {
            height: 300px;
            background-color: #f8f9fa;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #7f8c8d;
        }
        
        .table-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 1.5rem;
            overflow-x: auto;
        }
        
        .stats-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .stats-table th, .stats-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .stats-table th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        
        .stats-table tr:hover {
            background-color: #f5f5f5;
        }
        
        .trend-up {
            color: #e74c3c;
        }
        
        .trend-down {
            color: #2ecc71;
        }
        
        /* é¡µè„šæ ·å¼ */
        footer {
            background-color: #2c3e50;
            color: white;
            padding: 1rem;
            text-align: center;
        }
        
        .footer-divider {
            border-top: 1px solid #34495e;
            margin-bottom: 1rem;
        }
        
        .footer-text {
            font-size: 0.9rem;
            color: #ecf0f1;
        }
        
        /* ç§»åŠ¨ç«¯å“åº”å¼è®¾è®¡ */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .mobile-menu-toggle {
                display: block;
                position: absolute;
                right: 1rem;
                top: 1rem;
            }
            
            .nav-menu {
                flex-direction: column;
                width: 100%;
                margin-top: 1rem;
                display: none;
            }
            
            .nav-menu.active {
                display: flex;
            }
            
            .stats-container {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 1rem;
            }
            
            .chart-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .chart-filter {
                width: 100%;
                overflow-x: auto;
            }
            
            main {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="nav-container">
            <div class="page-title" data-lang="page-title">æˆˆå°”è®¾å¤‡æ•…éšœç®¡ç†</div>
            <button class="mobile-menu-toggle" id="mobileMenuToggle">â˜°</button>
            <nav class="nav-menu" id="navMenu">
                <a href="index.html" data-lang="nav-home">é¦–é¡µ</a>
                <a href="fault-list.html" data-lang="nav-fault-list">æ•…éšœåˆ—è¡¨</a>
                <a href="new-fault.html" data-lang="nav-new-fault">æ–°å»ºæ•…éšœ</a>
                <a href="fault-statistics.html" data-lang="nav-fault-stats">æ•…éšœç»Ÿè®¡</a>
                <a href="info-management.html" data-lang="nav-info-mgmt">ä¿¡æ¯ç®¡ç†</a>
            </nav>
        </div>
    </header>
    
    <main>
        <div class="content-header">
            <h1 class="content-title" data-lang="fault-stats-title">æ•…éšœç»Ÿè®¡</h1>
            <p class="content-description" data-lang="fault-stats-description">æŸ¥çœ‹è®¾å¤‡æ•…éšœæ•°æ®åˆ†æä¸è¶‹åŠ¿</p>
        </div>
        
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-icon">ğŸ“Š</div>
                <div class="stat-value" id="totalFaults">-</div>
                <div class="stat-label" data-lang="stat-total-faults">æ•…éšœæ€»æ•°</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">ğŸ”„</div>
                <div class="stat-value" id="inProgressFaults">-</div>
                <div class="stat-label" data-lang="stat-processing">å¤„ç†ä¸­</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">â³</div>
                <div class="stat-value" id="pendingFaults">-</div>
                <div class="stat-label" data-lang="stat-pending">å¾…å¤„ç†</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">ğŸš¨</div>
                <div class="stat-value" id="urgentFaults">-</div>
                <div class="stat-label" data-lang="stat-urgent">ç´§æ€¥æ•…éšœæ•°</div>
            </div>
        </div>
        
        <div class="chart-container">
            <div class="chart-header">
                <h2 class="chart-title" data-lang="chart-distribution-title">æ•…éšœåˆ†å¸ƒ</h2>
                <div class="chart-filter">
                    <select id="faultTypeFilter" class="filter-select">
                            <option value="faultCategory" data-lang="filter-category">æ•…éšœåˆ†ç±»</option>
                            <option value="plant" data-lang="filter-plant">å·¥å‚</option>
                            <option value="equipmentName" data-lang="filter-equipment">æ•…éšœè®¾å¤‡</option>
                            <option value="faultArea" data-lang="filter-area">æ•…éšœåŒºåŸŸ</option>
                            <option value="faultLevel" data-lang="filter-level">æ•…éšœç­‰çº§</option>
                            <option value="reporter" data-lang="filter-reporter">æŠ¥å‘Šäºº</option>
                            <option value="status" data-lang="filter-status">çŠ¶æ€</option>
                        </select>
                </div>
            </div>
            <div id="faultTypeChart" class="chart-placeholder">
                <p data-lang="chart-distribution-placeholder">æ•…éšœç±»å‹åˆ†å¸ƒå›¾è¡¨å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
            </div>
        </div>
        
        <div class="chart-container">
            <div class="chart-header">
                <h2 class="chart-title" data-lang="chart-trend-title">æ•…éšœæ—¶é—´è¶‹åŠ¿</h2>
                <div class="chart-filter">
                    <select id="trendFilter" class="filter-select">
                            <option value="month" data-lang="filter-month">æŒ‰æœˆç»Ÿè®¡</option>
                            <option value="quarter" data-lang="filter-quarter">æŒ‰å­£åº¦ç»Ÿè®¡</option>
                            <option value="year" data-lang="filter-year">æŒ‰å¹´ç»Ÿè®¡</option>
                        </select>
                </div>
            </div>
            <div id="trendChart" class="chart-placeholder">
                <p data-lang="chart-trend-placeholder">æ•…éšœæ—¶é—´è¶‹åŠ¿å›¾è¡¨å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
            </div>
        </div>
        
    </main>
    
    <footer>
        <div class="footer-text">ç½‘é¡µåŸºäºæ™ºè°±å¤§æ¨¡å‹GLM-4.5åˆ›å»º</div>
    </footer>
    
    <script>
        // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
        document.getElementById('mobileMenuToggle').addEventListener('click', function() {
            const navMenu = document.getElementById('navMenu');
            navMenu.classList.toggle('active');
        });
        
        // ç‚¹å‡»é¡µé¢ä»»æ„ä½ç½®éšè—å¯¼èˆªèœå•
        document.addEventListener('click', function(event) {
            const navMenu = document.getElementById('navMenu');
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            
            // å¦‚æœç‚¹å‡»çš„ä¸æ˜¯èœå•æŒ‰é’®ä¸”èœå•æ˜¯å±•å¼€çŠ¶æ€ï¼Œåˆ™å…³é—­èœå•
            if (!mobileMenuToggle.contains(event.target) && navMenu.classList.contains('active')) {
                navMenu.classList.remove('active');
            }
        });
        
        // å›¾è¡¨ç­›é€‰æŒ‰é’®åˆ‡æ¢
        document.querySelectorAll('.filter-button').forEach(button => {
            button.addEventListener('click', function() {
                document.querySelectorAll('.filter-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                
                // å¦‚æœæ˜¯è®¾å¤‡/åŒºåŸŸåˆ†å¸ƒçš„ç­›é€‰æŒ‰é’®ï¼Œæ›´æ–°å›¾è¡¨
                if (this.closest('.chart-header').querySelector('.chart-title').textContent === 'æ•…éšœè®¾å¤‡å’ŒåŒºåŸŸåˆ†å¸ƒ') {
                    updateEquipmentAreaChart(this.textContent);
                }
            });
        });
        
        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            fetchFaultData();
            
            // æ·»åŠ ä¸‹æ‹‰ç­›é€‰å™¨äº‹ä»¶ç›‘å¬
            const filterSelect = document.getElementById('faultTypeFilter');
            if (filterSelect) {
                filterSelect.addEventListener('change', function() {
                    updateFaultTypeChart(this.value);
                });
            }
            
            // æ·»åŠ è¶‹åŠ¿å›¾è¡¨ç­›é€‰å™¨äº‹ä»¶ç›‘å¬
            const trendFilter = document.getElementById('trendFilter');
            if (trendFilter) {
                trendFilter.addEventListener('change', function() {
                    updateTrendChart(this.value);
                });
            }
            
            // ç§»é™¤è®¿å®¢è®¿é—®æ§åˆ¶ - ä¿¡æ¯ç®¡ç†é“¾æ¥å¯¹æ‰€æœ‰ç”¨æˆ·å¯è§
        });
        
        // ä»KVæ•°æ®é›†è·å–æ•…éšœæ•°æ®
        async function fetchFaultData() {
            try {
                const response = await fetch('https://study-llm.me/ws/api/faults');
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                
                const faults = await response.json();
                updateStatisticsCards(faults);
                initFaultTypeChart(faults);
                initTrendChart(faults);
            } catch (error) {
                console.error('è·å–æ•…éšœæ•°æ®å¤±è´¥:', error);
                // å¦‚æœAPIä¸å¯ç”¨ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                const mockFaults = generateMockFaultData();
                updateStatisticsCards(mockFaults);
                initFaultTypeChart(mockFaults);
                initTrendChart(mockFaults);
            }
        }
        
        // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®ï¼ˆä»…ç”¨äºæ¼”ç¤ºï¼Œå®é™…åº”ç”¨ä¸­åº”ä½¿ç”¨çœŸå®æ•°æ®ï¼‰
        function generateMockFaultData() {
            const plants = ['å·¥å‚A', 'å·¥å‚B', 'å·¥å‚C'];
            const equipmentNames = ['ç”Ÿäº§çº¿1', 'ç”Ÿäº§çº¿2', 'æ£€æµ‹ä»ª1', 'æ£€æµ‹ä»ª2', 'ä¼ é€å¸¦1', 'ä¼ é€å¸¦2'];
            const faultAreas = ['åŒºåŸŸ1', 'åŒºåŸŸ2', 'åŒºåŸŸ3'];
            const faultCategories = ['ç”µæ°”', 'æœºæ¢°', 'è½¯ä»¶', 'å…¶ä»–'];
            const faultLevels = ['ä½', 'ä¸­', 'é«˜', 'ç´§æ€¥'];
            const statuses = ['pending', 'in-progress', 'resolved'];
            const reporters = ['å¼ ä¸‰', 'æå››', 'ç‹äº”', 'èµµå…­', 'é’±ä¸ƒ', 'å­™å…«'];
            
            const mockFaults = [];
            for (let i = 0; i < 30; i++) {
                mockFaults.push({
                    id: `fault-${i}`,
                    plant: plants[Math.floor(Math.random() * plants.length)],
                    equipmentName: equipmentNames[Math.floor(Math.random() * equipmentNames.length)],
                    faultArea: faultAreas[Math.floor(Math.random() * faultAreas.length)],
                    faultCategory: faultCategories[Math.floor(Math.random() * faultCategories.length)],
                    faultLevel: faultLevels[Math.floor(Math.random() * faultLevels.length)],
                    status: statuses[Math.floor(Math.random() * statuses.length)],
                    reporter: reporters[Math.floor(Math.random() * reporters.length)],
                    reportTime: new Date(Date.now() - Math.floor(Math.random() * 30 * 24 * 60 * 60 * 1000)).toISOString()
                });
            }
            return mockFaults;
        }
        
        // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
        function updateStatisticsCards(faults) {
            const totalFaults = faults.length;
            const inProgressFaults = faults.filter(f => f.status === 'processing').length;
            const pendingFaults = faults.filter(f => f.status === 'pending').length;
            const urgentFaults = faults.filter(f => f.faultLevel === 'urgent' && f.status !== 'resolved').length;
            
            document.getElementById('totalFaults').textContent = totalFaults;
            document.getElementById('inProgressFaults').textContent = inProgressFaults;
            document.getElementById('pendingFaults').textContent = pendingFaults;
            document.getElementById('urgentFaults').textContent = urgentFaults;
        }
        
        // å…¨å±€å˜é‡å­˜å‚¨æ•…éšœæ•°æ®
        let globalFaultsData = [];
        
        // åˆå§‹åŒ–æ•…éšœç±»å‹åˆ†å¸ƒå›¾è¡¨ï¼ˆæ”¯æŒä¸‹æ‹‰ç­›é€‰ï¼‰
        function initFaultTypeChart(faults) {
            globalFaultsData = faults; // å­˜å‚¨æ•°æ®ä¾›åç»­ä½¿ç”¨
            updateFaultTypeChart('faultCategory'); // é»˜è®¤æŒ‰æ•…éšœåˆ†ç±»æ˜¾ç¤º
        }
        
        // æ›´æ–°æ•…éšœç±»å‹åˆ†å¸ƒå›¾è¡¨ï¼ˆæ ¹æ®ç­›é€‰æ¡ä»¶ï¼‰
        function updateFaultTypeChart(filterType) {
            const chartDom = document.getElementById('faultTypeChart');
            const myChart = echarts.init(chartDom);
            
            if (!globalFaultsData || globalFaultsData.length === 0) {
                // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œé‡æ–°è·å–
                fetch('https://study-llm.me/ws/api/faults')
                    .then(response => response.json())
                    .then(data => {
                        globalFaultsData = data;
                        updateFaultTypeChart(filterType);
                    })
                    .catch(error => {
                        console.error('è·å–æ•…éšœæ•°æ®å¤±è´¥:', error);
                        const mockFaults = generateMockFaultData();
                        globalFaultsData = mockFaults;
                        updateFaultTypeChart(filterType);
                    });
                return;
            }
            
            // æ ¹æ®ç­›é€‰ç±»å‹ç»Ÿè®¡æ•…éšœæ•°é‡
            const countData = {};
            const fieldNames = {
                'faultCategory': 'æ•…éšœåˆ†ç±»',
                'plant': 'å·¥å‚',
                'equipmentName': 'æ•…éšœè®¾å¤‡',
                'faultArea': 'æ•…éšœåŒºåŸŸ',
                'faultLevel': 'æ•…éšœç­‰çº§',
                'reporter': 'æŠ¥å‘Šäºº',
                'status': 'çŠ¶æ€'
            };
            
            globalFaultsData.forEach(fault => {
                const key = fault[filterType] || 'æœªçŸ¥';
                countData[key] = (countData[key] || 0) + 1;
            });
            
            const data = Object.keys(countData).map(name => ({
                name: name,
                value: countData[name]
            }));
            
            const option = {
                title: {
                    text: `æŒ‰${fieldNames[filterType]}åˆ†å¸ƒ`,
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} <br/>{b}: {c} ({d}%)'
                },
                legend: {
                    orient: 'vertical',
                    left: 'left',
                    data: data.map(item => item.name)
                },
                series: [
                    {
                        name: fieldNames[filterType],
                        type: 'pie',
                        radius: ['40%', '70%'],
                        avoidLabelOverlap: false,
                        itemStyle: {
                            borderRadius: 10,
                            borderColor: '#fff',
                            borderWidth: 2
                        },
                        label: {
                            show: false,
                            position: 'center'
                        },
                        emphasis: {
                            label: {
                                show: true,
                                fontSize: '18',
                                fontWeight: 'bold'
                            }
                        },
                        labelLine: {
                            show: false
                        },
                        data: data
                    }
                ]
            };
            
            myChart.setOption(option);
            
            // å“åº”å¼è°ƒæ•´
            window.addEventListener('resize', function() {
                myChart.resize();
            });
        }
        
        // åˆå§‹åŒ–è®¾å¤‡å’ŒåŒºåŸŸåˆ†å¸ƒå›¾è¡¨
        function initEquipmentAreaChart(faults) {
            const chartDom = document.getElementById('equipmentAreaChart');
            const myChart = echarts.init(chartDom);
            
            // é»˜è®¤æ˜¾ç¤ºæŒ‰è®¾å¤‡åˆ†å¸ƒ
            updateEquipmentAreaChart('æŒ‰è®¾å¤‡', faults, myChart);
            
            // å“åº”å¼è°ƒæ•´
            window.addEventListener('resize', function() {
                myChart.resize();
            });
        }
        
        // æ›´æ–°è®¾å¤‡å’ŒåŒºåŸŸåˆ†å¸ƒå›¾è¡¨
        function updateEquipmentAreaChart(type, faults, myChart) {
            if (!myChart) {
                const chartDom = document.getElementById('equipmentAreaChart');
                myChart = echarts.init(chartDom);
            }
            
            if (!faults) {
                // å¦‚æœæ²¡æœ‰ä¼ å…¥faultsæ•°æ®ï¼Œé‡æ–°è·å–
                fetch('https://study-llm.me/ws/api/faults')
                    .then(response => response.json())
                    .then(data => {
                        updateEquipmentAreaChart(type, data, myChart);
                    })
                    .catch(error => {
                        console.error('è·å–æ•…éšœæ•°æ®å¤±è´¥:', error);
                        const mockFaults = generateMockFaultData();
                        updateEquipmentAreaChart(type, mockFaults, myChart);
                    });
                return;
            }
            
            let data = [];
            let title = '';
            
            if (type === 'æŒ‰è®¾å¤‡') {
                // æŒ‰è®¾å¤‡ç»Ÿè®¡æ•…éšœæ•°é‡
                const equipmentCount = {};
                faults.forEach(fault => {
                    if (fault.equipmentName) {
                        equipmentCount[fault.equipmentName] = (equipmentCount[fault.equipmentName] || 0) + 1;
                    }
                });
                
                data = Object.keys(equipmentCount).map(name => ({
                    name: name,
                    value: equipmentCount[name]
                }));
                
                title = 'æ•…éšœè®¾å¤‡åˆ†å¸ƒ';
            } else {
                // æŒ‰åŒºåŸŸç»Ÿè®¡æ•…éšœæ•°é‡
                const areaCount = {};
                faults.forEach(fault => {
                    if (fault.faultArea) {
                        areaCount[fault.faultArea] = (areaCount[fault.faultArea] || 0) + 1;
                    }
                });
                
                data = Object.keys(areaCount).map(name => ({
                    name: name,
                    value: areaCount[name]
                }));
                
                title = 'æ•…éšœåŒºåŸŸåˆ†å¸ƒ';
            }
            
            const option = {
                title: {
                    text: title,
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} <br/>{b}: {c} ({d}%)'
                },
                legend: {
                    orient: 'vertical',
                    left: 'left',
                    data: data.map(item => item.name)
                },
                series: [
                    {
                        name: title,
                        type: 'pie',
                        radius: '50%',
                        center: ['60%', '50%'],
                        data: data,
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            };
            
            myChart.setOption(option);
        }
        
        // åˆå§‹åŒ–æ•…éšœç±»å‹åˆ†å¸ƒå›¾è¡¨
        function initFaultTypeChart(faults) {
            const chartDom = document.getElementById('faultTypeChart');
            const myChart = echarts.init(chartDom);
            
            // æŒ‰æ•…éšœç±»å‹ç»Ÿè®¡
            const categoryCount = {};
            faults.forEach(fault => {
                if (fault.faultCategory) {
                    categoryCount[fault.faultCategory] = (categoryCount[fault.faultCategory] || 0) + 1;
                }
            });
            
            const data = Object.keys(categoryCount).map(name => ({
                name: name,
                value: categoryCount[name]
            }));
            
            const option = {
                title: {
                    text: 'æ•…éšœåˆ†å¸ƒ',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} <br/>{b}: {c} ({d}%)'
                },
                legend: {
                    orient: 'vertical',
                    left: 'left',
                    data: data.map(item => item.name)
                },
                series: [
                    {
                        name: 'æ•…éšœç±»å‹',
                        type: 'pie',
                        radius: ['40%', '70%'],
                        avoidLabelOverlap: false,
                        itemStyle: {
                            borderRadius: 10,
                            borderColor: '#fff',
                            borderWidth: 2
                        },
                        label: {
                            show: false,
                            position: 'center'
                        },
                        emphasis: {
                            label: {
                                show: true,
                                fontSize: '18',
                                fontWeight: 'bold'
                            }
                        },
                        labelLine: {
                            show: false
                        },
                        data: data
                    }
                ]
            };
            
            myChart.setOption(option);
            
            // å“åº”å¼è°ƒæ•´
            window.addEventListener('resize', function() {
                myChart.resize();
            });
        }
        
        // åˆå§‹åŒ–è¶‹åŠ¿å›¾è¡¨
        function initTrendChart(faults) {
            globalFaultsData = faults; // å­˜å‚¨æ•°æ®ä¾›åç»­ä½¿ç”¨
            updateTrendChart('month'); // é»˜è®¤æŒ‰æœˆæ˜¾ç¤º
        }
        
        // æ›´æ–°è¶‹åŠ¿å›¾è¡¨
        function updateTrendChart(timeUnit) {
            const chartDom = document.getElementById('trendChart');
            const myChart = echarts.init(chartDom);
            
            if (!globalFaultsData || globalFaultsData.length === 0) {
                // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œé‡æ–°è·å–
                fetch('https://study-llm.me/ws/api/faults')
                    .then(response => response.json())
                    .then(data => {
                        globalFaultsData = data;
                        updateTrendChart(timeUnit);
                    })
                    .catch(error => {
                        console.error('è·å–æ•…éšœæ•°æ®å¤±è´¥:', error);
                        const mockFaults = generateMockFaultData();
                        globalFaultsData = mockFaults;
                        updateTrendChart(timeUnit);
                    });
                return;
            }
            
            // æŒ‰æ—¶é—´å•ä½ç»Ÿè®¡æ•…éšœæ•°é‡
            const countData = {};
            
            globalFaultsData.forEach(fault => {
                if (!fault.reportTime) return;
                
                const date = new Date(fault.reportTime);
                let key = '';
                
                if (timeUnit === 'month') {
                    // æŒ‰å¹´æœˆç»Ÿè®¡ï¼Œæ ¼å¼ï¼šYYYY-MM
                    key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                } else if (timeUnit === 'quarter') {
                    // æŒ‰å­£åº¦ç»Ÿè®¡ï¼Œæ ¼å¼ï¼šYYYY-QX
                    const quarter = Math.floor(date.getMonth() / 3) + 1;
                    key = `${date.getFullYear()}-Q${quarter}`;
                } else if (timeUnit === 'year') {
                    // æŒ‰å¹´ç»Ÿè®¡ï¼Œæ ¼å¼ï¼šYYYY
                    key = `${date.getFullYear()}`;
                }
                
                countData[key] = (countData[key] || 0) + 1;
            });
            
            // å¯¹æ—¶é—´å•ä½è¿›è¡Œæ’åº
            const sortedKeys = Object.keys(countData).sort();
            
            const data = sortedKeys.map(key => ({
                name: key,
                value: countData[key]
            }));
            
            const unitNames = {
                'month': 'æœˆ',
                'quarter': 'å­£åº¦',
                'year': 'å¹´'
            };
            
            const option = {
                title: {
                    text: `æŒ‰${unitNames[timeUnit]}ç»Ÿè®¡æ•…éšœæ•°é‡`,
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis',
                    formatter: '{b}: {c} ä¸ªæ•…éšœ'
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: true,
                    data: sortedKeys,
                    axisLabel: {
                        rotate: 45
                    }
                },
                yAxis: {
                    type: 'value',
                    name: 'æ•…éšœæ•°é‡'
                },
                series: [
                    {
                        name: 'æ•…éšœæ•°é‡',
                        type: 'bar',
                        data: sortedKeys.map(key => countData[key]),
                        itemStyle: {
                            color: '#3498db'
                        },
                        markPoint: {
                            data: [
                                { type: 'max', name: 'æœ€å¤§å€¼' },
                                { type: 'min', name: 'æœ€å°å€¼' }
                            ]
                        }
                    }
                ]
            };
            
            myChart.setOption(option);
            
            // å“åº”å¼è°ƒæ•´
            window.addEventListener('resize', function() {
                myChart.resize();
            });
        }
    </script>
</body>
</html>